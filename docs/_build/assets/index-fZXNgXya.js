const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/EChartsComponent-Dri_4RWG.js","assets/SJXContext-D9OqSdRv.js"])))=>i.map(i=>d[i]);
import{h as qt,G as Xi,s as af,H as yo,f as Ot,l as yh,t as sg,I as yl,w as jt,J as Sn,y as bt,z as og,A as Ht,K as ag,c as Ye,S as Pr,x as Li,L as Yt,M as lg,o as si,i as lp,a as vo,u as ho,d as Jc,P as x0,N as b0,O as cg,e as cp,Q as w0,R as C0,_ as S0}from"./SJXContext-D9OqSdRv.js";function I0(p,r={}){const[a,d]=qt();return!r.lazy&&lf(p,d),y=>{let S,x;const[,u]=Xi(y,["fallback"]);if(r.lazy&&lf(p,d),(S=a())&&!af.context)return S(u);const[O,V]=qt(!af.context);return yo(()=>V(!0)),Ot(()=>(S=a(),x=O(),yh(()=>S&&x?S(u):y.fallback)))}}function lf(p,r){p().then(a=>r(()=>a.default))}class vh extends Error{constructor(r,a){super(a),this.type=r}}class na extends vh{constructor(r,a){super("Configuration",r),this.node=a}}class T0 extends vh{constructor(r){super("PopoutBlocked",r)}}class E0 extends vh{constructor(r){super("API",r)}}class so extends vh{constructor(r){super("Bind",r)}}class xh extends Error{constructor(r,a,d){super(`${r}: ${a}${d===void 0?"":": "+d}`)}}class Lt extends xh{constructor(r,a){super("Assert",r,a)}}class ir extends xh{constructor(r,a,d){super("UnreachableCase",r,`${a}${d===void 0?"":": "+d}`)}}class di extends xh{constructor(r,a){super("UnexpectedNull",r,a)}}class _t extends xh{constructor(r,a){super("UnexpectedUndefined",r,a)}}var ch;(function(p){let r=!1;const a={PopoutCannotBeCreatedWithGroundItemConfig:{id:0,default:"Popout cannot be created with ground ItemConfig"},PleaseRegisterAConstructorFunction:{id:1,default:"Please register a constructor function"},ComponentTypeNotRegisteredAndBindComponentEventHandlerNotAssigned:{id:2,default:"Component type not registered and BindComponentEvent handler not assigned"},ComponentIsAlreadyRegistered:{id:3,default:"Component is already registered"},ComponentIsNotVirtuable:{id:4,default:"Component is not virtuable. Requires rootHtmlElement field/getter"},VirtualComponentDoesNotHaveRootHtmlElement:{id:5,default:'Virtual component does not have getter "rootHtmlElement"'},ItemConfigIsNotTypeComponent:{id:6,default:"ItemConfig is not of type component"},InvalidNumberPartInSizeString:{id:7,default:"Invalid number part in size string"},UnknownUnitInSizeString:{id:8,default:"Unknown unit in size string"},UnsupportedUnitInSizeString:{id:9,default:"Unsupported unit in size string"}};p.idCount=Object.keys(a).length;const d=Object.values(a);function y(){if(!r)for(let S=0;S<p.idCount;S++){const x=d[S];if(x.id!==S)throw new Lt("INSI00110",`${S}: ${x.id}`);Ln[S]=x.default}r=!0}p.checkInitialise=y})(ch||(ch={}));const Ln=new Array(ch.idCount);var Oc;(function(p){p.defaultComponentBaseZIndex="auto",p.defaultComponentDragZIndex="32",p.defaultComponentStackMaximisedZIndex="41"})(Oc||(Oc={}));var uh;(function(p){p.width="width",p.height="height"})(uh||(uh={}));var po;(function(p){p.top="top",p.left="left",p.right="right",p.bottom="bottom"})(po||(po={}));var Nc;(function(p){p.base="base",p.drag="drag",p.stackMaximised="stackMaximised"})(Nc||(Nc={}));const P0={base:Oc.defaultComponentBaseZIndex,drag:Oc.defaultComponentDragZIndex,stackMaximised:Oc.defaultComponentStackMaximisedZIndex};var Kd;(function(p){function r(d){return a(d)}p.isJson=r;function a(d){return!Array.isArray(d)&&d!==null&&typeof d=="object"}p.isJsonObject=a})(Kd||(Kd={}));var Te;(function(p){p.ground="ground",p.row="row",p.column="column",p.stack="stack",p.component="component"})(Te||(Te={}));var $c;(function(p){p.none="none",p.always="always",p.onload="onload"})($c||($c={}));var Nt;(function(p){p.Pixel="px",p.Percent="%",p.Fractional="fr",p.Em="em"})(Nt||(Nt={}));(function(p){function r(d){switch(d){case p.Pixel:return p.Pixel;case p.Percent:return p.Percent;case p.Fractional:return p.Fractional;case p.Em:return p.Em;default:return}}p.tryParse=r;function a(d){switch(d){case p.Pixel:return p.Pixel;case p.Percent:return p.Percent;case p.Fractional:return p.Fractional;case p.Em:return p.Em;default:throw new ir("SUEF44998",d)}}p.format=a})(Nt||(Nt={}));function Rt(p){return p.toString(10)+"px"}function ll(p){const r=p.replace("px","");return parseFloat(r)}function M0(p){p=p.trimStart();const r=p.length;if(r===0)return{numericPart:"",firstNonNumericCharPart:""};{let a=r,d=!1;for(let x=0;x<r;x++){const u=p[x];if(!k0(u))if(u!=="."){a=x;break}else if(d){a=x;break}else d=!0}const y=p.substring(0,a),S=p.substring(a).trim();return{numericPart:y,firstNonNumericCharPart:S}}}function k0(p){return p>="0"&&p<="9"}function A0(p){return p.offsetWidth}function er(p,r){const a=Rt(r);p.style.width=a}function z0(p){return p.offsetHeight}function tr(p,r){const a=Rt(r);p.style.height=a}function ao(p){return{width:p.offsetWidth,height:p.offsetHeight}}function lo(p,r){r?p.style.display="":p.style.display="none"}function D0(p){const r="absolute";p.style.position!==r&&(p.style.position=r)}function ea(p,r){if(r!==void 0){for(const a in r)if(r.hasOwnProperty(a)){const d=r[a],y=p[a];p[a]=hl(y,d)}}return p}function hl(p,r){if(typeof r!="object")return r;if(Array.isArray(r)){const a=r.length,d=new Array(a);for(let y=0;y<a;y++){const S=r[y];d[y]=hl({},S)}return d}else{if(r===null)return null;{const a=r;return p===void 0?ea({},a):typeof p!="object"?ea({},a):Array.isArray(p)?ea({},a):ea(p===null?{}:p,a)}}}function L0(p,r){const a=r.indexOf(p);if(a===-1)throw new Error("Can't remove item from array. Item is not in the array");r.splice(a,1)}function ug(){return(Math.random()*1e15).toString(36).replace(".","")}function R0(p){return p instanceof Error?p.message:typeof p=="string"?p:"Unknown Error"}var jc;(function(p){const r=["settings","hasHeaders","constrainDragToContainer","selectionEnabled","dimensions","borderWidth","minItemHeight","minItemWidth","headerHeight","dragProxyWidth","dragProxyHeight","labels","close","maximise","minimise","popout","content","componentType","componentState","id","width","type","height","isClosable","title","popoutWholeStack","openPopouts","parentId","activeItemIndex","reorderEnabled","borderGrabWidth"],a=[!0,!1,"row","column","stack","component","close","maximise","minimise","open in new window"];function d(){if(r.length>36)throw new Error("Too many keys in config minifier map")}p.checkInitialise=d;function y(oe,ie){const pe={};for(const ve in oe)if(oe.hasOwnProperty(ve)){let Ce;ie?Ce=u(ve):Ce=O(ve);const je=oe[ve];pe[Ce]=x(je,ie)}return pe}p.translateObject=y;function S(oe,ie){const pe=oe.length,ve=new Array(pe);for(let Ce=0;Ce<pe;Ce++){const je=oe[Ce];ve[Ce]=x(je,ie)}return ve}function x(oe,ie){return typeof oe=="object"?oe===null?null:Array.isArray(oe)?S(oe,ie):y(oe,ie):ie?V(oe):W(oe)}function u(oe){if(typeof oe=="string"&&oe.length===1)return"___"+oe;const ie=q(oe);return ie===-1?oe:ie.toString(36)}function O(oe){return oe.length===1?r[parseInt(oe,36)]:oe.substr(0,3)==="___"?oe[3]:oe}function V(oe){if(typeof oe=="string"&&oe.length===1)return"___"+oe;const ie=F(oe);return ie===-1?oe:ie.toString(36)}function W(oe){return typeof oe=="string"&&oe.length===1?a[parseInt(oe,36)]:typeof oe=="string"&&oe.substr(0,3)==="___"?oe[3]:oe}function q(oe){for(let ie=0;ie<r.length;ie++)if(r[ie]===oe)return ie;return-1}function F(oe){for(let ie=0;ie<a.length;ie++)if(a[ie]===oe)return ie;return-1}})(jc||(jc={}));var Tt;(function(p){p.defaults={type:Te.ground,content:[],size:1,sizeUnit:Nt.Fractional,minSize:void 0,minSizeUnit:Nt.Pixel,id:"",isClosable:!0};function r(x,u){switch(x.type){case Te.ground:case Te.row:case Te.column:return dl.createCopy(x,u);case Te.stack:return _s.createCopy(x,u);case Te.component:return ys.createCopy(x);default:throw new ir("CICC91354",x.type,"Invalid Config Item type specified")}}p.createCopy=r;function a(x){switch(x){case Te.ground:throw new Lt("CICCDR91562");case Te.row:case Te.column:return dl.createDefault(x);case Te.stack:return _s.createDefault();case Te.component:return ys.createDefault();default:throw new ir("CICCDD91563",x,"Invalid Config Item type specified")}}p.createDefault=a;function d(x){return x.type===Te.component}p.isComponentItem=d;function y(x){return x.type===Te.stack}p.isStackItem=y;function S(x){return x.type===Te.ground}p.isGroundItem=S})(Tt||(Tt={}));var _r;(function(p){p.defaultMaximised=!1,function(r){function a(d,y){if(d!==void 0)return{show:y??d.show,popout:d.popout,close:d.close,maximise:d.maximise,minimise:d.minimise,tabDropdown:d.tabDropdown}}r.createCopy=a}(p.Header||(p.Header={}))})(_r||(_r={}));var _s;(function(p){p.defaultActiveItemIndex=0;function r(y,S){return{type:y.type,content:a(S!==void 0?S:y.content),size:y.size,sizeUnit:y.sizeUnit,minSize:y.minSize,minSizeUnit:y.minSizeUnit,id:y.id,maximised:y.maximised,isClosable:y.isClosable,activeItemIndex:y.activeItemIndex,header:_r.Header.createCopy(y.header)}}p.createCopy=r;function a(y){const S=y.length,x=new Array(S);for(let u=0;u<S;u++)x[u]=Tt.createCopy(y[u]);return x}p.copyContent=a;function d(){return{type:Te.stack,content:[],size:Tt.defaults.size,sizeUnit:Tt.defaults.sizeUnit,minSize:Tt.defaults.minSize,minSizeUnit:Tt.defaults.minSizeUnit,id:Tt.defaults.id,maximised:_r.defaultMaximised,isClosable:Tt.defaults.isClosable,activeItemIndex:p.defaultActiveItemIndex,header:void 0}}p.createDefault=d})(_s||(_s={}));var ys;(function(p){p.defaultReorderEnabled=!0;function r(S){const x=S.componentType;if(typeof x=="string")return x}p.resolveComponentTypeName=r;function a(S){return{type:S.type,content:[],size:S.size,sizeUnit:S.sizeUnit,minSize:S.minSize,minSizeUnit:S.minSizeUnit,id:S.id,maximised:S.maximised,isClosable:S.isClosable,reorderEnabled:S.reorderEnabled,title:S.title,header:_r.Header.createCopy(S.header),componentType:S.componentType,componentState:hl(void 0,S.componentState)}}p.createCopy=a;function d(S="",x,u=""){return{type:Te.component,content:[],size:Tt.defaults.size,sizeUnit:Tt.defaults.sizeUnit,minSize:Tt.defaults.minSize,minSizeUnit:Tt.defaults.minSizeUnit,id:Tt.defaults.id,maximised:_r.defaultMaximised,isClosable:Tt.defaults.isClosable,reorderEnabled:p.defaultReorderEnabled,title:u,header:void 0,componentType:S,componentState:x}}p.createDefault=d;function y(S){return hl({},S)}p.copyComponentType=y})(ys||(ys={}));var dl;(function(p){function r(S){switch(S.type){case Te.row:case Te.column:case Te.stack:case Te.component:return!0;case Te.ground:return!1;default:throw new ir("CROCOSPCICIC13687",S.type)}}p.isChildItemConfig=r;function a(S,x){return{type:S.type,content:d(x!==void 0?x:S.content),size:S.size,sizeUnit:S.sizeUnit,minSize:S.minSize,minSizeUnit:S.minSizeUnit,id:S.id,isClosable:S.isClosable}}p.createCopy=a;function d(S){const x=S.length,u=new Array(x);for(let O=0;O<x;O++)u[O]=Tt.createCopy(S[O]);return u}p.copyContent=d;function y(S){return{type:S,content:[],size:Tt.defaults.size,sizeUnit:Tt.defaults.sizeUnit,minSize:Tt.defaults.minSize,minSizeUnit:Tt.defaults.minSizeUnit,id:Tt.defaults.id,isClosable:Tt.defaults.isClosable}}p.createDefault=y})(dl||(dl={}));var oa;(function(p){function r(d){return Tt.createCopy(d)}p.createCopy=r;function a(d){switch(d.type){case Te.row:case Te.column:case Te.stack:case Te.component:return!0;case Te.ground:return!1;default:throw new ir("CROCOSPCICIC13687",d.type)}}p.isRootItemConfig=a})(oa||(oa={}));var Jd;(function(p){function r(a){const d=a===void 0?[]:[a];return{type:Te.ground,content:d,size:100,sizeUnit:Nt.Percent,minSize:0,minSizeUnit:Nt.Pixel,id:"",isClosable:!1,title:"",reorderEnabled:!1}}p.create=r})(Jd||(Jd={}));var mt;(function(p){(function(u){u.defaults={constrainDragToContainer:!0,reorderEnabled:!0,popoutWholeStack:!1,blockedPopoutsThrowError:!0,closePopoutsOnUnload:!0,responsiveMode:$c.none,tabOverlapAllowance:0,reorderOnTabMenuClick:!0,tabControlOffset:10,popInOnClose:!1};function O(V){return{constrainDragToContainer:V.constrainDragToContainer,reorderEnabled:V.reorderEnabled,popoutWholeStack:V.popoutWholeStack,blockedPopoutsThrowError:V.blockedPopoutsThrowError,closePopoutsOnUnload:V.closePopoutsOnUnload,responsiveMode:V.responsiveMode,tabOverlapAllowance:V.tabOverlapAllowance,reorderOnTabMenuClick:V.reorderOnTabMenuClick,tabControlOffset:V.tabControlOffset,popInOnClose:V.popInOnClose}}u.createCopy=O})(p.Settings||(p.Settings={})),function(u){function O(V){return{borderWidth:V.borderWidth,borderGrabWidth:V.borderGrabWidth,defaultMinItemHeight:V.defaultMinItemHeight,defaultMinItemHeightUnit:V.defaultMinItemHeightUnit,defaultMinItemWidth:V.defaultMinItemWidth,defaultMinItemWidthUnit:V.defaultMinItemWidthUnit,headerHeight:V.headerHeight,dragProxyWidth:V.dragProxyWidth,dragProxyHeight:V.dragProxyHeight}}u.createCopy=O,u.defaults={borderWidth:5,borderGrabWidth:5,defaultMinItemHeight:0,defaultMinItemHeightUnit:Nt.Pixel,defaultMinItemWidth:10,defaultMinItemWidthUnit:Nt.Pixel,headerHeight:20,dragProxyWidth:300,dragProxyHeight:200}}(p.Dimensions||(p.Dimensions={})),function(u){function O(V){return{show:V.show,popout:V.popout,dock:V.dock,close:V.close,maximise:V.maximise,minimise:V.minimise,tabDropdown:V.tabDropdown}}u.createCopy=O,u.defaults={show:po.top,popout:"open in new window",dock:"dock",maximise:"maximise",minimise:"minimise",close:"close",tabDropdown:"additional tabs"}}(p.Header||(p.Header={}));function r(u){return"parentId"in u}p.isPopout=r;function a(){return{root:void 0,openPopouts:[],dimensions:p.Dimensions.defaults,settings:p.Settings.defaults,header:p.Header.defaults,resolved:!0}}p.createDefault=a;function d(u){return r(u)?qc.createCopy(u):{root:u.root===void 0?void 0:oa.createCopy(u.root),openPopouts:p.copyOpenPopouts(u.openPopouts),settings:p.Settings.createCopy(u.settings),dimensions:p.Dimensions.createCopy(u.dimensions),header:p.Header.createCopy(u.header),resolved:u.resolved}}p.createCopy=d;function y(u){const O=u.length,V=new Array(O);for(let W=0;W<O;W++)V[W]=qc.createCopy(u[W]);return V}p.copyOpenPopouts=y;function S(u){return jc.translateObject(u,!0)}p.minifyConfig=S;function x(u){return jc.translateObject(u,!1)}p.unminifyConfig=x})(mt||(mt={}));var qc;(function(p){(function(a){function d(y){return{width:y.width,height:y.height,left:y.left,top:y.top}}a.createCopy=d,a.defaults={width:null,height:null,left:null,top:null}})(p.Window||(p.Window={}));function r(a){return{root:a.root===void 0?void 0:oa.createCopy(a.root),openPopouts:mt.copyOpenPopouts(a.openPopouts),settings:mt.Settings.createCopy(a.settings),dimensions:mt.Dimensions.createCopy(a.dimensions),header:mt.Header.createCopy(a.header),parentId:a.parentId,indexInParent:a.indexInParent,window:p.Window.createCopy(a.window),resolved:a.resolved}}p.createCopy=r})(qc||(qc={}));var Ci;(function(p){function r(F,oe){switch(F.type){case Te.ground:throw new na("ItemConfig cannot specify type ground",JSON.stringify(F));case Te.row:case Te.column:return hh.resolve(F,oe);case Te.stack:return Hc.resolve(F,oe);case Te.component:return mo.resolve(F,oe);default:throw new ir("UCUICR55499",F.type)}}p.resolve=r;function a(F){if(F===void 0)return[];{const oe=F.length,ie=new Array(oe);for(let pe=0;pe<oe;pe++)ie[pe]=p.resolve(F[pe],!1);return ie}}p.resolveContent=a;function d(F){return F===void 0?Tt.defaults.id:Array.isArray(F)?F.length===0?Tt.defaults.id:F[0]:F}p.resolveId=d;function y(F,oe,ie,pe){if(F!==void 0)return dh(F,[Nt.Percent,Nt.Fractional]);if(oe!==void 0||ie!==void 0){if(oe!==void 0)return{size:oe,sizeUnit:Nt.Percent};if(ie!==void 0)return{size:ie,sizeUnit:Nt.Percent};throw new _t("CRS33390")}else return pe?{size:50,sizeUnit:Nt.Percent}:{size:Tt.defaults.size,sizeUnit:Tt.defaults.sizeUnit}}p.resolveSize=y;function S(F,oe,ie){if(F!==void 0)return dh(F,[Nt.Pixel]);{const pe=oe!==void 0;return pe||ie!==void 0?pe?{size:oe,sizeUnit:Nt.Pixel}:{size:ie,sizeUnit:Nt.Pixel}:{size:Tt.defaults.minSize,sizeUnit:Tt.defaults.minSizeUnit}}}p.resolveMinSize=S;function x(F){return F.size!==void 0?1:F.width!==void 0||F.height!==void 0?2:0}p.calculateSizeWidthHeightSpecificationType=x;function u(F){return F.type===Te.ground}p.isGround=u;function O(F){return F.type===Te.row}p.isRow=O;function V(F){return F.type===Te.column}p.isColumn=V;function W(F){return F.type===Te.stack}p.isStack=W;function q(F){return F.type===Te.component}p.isComponent=q})(Ci||(Ci={}));var pl;(function(p){const r="__glMaximised";(function(d){function y(S,x){var u;if(!(S===void 0&&x===void 0))return{show:(u=S?.show)!==null&&u!==void 0?u:x===void 0?void 0:x?mt.Header.defaults.show:!1,popout:S?.popout,maximise:S?.maximise,close:S?.close,minimise:S?.minimise,tabDropdown:S?.tabDropdown}}d.resolve=y})(p.Header||(p.Header={}));function a(d){let y,S=d.id,x=!1;if(S===void 0)y=Tt.defaults.id;else if(Array.isArray(S)){const O=S.findIndex(V=>V===r);O>0&&(x=!0,S=S.splice(O,1)),S.length>0?y=S[0]:y=Tt.defaults.id}else y=S;let u;return d.maximised!==void 0?u=d.maximised:u=x,{id:y,maximised:u}}p.resolveIdAndMaximised=a})(pl||(pl={}));var Hc;(function(p){function r(S,x){var u,O;const{id:V,maximised:W}=pl.resolveIdAndMaximised(S),{size:q,sizeUnit:F}=Ci.resolveSize(S.size,S.width,S.height,x),{size:oe,sizeUnit:ie}=Ci.resolveMinSize(S.minSize,S.minWidth,S.minHeight);return{type:Te.stack,content:d(S.content),size:q,sizeUnit:F,minSize:oe,minSizeUnit:ie,id:V,maximised:W,isClosable:(u=S.isClosable)!==null&&u!==void 0?u:Tt.defaults.isClosable,activeItemIndex:(O=S.activeItemIndex)!==null&&O!==void 0?O:_s.defaultActiveItemIndex,header:pl.Header.resolve(S.header,S.hasHeaders)}}p.resolve=r;function a(S){return{type:Te.stack,content:y(S.content),size:Wc(S.size,S.sizeUnit),minSize:up(S.minSize,S.minSizeUnit),id:S.id,maximised:S.maximised,isClosable:S.isClosable,activeItemIndex:S.activeItemIndex,header:_r.Header.createCopy(S.header)}}p.fromResolved=a;function d(S){if(S===void 0)return[];{const x=S.length,u=new Array(x);for(let O=0;O<x;O++){const V=S[O],W=Ci.resolve(V,!1);if(Tt.isComponentItem(W))u[O]=W;else throw new Lt("UCUSICRC91114",JSON.stringify(W))}return u}}function y(S){const x=S.length,u=new Array(x);for(let O=0;O<x;O++){const V=S[O];u[O]=mo.fromResolved(V)}return u}})(Hc||(Hc={}));var mo;(function(p){function r(y,S){var x,u,O;let V=y.componentType;if(V===void 0&&(V=y.componentName),V===void 0)throw new Error("ComponentItemConfig.componentType is undefined");{const{id:W,maximised:q}=pl.resolveIdAndMaximised(y);let F;y.title===void 0||y.title===""?F=p.componentTypeToTitle(V):F=y.title;const{size:oe,sizeUnit:ie}=Ci.resolveSize(y.size,y.width,y.height,S),{size:pe,sizeUnit:ve}=Ci.resolveMinSize(y.minSize,y.minWidth,y.minHeight);return{type:y.type,content:[],size:oe,sizeUnit:ie,minSize:pe,minSizeUnit:ve,id:W,maximised:q,isClosable:(x=y.isClosable)!==null&&x!==void 0?x:Tt.defaults.isClosable,reorderEnabled:(u=y.reorderEnabled)!==null&&u!==void 0?u:ys.defaultReorderEnabled,title:F,header:pl.Header.resolve(y.header,y.hasHeaders),componentType:V,componentState:(O=y.componentState)!==null&&O!==void 0?O:{}}}}p.resolve=r;function a(y){return{type:Te.component,size:Wc(y.size,y.sizeUnit),minSize:up(y.minSize,y.minSizeUnit),id:y.id,maximised:y.maximised,isClosable:y.isClosable,reorderEnabled:y.reorderEnabled,title:y.title,header:_r.Header.createCopy(y.header),componentType:y.componentType,componentState:hl(void 0,y.componentState)}}p.fromResolved=a;function d(y){switch(typeof y){case"string":return y;case"number":return y.toString();case"boolean":return y.toString();default:return""}}p.componentTypeToTitle=d})(mo||(mo={}));var hh;(function(p){function r(x){switch(x.type){case Te.row:case Te.column:case Te.stack:case Te.component:return!0;case Te.ground:return!1;default:throw new ir("UROCOSPCICIC13687",x.type)}}p.isChildItemConfig=r;function a(x,u){var O;const{size:V,sizeUnit:W}=Ci.resolveSize(x.size,x.width,x.height,u),{size:q,sizeUnit:F}=Ci.resolveMinSize(x.minSize,x.minWidth,x.minHeight);return{type:x.type,content:p.resolveContent(x.content),size:V,sizeUnit:W,minSize:q,minSizeUnit:F,id:Ci.resolveId(x.id),isClosable:(O=x.isClosable)!==null&&O!==void 0?O:Tt.defaults.isClosable}}p.resolve=a;function d(x){return{type:x.type,content:S(x.content),size:Wc(x.size,x.sizeUnit),minSize:up(x.minSize,x.minSizeUnit),id:x.id,isClosable:x.isClosable}}p.fromResolved=d;function y(x){if(x===void 0)return[];{const u=x.length,O=new Array(u);let V=!1,W=!1;for(let oe=0;oe<u;oe++){const ie=x[oe];if(p.isChildItemConfig(ie)){if(!W){const pe=Ci.calculateSizeWidthHeightSpecificationType(ie);switch(pe){case 0:break;case 2:V=!0;break;case 1:W=!0;break;default:throw new ir("ROCICRC87556",pe)}}O[oe]=ie}else throw new na("ItemConfig is not Row, Column or Stack",ie)}let q;W?q=!1:V?q=!0:q=!1;const F=new Array(u);for(let oe=0;oe<u;oe++){const ie=O[oe],pe=Ci.resolve(ie,q);if(dl.isChildItemConfig(pe))F[oe]=pe;else throw new Lt("UROCOSPIC99512",JSON.stringify(pe))}return F}}p.resolveContent=y;function S(x){const u=x.length,O=new Array(u);for(let V=0;V<u;V++){const W=x[V],q=W.type;let F;switch(q){case Te.row:case Te.column:F=p.fromResolved(W);break;case Te.stack:F=Hc.fromResolved(W);break;case Te.component:F=mo.fromResolved(W);break;default:throw new ir("ROCICFRC44797",q)}O[V]=F}return O}})(hh||(hh={}));var ml;(function(p){function r(y){switch(y.type){case Te.row:case Te.column:case Te.stack:case Te.component:return!0;case Te.ground:return!1;default:throw new ir("URICIR23687",y.type)}}p.isRootItemConfig=r;function a(y){if(y!==void 0){const S=Ci.resolve(y,!1);if(oa.isRootItemConfig(S))return S;throw new na("ItemConfig is not Row, Column or Stack",JSON.stringify(y))}}p.resolve=a;function d(y){if(y!==void 0){const S=y.type;switch(S){case Te.row:case Te.column:return hh.fromResolved(y);case Te.stack:return Hc.fromResolved(y);case Te.component:return mo.fromResolved(y);default:throw new ir("RICFROU89921",S)}}}p.fromResolvedOrUndefined=d})(ml||(ml={}));var Qn;(function(p){(function(x){function u(O){var V,W,q,F,oe,ie,pe,ve,Ce,je;return{constrainDragToContainer:(V=O?.constrainDragToContainer)!==null&&V!==void 0?V:mt.Settings.defaults.constrainDragToContainer,reorderEnabled:(W=O?.reorderEnabled)!==null&&W!==void 0?W:mt.Settings.defaults.reorderEnabled,popoutWholeStack:(q=O?.popoutWholeStack)!==null&&q!==void 0?q:mt.Settings.defaults.popoutWholeStack,blockedPopoutsThrowError:(F=O?.blockedPopoutsThrowError)!==null&&F!==void 0?F:mt.Settings.defaults.blockedPopoutsThrowError,closePopoutsOnUnload:(oe=O?.closePopoutsOnUnload)!==null&&oe!==void 0?oe:mt.Settings.defaults.closePopoutsOnUnload,responsiveMode:(ie=O?.responsiveMode)!==null&&ie!==void 0?ie:mt.Settings.defaults.responsiveMode,tabOverlapAllowance:(pe=O?.tabOverlapAllowance)!==null&&pe!==void 0?pe:mt.Settings.defaults.tabOverlapAllowance,reorderOnTabMenuClick:(ve=O?.reorderOnTabMenuClick)!==null&&ve!==void 0?ve:mt.Settings.defaults.reorderOnTabMenuClick,tabControlOffset:(Ce=O?.tabControlOffset)!==null&&Ce!==void 0?Ce:mt.Settings.defaults.tabControlOffset,popInOnClose:(je=O?.popInOnClose)!==null&&je!==void 0?je:mt.Settings.defaults.popInOnClose}}x.resolve=u})(p.Settings||(p.Settings={})),function(x){function u(q){var F,oe,ie,pe,ve;const{size:Ce,sizeUnit:je}=x.resolveDefaultMinItemHeight(q),{size:st,sizeUnit:Qe}=x.resolveDefaultMinItemWidth(q);return{borderWidth:(F=q?.borderWidth)!==null&&F!==void 0?F:mt.Dimensions.defaults.borderWidth,borderGrabWidth:(oe=q?.borderGrabWidth)!==null&&oe!==void 0?oe:mt.Dimensions.defaults.borderGrabWidth,defaultMinItemHeight:Ce,defaultMinItemHeightUnit:je,defaultMinItemWidth:st,defaultMinItemWidthUnit:Qe,headerHeight:(ie=q?.headerHeight)!==null&&ie!==void 0?ie:mt.Dimensions.defaults.headerHeight,dragProxyWidth:(pe=q?.dragProxyWidth)!==null&&pe!==void 0?pe:mt.Dimensions.defaults.dragProxyWidth,dragProxyHeight:(ve=q?.dragProxyHeight)!==null&&ve!==void 0?ve:mt.Dimensions.defaults.dragProxyHeight}}x.resolve=u;function O(q){return{borderWidth:q.borderWidth,borderGrabWidth:q.borderGrabWidth,defaultMinItemHeight:Wc(q.defaultMinItemHeight,q.defaultMinItemHeightUnit),defaultMinItemWidth:Wc(q.defaultMinItemWidth,q.defaultMinItemWidthUnit),headerHeight:q.headerHeight,dragProxyWidth:q.dragProxyWidth,dragProxyHeight:q.dragProxyHeight}}x.fromResolved=O;function V(q){const F=q?.defaultMinItemHeight;return F===void 0?{size:mt.Dimensions.defaults.defaultMinItemHeight,sizeUnit:mt.Dimensions.defaults.defaultMinItemHeightUnit}:dh(F,[Nt.Pixel])}x.resolveDefaultMinItemHeight=V;function W(q){const F=q?.defaultMinItemWidth;return F===void 0?{size:mt.Dimensions.defaults.defaultMinItemWidth,sizeUnit:mt.Dimensions.defaults.defaultMinItemWidthUnit}:dh(F,[Nt.Pixel])}x.resolveDefaultMinItemWidth=W}(p.Dimensions||(p.Dimensions={})),function(x){function u(O,V,W){var q,F,oe,ie,pe,ve,Ce,je,st,Qe,qe,ct;let We;return O?.show!==void 0?We=O.show:V!==void 0&&V.hasHeaders!==void 0?We=V.hasHeaders?mt.Header.defaults.show:!1:We=mt.Header.defaults.show,{show:We,popout:(F=(q=O?.popout)!==null&&q!==void 0?q:W?.popout)!==null&&F!==void 0?F:V?.showPopoutIcon===!1?!1:mt.Header.defaults.popout,dock:(ie=(oe=O?.popin)!==null&&oe!==void 0?oe:W?.popin)!==null&&ie!==void 0?ie:mt.Header.defaults.dock,maximise:(ve=(pe=O?.maximise)!==null&&pe!==void 0?pe:W?.maximise)!==null&&ve!==void 0?ve:V?.showMaximiseIcon===!1?!1:mt.Header.defaults.maximise,close:(je=(Ce=O?.close)!==null&&Ce!==void 0?Ce:W?.close)!==null&&je!==void 0?je:V?.showCloseIcon===!1?!1:mt.Header.defaults.close,minimise:(Qe=(st=O?.minimise)!==null&&st!==void 0?st:W?.minimise)!==null&&Qe!==void 0?Qe:mt.Header.defaults.minimise,tabDropdown:(ct=(qe=O?.tabDropdown)!==null&&qe!==void 0?qe:W?.tabDropdown)!==null&&ct!==void 0?ct:mt.Header.defaults.tabDropdown}}x.resolve=u}(p.Header||(p.Header={}));function r(x){return"parentId"in x||"indexInParent"in x||"window"in x}p.isPopout=r;function a(x){if(r(x))return Vc.resolve(x);{let u;return x.root!==void 0?u=x.root:x.content!==void 0&&x.content.length>0?u=x.content[0]:u=void 0,{resolved:!0,root:ml.resolve(u),openPopouts:p.resolveOpenPopouts(x.openPopouts),dimensions:p.Dimensions.resolve(x.dimensions),settings:p.Settings.resolve(x.settings),header:p.Header.resolve(x.header,x.settings,x.labels)}}}p.resolve=a;function d(x){return{root:ml.fromResolvedOrUndefined(x.root),openPopouts:Vc.fromResolvedArray(x.openPopouts),settings:mt.Settings.createCopy(x.settings),dimensions:p.Dimensions.fromResolved(x.dimensions),header:mt.Header.createCopy(x.header)}}p.fromResolved=d;function y(x){const u=x;return u.resolved!==void 0&&u.resolved===!0}p.isResolved=y;function S(x){if(x===void 0)return[];{const u=x.length,O=new Array(u);for(let V=0;V<u;V++)O[V]=Vc.resolve(x[V]);return O}}p.resolveOpenPopouts=S})(Qn||(Qn={}));var Vc;(function(p){(function(y){function S(u,O){var V,W,q,F,oe,ie,pe,ve;let Ce;const je=qc.Window.defaults;return u!==void 0?Ce={width:(V=u.width)!==null&&V!==void 0?V:je.width,height:(W=u.height)!==null&&W!==void 0?W:je.height,left:(q=u.left)!==null&&q!==void 0?q:je.left,top:(F=u.top)!==null&&F!==void 0?F:je.top}:Ce={width:(oe=O?.width)!==null&&oe!==void 0?oe:je.width,height:(ie=O?.height)!==null&&ie!==void 0?ie:je.height,left:(pe=O?.left)!==null&&pe!==void 0?pe:je.left,top:(ve=O?.top)!==null&&ve!==void 0?ve:je.top},Ce}y.resolve=S;function x(u){return{width:u.width===null?void 0:u.width,height:u.height===null?void 0:u.height,left:u.left===null?void 0:u.left,top:u.top===null?void 0:u.top}}y.fromResolved=x})(p.Window||(p.Window={}));function r(y){var S,x;let u;return y.root!==void 0?u=y.root:y.content!==void 0&&y.content.length>0?u=y.content[0]:u=void 0,{root:ml.resolve(u),openPopouts:Qn.resolveOpenPopouts(y.openPopouts),dimensions:Qn.Dimensions.resolve(y.dimensions),settings:Qn.Settings.resolve(y.settings),header:Qn.Header.resolve(y.header,y.settings,y.labels),parentId:(S=y.parentId)!==null&&S!==void 0?S:null,indexInParent:(x=y.indexInParent)!==null&&x!==void 0?x:null,window:p.Window.resolve(y.window,y.dimensions),resolved:!0}}p.resolve=r;function a(y){return{root:ml.fromResolvedOrUndefined(y.root),openPopouts:d(y.openPopouts),dimensions:Qn.Dimensions.fromResolved(y.dimensions),settings:mt.Settings.createCopy(y.settings),header:mt.Header.createCopy(y.header),parentId:y.parentId,indexInParent:y.indexInParent,window:p.Window.fromResolved(y.window)}}p.fromResolved=a;function d(y){const S=y.length,x=new Array(S);for(let u=0;u<S;u++){const O=y[u];x[u]=p.fromResolved(O)}return x}p.fromResolvedArray=d})(Vc||(Vc={}));function dh(p,r){const{numericPart:a,firstNonNumericCharPart:d}=M0(p),y=Number.parseInt(a,10);if(isNaN(y))throw new na(`${Ln[7]}: ${p}`);{const S=Nt.tryParse(d);if(S===void 0)throw new na(`${Ln[8]}: ${p}`);if(r.includes(S))return{size:y,sizeUnit:S};throw new na(`${Ln[9]}: ${p}`)}}function Wc(p,r){return p.toString(10)+Nt.format(r)}function up(p,r){if(p!==void 0)return p.toString(10)+Nt.format(r)}class Ti{constructor(){this._allEventSubscriptions=[],this._subscriptionsMap=new Map,this.unbind=this.removeEventListener,this.trigger=this.emit}tryBubbleEvent(r,a){}emit(r,...a){let d=this._subscriptionsMap.get(r);if(d!==void 0){d=d.slice();for(let y=0;y<d.length;y++){const S=d[y];S(...a)}}this.emitAllEvent(r,a),this.tryBubbleEvent(r,a)}emitUnknown(r,...a){let d=this._subscriptionsMap.get(r);if(d!==void 0){d=d.slice();for(let y=0;y<d.length;y++)d[y](...a)}this.emitAllEvent(r,a),this.tryBubbleEvent(r,a)}emitBaseBubblingEvent(r){const a=new Ti.BubblingEvent(r,this);this.emitUnknown(r,a)}emitUnknownBubblingEvent(r){const a=new Ti.BubblingEvent(r,this);this.emitUnknown(r,a)}removeEventListener(r,a){const d=a;this.removeUnknownEventListener(r,d)}off(r,a){this.removeEventListener(r,a)}addEventListener(r,a){const d=a;this.addUnknownEventListener(r,d)}on(r,a){this.addEventListener(r,a)}addUnknownEventListener(r,a){if(r===Ti.ALL_EVENT)this._allEventSubscriptions.push(a);else{let d=this._subscriptionsMap.get(r);d!==void 0?d.push(a):(d=[a],this._subscriptionsMap.set(r,d))}}removeUnknownEventListener(r,a){if(r===Ti.ALL_EVENT)this.removeSubscription(r,this._allEventSubscriptions,a);else{const d=this._subscriptionsMap.get(r);if(d===void 0)throw new Error("No subscribtions to unsubscribe for event "+r);this.removeSubscription(r,d,a)}}removeSubscription(r,a,d){const y=a.indexOf(d);if(y<0)throw new Error("Nothing to unbind for "+r);a.splice(y,1)}emitAllEvent(r,a){const d=this._allEventSubscriptions.length;if(d>0){const y=a.slice();y.unshift(r);const S=this._allEventSubscriptions.slice();for(let x=0;x<d;x++)S[x](...y)}}}(function(p){p.ALL_EVENT="__all",p.headerClickEventName="stackHeaderClick",p.headerTouchStartEventName="stackHeaderTouchStart";class r{constructor(S,x){this._name=S,this._target=x,this._isPropagationStopped=!1}get name(){return this._name}get target(){return this._target}get origin(){return this._target}get isPropagationStopped(){return this._isPropagationStopped}stopPropagation(){this._isPropagationStopped=!0}}p.BubblingEvent=r;class a extends r{constructor(S,x,u){super(S,x),this._mouseEvent=u}get mouseEvent(){return this._mouseEvent}}p.ClickBubblingEvent=a;class d extends r{constructor(S,x,u){super(S,x),this._touchEvent=u}get touchEvent(){return this._touchEvent}}p.TouchStartBubblingEvent=d})(Ti||(Ti={}));class B0 extends Ti{constructor(r,a,d,y,S,x,u,O,V){super(),this._config=r,this._parent=a,this._layoutManager=d,this._element=y,this._updateItemConfigEvent=S,this._showEvent=x,this._hideEvent=u,this._focusEvent=O,this._blurEvent=V,this._stackMaximised=!1,this._width=0,this._height=0,this._visible=!0,this._isShownWithZeroDimensions=!0,this._componentType=r.componentType,this._isClosable=r.isClosable,this._initialState=r.componentState,this._state=this._initialState,this._boundComponent=this.layoutManager.bindComponent(this,r),this.updateElementPositionPropertyFromBoundComponent()}get width(){return this._width}get height(){return this._height}get parent(){return this._parent}get componentName(){return this._componentType}get componentType(){return this._componentType}get virtual(){return this._boundComponent.virtual}get component(){return this._boundComponent.component}get tab(){return this._tab}get title(){return this._parent.title}get layoutManager(){return this._layoutManager}get isHidden(){return!this._visible}get visible(){return this._visible}get state(){return this._state}get initialState(){return this._initialState}get element(){return this._element}destroy(){this.releaseComponent(),this.stateRequestEvent=void 0,this.emit("destroy")}getElement(){return this._element}hide(){this._hideEvent()}show(){this._showEvent()}focus(r=!1){this._focusEvent(r)}blur(r=!1){this._blurEvent(r)}setSize(r,a){let d=this._parent;if(d.isColumn||d.isRow||d.parent===null)throw new Lt("ICSSPRC","ComponentContainer cannot have RowColumn Parent");{let y;do y=d,d=d.parent;while(d!==null&&!d.isColumn&&!d.isRow);if(d===null)return!1;{const S=d.isColumn?"height":"width",x=this[S];if(x===null)throw new di("ICSSCS11194");{const u=S==="height"?a:r,O=x*(1/(y.size/100)),V=u/O*100,W=(y.size-V)/(d.contentItems.length-1);for(let q=0;q<d.contentItems.length;q++){const F=d.contentItems[q];F===y?F.size=V:F.size+=W}return d.updateSize(!1),!0}}}}close(){this._isClosable&&(this.emit("close"),this._parent.close())}replaceComponent(r){if(this.releaseComponent(),Ci.isComponent(r)){const a=mo.resolve(r,!1);if(this._initialState=a.componentState,this._state=this._initialState,this._componentType=a.componentType,this._updateItemConfigEvent(a),this._boundComponent=this.layoutManager.bindComponent(this,a),this.updateElementPositionPropertyFromBoundComponent(),this._boundComponent.virtual){if(this.virtualVisibilityChangeRequiredEvent!==void 0&&this.virtualVisibilityChangeRequiredEvent(this,this._visible),this.virtualRectingRequiredEvent!==void 0){this._layoutManager.fireBeforeVirtualRectingEvent(1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{this._layoutManager.fireAfterVirtualRectingEvent()}}this.setBaseLogicalZIndex()}this.emit("stateChanged")}else throw new Error("ReplaceComponent not passed a component ItemConfig")}getState(){return this._state}extendState(r){const a=ea(this._state,r);this.setState(a)}setState(r){this._state=r,this._parent.emitBaseBubblingEvent("stateChanged")}setTitle(r){this._parent.setTitle(r)}setTab(r){this._tab=r,this.emit("tab",r)}setVisibility(r){this._boundComponent.virtual&&this.virtualVisibilityChangeRequiredEvent!==void 0&&this.virtualVisibilityChangeRequiredEvent(this,r),r?this._visible?this._isShownWithZeroDimensions&&(this._height!==0||this._width!==0)&&(this._isShownWithZeroDimensions=!1,this.setSizeToNodeSize(this._width,this._height,!0),this.emitShow()):(this._visible=!0,this._height===0&&this._width===0?this._isShownWithZeroDimensions=!0:(this._isShownWithZeroDimensions=!1,this.setSizeToNodeSize(this._width,this._height,!0),this.emitShow())):this._visible&&(this._visible=!1,this._isShownWithZeroDimensions=!1,this.emitHide())}setBaseLogicalZIndex(){this.setLogicalZIndex(Nc.base)}setLogicalZIndex(r){r!==this._logicalZIndex&&(this._logicalZIndex=r,this.notifyVirtualZIndexChangeRequired())}enterDragMode(r,a){this._width=r,this._height=a,er(this._element,r),tr(this._element,a),this.setLogicalZIndex(Nc.drag),this.drag()}exitDragMode(){this.setBaseLogicalZIndex()}enterStackMaximised(){this._stackMaximised=!0,this.setLogicalZIndex(Nc.stackMaximised)}exitStackMaximised(){this.setBaseLogicalZIndex(),this._stackMaximised=!1}drag(){if(this._boundComponent.virtual&&this.virtualRectingRequiredEvent!==void 0){this._layoutManager.fireBeforeVirtualRectingEvent(1);try{this.virtualRectingRequiredEvent(this,this._width,this._height)}finally{this._layoutManager.fireAfterVirtualRectingEvent()}}}setSizeToNodeSize(r,a,d){(r!==this._width||a!==this._height||d)&&(this._width=r,this._height=a,er(this._element,r),tr(this._element,a),this._boundComponent.virtual?this.addVirtualSizedContainerToLayoutManager():(this.emit("resize"),this.checkShownFromZeroDimensions()))}notifyVirtualRectingRequired(){this.virtualRectingRequiredEvent!==void 0&&(this.virtualRectingRequiredEvent(this,this._width,this._height),this.emit("resize"),this.checkShownFromZeroDimensions())}notifyVirtualZIndexChangeRequired(){if(this.virtualZIndexChangeRequiredEvent!==void 0){const r=this._logicalZIndex,a=P0[r];this.virtualZIndexChangeRequiredEvent(this,r,a)}}updateElementPositionPropertyFromBoundComponent(){this._boundComponent.virtual?this._element.style.position="static":this._element.style.position=""}addVirtualSizedContainerToLayoutManager(){this._layoutManager.beginVirtualSizedContainerAdding();try{this._layoutManager.addVirtualSizedContainer(this)}finally{this._layoutManager.endVirtualSizedContainerAdding()}}checkShownFromZeroDimensions(){this._isShownWithZeroDimensions&&(this._height!==0||this._width!==0)&&(this._isShownWithZeroDimensions=!1,this.emitShow())}emitShow(){this.emit("shown"),this.emit("show")}emitHide(){this.emit("hide")}releaseComponent(){this._stackMaximised&&this.exitStackMaximised(),this.emit("beforeComponentRelease",this._boundComponent.component),this.layoutManager.unbindComponent(this,this._boundComponent.virtual,this._boundComponent.component)}}class F0 extends Ti{constructor(r,a,d){super(),this._config=r,this._initialWindowSize=a,this._layoutManager=d,this._isInitialised=!1,this._popoutWindow=null,this.createWindow()}toConfig(){var r,a;if(this._isInitialised===!1)throw new Error("Can't create config, layout not yet initialised");const y=this.getGlInstance().saveLayout();let S,x;this._popoutWindow===null?(S=null,x=null):(S=(r=this._popoutWindow.screenX)!==null&&r!==void 0?r:this._popoutWindow.screenLeft,x=(a=this._popoutWindow.screenY)!==null&&a!==void 0?a:this._popoutWindow.screenTop);const u={width:this.getGlInstance().width,height:this.getGlInstance().height,left:S,top:x};return{root:y.root,openPopouts:y.openPopouts,settings:y.settings,dimensions:y.dimensions,header:y.header,window:u,parentId:this._config.parentId,indexInParent:this._config.indexInParent,resolved:!0}}getGlInstance(){if(this._popoutWindow===null)throw new di("BPGGI24693");return this._popoutWindow.__glInstance}getWindow(){if(this._popoutWindow===null)throw new di("BPGW087215");return this._popoutWindow}close(){if(this.getGlInstance())this.getGlInstance().closeWindow();else try{this.getWindow().close()}catch{}}popIn(){let r,a=this._config.indexInParent;if(!this._config.parentId)return;const d=this.getGlInstance().saveLayout(),S=ea({},d).root;if(S===void 0)throw new _t("BPPIR19998");const x=this._layoutManager.groundItem;if(x===void 0)throw new _t("BPPIG34972");r=x.getItemsByPopInParentId(this._config.parentId)[0],r||(x.contentItems.length>0?r=x.contentItems[0]:r=x,a=0);const u=this._layoutManager.createAndInitContentItem(S,r);r.addChild(u,a),this._layoutManager.layoutConfig.settings.popInOnClose?this._onClose():this.close()}createWindow(){const r=this.createUrl(),a=Math.floor(Math.random()*1e6).toString(36),d=this.serializeWindowFeatures({width:this._initialWindowSize.width,height:this._initialWindowSize.height,innerWidth:this._initialWindowSize.width,innerHeight:this._initialWindowSize.height,menubar:"no",toolbar:"no",location:"no",personalbar:"no",resizable:"yes",scrollbars:"no",status:"no"});if(this._popoutWindow=globalThis.open(r,a,d),!this._popoutWindow){if(this._layoutManager.layoutConfig.settings.blockedPopoutsThrowError===!0)throw new T0("Popout blocked");return}this._popoutWindow.addEventListener("load",()=>this.positionWindow(),{passive:!0}),this._popoutWindow.addEventListener("beforeunload",()=>{this._layoutManager.layoutConfig.settings.popInOnClose?this.popIn():this._onClose()},{passive:!0}),this._checkReadyInterval=setInterval(()=>this.checkReady(),10)}checkReady(){if(this._popoutWindow===null)throw new di("BPCR01844");this._popoutWindow.__glInstance&&this._popoutWindow.__glInstance.isInitialised&&(this.onInitialised(),this._checkReadyInterval!==void 0&&(clearInterval(this._checkReadyInterval),this._checkReadyInterval=void 0))}serializeWindowFeatures(r){const a=[];for(const d in r)a.push(d+"="+r[d].toString());return a.join(",")}createUrl(){const r="gl-window-config-"+ug(),a=mt.minifyConfig(this._config);try{localStorage.setItem(r,JSON.stringify(a))}catch(y){throw new Error("Error while writing to localStorage "+R0(y))}const d=new URL(location.href);return d.searchParams.set("gl-window",r),d.toString()}positionWindow(){if(this._popoutWindow===null)throw new Error("BrowserPopout.positionWindow: null popoutWindow");this._popoutWindow.moveTo(this._initialWindowSize.left,this._initialWindowSize.top),this._popoutWindow.focus()}onInitialised(){this._isInitialised=!0,this.getGlInstance().on("popIn",()=>this.popIn()),this.emit("initialised")}_onClose(){setTimeout(()=>this.emit("closed"),50)}}class Bn extends Ti{constructor(r,a,d,y){super(),this.layoutManager=r,this._parent=d,this._element=y,this._popInParentIds=[],this._type=a.type,this._id=a.id,this._isInitialised=!1,this.isGround=!1,this.isRow=!1,this.isColumn=!1,this.isStack=!1,this.isComponent=!1,this.size=a.size,this.sizeUnit=a.sizeUnit,this.minSize=a.minSize,this.minSizeUnit=a.minSizeUnit,this._isClosable=a.isClosable,this._pendingEventPropagations={},this._throttledEvents=["stateChanged"],this._contentItems=this.createContentItems(a.content)}get type(){return this._type}get id(){return this._id}set id(r){this._id=r}get popInParentIds(){return this._popInParentIds}get parent(){return this._parent}get contentItems(){return this._contentItems}get isClosable(){return this._isClosable}get element(){return this._element}get isInitialised(){return this._isInitialised}static isStack(r){return r.isStack}static isComponentItem(r){return r.isComponent}static isComponentParentableItem(r){return r.isStack||r.isGround}removeChild(r,a=!1){const d=this._contentItems.indexOf(r);if(d===-1)throw new Error("Can't remove child item. Unknown content item");if(a||this._contentItems[d].destroy(),this._contentItems.splice(d,1),this._contentItems.length>0)this.updateSize(!1);else if(!this.isGround&&this._isClosable===!0){if(this._parent===null)throw new di("CIUC00874");this._parent.removeChild(this)}}addChild(r,a,d){return a??(a=this._contentItems.length),this._contentItems.splice(a,0,r),r.setParent(this),this._isInitialised===!0&&r._isInitialised===!1&&r.init(),a}replaceChild(r,a,d=!1){const y=this._contentItems.indexOf(r),S=r._element.parentNode;if(y===-1)throw new Lt("CIRCI23232","Can't replace child. oldChild is not child of this");if(S===null)throw new di("CIRCP23232");if(S.replaceChild(a._element,r._element),d===!0&&(r._parent=null,r.destroy()),this._contentItems[y]=a,a.setParent(this),a.size=r.size,a.sizeUnit=r.sizeUnit,a.minSize=r.minSize,a.minSizeUnit=r.minSizeUnit,a._parent===null)throw new di("CIRCNC45699");a._parent._isInitialised===!0&&a._isInitialised===!1&&a.init(),this.updateSize(!1)}remove(){if(this._parent===null)throw new di("CIR11110");this._parent.removeChild(this)}popout(){const r=ug(),a=this.layoutManager.createPopoutFromContentItem(this,void 0,r,void 0);return this.emitBaseBubblingEvent("stateChanged"),a}calculateConfigContent(){const r=this._contentItems,a=r.length,d=new Array(a);for(let y=0;y<a;y++){const S=r[y];d[y]=S.toConfig()}return d}highlightDropZone(r,a,d){const y=this.layoutManager.dropTargetIndicator;if(y===null)throw new di("ACIHDZ5593");y.highlightArea(d,1)}onDrop(r,a){this.addChild(r)}show(){this.layoutManager.beginSizeInvalidation();try{lo(this._element,!0);for(let r=0;r<this._contentItems.length;r++)this._contentItems[r].show()}finally{this.layoutManager.endSizeInvalidation()}}destroy(){for(let r=0;r<this._contentItems.length;r++)this._contentItems[r].destroy();this._contentItems=[],this.emitBaseBubblingEvent("beforeItemDestroyed"),this._element.remove(),this.emitBaseBubblingEvent("itemDestroyed")}getElementArea(r){r=r??this._element;const a=r.getBoundingClientRect(),d=a.top+document.body.scrollTop,y=a.left+document.body.scrollLeft,S=a.width,x=a.height;return{x1:y,y1:d,x2:y+S,y2:d+x,surface:S*x,contentItem:this}}init(){this._isInitialised=!0,this.emitBaseBubblingEvent("itemCreated"),this.emitUnknownBubblingEvent(this.type+"Created")}setParent(r){this._parent=r}addPopInParentId(r){this.popInParentIds.includes(r)||this.popInParentIds.push(r)}initContentItems(){for(let r=0;r<this._contentItems.length;r++)this._contentItems[r].init()}hide(){this.layoutManager.beginSizeInvalidation();try{lo(this._element,!1)}finally{this.layoutManager.endSizeInvalidation()}}updateContentItemsSize(r){for(let a=0;a<this._contentItems.length;a++)this._contentItems[a].updateSize(r)}createContentItems(r){const a=r.length,d=new Array(a);for(let y=0;y<r.length;y++)d[y]=this.layoutManager.createContentItem(r[y],this);return d}propagateEvent(r,a){if(a.length===1){const d=a[0];d instanceof Ti.BubblingEvent&&d.isPropagationStopped===!1&&this._isInitialised===!0&&(this.isGround===!1&&this._parent?this._parent.emitUnknown(r,d):this.scheduleEventPropagationToLayoutManager(r,d))}}tryBubbleEvent(r,a){if(a.length===1){const d=a[0];d instanceof Ti.BubblingEvent&&d.isPropagationStopped===!1&&this._isInitialised===!0&&(this.isGround===!1&&this._parent?this._parent.emitUnknown(r,d):this.scheduleEventPropagationToLayoutManager(r,d))}}scheduleEventPropagationToLayoutManager(r,a){this._throttledEvents.indexOf(r)===-1?this.layoutManager.emitUnknown(r,a):this._pendingEventPropagations[r]!==!0&&(this._pendingEventPropagations[r]=!0,globalThis.requestAnimationFrame(()=>this.propagateEventToLayoutManager(r,a)))}propagateEventToLayoutManager(r,a){this._pendingEventPropagations[r]=!1,this.layoutManager.emitUnknown(r,a)}}class ta extends Bn{constructor(r,a,d){super(r,a,d,document.createElement("div")),this._parentItem=d,this._focused=!1,this.isComponent=!0,this._reorderEnabled=a.reorderEnabled,this.applyUpdatableConfig(a),this._initialWantMaximise=a.maximised;const y=document.createElement("div");y.classList.add("lm_content"),this.element.appendChild(y),this._container=new B0(a,this,r,y,S=>this.handleUpdateItemConfigEvent(S),()=>this.show(),()=>this.hide(),S=>this.focus(S),S=>this.blur(S))}get componentName(){return this._container.componentType}get componentType(){return this._container.componentType}get reorderEnabled(){return this._reorderEnabled}get initialWantMaximise(){return this._initialWantMaximise}get component(){return this._container.component}get container(){return this._container}get parentItem(){return this._parentItem}get headerConfig(){return this._headerConfig}get title(){return this._title}get tab(){return this._tab}get focused(){return this._focused}destroy(){this._container.destroy(),super.destroy()}applyUpdatableConfig(r){this.setTitle(r.title),this._headerConfig=r.header}toConfig(){const r=this._container.stateRequestEvent,a=r===void 0?this._container.state:r();return{type:Te.component,content:[],size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,maximised:!1,isClosable:this.isClosable,reorderEnabled:this._reorderEnabled,title:this._title,header:_r.Header.createCopy(this._headerConfig),componentType:ys.copyComponentType(this.componentType),componentState:a}}close(){if(this.parent===null)throw new di("CIC68883");this.parent.removeChild(this,!1)}enterDragMode(r,a){er(this.element,r),tr(this.element,a),this._container.enterDragMode(r,a)}exitDragMode(){this._container.exitDragMode()}enterStackMaximised(){this._container.enterStackMaximised()}exitStackMaximised(){this._container.exitStackMaximised()}drag(){this._container.drag()}updateSize(r){this.updateNodeSize(r)}init(){this.updateNodeSize(!1),super.init(),this._container.emit("open"),this.initContentItems()}setTitle(r){this._title=r,this.emit("titleChanged",r),this.emit("stateChanged")}setTab(r){this._tab=r,this.emit("tab",r),this._container.setTab(r)}hide(){super.hide(),this._container.setVisibility(!1)}show(){super.show(),this._container.setVisibility(!0)}focus(r=!1){this.parentItem.setActiveComponentItem(this,!0,r)}setFocused(r){this._focused=!0,this.tab.setFocused(),r||this.emitBaseBubblingEvent("focus")}blur(r=!1){this._focused&&this.layoutManager.setFocusedComponentItem(void 0,r)}setBlurred(r){this._focused=!1,this.tab.setBlurred(),r||this.emitBaseBubblingEvent("blur")}setParent(r){this._parentItem=r,super.setParent(r)}handleUpdateItemConfigEvent(r){this.applyUpdatableConfig(r)}updateNodeSize(r){if(this.element.style.display!=="none"){const{width:a,height:d}=ao(this.element);this._container.setSizeToNodeSize(a,d,r)}}}class hg extends Bn{constructor(){super(...arguments),this._focused=!1}get focused(){return this._focused}setFocusedValue(r){this._focused=r}}class hp extends Ti{constructor(r,a){super(),this._eElement=r,this._pointerTracking=!1,this._pointerDownEventListener=d=>this.onPointerDown(d),this._pointerMoveEventListener=d=>this.onPointerMove(d),this._pointerUpEventListener=d=>this.onPointerUp(d),this._timeout=void 0,this._allowableTargets=[r,...a],this._oDocument=document,this._eBody=document.body,this._nDelay=1800,this._nDistance=10,this._nX=0,this._nY=0,this._nOriginalX=0,this._nOriginalY=0,this._dragging=!1,this._eElement.addEventListener("pointerdown",this._pointerDownEventListener,{passive:!0})}destroy(){this.checkRemovePointerTrackingEventListeners(),this._eElement.removeEventListener("pointerdown",this._pointerDownEventListener)}cancelDrag(){this.processDragStop(void 0)}onPointerDown(r){if(this._allowableTargets.includes(r.target)&&r.isPrimary){const a=this.getPointerCoordinates(r);this.processPointerDown(a)}}processPointerDown(r){this._nOriginalX=r.x,this._nOriginalY=r.y,this._oDocument.addEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.addEventListener("pointerup",this._pointerUpEventListener,{passive:!0}),this._pointerTracking=!0,this._timeout=setTimeout(()=>{try{this.startDrag()}catch(a){throw console.error(a),a}},this._nDelay)}onPointerMove(r){this._pointerTracking&&(this.processDragMove(r),r.preventDefault())}processDragMove(r){this._nX=r.pageX-this._nOriginalX,this._nY=r.pageY-this._nOriginalY,this._dragging===!1&&(Math.abs(this._nX)>this._nDistance||Math.abs(this._nY)>this._nDistance)&&this.startDrag(),this._dragging&&this.emit("drag",this._nX,this._nY,r)}onPointerUp(r){this.processDragStop(r)}processDragStop(r){var a;this._timeout!==void 0&&(clearTimeout(this._timeout),this._timeout=void 0),this.checkRemovePointerTrackingEventListeners(),this._dragging===!0&&(this._eBody.classList.remove("lm_dragging"),this._eElement.classList.remove("lm_dragging"),(a=this._oDocument.querySelector("iframe"))===null||a===void 0||a.style.setProperty("pointer-events",""),this._dragging=!1,this.emit("dragStop",r))}checkRemovePointerTrackingEventListeners(){this._pointerTracking&&(this._oDocument.removeEventListener("pointermove",this._pointerMoveEventListener),this._oDocument.removeEventListener("pointerup",this._pointerUpEventListener),this._pointerTracking=!1)}startDrag(){var r;this._timeout!==void 0&&(clearTimeout(this._timeout),this._timeout=void 0),this._dragging=!0,this._eBody.classList.add("lm_dragging"),this._eElement.classList.add("lm_dragging"),(r=this._oDocument.querySelector("iframe"))===null||r===void 0||r.style.setProperty("pointer-events","none"),this.emit("dragStart",this._nOriginalX,this._nOriginalY)}getPointerCoordinates(r){return{x:r.pageX,y:r.pageY}}}class O0{constructor(r,a,d){this._isVertical=r,this._size=a,this._grabSize=d<this._size?this._size:d,this._element=document.createElement("div"),this._element.classList.add("lm_splitter");const y=document.createElement("div");y.classList.add("lm_drag_handle");const S=this._grabSize-this._size,x=S/2;this._isVertical?(y.style.top=Rt(-x),y.style.height=Rt(this._size+S),this._element.classList.add("lm_vertical"),this._element.style.height=Rt(this._size)):(y.style.left=Rt(-x),y.style.width=Rt(this._size+S),this._element.classList.add("lm_horizontal"),this._element.style.width=Rt(this._size)),this._element.appendChild(y),this._dragListener=new hp(this._element,[y])}get element(){return this._element}destroy(){this._element.remove()}on(r,a){this._dragListener.on(r,a)}}class aa extends Bn{constructor(r,a,d,y){switch(super(a,d,y,aa.createElement(document,r)),this._rowOrColumnParent=y,this._splitter=[],this.isRow=!r,this.isColumn=r,this._childElementContainer=this.element,this._splitterSize=a.layoutConfig.dimensions.borderWidth,this._splitterGrabSize=a.layoutConfig.dimensions.borderGrabWidth,this._isColumn=r,this._dimension=r?"height":"width",this._splitterPosition=null,this._splitterMinPosition=null,this._splitterMaxPosition=null,d.type){case Te.row:case Te.column:this._configType=d.type;break;default:throw new Lt("ROCCCT00925")}}newComponent(r,a,d,y){const S={type:"component",componentType:r,componentState:a,title:d};return this.newItem(S,y)}addComponent(r,a,d,y){const S={type:"component",componentType:r,componentState:a,title:d};return this.addItem(S,y)}newItem(r,a){a=this.addItem(r,a);const d=this.contentItems[a];return Bn.isStack(d)&&Ci.isComponent(r)?d.contentItems[0]:d}addItem(r,a){this.layoutManager.checkMinimiseMaximisedStack();const d=Ci.resolve(r,!1),y=this.layoutManager.createAndInitContentItem(d,this);return this.addChild(y,a,!1)}addChild(r,a,d){if(a===void 0&&(a=this.contentItems.length),this.contentItems.length>0){const S=this.createSplitter(Math.max(0,a-1)).element;a>0?(this.contentItems[a-1].element.insertAdjacentElement("afterend",S),S.insertAdjacentElement("afterend",r.element)):(this.contentItems[0].element.insertAdjacentElement("beforebegin",S),S.insertAdjacentElement("beforebegin",r.element))}else this._childElementContainer.appendChild(r.element);super.addChild(r,a);const y=1/this.contentItems.length*100;if(d===!0)return this.emitBaseBubblingEvent("stateChanged"),a;for(let S=0;S<this.contentItems.length;S++){const x=this.contentItems[S];if(x===r)r.size=y;else{const u=x.size*=(100-y)/100;x.size=u}}return this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged"),a}removeChild(r,a){const d=this.contentItems.indexOf(r),y=Math.max(d-1,0);if(d===-1)throw new Error("Can't remove child. ContentItem is not child of this Row or Column");if(this._splitter[y]&&(this._splitter[y].destroy(),this._splitter.splice(y,1)),super.removeChild(r,a),this.contentItems.length===1&&this.isClosable===!0){const S=this.contentItems[0];this.contentItems.length=0,this._rowOrColumnParent.replaceChild(this,S,!0)}else this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged")}replaceChild(r,a){const d=r.size;super.replaceChild(r,a),a.size=d,this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged")}updateSize(r){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(r)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}init(){if(this.isInitialised!==!0){this.updateNodeSize();for(let r=0;r<this.contentItems.length;r++)this._childElementContainer.appendChild(this.contentItems[r].element);super.init();for(let r=0;r<this.contentItems.length-1;r++)this.contentItems[r].element.insertAdjacentElement("afterend",this.createSplitter(r).element);this.initContentItems()}}toConfig(){return{type:this.type,content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable}}setParent(r){this._rowOrColumnParent=r,super.setParent(r)}updateNodeSize(){this.contentItems.length>0&&(this.calculateRelativeSizes(),this.setAbsoluteSizes()),this.emitBaseBubblingEvent("stateChanged"),this.emit("resize")}setAbsoluteSizes(){const r=this.calculateAbsoluteSizes();for(let a=0;a<this.contentItems.length;a++)r.additionalPixel-a>0&&r.itemSizes[a]++,this._isColumn?(er(this.contentItems[a].element,r.crossAxisSize),tr(this.contentItems[a].element,r.itemSizes[a])):(er(this.contentItems[a].element,r.itemSizes[a]),tr(this.contentItems[a].element,r.crossAxisSize))}calculateAbsoluteSizes(){const r=(this.contentItems.length-1)*this._splitterSize,{width:a,height:d}=ao(this.element);let y,S;this._isColumn?(y=d-r,S=a):(y=a-r,S=d);let x=0;const u=[];for(let V=0;V<this.contentItems.length;V++){const W=this.contentItems[V];let q;if(W.sizeUnit===Nt.Percent)q=Math.floor(y*(W.size/100));else throw new Lt("ROCCAS6692");x+=q,u.push(q)}const O=Math.floor(y-x);return{itemSizes:u,additionalPixel:O,totalSize:y,crossAxisSize:S}}calculateRelativeSizes(){let r=0;const a=[];let d=0;for(let y=0;y<this.contentItems.length;y++){const S=this.contentItems[y];switch(S.sizeUnit){case Nt.Percent:{r+=S.size;break}case Nt.Fractional:{a.push(S),d+=S.size;break}default:throw new Lt("ROCCRS49110",JSON.stringify(S))}}if(Math.round(r)===100){this.respectMinItemSize();return}else if(Math.round(r)<100&&a.length>0){const y=100-r;for(let S=0;S<a.length;S++){const x=a[S];x.size=y*(x.size/d),x.sizeUnit=Nt.Percent}this.respectMinItemSize();return}else{if(Math.round(r)>100&&a.length>0){for(let y=0;y<a.length;y++){const S=a[y];S.size=50*(S.size/d),S.sizeUnit=Nt.Percent}r+=50}for(let y=0;y<this.contentItems.length;y++){const S=this.contentItems[y];S.size=S.size/r*100}this.respectMinItemSize()}}respectMinItemSize(){const r=this.calculateContentItemMinSize(this);if(!(r<=0||this.contentItems.length<=1)){let a=0,d=0;const y=[],S=[],x=this.calculateAbsoluteSizes();for(let u=0;u<x.itemSizes.length;u++){const O=x.itemSizes[u];let V;O<r?(d+=r-O,V={size:r}):(a+=O-r,V={size:O},y.push(V)),S.push(V)}if(d===0||d>a)return;{const u=d/a;let O=d;for(let V=0;V<y.length;V++){const W=y[V],q=Math.round((W.size-r)*u);O-=q,W.size-=q}O!==0&&(S[S.length-1].size-=O);for(let V=0;V<this.contentItems.length;V++){const W=this.contentItems[V];W.size=S[V].size/x.totalSize*100}}}}createSplitter(r){const a=new O0(this._isColumn,this._splitterSize,this._splitterGrabSize);return a.on("drag",(d,y)=>this.onSplitterDrag(a,d,y)),a.on("dragStop",()=>this.onSplitterDragStop(a)),a.on("dragStart",()=>this.onSplitterDragStart(a)),this._splitter.splice(r,0,a),a}getSplitItems(r){const a=this._splitter.indexOf(r);return{before:this.contentItems[a],after:this.contentItems[a+1]}}calculateContentItemMinSize(r){const a=r.minSize;if(a!==void 0){if(r.minSizeUnit===Nt.Pixel)return a;throw new Lt("ROCGMD98831",JSON.stringify(r))}else{const d=this.layoutManager.layoutConfig.dimensions;return this._isColumn?d.defaultMinItemHeight:d.defaultMinItemWidth}}calculateContentItemsTotalMinSize(r){let a=0;for(const d of r)a+=this.calculateContentItemMinSize(d);return a}onSplitterDragStart(r){const a=this.getSplitItems(r),d=ll(a.before.element.style[this._dimension]),y=ll(a.after.element.style[this._dimension]),S=this.calculateContentItemsTotalMinSize(a.before.contentItems),x=this.calculateContentItemsTotalMinSize(a.after.contentItems);this._splitterPosition=0,this._splitterMinPosition=-1*(d-S),this._splitterMaxPosition=y-x}onSplitterDrag(r,a,d){let y=this._isColumn?d:a;if(this._splitterMinPosition===null||this._splitterMaxPosition===null)throw new di("ROCOSD59226");y=Math.max(y,this._splitterMinPosition),y=Math.min(y,this._splitterMaxPosition),this._splitterPosition=y;const S=Rt(y);this._isColumn?r.element.style.top=S:r.element.style.left=S}onSplitterDragStop(r){if(this._splitterPosition===null)throw new di("ROCOSDS66932");{const a=this.getSplitItems(r),d=ll(a.before.element.style[this._dimension]),y=ll(a.after.element.style[this._dimension]),S=(this._splitterPosition+d)/(d+y),x=a.before.size+a.after.size;a.before.size=S*x,a.after.size=(1-S)*x,r.element.style.top=Rt(0),r.element.style.left=Rt(0),globalThis.requestAnimationFrame(()=>this.updateSize(!1))}}}(function(p){function r(y,S){return S==="width"?A0(y):z0(y)}p.getElementDimensionSize=r;function a(y,S,x){return S==="width"?er(y,x):tr(y,x)}p.setElementDimensionSize=a;function d(y,S){const x=y.createElement("div");return x.classList.add("lm_item"),S?x.classList.add("lm_column"):x.classList.add("lm_row"),x}p.createElement=d})(aa||(aa={}));class fo extends hg{constructor(r,a,d){super(r,Jd.create(a),null,fo.createElement(document)),this.isGround=!0,this._childElementContainer=this.element,this._containerElement=d;let y=null;for(;;){const S=y?y.previousSibling:this._containerElement.lastChild;if(S instanceof Element&&S.classList.contains("lm_content"))y=S;else break}this._containerElement.insertBefore(this.element,y)}init(){if(this.isInitialised!==!0){this.updateNodeSize();for(let r=0;r<this.contentItems.length;r++)this._childElementContainer.appendChild(this.contentItems[r].element);super.init(),this.initContentItems()}}loadRoot(r){if(this.clearRoot(),r!==void 0){const a=this.layoutManager.createAndInitContentItem(r,this);this.addChild(a,0)}}clearRoot(){const r=this.contentItems;switch(r.length){case 0:return;case 1:{r[0].remove();return}default:throw new Lt("GILR07721")}}addItem(r,a){this.layoutManager.checkMinimiseMaximisedStack();const d=Ci.resolve(r,!1);let y;if(this.contentItems.length>0?y=this.contentItems[0]:y=this,y.isComponent)throw new Error("Cannot add item as child to ComponentItem");{const S=this.layoutManager.createAndInitContentItem(d,y);return a=y.addChild(S,a),y===this?-1:a}}loadComponentAsRoot(r){this.clearRoot();const a=Ci.resolve(r,!1);if(a.maximised)throw new Error("Root Component cannot be maximised");{const d=new ta(this.layoutManager,a,this);d.init(),this.addChild(d,0)}}addChild(r,a){if(this.contentItems.length>0)throw new Error("Ground node can only have a single child");return this._childElementContainer.appendChild(r.element),a=super.addChild(r,a),this.updateSize(!1),this.emitBaseBubblingEvent("stateChanged"),a}calculateConfigContent(){const r=this.contentItems,a=r.length,d=new Array(a);for(let y=0;y<a;y++){const x=r[y].toConfig();if(oa.isRootItemConfig(x))d[y]=x;else throw new Lt("RCCC66832")}return d}setSize(r,a){r===void 0||a===void 0?this.updateSize(!1):(er(this.element,r),tr(this.element,a),this.contentItems.length>0&&(er(this.contentItems[0].element,r),tr(this.contentItems[0].element,a)),this.updateContentItemsSize(!1))}updateSize(r){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(r)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}createSideAreas(){const a=fo.Area.oppositeSides,d=new Array(Object.keys(a).length);let y=0;for(const S in a){const x=S,u=this.getElementArea();if(u===null)throw new di("RCSA77553");u.side=x,a[x][1]==="2"?u[x]=u[a[x]]-50:u[x]=u[a[x]]+50,u.surface=(u.x2-u.x1)*(u.y2-u.y1),d[y++]=u}return d}highlightDropZone(r,a,d){this.layoutManager.tabDropPlaceholder.remove(),super.highlightDropZone(r,a,d)}onDrop(r,a){if(r.isComponent){const d=_s.createDefault(),y=r;d.header=_r.Header.createCopy(y.headerConfig);const S=this.layoutManager.createAndInitContentItem(d,this);S.addChild(r),r=S}if(this.contentItems.length===0)this.addChild(r);else{if(r.type===Te.row||r.type===Te.column){const x=_s.createDefault(),u=this.layoutManager.createContentItem(x,this);u.addChild(r),r=u}const d=a.side[0]=="x"?Te.row:Te.column,y=a.side[1]=="2",S=this.contentItems[0];if(!(S instanceof aa)||S.type!==d){const x=Tt.createDefault(d),u=this.layoutManager.createContentItem(x,this);this.replaceChild(S,u),u.addChild(r,y?0:void 0,!0),u.addChild(S,y?void 0:0,!0),S.size=50,r.size=50,r.sizeUnit=Nt.Percent,u.updateSize(!1)}else{const x=S.contentItems[y?0:S.contentItems.length-1];S.addChild(r,y?0:void 0,!0),x.size*=.5,r.size=x.size,r.sizeUnit=Nt.Percent,S.updateSize(!1)}}}dock(){throw new Lt("GID87731")}validateDocking(){throw new Lt("GIVD87732")}getAllContentItems(){const r=[this];return this.deepGetAllContentItems(this.contentItems,r),r}getConfigMaximisedItems(){const r=[];return this.deepFilterContentItems(this.contentItems,r,a=>Bn.isStack(a)&&a.initialWantMaximise?!0:!!(Bn.isComponentItem(a)&&a.initialWantMaximise)),r}getItemsByPopInParentId(r){const a=[];return this.deepFilterContentItems(this.contentItems,a,d=>d.popInParentIds.includes(r)),a}toConfig(){throw new Error("Cannot generate GroundItem config")}setActiveComponentItem(r,a,d){}updateNodeSize(){const{width:r,height:a}=ao(this._containerElement);er(this.element,r),tr(this.element,a),this.contentItems.length>0&&(er(this.contentItems[0].element,r),tr(this.contentItems[0].element,a))}deepGetAllContentItems(r,a){for(let d=0;d<r.length;d++){const y=r[d];a.push(y),this.deepGetAllContentItems(y.contentItems,a)}}deepFilterContentItems(r,a,d){for(let y=0;y<r.length;y++){const S=r[y];d(S)&&a.push(S),this.deepFilterContentItems(S.contentItems,a,d)}}}(function(p){(function(a){a.oppositeSides={y2:"y1",x2:"x1",y1:"y2",x1:"x2"}})(p.Area||(p.Area={}));function r(a){const d=a.createElement("div");return d.classList.add("lm_goldenlayout"),d.classList.add("lm_item"),d.classList.add("lm_root"),d}p.createElement=r})(fo||(fo={}));class ih{constructor(r,a,d,y){this._header=r,this._pushEvent=y,this._clickEventListener=S=>this.onClick(S),this._touchStartEventListener=S=>this.onTouchStart(S),this._element=document.createElement("div"),this._element.classList.add(d),this._element.title=a,this._header.on("destroy",()=>this.destroy()),this._element.addEventListener("click",this._clickEventListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartEventListener,{passive:!0}),this._header.controlsContainerElement.appendChild(this._element)}get element(){return this._element}destroy(){var r;this._element.removeEventListener("click",this._clickEventListener),this._element.removeEventListener("touchstart",this._touchStartEventListener),(r=this._element.parentNode)===null||r===void 0||r.removeChild(this._element)}onClick(r){this._pushEvent(r)}onTouchStart(r){this._pushEvent(r)}}class N0{constructor(r,a,d,y,S){var x;this._layoutManager=r,this._componentItem=a,this._closeEvent=d,this._focusEvent=y,this._dragStartEvent=S,this._isActive=!1,this._tabClickListener=O=>this.onTabClickDown(O),this._tabTouchStartListener=O=>this.onTabTouchStart(O),this._closeClickListener=()=>this.onCloseClick(),this._closeTouchStartListener=()=>this.onCloseTouchStart(),this._dragStartListener=(O,V)=>this.onDragStart(O,V),this._contentItemDestroyListener=()=>this.onContentItemDestroy(),this._tabTitleChangedListener=O=>this.setTitle(O),this._element=document.createElement("div"),this._element.classList.add("lm_tab"),this._titleElement=document.createElement("span"),this._titleElement.classList.add("lm_title"),this._closeElement=document.createElement("div"),this._closeElement.classList.add("lm_close_tab"),this._element.appendChild(this._titleElement),this._element.appendChild(this._closeElement),a.isClosable?this._closeElement.style.display="":this._closeElement.style.display="none",this.setTitle(a.title),this._componentItem.on("titleChanged",this._tabTitleChangedListener),((x=a.reorderEnabled)!==null&&x!==void 0?x:this._layoutManager.layoutConfig.settings.reorderEnabled)&&this.enableReorder(),this._element.addEventListener("click",this._tabClickListener,{passive:!0}),this._element.addEventListener("touchstart",this._tabTouchStartListener,{passive:!0}),this._componentItem.isClosable?(this._closeElement.addEventListener("click",this._closeClickListener,{passive:!0}),this._closeElement.addEventListener("touchstart",this._closeTouchStartListener,{passive:!0})):(this._closeElement.remove(),this._closeElement=void 0),this._componentItem.setTab(this),this._layoutManager.emit("tabCreated",this)}get isActive(){return this._isActive}get componentItem(){return this._componentItem}get contentItem(){return this._componentItem}get element(){return this._element}get titleElement(){return this._titleElement}get closeElement(){return this._closeElement}get reorderEnabled(){return this._dragListener!==void 0}set reorderEnabled(r){r!==this.reorderEnabled&&(r?this.enableReorder():this.disableReorder())}setTitle(r){this._titleElement.innerText=r,this._element.title=r}setActive(r){r!==this._isActive&&(this._isActive=r,r?this._element.classList.add("lm_active"):this._element.classList.remove("lm_active"))}destroy(){var r,a;this._closeEvent=void 0,this._focusEvent=void 0,this._dragStartEvent=void 0,this._element.removeEventListener("click",this._tabClickListener),this._element.removeEventListener("touchstart",this._tabTouchStartListener),(r=this._closeElement)===null||r===void 0||r.removeEventListener("click",this._closeClickListener),(a=this._closeElement)===null||a===void 0||a.removeEventListener("touchstart",this._closeTouchStartListener),this._componentItem.off("titleChanged",this._tabTitleChangedListener),this.reorderEnabled&&this.disableReorder(),this._element.remove()}setBlurred(){this._element.classList.remove("lm_focused"),this._titleElement.classList.remove("lm_focused")}setFocused(){this._element.classList.add("lm_focused"),this._titleElement.classList.add("lm_focused")}onDragStart(r,a){if(this._dragListener===void 0)throw new _t("TODSDLU10093");if(this._dragStartEvent===void 0)throw new _t("TODS23309");this._dragStartEvent(r,a,this._dragListener,this.componentItem)}onContentItemDestroy(){this._dragListener!==void 0&&(this._dragListener.destroy(),this._dragListener=void 0)}onTabClickDown(r){const a=r.target;(a===this._element||a===this._titleElement)&&(r.button===0?this.notifyFocus():r.button===1&&this._componentItem.isClosable&&this.notifyClose())}onTabTouchStart(r){r.target===this._element&&this.notifyFocus()}onCloseClick(){this.notifyClose()}onCloseTouchStart(){this.notifyClose()}notifyClose(){if(this._closeEvent===void 0)throw new _t("TNC15007");this._closeEvent(this._componentItem)}notifyFocus(){if(this._focusEvent===void 0)throw new _t("TNA15007");this._focusEvent(this._componentItem)}enableReorder(){this._dragListener=new hp(this._element,[this._titleElement]),this._dragListener.on("dragStart",this._dragStartListener),this._componentItem.on("destroy",this._contentItemDestroyListener)}disableReorder(){if(this._dragListener===void 0)throw new _t("TDR87745");this._componentItem.off("destroy",this._contentItemDestroyListener),this._dragListener.off("dragStart",this._dragStartListener),this._dragListener=void 0}}class V0{constructor(r,a,d,y,S){this._layoutManager=r,this._componentRemoveEvent=a,this._componentFocusEvent=d,this._componentDragStartEvent=y,this._dropdownActiveChangedEvent=S,this._tabs=[],this._lastVisibleTabIndex=-1,this._dropdownActive=!1,this._element=document.createElement("section"),this._element.classList.add("lm_tabs"),this._dropdownElement=document.createElement("section"),this._dropdownElement.classList.add("lm_tabdropdown_list"),this._dropdownElement.style.display="none"}get tabs(){return this._tabs}get tabCount(){return this._tabs.length}get lastVisibleTabIndex(){return this._lastVisibleTabIndex}get element(){return this._element}get dropdownElement(){return this._dropdownElement}get dropdownActive(){return this._dropdownActive}destroy(){for(let r=0;r<this._tabs.length;r++)this._tabs[r].destroy()}createTab(r,a){for(let y=0;y<this._tabs.length;y++)if(this._tabs[y].componentItem===r)return;const d=new N0(this._layoutManager,r,y=>this.handleTabCloseEvent(y),y=>this.handleTabFocusEvent(y),(y,S,x,u)=>this.handleTabDragStartEvent(y,S,x,u));a===void 0&&(a=this._tabs.length),this._tabs.splice(a,0,d),a<this._element.childNodes.length?this._element.insertBefore(d.element,this._element.childNodes[a]):this._element.appendChild(d.element)}removeTab(r){for(let a=0;a<this._tabs.length;a++)if(this._tabs[a].componentItem===r){this._tabs[a].destroy(),this._tabs.splice(a,1);return}throw new Error("contentItem is not controlled by this header")}processActiveComponentChanged(r){let a=-1;for(let d=0;d<this._tabs.length;d++){const y=this._tabs[d].componentItem===r;this._tabs[d].setActive(y),y&&(a=d)}if(a<0)throw new Lt("HSACI56632");if(this._layoutManager.layoutConfig.settings.reorderOnTabMenuClick&&this._lastVisibleTabIndex!==-1&&a>this._lastVisibleTabIndex){const d=this._tabs[a];for(let y=a;y>0;y--)this._tabs[y]=this._tabs[y-1];this._tabs[0]=d}}updateTabSizes(r,a){let d=!1;this.tryUpdateTabSizes(d,r,a)||(d=!0,this.tryUpdateTabSizes(d,r,a)),d!==this._dropdownActive&&(this._dropdownActive=d,this._dropdownActiveChangedEvent())}tryUpdateTabSizes(r,a,d){if(this._tabs.length>0){if(d===void 0)throw new Error("non-empty tabs must have active component item");let y=0,S=!1;const x=this._layoutManager.layoutConfig.settings.tabOverlapAllowance,u=this._tabs.indexOf(d.tab),O=this._tabs[u];this._lastVisibleTabIndex=-1;for(let V=0;V<this._tabs.length;V++){const W=this._tabs[V].element;W.parentElement!==this._element&&this._element.appendChild(W);const q=getComputedStyle(O.element).marginRight,F=ll(q),oe=W.offsetWidth+F;y+=oe;let ie=0;if(u<=V)ie=y;else{const pe=getComputedStyle(O.element).marginRight,ve=ll(pe);ie=y+O.element.offsetWidth+ve}if(ie>a){if(S)V===u&&(W.style.zIndex="auto",W.style.marginLeft="",W.parentElement!==this._element&&this._element.appendChild(W));else{let pe;if(u>0&&u<=V?pe=(ie-a)/(V-1):pe=(ie-a)/V,pe<x){for(let ve=0;ve<=V;ve++){const Ce=ve!==u&&ve!==0?"-"+Rt(pe):"";this._tabs[ve].element.style.zIndex=Rt(V-ve),this._tabs[ve].element.style.marginLeft=Ce}this._lastVisibleTabIndex=V,W.parentElement!==this._element&&this._element.appendChild(W)}else S=!0}if(S&&V!==u)if(r)W.style.zIndex="auto",W.style.marginLeft="",W.parentElement!==this._dropdownElement&&this._dropdownElement.appendChild(W);else return!1}else this._lastVisibleTabIndex=V,W.style.zIndex="auto",W.style.marginLeft="",W.parentElement!==this._element&&this._element.appendChild(W)}}return!0}showAdditionalTabsDropdown(){this._dropdownElement.style.display=""}hideAdditionalTabsDropdown(){this._dropdownElement.style.display="none"}handleTabCloseEvent(r){this._componentRemoveEvent(r)}handleTabFocusEvent(r){this._componentFocusEvent(r)}handleTabDragStartEvent(r,a,d,y){this._componentDragStartEvent(r,a,d,y)}}class U0 extends Ti{constructor(r,a,d,y,S,x,u,O,V,W,q,F,oe){super(),this._layoutManager=r,this._parent=a,this._configClosable=y,this._getActiveComponentItemEvent=S,this._popoutEvent=u,this._maximiseToggleEvent=O,this._clickEvent=V,this._touchStartEvent=W,this._componentRemoveEvent=q,this._componentFocusEvent=F,this._componentDragStartEvent=oe,this._clickListener=ie=>this.onClick(ie),this._touchStartListener=ie=>this.onTouchStart(ie),this._rowColumnClosable=!0,this._closeButton=null,this._popoutButton=null,this._tabsContainer=new V0(this._layoutManager,ie=>this.handleTabInitiatedComponentRemoveEvent(ie),ie=>this.handleTabInitiatedComponentFocusEvent(ie),(ie,pe,ve,Ce)=>this.handleTabInitiatedDragStartEvent(ie,pe,ve,Ce),()=>this.processTabDropdownActiveChanged()),this._show=d.show,this._popoutEnabled=d.popoutEnabled,this._popoutLabel=d.popoutLabel,this._maximiseEnabled=d.maximiseEnabled,this._maximiseLabel=d.maximiseLabel,this._minimiseEnabled=d.minimiseEnabled,this._minimiseLabel=d.minimiseLabel,this._closeEnabled=d.closeEnabled,this._closeLabel=d.closeLabel,this._tabDropdownEnabled=d.tabDropdownEnabled,this._tabDropdownLabel=d.tabDropdownLabel,this.setSide(d.side),this._canRemoveComponent=this._configClosable,this._element=document.createElement("section"),this._element.classList.add("lm_header"),this._controlsContainerElement=document.createElement("section"),this._controlsContainerElement.classList.add("lm_controls"),this._element.appendChild(this._tabsContainer.element),this._element.appendChild(this._controlsContainerElement),this._element.appendChild(this._tabsContainer.dropdownElement),this._element.addEventListener("click",this._clickListener,{passive:!0}),this._element.addEventListener("touchstart",this._touchStartListener,{passive:!0}),this._documentMouseUpListener=()=>this._tabsContainer.hideAdditionalTabsDropdown(),globalThis.document.addEventListener("mouseup",this._documentMouseUpListener,{passive:!0}),this._tabControlOffset=this._layoutManager.layoutConfig.settings.tabControlOffset,this._tabDropdownEnabled&&(this._tabDropdownButton=new ih(this,this._tabDropdownLabel,"lm_tabdropdown",()=>this._tabsContainer.showAdditionalTabsDropdown())),this._popoutEnabled&&(this._popoutButton=new ih(this,this._popoutLabel,"lm_popout",()=>this.handleButtonPopoutEvent())),this._maximiseEnabled&&(this._maximiseButton=new ih(this,this._maximiseLabel,"lm_maximise",ie=>this.handleButtonMaximiseToggleEvent(ie))),this._configClosable&&(this._closeButton=new ih(this,this._closeLabel,"lm_close",()=>x())),this.processTabDropdownActiveChanged()}get show(){return this._show}get side(){return this._side}get leftRightSided(){return this._leftRightSided}get layoutManager(){return this._layoutManager}get parent(){return this._parent}get tabs(){return this._tabsContainer.tabs}get lastVisibleTabIndex(){return this._tabsContainer.lastVisibleTabIndex}get element(){return this._element}get tabsContainerElement(){return this._tabsContainer.element}get controlsContainerElement(){return this._controlsContainerElement}destroy(){this.emit("destroy"),this._popoutEvent=void 0,this._maximiseToggleEvent=void 0,this._clickEvent=void 0,this._touchStartEvent=void 0,this._componentRemoveEvent=void 0,this._componentFocusEvent=void 0,this._componentDragStartEvent=void 0,this._tabsContainer.destroy(),globalThis.document.removeEventListener("mouseup",this._documentMouseUpListener),this._element.remove()}createTab(r,a){this._tabsContainer.createTab(r,a)}removeTab(r){this._tabsContainer.removeTab(r)}processActiveComponentChanged(r){this._tabsContainer.processActiveComponentChanged(r),this.updateTabSizes()}setSide(r){this._side=r,this._leftRightSided=[po.right,po.left].includes(this._side)}setRowColumnClosable(r){this._rowColumnClosable=r,this.updateClosability()}updateClosability(){let r;if(!this._configClosable)r=!1;else if(!this._rowColumnClosable)r=!1;else{r=!0;const a=this.tabs.length;for(let d=0;d<a;d++)if(!this._tabsContainer.tabs[d].componentItem.isClosable){r=!1;break}}this._closeButton!==null&&lo(this._closeButton.element,r),this._popoutButton!==null&&lo(this._popoutButton.element,r),this._canRemoveComponent=r||this._tabsContainer.tabCount>1}applyFocusedValue(r){r?this._element.classList.add("lm_focused"):this._element.classList.remove("lm_focused")}processMaximised(){if(this._maximiseButton===void 0)throw new _t("HPMAX16997");this._maximiseButton.element.setAttribute("title",this._minimiseLabel)}processMinimised(){if(this._maximiseButton===void 0)throw new _t("HPMIN16997");this._maximiseButton.element.setAttribute("title",this._maximiseLabel)}updateTabSizes(){if(this._tabsContainer.tabCount>0){const r=this._show?this._layoutManager.layoutConfig.dimensions.headerHeight:0;this._leftRightSided?(this._element.style.height="",this._element.style.width=Rt(r)):(this._element.style.width="",this._element.style.height=Rt(r));let a;this._leftRightSided?a=this._element.offsetHeight-this._controlsContainerElement.offsetHeight-this._tabControlOffset:a=this._element.offsetWidth-this._controlsContainerElement.offsetWidth-this._tabControlOffset,this._tabsContainer.updateTabSizes(a,this._getActiveComponentItemEvent())}}handleTabInitiatedComponentRemoveEvent(r){if(this._canRemoveComponent){if(this._componentRemoveEvent===void 0)throw new _t("HHTCE22294");this._componentRemoveEvent(r)}}handleTabInitiatedComponentFocusEvent(r){if(this._componentFocusEvent===void 0)throw new _t("HHTAE22294");this._componentFocusEvent(r)}handleTabInitiatedDragStartEvent(r,a,d,y){if(!this._canRemoveComponent)d.cancelDrag();else{if(this._componentDragStartEvent===void 0)throw new _t("HHTDSE22294");this._componentDragStartEvent(r,a,d,y)}}processTabDropdownActiveChanged(){this._tabDropdownButton!==void 0&&lo(this._tabDropdownButton.element,this._tabsContainer.dropdownActive)}handleButtonPopoutEvent(){if(this._layoutManager.layoutConfig.settings.popoutWholeStack){if(this._popoutEvent===void 0)throw new _t("HHBPOE17834");this._popoutEvent()}else{const r=this._getActiveComponentItemEvent();r&&r.popout()}}handleButtonMaximiseToggleEvent(r){if(this._maximiseToggleEvent===void 0)throw new _t("HHBMTE16834");this._maximiseToggleEvent()}onClick(r){r.target===this._element&&this.notifyClick(r)}onTouchStart(r){r.target===this._element&&this.notifyTouchStart(r)}notifyClick(r){if(this._clickEvent===void 0)throw new _t("HNHC46834");this._clickEvent(r)}notifyTouchStart(r){if(this._touchStartEvent===void 0)throw new _t("HNHTS46834");this._touchStartEvent(r)}}class fs extends hg{constructor(r,a,d){var y,S,x,u,O,V,W,q,F,oe,ie,pe,ve,Ce,je,st,Qe,qe,ct;super(r,a,d,fs.createElement(document)),this._headerSideChanged=!1,this._resizeListener=()=>this.handleResize(),this._maximisedListener=()=>this.handleMaximised(),this._minimisedListener=()=>this.handleMinimised(),this._headerConfig=a.header;const We=r.layoutConfig.header,It=a.content;let Ve;It.length!==1?Ve=void 0:Ve=It[0].header,this._initialWantMaximise=a.maximised,this._initialActiveItemIndex=(y=a.activeItemIndex)!==null&&y!==void 0?y:0;const pi=(u=(x=(S=this._headerConfig)===null||S===void 0?void 0:S.show)!==null&&x!==void 0?x:Ve?.show)!==null&&u!==void 0?u:We.show,tt=(W=(V=(O=this._headerConfig)===null||O===void 0?void 0:O.popout)!==null&&V!==void 0?V:Ve?.popout)!==null&&W!==void 0?W:We.popout,oi=(oe=(F=(q=this._headerConfig)===null||q===void 0?void 0:q.maximise)!==null&&F!==void 0?F:Ve?.maximise)!==null&&oe!==void 0?oe:We.maximise,St=(ve=(pe=(ie=this._headerConfig)===null||ie===void 0?void 0:ie.close)!==null&&pe!==void 0?pe:Ve?.close)!==null&&ve!==void 0?ve:We.close,Zt=(st=(je=(Ce=this._headerConfig)===null||Ce===void 0?void 0:Ce.minimise)!==null&&je!==void 0?je:Ve?.minimise)!==null&&st!==void 0?st:We.minimise,Ri=(ct=(qe=(Qe=this._headerConfig)===null||Qe===void 0?void 0:Qe.tabDropdown)!==null&&qe!==void 0?qe:Ve?.tabDropdown)!==null&&ct!==void 0?ct:We.tabDropdown;this._maximisedEnabled=oi!==!1;const rr={show:pi!==!1,side:pi===!1?po.top:pi,popoutEnabled:tt!==!1,popoutLabel:tt===!1?"":tt,maximiseEnabled:this._maximisedEnabled,maximiseLabel:oi===!1?"":oi,closeEnabled:St!==!1,closeLabel:St===!1?"":St,minimiseEnabled:!0,minimiseLabel:Zt,tabDropdownEnabled:Ri!==!1,tabDropdownLabel:Ri===!1?"":Ri};this._header=new U0(r,this,rr,a.isClosable&&St!==!1,()=>this.getActiveComponentItem(),()=>this.remove(),()=>this.handlePopoutEvent(),()=>this.toggleMaximise(),li=>this.handleHeaderClickEvent(li),li=>this.handleHeaderTouchStartEvent(li),li=>this.handleHeaderComponentRemoveEvent(li),li=>this.handleHeaderComponentFocusEvent(li),(li,yr,Fn,mn)=>this.handleHeaderComponentStartDragEvent(li,yr,Fn,mn)),this.isStack=!0,this._childElementContainer=document.createElement("section"),this._childElementContainer.classList.add("lm_items"),this.on("resize",this._resizeListener),this._maximisedEnabled&&(this.on("maximised",this._maximisedListener),this.on("minimised",this._minimisedListener)),this.element.appendChild(this._header.element),this.element.appendChild(this._childElementContainer),this.setupHeaderPosition(),this._header.updateClosability()}get childElementContainer(){return this._childElementContainer}get header(){return this._header}get headerShow(){return this._header.show}get headerSide(){return this._header.side}get headerLeftRightSided(){return this._header.leftRightSided}get contentAreaDimensions(){return this._contentAreaDimensions}get initialWantMaximise(){return this._initialWantMaximise}get isMaximised(){return this===this.layoutManager.maximisedStack}get stackParent(){if(!this.parent)throw new Error("Stack should always have a parent");return this.parent}updateSize(r){this.layoutManager.beginVirtualSizedContainerAdding();try{this.updateNodeSize(),this.updateContentItemsSize(r)}finally{this.layoutManager.endVirtualSizedContainerAdding()}}init(){if(this.isInitialised===!0)return;this.updateNodeSize();for(let d=0;d<this.contentItems.length;d++)this._childElementContainer.appendChild(this.contentItems[d].element);super.init();const r=this.contentItems,a=r.length;if(a>0){if(this._initialActiveItemIndex<0||this._initialActiveItemIndex>=a)throw new Error(`ActiveItemIndex out of range: ${this._initialActiveItemIndex} id: ${this.id}`);for(let d=0;d<a;d++){const y=r[d];if(y instanceof ta)this._header.createTab(y,d),y.hide(),y.container.setBaseLogicalZIndex();else throw new Error(`Stack Content Item is not of type ComponentItem: ${d} id: ${this.id}`)}this.setActiveComponentItem(r[this._initialActiveItemIndex],!1),this._header.updateTabSizes()}this._header.updateClosability(),this.initContentItems()}setActiveContentItem(r){if(Bn.isComponentItem(r))this.setActiveComponentItem(r,!1);else throw new Error("Stack.setActiveContentItem: item is not a ComponentItem")}setActiveComponentItem(r,a,d=!1){if(this._activeComponentItem!==r){if(this.contentItems.indexOf(r)===-1)throw new Error("componentItem is not a child of this stack");this.layoutManager.beginSizeInvalidation();try{this._activeComponentItem!==void 0&&this._activeComponentItem.hide(),this._activeComponentItem=r,this._header.processActiveComponentChanged(r),r.show()}finally{this.layoutManager.endSizeInvalidation()}this.emit("activeContentItemChanged",r),this.layoutManager.emit("activeContentItemChanged",r),this.emitStateChangedEvent()}(this.focused||a)&&this.layoutManager.setFocusedComponentItem(r,d)}getActiveContentItem(){var r;return(r=this.getActiveComponentItem())!==null&&r!==void 0?r:null}getActiveComponentItem(){return this._activeComponentItem}focusActiveContentItem(){var r;(r=this._activeComponentItem)===null||r===void 0||r.focus()}setFocusedValue(r){this._header.applyFocusedValue(r),super.setFocusedValue(r)}setRowColumnClosable(r){this._header.setRowColumnClosable(r)}newComponent(r,a,d,y){const S={type:"component",componentType:r,componentState:a,title:d};return this.newItem(S,y)}addComponent(r,a,d,y){const S={type:"component",componentType:r,componentState:a,title:d};return this.addItem(S,y)}newItem(r,a){return a=this.addItem(r,a),this.contentItems[a]}addItem(r,a){this.layoutManager.checkMinimiseMaximisedStack();const d=Ci.resolve(r,!1),y=this.layoutManager.createAndInitContentItem(d,this);return this.addChild(y,a)}addChild(r,a,d=!1){if(a!==void 0&&a>this.contentItems.length)throw a-=1,new Lt("SAC99728");if(r instanceof ta)return a=super.addChild(r,a),this._childElementContainer.appendChild(r.element),this._header.createTab(r,a),this.setActiveComponentItem(r,d),this._header.updateTabSizes(),this.updateSize(!1),r.container.setBaseLogicalZIndex(),this._header.updateClosability(),this.emitStateChangedEvent(),a;throw new Lt("SACC88532")}removeChild(r,a){const d=r,y=this.contentItems.indexOf(d),S=this.contentItems.length===1;if(this._activeComponentItem===d&&(d.focused&&d.blur(),!S)){const x=y===0?1:y-1;this.setActiveComponentItem(this.contentItems[x],!1)}this._header.removeTab(d),super.removeChild(d,a),S||this._header.updateClosability(),this.emitStateChangedEvent()}toggleMaximise(){this.isMaximised?this.minimise():this.maximise()}maximise(){if(!this.isMaximised){this.layoutManager.setMaximisedStack(this);const r=this.contentItems,a=r.length;for(let d=0;d<a;d++){const y=r[d];if(y instanceof ta)y.enterStackMaximised();else throw new Lt("SMAXI87773")}this.emitStateChangedEvent()}}minimise(){if(this.isMaximised){this.layoutManager.setMaximisedStack(void 0);const r=this.contentItems,a=r.length;for(let d=0;d<a;d++){const y=r[d];if(y instanceof ta)y.exitStackMaximised();else throw new Lt("SMINI87773")}this.emitStateChangedEvent()}}destroy(){var r;!((r=this._activeComponentItem)===null||r===void 0)&&r.focused&&this._activeComponentItem.blur(),super.destroy(),this.off("resize",this._resizeListener),this._maximisedEnabled&&(this.off("maximised",this._maximisedListener),this.off("minimised",this._minimisedListener)),this._header.destroy()}toConfig(){let r;if(this._activeComponentItem&&(r=this.contentItems.indexOf(this._activeComponentItem),r<0))throw new Error("active component item not found in stack");if(this.contentItems.length>0&&r===void 0)throw new Error("expected non-empty stack to have an active component item");return{type:"stack",content:this.calculateConfigContent(),size:this.size,sizeUnit:this.sizeUnit,minSize:this.minSize,minSizeUnit:this.minSizeUnit,id:this.id,isClosable:this.isClosable,maximised:this.isMaximised,header:this.createHeaderConfig(),activeItemIndex:r}}onDrop(r,a){if(this._dropSegment==="header"){if(this.resetHeaderDropZone(),this._dropIndex===void 0)throw new _t("SODDI68990");this.addChild(r,this._dropIndex);return}if(this._dropSegment==="body"){this.addChild(r,0,!0);return}const d=this._dropSegment==="top"||this._dropSegment==="bottom",y=this._dropSegment==="left"||this._dropSegment==="right",S=this._dropSegment==="top"||this._dropSegment==="left",x=d&&this.stackParent.isColumn||y&&this.stackParent.isRow;if(r.isComponent){const u=_s.createDefault();u.header=this.createHeaderConfig();const O=this.layoutManager.createAndInitContentItem(u,this);O.addChild(r),r=O}if(r.type===Te.row||r.type===Te.column){const u=_s.createDefault();u.header=this.createHeaderConfig();const O=this.layoutManager.createContentItem(u,this);O.addChild(r),r=O}if(x){const u=this.stackParent.contentItems.indexOf(this);this.stackParent.addChild(r,S?u:u+1,!0),this.size*=.5,r.size=this.size,r.sizeUnit=this.sizeUnit,this.stackParent.updateSize(!1)}else{const u=d?Te.column:Te.row,O=Tt.createDefault(u),V=this.layoutManager.createContentItem(O,this);this.stackParent.replaceChild(this,V),V.addChild(r,S?0:void 0,!0),V.addChild(this,S?void 0:0,!0),this.size=50,r.size=50,r.sizeUnit=Nt.Percent,V.updateSize(!1)}}highlightDropZone(r,a){for(const d in this._contentAreaDimensions){const y=d,S=this._contentAreaDimensions[y].hoverArea;if(S.x1<r&&S.x2>r&&S.y1<a&&S.y2>a){y==="header"?(this._dropSegment="header",this.highlightHeaderDropZone(this._header.leftRightSided?a:r)):(this.resetHeaderDropZone(),this.highlightBodyDropZone(y));return}}}getArea(){if(this.element.style.display==="none")return null;const r=super.getElementArea(this._header.element),a=super.getElementArea(this._childElementContainer);if(r===null||a===null)throw new di("SGAHC13086");const d=a.x2-a.x1,y=a.y2-a.y1;return this._contentAreaDimensions={header:{hoverArea:{x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2},highlightArea:{x1:r.x1,y1:r.y1,x2:r.x2,y2:r.y2}}},this.contentItems.length===0?(this._contentAreaDimensions.body={hoverArea:{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2},highlightArea:{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y2}},super.getElementArea(this.element)):(this._contentAreaDimensions.left={hoverArea:{x1:a.x1,y1:a.y1,x2:a.x1+d*.25,y2:a.y2},highlightArea:{x1:a.x1,y1:a.y1,x2:a.x1+d*.5,y2:a.y2}},this._contentAreaDimensions.top={hoverArea:{x1:a.x1+d*.25,y1:a.y1,x2:a.x1+d*.75,y2:a.y1+y*.5},highlightArea:{x1:a.x1,y1:a.y1,x2:a.x2,y2:a.y1+y*.5}},this._contentAreaDimensions.right={hoverArea:{x1:a.x1+d*.75,y1:a.y1,x2:a.x2,y2:a.y2},highlightArea:{x1:a.x1+d*.5,y1:a.y1,x2:a.x2,y2:a.y2}},this._contentAreaDimensions.bottom={hoverArea:{x1:a.x1+d*.25,y1:a.y1+y*.5,x2:a.x1+d*.75,y2:a.y2},highlightArea:{x1:a.x1,y1:a.y1+y*.5,x2:a.x2,y2:a.y2}},super.getElementArea(this.element))}positionHeader(r){this._header.side!==r&&(this._header.setSide(r),this._headerSideChanged=!0,this.setupHeaderPosition())}updateNodeSize(){if(this.element.style.display!=="none"){const r=ao(this.element);if(this._header.show){const a=this._header.leftRightSided?uh.width:uh.height;r[a]-=this.layoutManager.layoutConfig.dimensions.headerHeight}this._childElementContainer.style.width=Rt(r.width),this._childElementContainer.style.height=Rt(r.height);for(let a=0;a<this.contentItems.length;a++)this.contentItems[a].element.style.width=Rt(r.width),this.contentItems[a].element.style.height=Rt(r.height);this.emit("resize"),this.emitStateChangedEvent()}}highlightHeaderDropZone(r){const a=this._header.lastVisibleTabIndex+1,y=this._header.tabsContainerElement.childNodes,S=new Array(a);let x=0,u=0;for(;u<a;){const W=y[x++];W!==this.layoutManager.tabDropPlaceholder&&(S[u++]=W)}const O=this.layoutManager.dropTargetIndicator;if(O===null)throw new di("SHHDZDTI97110");let V;if(a===0){const W=this._header.element.getBoundingClientRect(),q=W.top+document.body.scrollTop,F=W.left+document.body.scrollLeft;V={x1:F,x2:F+100,y1:q+W.height-20,y2:q+W.height},this._dropIndex=0}else{let W=0,q=!1,F,oe,ie,pe;do{pe=S[W];const qe=pe.getBoundingClientRect(),ct=qe.top+document.body.scrollTop,We=qe.left+document.body.scrollLeft;this._header.leftRightSided?(oe=ct,F=We,ie=qe.height):(oe=We,F=ct,ie=qe.width),r>=oe&&r<oe+ie?q=!0:W++}while(W<a&&!q);if(q===!1&&r<oe)return;const ve=oe+ie/2;r<ve?(this._dropIndex=W,pe.insertAdjacentElement("beforebegin",this.layoutManager.tabDropPlaceholder)):(this._dropIndex=Math.min(W+1,a),pe.insertAdjacentElement("afterend",this.layoutManager.tabDropPlaceholder));const Ce=this.layoutManager.tabDropPlaceholder.getBoundingClientRect(),je=Ce.top+document.body.scrollTop,st=Ce.left+document.body.scrollLeft,Qe=Ce.width;if(this._header.leftRightSided){const qe=je;V={x1:F,x2:F+pe.clientHeight,y1:qe,y2:qe+Qe}}else{const qe=st;V={x1:qe,x2:qe+Qe,y1:F,y2:F+pe.clientHeight}}}O.highlightArea(V,0)}resetHeaderDropZone(){this.layoutManager.tabDropPlaceholder.remove()}setupHeaderPosition(){lo(this._header.element,this._header.show),this.element.classList.remove("lm_left","lm_right","lm_bottom"),this._header.leftRightSided&&this.element.classList.add("lm_"+this._header.side),this.updateSize(!1)}highlightBodyDropZone(r){if(this._contentAreaDimensions===void 0)throw new _t("SHBDZC82265");{const a=this._contentAreaDimensions[r].highlightArea,d=this.layoutManager.dropTargetIndicator;if(d===null)throw new di("SHBDZD96110");d.highlightArea(a,1),this._dropSegment=r}}handleResize(){this._header.updateTabSizes()}handleMaximised(){this._header.processMaximised()}handleMinimised(){this._header.processMinimised()}handlePopoutEvent(){this.popout()}handleHeaderClickEvent(r){const a=Ti.headerClickEventName,d=new Ti.ClickBubblingEvent(a,this,r);this.emit(a,d)}handleHeaderTouchStartEvent(r){const a=Ti.headerTouchStartEventName,d=new Ti.TouchStartBubblingEvent(a,this,r);this.emit(a,d)}handleHeaderComponentRemoveEvent(r){this.removeChild(r,!1)}handleHeaderComponentFocusEvent(r){this.setActiveComponentItem(r,!0)}handleHeaderComponentStartDragEvent(r,a,d,y){this.isMaximised===!0&&this.toggleMaximise(),this.layoutManager.startComponentDrag(r,a,d,y,this)}createHeaderConfig(){if(this._headerSideChanged){const r=this._header.show?this._header.side:!1;let a=_r.Header.createCopy(this._headerConfig,r);return a===void 0&&(a={show:r,popout:void 0,maximise:void 0,close:void 0,minimise:void 0,tabDropdown:void 0}),a}else return _r.Header.createCopy(this._headerConfig)}emitStateChangedEvent(){this.emitBaseBubblingEvent("stateChanged")}}(function(p){function r(a){const d=a.createElement("div");return d.classList.add("lm_item"),d.classList.add("lm_stack"),d}p.createElement=r})(fs||(fs={}));class dg extends Ti{constructor(r,a,d,y,S,x){if(super(),this._dragListener=d,this._layoutManager=y,this._componentItem=S,this._originalParent=x,this._area=null,this._lastValidArea=null,this._dragListener.on("drag",(u,O,V)=>this.onDrag(u,O,V)),this._dragListener.on("dragStop",()=>this.onDrop()),this.createDragProxyElements(r,a),this._componentItem.parent===null)throw new di("DPC10097");this._componentItemFocused=this._componentItem.focused,this._componentItemFocused&&this._componentItem.blur(),this._componentItem.parent.removeChild(this._componentItem,!0),this.setDimensions(),document.body.appendChild(this._element),this.determineMinMaxXY(),this._layoutManager.calculateItemAreas(),this.setDropPosition(r,a)}get element(){return this._element}createDragProxyElements(r,a){this._element=document.createElement("div"),this._element.classList.add("lm_dragProxy");const d=document.createElement("div");d.classList.add("lm_header");const y=document.createElement("div");y.classList.add("lm_tabs");const S=document.createElement("div");S.classList.add("lm_tab");const x=document.createElement("span");x.classList.add("lm_title"),S.appendChild(x),y.appendChild(S),d.appendChild(y),this._proxyContainerElement=document.createElement("div"),this._proxyContainerElement.classList.add("lm_content"),this._element.appendChild(d),this._element.appendChild(this._proxyContainerElement),this._originalParent instanceof fs&&this._originalParent.headerShow&&(this._sided=this._originalParent.headerLeftRightSided,this._element.classList.add("lm_"+this._originalParent.headerSide),[po.right,po.bottom].indexOf(this._originalParent.headerSide)>=0&&this._proxyContainerElement.insertAdjacentElement("afterend",d)),this._element.style.left=Rt(r),this._element.style.top=Rt(a),S.setAttribute("title",this._componentItem.title),x.insertAdjacentText("afterbegin",this._componentItem.title),this._proxyContainerElement.appendChild(this._componentItem.element)}determineMinMaxXY(){const r=this._layoutManager.groundItem;if(r===void 0)throw new _t("DPDMMXY73109");{const d=r.element.getBoundingClientRect();this._minX=d.left+document.body.scrollLeft,this._minY=d.top+document.body.scrollTop,this._maxX=this._minX+d.width,this._maxY=this._minY+d.height}}onDrag(r,a,d){const y=d.pageX,S=d.pageY;this.setDropPosition(y,S),this._componentItem.drag()}setDropPosition(r,a){this._layoutManager.layoutConfig.settings.constrainDragToContainer&&(r<=this._minX?r=Math.ceil(this._minX):r>=this._maxX&&(r=Math.floor(this._maxX)),a<=this._minY?a=Math.ceil(this._minY):a>=this._maxY&&(a=Math.floor(this._maxY))),this._element.style.left=Rt(r),this._element.style.top=Rt(a),this._area=this._layoutManager.getArea(r,a),this._area!==null&&(this._lastValidArea=this._area,this._area.contentItem.highlightDropZone(r,a,this._area))}onDrop(){const r=this._layoutManager.dropTargetIndicator;if(r===null)throw new di("DPOD30011");r.hide(),this._componentItem.exitDragMode();let a;this._area!==null?(a=this._componentItem,this._area.contentItem.onDrop(a,this._area)):this._lastValidArea!==null?(a=this._componentItem,this._lastValidArea.contentItem.onDrop(a,this._lastValidArea)):this._originalParent?(a=this._componentItem,this._originalParent.addChild(a)):this._componentItem.destroy(),this._element.remove(),this._layoutManager.emit("itemDropped",this._componentItem),this._componentItemFocused&&a!==void 0&&a.focus()}setDimensions(){const r=this._layoutManager.layoutConfig.dimensions;if(r===void 0)throw new Error("DragProxy.setDimensions: dimensions undefined");let a=r.dragProxyWidth,d=r.dragProxyHeight;if(a===void 0||d===void 0)throw new Error("DragProxy.setDimensions: width and/or height undefined");const y=this._layoutManager.layoutConfig.header.show===!1?0:r.headerHeight;this._element.style.width=Rt(a),this._element.style.height=Rt(d),a-=this._sided?y:0,d-=this._sided?0:y,this._proxyContainerElement.style.width=Rt(a),this._proxyContainerElement.style.height=Rt(d),this._componentItem.enterDragMode(a,d),this._componentItem.show()}}class Zc{constructor(r,a,d,y,S,x,u){this._layoutManager=r,this._element=a,this._extraAllowableChildTargets=d,this._componentTypeOrFtn=y,this._componentState=S,this._title=x,this._id=u,this._dragListener=null,this._dummyGroundContainer=document.createElement("div");const O=dl.createDefault("row");this._dummyGroundContentItem=new fo(this._layoutManager,O,this._dummyGroundContainer),this.createDragListener()}destroy(){this.removeDragListener()}createDragListener(){this.removeDragListener(),this._dragListener=new hp(this._element,this._extraAllowableChildTargets),this._dragListener.on("dragStart",(r,a)=>this.onDragStart(r,a)),this._dragListener.on("dragStop",()=>this.onDragStop())}onDragStart(r,a){var d;const y="component";let S;if(typeof this._componentTypeOrFtn=="function"){const O=this._componentTypeOrFtn();Zc.isDragSourceComponentItemConfig(O)?S={type:y,componentState:O.state,componentType:O.type,title:(d=O.title)!==null&&d!==void 0?d:this._title}:S=O}else S={type:y,componentState:this._componentState,componentType:this._componentTypeOrFtn,title:this._title,id:this._id};const x=mo.resolve(S,!1),u=new ta(this._layoutManager,x,this._dummyGroundContentItem);if(this._dummyGroundContentItem.contentItems.push(u),this._dragListener===null)throw new di("DSODSD66746");{const O=new dg(r,a,this._dragListener,this._layoutManager,u,this._dummyGroundContentItem),V=this._layoutManager.transitionIndicator;if(V===null)throw new di("DSODST66746");V.transitionElements(this._element,O.element)}}onDragStop(){this.createDragListener()}removeDragListener(){this._dragListener!==null&&(this._dragListener.destroy(),this._dragListener=null)}}(function(p){function r(a){return!("componentType"in a)}p.isDragSourceComponentItemConfig=r})(Zc||(Zc={}));class $0{constructor(){this._element=document.createElement("div"),this._element.classList.add("lm_dropTargetIndicator");const r=document.createElement("div");r.classList.add("lm_inner"),this._element.appendChild(r),document.body.appendChild(this._element)}destroy(){this._element.remove()}highlightArea(r,a){this._element.style.left=Rt(r.x1+a),this._element.style.top=Rt(r.y1+a),this._element.style.width=Rt(r.x2-r.x1-a),this._element.style.height=Rt(r.y2-r.y1-a),this._element.style.display="block"}hide(){lo(this._element,!1)}}class j0{constructor(){this._element=document.createElement("div"),this._element.classList.add("lm_transition_indicator"),document.body.appendChild(this._element),this._toElement=null,this._fromDimensions=null,this._totalAnimationDuration=200,this._animationStartTime=null}destroy(){this._element.remove()}transitionElements(r,a){}nextAnimationFrame(){}measure(r){const a=r.getBoundingClientRect();return{left:a.left,top:a.top,width:r.offsetWidth,height:r.offsetHeight}}}class ra extends Ti{constructor(r){super(),this._layoutManager=r,this._childEventListener=a=>this.onEventFromChild(a),globalThis.addEventListener(ra.ChildEventName,this._childEventListener,{passive:!0})}emit(r,...a){r==="userBroadcast"?this.emitUserBroadcast(...a):super.emit(r,...a)}emitUserBroadcast(...r){this.handleUserBroadcastEvent("userBroadcast",r)}destroy(){globalThis.removeEventListener(ra.ChildEventName,this._childEventListener)}handleUserBroadcastEvent(r,a){this._layoutManager.isSubWindow?this.propagateToParent(r,a):this.propagateToThisAndSubtree(r,a)}onEventFromChild(r){const a=r.detail;this.handleUserBroadcastEvent(a.eventName,a.args)}propagateToParent(r,a){const y={bubbles:!0,cancelable:!0,detail:{layoutManager:this._layoutManager,eventName:r,args:a}},S=new CustomEvent(ra.ChildEventName,y),x=globalThis.opener;if(x===null)throw new di("EHPTP15778");x.dispatchEvent(S)}propagateToThisAndSubtree(r,a){this.emitUnknown(r,...a);for(let d=0;d<this._layoutManager.openPopouts.length;d++){const y=this._layoutManager.openPopouts[d].getGlInstance();y&&y.eventHub.propagateToThisAndSubtree(r,a)}}}(function(p){p.ChildEventName="gl_child_event"})(ra||(ra={}));class sa extends Ti{constructor(r){super(),this.resizeWithContainerAutomatically=!1,this.resizeDebounceInterval=100,this.resizeDebounceExtendedWhenPossible=!0,this._isInitialised=!1,this._groundItem=void 0,this._openPopouts=[],this._dropTargetIndicator=null,this._transitionIndicator=null,this._itemAreas=[],this._maximisePlaceholder=sa.createMaximisePlaceElement(document),this._tabDropPlaceholder=sa.createTabDropPlaceholderElement(document),this._dragSources=[],this._updatingColumnsResponsive=!1,this._firstLoad=!0,this._eventHub=new ra(this),this._width=null,this._height=null,this._virtualSizedContainers=[],this._virtualSizedContainerAddingBeginCount=0,this._sizeInvalidationBeginCount=0,this._resizeObserver=new ResizeObserver(()=>this.handleContainerResize()),this._windowBeforeUnloadListener=()=>this.onBeforeUnload(),this._windowBeforeUnloadListening=!1,this._maximisedStackBeforeDestroyedListener=a=>this.cleanupBeforeMaximisedStackDestroyed(a),this.isSubWindow=r.isSubWindow,this._constructorOrSubWindowLayoutConfig=r.constructorOrSubWindowLayoutConfig,ch.checkInitialise(),jc.checkInitialise(),r.containerElement!==void 0&&(this._containerElement=r.containerElement)}get container(){return this._containerElement}get isInitialised(){return this._isInitialised}get groundItem(){return this._groundItem}get root(){return this._groundItem}get openPopouts(){return this._openPopouts}get dropTargetIndicator(){return this._dropTargetIndicator}get transitionIndicator(){return this._transitionIndicator}get width(){return this._width}get height(){return this._height}get eventHub(){return this._eventHub}get rootItem(){if(this._groundItem===void 0)throw new Error("Cannot access rootItem before init");return this._groundItem.contentItems.length===0?void 0:this._groundItem.contentItems[0]}get focusedComponentItem(){return this._focusedComponentItem}get tabDropPlaceholder(){return this._tabDropPlaceholder}get maximisedStack(){return this._maximisedStack}get deprecatedConstructor(){return!this.isSubWindow&&this._constructorOrSubWindowLayoutConfig!==void 0}destroy(){if(this._isInitialised){this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1),this.layoutConfig.settings.closePopoutsOnUnload===!0&&this.closeAllOpenPopouts(),this._resizeObserver.disconnect(),this.checkClearResizeTimeout(),this._groundItem!==void 0&&this._groundItem.destroy(),this._tabDropPlaceholder.remove(),this._dropTargetIndicator!==null&&this._dropTargetIndicator.destroy(),this._transitionIndicator!==null&&this._transitionIndicator.destroy(),this._eventHub.destroy();for(const r of this._dragSources)r.destroy();this._dragSources=[],this._isInitialised=!1}}minifyConfig(r){return mt.minifyConfig(r)}unminifyConfig(r){return mt.unminifyConfig(r)}init(){this.setContainer(),this._dropTargetIndicator=new $0,this._transitionIndicator=new j0,this.updateSizeFromContainer();let r;if(this.isSubWindow){if(this._constructorOrSubWindowLayoutConfig===void 0)throw new _t("LMIU07155");{const d=this._constructorOrSubWindowLayoutConfig.root;if(d===void 0)throw new Lt("LMIC07156");if(Ci.isComponent(d))r=d;else throw new Lt("LMIC07157");const y=Qn.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},y),{root:void 0})}}else this._constructorOrSubWindowLayoutConfig===void 0?this.layoutConfig=mt.createDefault():this.layoutConfig=Qn.resolve(this._constructorOrSubWindowLayoutConfig);const a=this.layoutConfig;this._groundItem=new fo(this,a.root,this._containerElement),this._groundItem.init(),this.checkLoadedLayoutMaximiseItem(),this._resizeObserver.observe(this._containerElement),this._isInitialised=!0,this.adjustColumnsResponsive(),this.emit("initialised"),r!==void 0&&this.loadComponentAsRoot(r)}loadLayout(r){if(this.isInitialised){if(this._groundItem===void 0)throw new _t("LMLL11119");this.createSubWindows(),this.layoutConfig=Qn.resolve(r),this._groundItem.loadRoot(this.layoutConfig.root),this.checkLoadedLayoutMaximiseItem(),this.adjustColumnsResponsive()}else throw new Error("GoldenLayout: Need to call init() if LayoutConfig with defined root passed to constructor")}saveLayout(){if(this._isInitialised===!1)throw new Error("Can't create config, layout not yet initialised");if(this._groundItem===void 0)throw new _t("LMTC18244");{const r=this._groundItem.calculateConfigContent();let a;r.length!==1?a=void 0:a=r[0],this.reconcilePopoutWindows();const d=[];for(let S=0;S<this._openPopouts.length;S++)d.push(this._openPopouts[S].toConfig());return{root:a,openPopouts:d,settings:mt.Settings.createCopy(this.layoutConfig.settings),dimensions:mt.Dimensions.createCopy(this.layoutConfig.dimensions),header:mt.Header.createCopy(this.layoutConfig.header),resolved:!0}}}clear(){if(this._groundItem===void 0)throw new _t("LMCL11129");this._groundItem.clearRoot()}toConfig(){return this.saveLayout()}newComponent(r,a,d){const y=this.newComponentAtLocation(r,a,d);if(y===void 0)throw new Lt("LMNC65588");return y}newComponentAtLocation(r,a,d,y){if(this._groundItem===void 0)throw new Error("Cannot add component before init");{const S=this.addComponentAtLocation(r,a,d,y);if(S===void 0)return;{const x=S.parentItem.contentItems[S.index];if(Bn.isComponentItem(x))return x;throw new Lt("LMNC992877533")}}}addComponent(r,a,d){const y=this.addComponentAtLocation(r,a,d);if(y===void 0)throw new Lt("LMAC99943");return y}addComponentAtLocation(r,a,d,y){const S={type:"component",componentType:r,componentState:a,title:d};return this.addItemAtLocation(S,y)}newItem(r){const a=this.newItemAtLocation(r);if(a===void 0)throw new Lt("LMNC65588");return a}newItemAtLocation(r,a){if(this._groundItem===void 0)throw new Error("Cannot add component before init");{const d=this.addItemAtLocation(r,a);return d===void 0?void 0:d.parentItem.contentItems[d.index]}}addItem(r){const a=this.addItemAtLocation(r);if(a===void 0)throw new Lt("LMAI99943");return a}addItemAtLocation(r,a){if(this._groundItem===void 0)throw new Error("Cannot add component before init");{a===void 0&&(a=sa.defaultLocationSelectors);const d=this.findFirstLocation(a);if(d===void 0)return;{let y=d.parentItem,S;switch(y.type){case Te.ground:{S=y.addItem(r,d.index),S>=0?y=this._groundItem.contentItems[0]:S=0;break}case Te.row:case Te.column:{S=y.addItem(r,d.index);break}case Te.stack:if(Ci.isComponent(r)){S=y.addItem(r,d.index);break}else throw Error(Ln[6]);case Te.component:throw new Lt("LMAIALC87444602");default:throw new ir("LMAIALU98881733",y.type)}if(Ci.isComponent(r)){const x=y.contentItems[S];Bn.isStack(x)&&(y=x,S=0)}return d.parentItem=y,d.index=S,d}}}loadComponentAsRoot(r){if(this._groundItem===void 0)throw new Error("Cannot add item before init");this._groundItem.loadComponentAsRoot(r)}updateSize(r,a){this.setSize(r,a)}setSize(r,a){if(this._width=r,this._height=a,this._isInitialised===!0){if(this._groundItem===void 0)throw new _t("LMUS18881");if(this._groundItem.setSize(this._width,this._height),this._maximisedStack){const{width:d,height:y}=ao(this._containerElement);er(this._maximisedStack.element,d),tr(this._maximisedStack.element,y),this._maximisedStack.updateSize(!1)}this.adjustColumnsResponsive()}}beginSizeInvalidation(){this._sizeInvalidationBeginCount++}endSizeInvalidation(){--this._sizeInvalidationBeginCount===0&&this.updateSizeFromContainer()}updateSizeFromContainer(){const{width:r,height:a}=ao(this._containerElement);this.setSize(r,a)}updateRootSize(r=!1){if(this._groundItem===void 0)throw new _t("LMURS28881");this._groundItem.updateSize(r)}createAndInitContentItem(r,a){const d=this.createContentItem(r,a);return d.init(),d}createContentItem(r,a){if(typeof r.type!="string")throw new na("Missing parameter 'type'",JSON.stringify(r));return Tt.isComponentItem(r)&&!(a instanceof fs)&&a&&!(this.isSubWindow===!0&&a instanceof fo)&&(r={type:Te.stack,content:[r],size:r.size,sizeUnit:r.sizeUnit,minSize:r.minSize,minSizeUnit:r.minSizeUnit,id:r.id,maximised:r.maximised,isClosable:r.isClosable,activeItemIndex:0,header:void 0}),this.createContentItemFromConfig(r,a)}findFirstComponentItemById(r){if(this._groundItem===void 0)throw new _t("LMFFCIBI82446");return this.findFirstContentItemTypeByIdRecursive(Te.component,r,this._groundItem)}createPopout(r,a,d,y){return r instanceof Bn?this.createPopoutFromContentItem(r,a,d,y):this.createPopoutFromItemConfig(r,a,d,y)}createPopoutFromContentItem(r,a,d,y){let S=r.parent,x=r;for(;S!==null&&S.contentItems.length===1&&!S.isGround;)x=S,S=S.parent;if(S===null)throw new di("LMCPFCI00834");{if(y===void 0&&(y=S.contentItems.indexOf(x)),d!==null&&S.addPopInParentId(d),a===void 0){const O=globalThis.screenX||globalThis.screenLeft,V=globalThis.screenY||globalThis.screenTop,W=r.element.offsetLeft,q=r.element.offsetTop,{width:F,height:oe}=ao(r.element);a={left:O+W,top:V+q,width:F,height:oe}}const u=r.toConfig();if(r.remove(),oa.isRootItemConfig(u))return this.createPopoutFromItemConfig(u,a,d,y);throw new Error(`${Ln[0]}`)}}beginVirtualSizedContainerAdding(){++this._virtualSizedContainerAddingBeginCount===0&&(this._virtualSizedContainers.length=0)}addVirtualSizedContainer(r){this._virtualSizedContainers.push(r)}endVirtualSizedContainerAdding(){if(--this._virtualSizedContainerAddingBeginCount===0){const r=this._virtualSizedContainers.length;if(r>0){this.fireBeforeVirtualRectingEvent(r);for(let a=0;a<r;a++)this._virtualSizedContainers[a].notifyVirtualRectingRequired();this.fireAfterVirtualRectingEvent(),this._virtualSizedContainers.length=0}}}fireBeforeVirtualRectingEvent(r){this.beforeVirtualRectingEvent!==void 0&&this.beforeVirtualRectingEvent(r)}fireAfterVirtualRectingEvent(){this.afterVirtualRectingEvent!==void 0&&this.afterVirtualRectingEvent()}createPopoutFromItemConfig(r,a,d,y){const S=this.toConfig(),x={root:r,openPopouts:[],settings:S.settings,dimensions:S.dimensions,header:S.header,window:a,parentId:d,indexInParent:y,resolved:!0};return this.createPopoutFromPopoutLayoutConfig(x)}createPopoutFromPopoutLayoutConfig(r){var a,d,y,S;const x=r.window,u={left:(a=x.left)!==null&&a!==void 0?a:globalThis.screenX||globalThis.screenLeft+20,top:(d=x.top)!==null&&d!==void 0?d:globalThis.screenY||globalThis.screenTop+20,width:(y=x.width)!==null&&y!==void 0?y:500,height:(S=x.height)!==null&&S!==void 0?S:309},O=new F0(r,u,this);return O.on("initialised",()=>this.emit("windowOpened",O)),O.on("closed",()=>this.reconcilePopoutWindows()),this._openPopouts.push(O),this.layoutConfig.settings.closePopoutsOnUnload&&!this._windowBeforeUnloadListening&&(globalThis.addEventListener("beforeunload",this._windowBeforeUnloadListener,{passive:!0}),this._windowBeforeUnloadListening=!0),O}closeAllOpenPopouts(){for(let r=0;r<this._openPopouts.length;r++)this._openPopouts[r].close();this._openPopouts.length=0,this._windowBeforeUnloadListening&&(globalThis.removeEventListener("beforeunload",this._windowBeforeUnloadListener),this._windowBeforeUnloadListening=!1)}newDragSource(r,a,d,y,S){const x=new Zc(this,r,[],a,d,y,S);return this._dragSources.push(x),x}removeDragSource(r){L0(r,this._dragSources),r.destroy()}startComponentDrag(r,a,d,y,S){new dg(r,a,d,this,y,S)}focusComponent(r,a=!1){r.focus(a)}clearComponentFocus(r=!1){this.setFocusedComponentItem(void 0,r)}setFocusedComponentItem(r,a=!1){if(r!==this._focusedComponentItem){let d;if(r===void 0||(d=r.parentItem),this._focusedComponentItem!==void 0){const y=this._focusedComponentItem;this._focusedComponentItem=void 0,y.setBlurred(a);const S=y.parentItem;d===S?d=void 0:S.setFocusedValue(!1)}r!==void 0&&(this._focusedComponentItem=r,r.setFocused(a),d!==void 0&&d.setFocusedValue(!0))}}createContentItemFromConfig(r,a){switch(r.type){case Te.ground:throw new Lt("LMCCIFC68871");case Te.row:return new aa(!1,this,r,a);case Te.column:return new aa(!0,this,r,a);case Te.stack:return new fs(this,r,a);case Te.component:return new ta(this,r,a);default:throw new ir("CCC913564",r.type,"Invalid Config Item type specified")}}setMaximisedStack(r){r===void 0?this._maximisedStack!==void 0&&this.processMinimiseMaximisedStack():r!==this._maximisedStack&&(this._maximisedStack!==void 0&&this.processMinimiseMaximisedStack(),this.processMaximiseStack(r))}checkMinimiseMaximisedStack(){this._maximisedStack!==void 0&&this._maximisedStack.minimise()}cleanupBeforeMaximisedStackDestroyed(r){this._maximisedStack!==null&&this._maximisedStack===r.target&&(this._maximisedStack.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),this._maximisedStack=void 0)}closeWindow(){globalThis.setTimeout(()=>globalThis.close(),1)}getArea(r,a){let d=null,y=1/0;for(let S=0;S<this._itemAreas.length;S++){const x=this._itemAreas[S];r>=x.x1&&r<x.x2&&a>=x.y1&&a<x.y2&&y>x.surface&&(y=x.surface,d=x)}return d}calculateItemAreas(){const r=this.getAllContentItems(),a=this._groundItem;if(a===void 0)throw new _t("LMCIAR44365");if(r.length===1){const d=a.getElementArea();if(d===null)throw new di("LMCIARA44365");this._itemAreas=[d];return}else{a.contentItems[0].isStack?this._itemAreas=[]:this._itemAreas=a.createSideAreas();for(let d=0;d<r.length;d++){const y=r[d];if(Bn.isStack(y)){const S=y.getArea();if(S===null)continue;{this._itemAreas.push(S);const x=y.contentAreaDimensions;if(x===void 0)throw new _t("LMCIASC45599");{const u=x.header.highlightArea,O=(u.x2-u.x1)*(u.y2-u.y1),V={x1:u.x1,x2:u.x2,y1:u.y1,y2:u.y2,contentItem:y,surface:O};this._itemAreas.push(V)}}}}}}checkLoadedLayoutMaximiseItem(){if(this._groundItem===void 0)throw new _t("LMCLLMI43432");{const r=this._groundItem.getConfigMaximisedItems();if(r.length>0){let a=r[0];if(Bn.isComponentItem(a)){const d=a.parent;if(d===null)throw new di("LMXLLMI69999");a=d}if(Bn.isStack(a))a.maximise();else throw new Lt("LMCLLMI19993")}}}processMaximiseStack(r){if(this._maximisedStack=r,r.on("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),r.element.classList.add("lm_maximised"),r.element.insertAdjacentElement("afterend",this._maximisePlaceholder),this._groundItem===void 0)throw new _t("LMMXI19993");{this._groundItem.element.prepend(r.element);const{width:a,height:d}=ao(this._containerElement);er(r.element,a),tr(r.element,d),r.updateSize(!0),r.focusActiveContentItem(),this._maximisedStack.emit("maximised"),this.emit("stateChanged")}}processMinimiseMaximisedStack(){if(this._maximisedStack===void 0)throw new Lt("LMMMS74422");{const r=this._maximisedStack;if(r.parent===null)throw new di("LMMI13668");r.element.classList.remove("lm_maximised"),this._maximisePlaceholder.insertAdjacentElement("afterend",r.element),this._maximisePlaceholder.remove(),this.updateRootSize(!0),this._maximisedStack=void 0,r.off("beforeItemDestroyed",this._maximisedStackBeforeDestroyedListener),r.emit("minimised"),this.emit("stateChanged")}}reconcilePopoutWindows(){const r=[];for(let a=0;a<this._openPopouts.length;a++)this._openPopouts[a].getWindow().closed===!1?r.push(this._openPopouts[a]):this.emit("windowClosed",this._openPopouts[a]);this._openPopouts.length!==r.length&&(this._openPopouts=r,this.emit("stateChanged"))}getAllContentItems(){if(this._groundItem===void 0)throw new _t("LMGACI13130");return this._groundItem.getAllContentItems()}createSubWindows(){for(let r=0;r<this.layoutConfig.openPopouts.length;r++){const a=this.layoutConfig.openPopouts[r];this.createPopoutFromPopoutLayoutConfig(a)}}handleContainerResize(){this.resizeWithContainerAutomatically&&this.processResizeWithDebounce()}processResizeWithDebounce(){this.resizeDebounceExtendedWhenPossible&&this.checkClearResizeTimeout(),this._resizeTimeoutId===void 0&&(this._resizeTimeoutId=setTimeout(()=>{this._resizeTimeoutId=void 0,this.beginSizeInvalidation(),this.endSizeInvalidation()},this.resizeDebounceInterval))}checkClearResizeTimeout(){this._resizeTimeoutId!==void 0&&(clearTimeout(this._resizeTimeoutId),this._resizeTimeoutId=void 0)}setContainer(){var r;const a=document.body,d=(r=this._containerElement)!==null&&r!==void 0?r:a;if(d===a){this.resizeWithContainerAutomatically=!0;const y=document.documentElement;y.style.height="100%",y.style.margin="0",y.style.padding="0",y.style.overflow="clip",a.style.height="100%",a.style.margin="0",a.style.padding="0",a.style.overflow="clip"}this._containerElement=d}onBeforeUnload(){this.destroy()}adjustColumnsResponsive(){if(this._groundItem===void 0)throw new _t("LMACR20883");if(this._firstLoad=!1,this.useResponsiveLayout()&&!this._updatingColumnsResponsive&&this._groundItem.contentItems.length>0&&this._groundItem.contentItems[0].isRow){if(this._groundItem===void 0||this._width===null)throw new _t("LMACR77412");{const r=this._groundItem.contentItems[0].contentItems.length;if(r<=1)return;{const a=this.layoutConfig.dimensions.defaultMinItemWidth;if(r*a<=this._width)return;{this._updatingColumnsResponsive=!0;const y=Math.max(Math.floor(this._width/a),1),S=r-y,x=this._groundItem.contentItems[0],u=this.getAllStacks();if(u.length===0)throw new Lt("LMACRS77413");{const O=u[0];for(let V=0;V<S;V++){const W=x.contentItems[x.contentItems.length-1];this.addChildContentItemsToContainer(O,W)}this._updatingColumnsResponsive=!1}}}}}}useResponsiveLayout(){const r=this.layoutConfig.settings,a=r.responsiveMode===$c.always,d=r.responsiveMode===$c.onload&&this._firstLoad;return a||d}addChildContentItemsToContainer(r,a){const d=a.contentItems;if(a instanceof fs)for(let y=0;y<d.length;y++){const S=d[y];a.removeChild(S,!0),r.addChild(S)}else for(let y=0;y<d.length;y++){const S=d[y];this.addChildContentItemsToContainer(r,S)}}getAllStacks(){if(this._groundItem===void 0)throw new _t("LMFASC52778");{const r=[];return this.findAllStacksRecursive(r,this._groundItem),r}}findFirstContentItemType(r){if(this._groundItem===void 0)throw new _t("LMFFCIT82446");return this.findFirstContentItemTypeRecursive(r,this._groundItem)}findFirstContentItemTypeRecursive(r,a){const d=a.contentItems,y=d.length;if(y!==0){for(let S=0;S<y;S++){const x=d[S];if(x.type===r)return x}for(let S=0;S<y;S++){const x=d[S],u=this.findFirstContentItemTypeRecursive(r,x);if(u!==void 0)return u}return}}findFirstContentItemTypeByIdRecursive(r,a,d){const y=d.contentItems,S=y.length;if(S!==0){for(let x=0;x<S;x++){const u=y[x];if(u.type===r&&u.id===a)return u}for(let x=0;x<S;x++){const u=y[x],O=this.findFirstContentItemTypeByIdRecursive(r,a,u);if(O!==void 0)return O}return}}findAllStacksRecursive(r,a){const d=a.contentItems;for(let y=0;y<d.length;y++){const S=d[y];S instanceof fs?r.push(S):S.isComponent||this.findAllStacksRecursive(r,S)}}findFirstLocation(r){const a=r.length;for(let d=0;d<a;d++){const y=r[d],S=this.findLocation(y);if(S!==void 0)return S}}findLocation(r){const a=r.index;switch(r.typeId){case 0:{if(this._focusedComponentItem===void 0)return;{const d=this._focusedComponentItem.parentItem,y=d.contentItems,S=y.length;if(a===void 0)return{parentItem:d,index:S};{const u=y.indexOf(this._focusedComponentItem)+a;return u<0||u>S?void 0:{parentItem:d,index:u}}}}case 1:{if(this._focusedComponentItem===void 0)return;{const d=this._focusedComponentItem.parentItem;return this.tryCreateLocationFromParentItem(d,a)}}case 2:{const d=this.findFirstContentItemType(Te.stack);return d===void 0?void 0:this.tryCreateLocationFromParentItem(d,a)}case 3:{let d=this.findFirstContentItemType(Te.row);return d!==void 0?this.tryCreateLocationFromParentItem(d,a):(d=this.findFirstContentItemType(Te.column),d!==void 0?this.tryCreateLocationFromParentItem(d,a):void 0)}case 4:{const d=this.findFirstContentItemType(Te.row);return d===void 0?void 0:this.tryCreateLocationFromParentItem(d,a)}case 5:{const d=this.findFirstContentItemType(Te.column);return d===void 0?void 0:this.tryCreateLocationFromParentItem(d,a)}case 6:{if(this._groundItem===void 0)throw new _t("LMFLRIF18244");return this.rootItem!==void 0?void 0:a===void 0||a===0?{parentItem:this._groundItem,index:0}:void 0}case 7:{if(this._groundItem===void 0)throw new _t("LMFLF18244");{const d=this._groundItem.contentItems;if(d.length===0)return a===void 0||a===0?{parentItem:this._groundItem,index:0}:void 0;{const y=d[0];return this.tryCreateLocationFromParentItem(y,a)}}}}}tryCreateLocationFromParentItem(r,a){const y=r.contentItems.length;return a===void 0?{parentItem:r,index:y}:a<0||a>y?void 0:{parentItem:r,index:a}}}(function(p){function r(d){const y=d.createElement("div");return y.classList.add("lm_maximise_place"),y}p.createMaximisePlaceElement=r;function a(d){const y=d.createElement("div");return y.classList.add("lm_drop_tab_placeholder"),y}p.createTabDropPlaceholderElement=a,p.defaultLocationSelectors=[{typeId:1,index:void 0},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}],p.afterFocusedItemIfPossibleLocationSelectors=[{typeId:0,index:1},{typeId:2,index:void 0},{typeId:3,index:void 0},{typeId:7,index:void 0}]})(sa||(sa={}));class Gc extends sa{constructor(r,a,d,y){if(super(Gc.createLayoutManagerConstructorParameters(r,a)),this._bindComponentEventHanlderPassedInConstructor=!1,this._creationTimeoutPassed=!1,a!==void 0&&typeof a=="function"&&(this.bindComponentEvent=a,this._bindComponentEventHanlderPassedInConstructor=!0,d!==void 0&&(this.unbindComponentEvent=d)),!this._bindComponentEventHanlderPassedInConstructor&&this.isSubWindow){if(this._constructorOrSubWindowLayoutConfig===void 0)throw new _t("VLC98823");{const S=Qn.resolve(this._constructorOrSubWindowLayoutConfig);this.layoutConfig=Object.assign(Object.assign({},S),{root:void 0})}}y!==!0&&(this.deprecatedConstructor||this.init())}destroy(){this.bindComponentEvent=void 0,this.unbindComponentEvent=void 0,super.destroy()}init(){if(!this._bindComponentEventHanlderPassedInConstructor&&(document.readyState==="loading"||document.body===null)){document.addEventListener("DOMContentLoaded",()=>this.init(),{passive:!0});return}if(!this._bindComponentEventHanlderPassedInConstructor&&this.isSubWindow===!0&&!this._creationTimeoutPassed){setTimeout(()=>this.init(),7),this._creationTimeoutPassed=!0;return}this.isSubWindow===!0&&(this._bindComponentEventHanlderPassedInConstructor||this.clearHtmlAndAdjustStylesForSubWindow(),window.__glInstance=this),super.init()}clearHtmlAndAdjustStylesForSubWindow(){const r=document.head,a=new Array(4);a[0]=document.querySelectorAll("body link"),a[1]=document.querySelectorAll("body style"),a[2]=document.querySelectorAll("template"),a[3]=document.querySelectorAll(".gl_keep");for(let y=0;y<a.length;y++){const S=a[y];for(let x=0;x<S.length;x++){const u=S[x];r.appendChild(u)}}const d=document.body;d.innerHTML="",d.style.visibility="visible",this.checkAddDefaultPopinButton(),document.body.offsetHeight}checkAddDefaultPopinButton(){if(this.layoutConfig.settings.popInOnClose)return!1;{const r=document.createElement("div");r.classList.add("lm_popin"),r.setAttribute("title",this.layoutConfig.header.dock);const a=document.createElement("div");a.classList.add("lm_icon");const d=document.createElement("div");return d.classList.add("lm_bg"),r.appendChild(a),r.appendChild(d),r.addEventListener("click",()=>this.emit("popIn")),document.body.appendChild(r),!0}}bindComponent(r,a){if(this.bindComponentEvent!==void 0)return this.bindComponentEvent(r,a);if(this.getComponentEvent!==void 0)return{virtual:!1,component:this.getComponentEvent(r,a)};{const y=`${Ln[2]}: ${JSON.stringify(a)}`;throw new so(y)}}unbindComponent(r,a,d){if(this.unbindComponentEvent!==void 0)this.unbindComponentEvent(r);else if(!a&&this.releaseComponentEvent!==void 0){if(d===void 0)throw new _t("VCUCRCU333998");this.releaseComponentEvent(r,d)}}}(function(p){let r=!1;function a(d,y){const S=r?null:new URL(document.location.href).searchParams.get("gl-window");r=!0;const x=S!==null;let u,O;if(S!==null){const V=localStorage.getItem(S);if(V===null)throw new Error("Null gl-window Config");localStorage.removeItem(S);const W=JSON.parse(V),q=mt.unminifyConfig(W);O=Qn.fromResolved(q),d instanceof HTMLElement&&(u=d)}else d===void 0?O=void 0:d instanceof HTMLElement?(O=void 0,u=d):O=d,u===void 0&&y instanceof HTMLElement&&(u=y);return{constructorOrSubWindowLayoutConfig:O,isSubWindow:x,containerElement:u}}p.createLayoutManagerConstructorParameters=a})(Gc||(Gc={}));class q0 extends Gc{constructor(r,a,d){super(r,a,d,!0),this._componentTypesMap=new Map,this._registeredComponentMap=new Map,this._virtuableComponentMap=new Map,this._containerVirtualRectingRequiredEventListener=(y,S,x)=>this.handleContainerVirtualRectingRequiredEvent(y,S,x),this._containerVirtualVisibilityChangeRequiredEventListener=(y,S)=>this.handleContainerVirtualVisibilityChangeRequiredEvent(y,S),this._containerVirtualZIndexChangeRequiredEventListener=(y,S,x)=>this.handleContainerVirtualZIndexChangeRequiredEvent(y,S,x),this.deprecatedConstructor||this.init()}registerComponent(r,a,d=!1){if(typeof a!="function")throw new E0("registerComponent() componentConstructorOrFactoryFtn parameter is not a function");if(a.hasOwnProperty("prototype")){const y=a;this.registerComponentConstructor(r,y,d)}else{const y=a;this.registerComponentFactoryFunction(r,y,d)}}registerComponentConstructor(r,a,d=!1){if(typeof a!="function")throw new Error(Ln[1]);if(this._componentTypesMap.get(r)!==void 0)throw new so(`${Ln[3]}: ${r}`);this._componentTypesMap.set(r,{constructor:a,factoryFunction:void 0,virtual:d})}registerComponentFactoryFunction(r,a,d=!1){if(typeof a!="function")throw new so("Please register a constructor function");if(this._componentTypesMap.get(r)!==void 0)throw new so(`${Ln[3]}: ${r}`);this._componentTypesMap.set(r,{constructor:void 0,factoryFunction:a,virtual:d})}registerComponentFunction(r){this.registerGetComponentConstructorCallback(r)}registerGetComponentConstructorCallback(r){if(typeof r!="function")throw new Error("Please register a callback function");this._getComponentConstructorFtn!==void 0&&console.warn("Multiple component functions are being registered.  Only the final registered function will be used."),this._getComponentConstructorFtn=r}getRegisteredComponentTypeNames(){const r=this._componentTypesMap.keys();return Array.from(r)}getComponentInstantiator(r){let a;const d=ys.resolveComponentTypeName(r);return d!==void 0&&(a=this._componentTypesMap.get(d)),a===void 0&&this._getComponentConstructorFtn!==void 0&&(a={constructor:this._getComponentConstructorFtn(r),factoryFunction:void 0,virtual:!1}),a}bindComponent(r,a){let d;const y=ys.resolveComponentTypeName(a);y!==void 0&&(d=this._componentTypesMap.get(y)),d===void 0&&this._getComponentConstructorFtn!==void 0&&(d={constructor:this._getComponentConstructorFtn(a),factoryFunction:void 0,virtual:!1});let S;if(d!==void 0){const x=d.virtual;let u;a.componentState===void 0?u=void 0:u=hl({},a.componentState);let O;const V=d.constructor;if(V!==void 0)O=new V(r,u,x);else{const W=d.factoryFunction;if(W!==void 0)O=W(r,u,x);else throw new Lt("LMBCFFU10008")}if(x){if(O===void 0)throw new _t("GLBCVCU988774");{const W=O,q=W.rootHtmlElement;if(q===void 0)throw new so(`${Ln[5]}: ${y}`);D0(q),this.container.appendChild(q),this._virtuableComponentMap.set(r,W),r.virtualRectingRequiredEvent=this._containerVirtualRectingRequiredEventListener,r.virtualVisibilityChangeRequiredEvent=this._containerVirtualVisibilityChangeRequiredEventListener,r.virtualZIndexChangeRequiredEvent=this._containerVirtualZIndexChangeRequiredEventListener}}this._registeredComponentMap.set(r,O),S={virtual:d.virtual,component:O}}else S=super.bindComponent(r,a);return S}unbindComponent(r,a,d){if(this._registeredComponentMap.get(r)===void 0)super.unbindComponent(r,a,d);else{const S=this._virtuableComponentMap.get(r);if(S!==void 0){const x=S.rootHtmlElement;if(x===void 0)throw new Lt("GLUC77743",r.title);this.container.removeChild(x),this._virtuableComponentMap.delete(r)}}}fireBeforeVirtualRectingEvent(r){this._goldenLayoutBoundingClientRect=this.container.getBoundingClientRect(),super.fireBeforeVirtualRectingEvent(r)}handleContainerVirtualRectingRequiredEvent(r,a,d){const y=this._virtuableComponentMap.get(r);if(y===void 0)throw new _t("GLHCSCE55933");{const S=y.rootHtmlElement;if(S===void 0)throw new so(Ln[4]+" "+r.title);{const x=r.element.getBoundingClientRect(),u=x.left-this._goldenLayoutBoundingClientRect.left;S.style.left=Rt(u);const O=x.top-this._goldenLayoutBoundingClientRect.top;S.style.top=Rt(O),er(S,a),tr(S,d)}}}handleContainerVirtualVisibilityChangeRequiredEvent(r,a){const d=this._virtuableComponentMap.get(r);if(d===void 0)throw new _t("GLHCVVCRE55934");{const y=d.rootHtmlElement;if(y===void 0)throw new so(Ln[4]+" "+r.title);lo(y,a)}}handleContainerVirtualZIndexChangeRequiredEvent(r,a,d){const y=this._virtuableComponentMap.get(r);if(y===void 0)throw new _t("GLHCVZICRE55935");{const S=y.rootHtmlElement;if(S===void 0)throw new so(Ln[4]+" "+r.title);S.style.zIndex=d}}}class vl{constructor(r,a){this._container=r,a?(this._rootElement=document.createElement("div"),this._rootElement.style.position="absolute",this._rootElement.style.overflow="hidden"):this._rootElement=this._container.element}_rootElement;get container(){return this._container}get rootHtmlElement(){return this._rootElement}}var H0=Ht("<button class=increment type=button>Clicks: <!$><!/>");function W0(){const[p,r]=qt(0),a=yl();return(()=>{var d=jt(H0),y=d.firstChild,S=y.nextSibling,[x,u]=Sn(S.nextSibling);return d.$$click=()=>{r(p()+1),a?.ctx.increments.set(p())},bt(d,p,x,u),og(),d})()}sg(["click"]);class ds extends vl{static typeName="boolean";_inputElement;_containerClickListener=()=>this.handleClickFocusEvent();_containerFocusinListener=()=>this.handleClickFocusEvent();constructor(r,a,d){super(r,d),this._inputElement=document.createElement("input"),this._inputElement.type="checkbox",this._inputElement.checked=a??!0,this._inputElement.style.display="block",this.rootHtmlElement.appendChild(this._inputElement),ag(()=>W0(),this.rootHtmlElement),this.container.stateRequestEvent=()=>this.handleContainerStateRequestEvent(),this.rootHtmlElement.addEventListener("click",this._containerClickListener),this.rootHtmlElement.addEventListener("focusin",this._containerFocusinListener)}handleContainerStateRequestEvent(){return this._inputElement.checked}handleClickFocusEvent(){this.container.focus()}}class Be extends vl{static typeName="color";static undefinedColor="MediumVioletRed";_paraElement;_inputElement;_containerClickListener=()=>this.handleClickFocusEvent();_containerFocusinListener=()=>this.handleClickFocusEvent();_beforeComponentReleaseEventListener=()=>this.handleBeforeComponentReleaseEvent();_inputChangeListener=()=>this.handleInputChangeEvent();_showEventListener=()=>this.handleShowEvent();constructor(r,a,d){super(r,d);let y;a===void 0?y=Be.undefinedColor:typeof a!="string"?y="IndianRed":y=a,this._paraElement=document.createElement("p"),this._paraElement.style.textAlign="left",this._paraElement.style.color=y;const S=this.container.title;this._paraElement.innerText=(S??"unknown")+" component",this.rootHtmlElement.appendChild(this._paraElement),this._inputElement=document.createElement("input"),this._inputElement.type="text",this._inputElement.value=y,this._inputElement.style.display="block",this._inputElement.addEventListener("input",this._inputChangeListener,{passive:!0}),this.rootHtmlElement.appendChild(this._inputElement),this.container.stateRequestEvent=()=>this.handleContainerStateRequestEvent(),this.container.addEventListener("beforeComponentRelease",this._beforeComponentReleaseEventListener),this.container.addEventListener("show",this._showEventListener),this.rootHtmlElement.addEventListener("click",this._containerClickListener),this.rootHtmlElement.addEventListener("focusin",this._containerFocusinListener)}handleInputChangeEvent(){this._paraElement.style.color=this._inputElement.value}handleContainerStateRequestEvent(){const r=this._inputElement.value;if(r!==Be.undefinedColor)return r}handleBeforeComponentReleaseEvent(){this._inputElement.removeEventListener("change",this._inputChangeListener),this.rootHtmlElement.removeChild(this._inputElement),this.rootHtmlElement.removeChild(this._paraElement),this.container.removeEventListener("show",this._showEventListener),this.container.removeEventListener("beforeComponentRelease",this._beforeComponentReleaseEventListener),this.rootHtmlElement.removeEventListener("click",this._containerClickListener),this.rootHtmlElement.removeEventListener("focusin",this._containerFocusinListener)}handleShowEvent(){this._paraElement.style.backgroundColor="purple",setTimeout(()=>{this._paraElement.style.backgroundColor=""},1e3)}handleClickFocusEvent(){this.container.focus()}}class ps extends vl{static typeName="event";_inputElement;_sendElement;_containerClickListener=()=>this.handleClickFocusEvent();_containerFocusinListener=()=>this.handleClickFocusEvent();constructor(r,a,d){super(r,d),this._inputElement=document.createElement("input"),this._inputElement.type="text",this._inputElement.style.display="block",this.rootHtmlElement.appendChild(this._inputElement),this._sendElement=document.createElement("button"),this._sendElement.innerText="SEND EVENT",this._sendElement.addEventListener("click",()=>{this.container.layoutManager.eventHub.emitUserBroadcast("foo",this._inputElement.value)}),this.rootHtmlElement.appendChild(this._sendElement);const y=(...S)=>{const x=document.createElement("span");x.innerText=`Received: ${S}`,this.rootHtmlElement.appendChild(x)};this.container.layoutManager.eventHub.on("userBroadcast",y),this.container.on("beforeComponentRelease",()=>{this.container.layoutManager.eventHub.off("userBroadcast",y)}),this.rootHtmlElement.addEventListener("click",this._containerClickListener),this.rootHtmlElement.addEventListener("focusin",this._containerFocusinListener)}handleClickFocusEvent(){this.container.focus()}}class Rn extends vl{static undefinedTextValue="<undefined>";static typeName="text";_inputElement;_containerClickListener=()=>this.handleClickFocusEvent();_containerFocusinListener=()=>this.handleClickFocusEvent();constructor(r,a,d){super(r,d);let y;a===void 0?y=Rn.undefinedTextValue:Kd.isJson(a)?y=a.text:y="<Unexpect type>",this._inputElement=document.createElement("input"),this._inputElement.type="text",this._inputElement.value=y,this._inputElement.style.display="block",this.rootHtmlElement.appendChild(this._inputElement),this.container.stateRequestEvent=()=>this.handleContainerStateRequestEvent(),this.rootHtmlElement.addEventListener("click",this._containerClickListener),this.rootHtmlElement.addEventListener("focusin",this._containerFocusinListener)}handleContainerStateRequestEvent(){const r=this._inputElement.value;if(r!==Rn.undefinedTextValue)return{text:r}}handleClickFocusEvent(){this.container.focus()}}const Z0={root:{type:Te.row,content:[{type:Te.column,size:"30%",content:[{type:"component",title:"Monitoring Udara",header:{show:"top"},size:"35%",isClosable:!0,reorderEnabled:!0,componentType:"solid view",componentState:{jsxIndex:0}},{type:"component",title:"Lokasi",header:{show:"top"},isClosable:!0,reorderEnabled:!0,componentType:"solid view",componentState:{jsxIndex:1}}]},{type:Te.column,content:[{type:Te.row,content:[{title:"Kesimpulan",header:{show:"top",popout:"open in new window"},type:"component",reorderEnabled:!0,componentType:"solid view",componentState:{jsxIndex:2}},{title:"Pemetaan",header:{show:"top",popout:"open in new window"},type:"component",reorderEnabled:!0,componentType:"solid view",componentState:{jsxIndex:3}}]},{type:"component",title:"Indeks Kondisi Udara Hari Ini",header:{show:"top"},isClosable:!0,reorderEnabled:!0,componentType:"solid view",size:"30%",componentState:{jsxIndex:4}},{type:Te.row,content:[{title:"CO",header:{show:"top",popout:"open in new window"},type:"component",reorderEnabled:!0,componentType:"solid view",componentState:{jsxIndex:5}},{title:"LPG",header:{show:"top",popout:"open in new window"},type:"component",reorderEnabled:!0,componentType:"solid view",componentState:{jsxIndex:6}}]}]}]}},cf={name:"miniRow",config:Z0},G0={root:{type:Te.stack,content:[{type:"component",title:"Golden",header:{show:"top"},componentType:Be.typeName,size:"30%",componentState:"white"},{title:"Layout",header:{show:"top",popout:!1},type:"component",componentType:Be.typeName,componentState:"green"}]}},uf={name:"miniStack",config:G0},X0={root:{type:Te.row,content:[{type:"component",title:"Golden",componentType:Be.typeName,size:"30%",componentState:"gold"},{title:"Layout",header:{show:"top",popout:!1},type:"component",componentType:Be.typeName,componentState:void 0},{type:"stack",isClosable:!1,content:[]}]}},Y0={name:"row with empty stack",config:X0},K0={root:{type:Te.component,title:"Layout",header:{show:"top",popout:!1},componentType:Be.typeName,componentState:"green"}},hf={name:"component",config:K0},J0={settings:{popoutWholeStack:!0,popInOnClose:!0},root:{type:"row",content:[{size:"80%",type:"column",content:[{title:"Fnts 100",header:{show:"bottom"},type:"component",componentType:Be.typeName},{type:"row",content:[{type:"component",title:"Golden",header:{show:"right"},isClosable:!1,componentType:Be.typeName,size:"30%",componentState:{bg:"golden_layout_spiral.png"}},{title:"Layout",header:{show:"left",popout:!1},type:"component",componentType:Be.typeName,componentState:{bg:"golden_layout_text.png"}}]},{type:"stack",content:[{type:"component",title:"Acme, inc.",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"LexCorp plc.",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"Springshield plc.",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]},{size:"50%",type:"row",content:[{type:"stack",content:[{type:"component",title:"comp 1",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"comp 1",componentType:ps.typeName,componentState:{companyName:"Event"}},{type:"component",title:"comp 2",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"comp 3",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]}]}},df={name:"standard",config:J0},Q0={settings:{responsiveMode:"always"},dimensions:{defaultMinItemWidth:"250px"},root:{type:"row",content:[{size:"30%",type:"column",content:[{title:"Fnts 100",type:"component",componentType:Be.typeName},{type:"row",content:[{type:"component",title:"Golden",componentType:Be.typeName,size:"30%",componentState:{bg:"golden_layout_spiral.png"}}]},{type:"stack",content:[{type:"component",title:"Acme, inc.",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"LexCorp plc.",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"Springshield plc.",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]},{size:"30%",title:"Layout",type:"component",componentType:Be.typeName,componentState:{bg:"golden_layout_text.png"}},{size:"20%",type:"component",title:"Market",componentType:Be.typeName,componentState:{className:"market-content",style:[".market-content label {","  margin-top: 10px","  display: block","  text-align: left","}",".market-content input {","  width: 250px","  border: 1px solid red","}"],html:['<label for="name">Name<label>','<input id="name" type="text"></input>']}},{size:"20%",type:"column",content:[{size:"20%",type:"component",title:"Performance",componentType:Be.typeName},{size:"80%",type:"component",title:"Profile",componentType:Be.typeName}]}]}},ev={name:"responsive",config:Q0},tv={settings:{tabOverlapAllowance:25,reorderOnTabMenuClick:!1,tabControlOffset:5},root:{type:"row",content:[{size:"30%",type:"column",content:[{title:"Fnts 100",type:"component",componentType:Rn.typeName},{type:"row",content:[{type:"component",title:"Golden",componentType:Rn.typeName,size:"30%",componentState:{text:"hello"}}]},{type:"stack",content:[{type:"component",title:"Acme, inc.",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"LexCorp plc.",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"Springshield plc.",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]},{size:"20%",type:"stack",content:[{type:"component",title:"Market",componentType:Be.typeName},{type:"component",title:"Performance",componentType:Be.typeName},{type:"component",title:"Trend",componentType:Be.typeName},{type:"component",title:"Balance",componentType:Be.typeName},{type:"component",title:"Budget",componentType:Be.typeName},{type:"component",title:"Curve",componentType:Be.typeName},{type:"component",title:"Standing",componentType:Be.typeName},{type:"component",title:"Lasting",componentType:Be.typeName,componentState:{bg:"golden_layout_spiral.png"}},{type:"component",title:"Profile",componentType:Be.typeName}]},{size:"30%",title:"Layout",type:"component",componentType:ds.typeName,componentState:!0}]}},iv={name:"tabDropdown",config:tv},nv={root:{type:Te.row,content:[{type:"component",title:"Golden",header:{show:"top"},isClosable:!1,componentType:Be.typeName,width:30,componentState:"gold"},{title:"Layout",header:{show:"top",popout:!1},type:"component",componentType:Be.typeName,componentState:void 0}]}},pf={name:"miniRow (WidthHeight)",config:nv},rv={root:{type:Te.stack,content:[{type:"component",title:"Golden",header:{show:"top"},componentType:Be.typeName,width:30,componentState:"white"},{title:"Layout",header:{show:"top",popout:!1},type:"component",componentType:Be.typeName,componentState:"green"}]}},mf={name:"miniStack (WidthHeight)",config:rv},sv={root:{type:Te.row,content:[{type:"component",title:"Golden",componentType:Be.typeName,width:30,componentState:"gold"},{title:"Layout",header:{show:"top",popout:!1},type:"component",componentType:Be.typeName,componentState:void 0},{type:"stack",isClosable:!1,content:[]}]}},ov={name:"row with empty stack (WidthHeight)",config:sv},av={root:{type:Te.component,title:"Layout",header:{show:"top",popout:!1},componentType:Be.typeName,componentState:"green"}},ff={name:"component (WidthHeight)",config:av},lv={settings:{popoutWholeStack:!0,popInOnClose:!0},root:{type:"row",content:[{width:80,type:"column",content:[{title:"Fnts 100",header:{show:"bottom"},type:"component",componentType:Be.typeName},{type:"row",content:[{type:"component",title:"Golden",header:{show:"right"},isClosable:!1,componentType:Be.typeName,width:30,componentState:{bg:"golden_layout_spiral.png"}},{title:"Layout",header:{show:"left",popout:!1},type:"component",componentType:Be.typeName,componentState:{bg:"golden_layout_text.png"}}]},{type:"stack",content:[{type:"component",title:"Acme, inc.",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"LexCorp plc.",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"Springshield plc.",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]},{width:50,type:"row",title:"test stack",content:[{type:"stack",title:"test row",content:[{type:"component",title:"comp 1",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"comp 1",componentType:ps.typeName,componentState:{companyName:"Event"}},{type:"component",title:"comp 2",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"comp 3",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]}]}},gf={name:"standard (WidthHeight)",config:lv},cv={settings:{responsiveMode:"always"},dimensions:{minItemWidth:250},root:{type:"row",content:[{width:30,type:"column",content:[{title:"Fnts 100",type:"component",componentType:Be.typeName},{type:"row",content:[{type:"component",title:"Golden",componentType:Be.typeName,width:30,componentState:{bg:"golden_layout_spiral.png"}}]},{type:"stack",content:[{type:"component",title:"Acme, inc.",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"LexCorp plc.",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"Springshield plc.",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]},{width:30,title:"Layout",type:"component",componentType:Be.typeName,componentState:{bg:"golden_layout_text.png"}},{width:20,type:"component",title:"Market",componentType:Be.typeName,componentState:{className:"market-content",style:[".market-content label {","  margin-top: 10px","  display: block","  text-align: left","}",".market-content input {","  width: 250px","  border: 1px solid red","}"],html:['<label for="name">Name<label>','<input id="name" type="text"></input>']}},{width:20,type:"column",content:[{height:20,type:"component",title:"Performance",componentType:Be.typeName},{height:80,type:"component",title:"Profile",componentType:Be.typeName}]}]}},uv={name:"responsive (WidthHeight)",config:cv},hv={settings:{tabOverlapAllowance:25,reorderOnTabMenuClick:!1,tabControlOffset:5},root:{type:"row",content:[{width:30,type:"column",content:[{title:"Fnts 100",type:"component",componentType:Rn.typeName},{type:"row",content:[{type:"component",title:"Golden",componentType:Rn.typeName,width:30,componentState:{text:"hello"}}]},{type:"stack",content:[{type:"component",title:"Acme, inc.",componentType:Be.typeName,componentState:{companyName:"Stock X"}},{type:"component",title:"LexCorp plc.",componentType:Be.typeName,componentState:{companyName:"Stock Y"}},{type:"component",title:"Springshield plc.",componentType:Be.typeName,componentState:{companyName:"Stock Z"}}]}]},{width:20,type:"stack",content:[{type:"component",title:"Market",componentType:Be.typeName},{type:"component",title:"Performance",componentType:Be.typeName},{type:"component",title:"Trend",componentType:Be.typeName},{type:"component",title:"Balance",componentType:Be.typeName},{type:"component",title:"Budget",componentType:Be.typeName},{type:"component",title:"Curve",componentType:Be.typeName},{type:"component",title:"Standing",componentType:Be.typeName},{type:"component",title:"Lasting",componentType:Be.typeName,componentState:{bg:"golden_layout_spiral.png"}},{type:"component",title:"Profile",componentType:Be.typeName}]},{width:30,title:"Layout",type:"component",componentType:ds.typeName,componentState:!0}]}},dv={name:"tabDropdown (WidthHeight)",config:hv},Nd={colorComponentCompatible:[cf,uf,Y0,hf,df,pf,mf,ov,ff,gf],allComponents:[cf,uf,hf,ev,df,iv,pf,mf,ff,uv,gf,dv]};var pv=Ht("<h1>SolidGoldenView Not Found"),mv=Ht("<p>Current Index: <!$><!/>"),fv=Ht("<p>Max Index: <!$><!/>"),gv=Ht("<p>State: <!$><!/>"),_v=Ht("<p>ctxcnt: cnt=<!$><!/>");const yv=p=>{const r=yl();return Ye(Pr,{get when(){return p.jsxComponents[p.currentIndex]},get fallback(){return[jt(pv),(()=>{var a=jt(mv),d=a.firstChild,y=d.nextSibling,[S,x]=Sn(y.nextSibling);return bt(a,()=>p.currentIndex,S,x),a})(),(()=>{var a=jt(fv),d=a.firstChild,y=d.nextSibling,[S,x]=Sn(y.nextSibling);return bt(a,()=>p.maxIndex,S,x),a})(),(()=>{var a=jt(gv),d=a.firstChild,y=d.nextSibling,[S,x]=Sn(y.nextSibling);return bt(a,()=>JSON.stringify(p.state),S,x),a})(),(()=>{var a=jt(_v),d=a.firstChild,y=d.nextSibling,[S,x]=Sn(y.nextSibling);return bt(a,()=>r?.ctx.increments.val(),S,x),a})()]},get children(){return Ot(()=>typeof p.jsxComponents[p.currentIndex]=="function")()?p.jsxComponents[p.currentIndex]():p.jsxComponents[p.currentIndex]}})},[nl,Vd]=qt({});class dp{constructor(){}jsxComponents=[];static defaultOptions={typeName:"solidgolden"};create(r){if(!r||typeof r!="string")throw new Error("Invalid typeName");const a=nl[r];if(a)return new a;const d={...dp.defaultOptions,typeName:r},y=this.jsxComponents,S=class Lc extends vl{static typeName=d.typeName;static jsxCmps=[];_containerClickListener=()=>this.handleClickFocusEvent();_containerFocusinListener=()=>this.handleClickFocusEvent();state;constructor(u,O,V){super(u,V),this.state=O,Lc.jsxCmps=y,ag(()=>yv({currentIndex:O.jsxIndex,maxIndex:Lc.jsxCmps.length,jsxComponents:Lc.jsxCmps,state:O}),this.rootHtmlElement),this.container.stateRequestEvent=()=>this.handleContainerStateRequestEvent(),this.rootHtmlElement.addEventListener("click",this._containerClickListener),this.rootHtmlElement.addEventListener("focusin",this._containerFocusinListener)}handleContainerStateRequestEvent(){return this.state}handleClickFocusEvent(){this.container.focus()}updateJsxComponents(u){Lc.jsxCmps=u}};return Vd({...nl,[r]:S}),S}static register(r,a){Vd({...nl,[r]:a})}static unregister(r){const a=nl;delete a[r],Vd(a)}setJsxComponents(r){console.log("[Factory] Set JSX",r),this.jsxComponents=r,Object.keys(nl()).forEach(a=>{nl()[a].prototype.updateJsxComponents(r)})}}class vv{_layoutElement;_controlsElement;_goldenLayout;_registerComponentTypesButton;_registerComponentTypesButtonClickListener=()=>this.registerComponentTypes();_registerAllRadio;_registerColorEventRadio;_registerComponentTypesAsVirtualButton;_registerComponentTypesAsVirtualButtonClickListener=()=>this.registerComponentTypesAsVirtual();_registerAllAsVirtualRadio;_registerTextBooleanAsVirtualRadio;_registeredComponentTypesForAddSelect;_registeredComponentTypesForAddSelectChangeListener=()=>this.handleRegisteredComponentTypesForAddSelectChange();_eventBindingVirtualRadio;_eventBindingVirtualRadioClickListener=()=>this.handleEventBindingVirtualRadioClick();_eventBindingEmbeddedRadio;_eventBindingEmbeddedRadioClickListener=()=>this.handleEventBindingEmbeddedRadioClick();_clearButton;_clearButtonClickListener=()=>this.handleClearButtonClick();_addComponentButton;_addComponentButtonClickListener=()=>this.handleAddComponentButtonClick();_layoutSelect;_layoutSelectChangeListener=()=>this.handleLayoutSelectChange();_loadLayoutButton;_loadLayoutButtonClickListener=()=>this.handleLoadLayoutButtonClick();_loadComponentAsRootButton;_loadComponentAsRootClickListener=()=>this.handleLoadComponentAsRootButtonClick();_registeredComponentTypesForReplaceSelect;_registeredComponentTypesForReplaceSelectChangeListener=()=>this.handleRegisteredComponentTypesForReplaceSelectChange();_replaceComponentButton;_replaceComponentButtonClickListener=()=>this.handleReplaceComponentButtonClick();_saveLayoutButton;_saveLayoutButtonClickListener=()=>this.handleSaveLayoutButtonClick();_reloadSavedLayoutButton;_reloadSavedLayoutButtonClickListener=()=>this.handleReloadSavedLayoutButtonClick();_lastVirtualRectingCountSpan;_bubbleClickCountSpan;_captureClickCountSpan;_stackHeaderClickedDiv;_stackHeaderClickedItemCountSpan;_boundComponentMap=new Map;_bubbleClickCount=0;_captureClickCount=0;_lastVirtualRectingCount=0;_allComponentsRegistered=!1;_savedLayout;_useVirtualEventBinding=!0;_goldenLayoutBoundingClientRect=new DOMRect;_globalBubbleClickListener=()=>this.handleGlobalBubbleClickEvent();_globalCaptureClickListener=()=>this.handleGlobalCaptureClickEvent();_bindComponentEventListener=(r,a)=>this.handleBindComponentEvent(r,a);_unbindComponentEventListener=r=>this.handleUnbindComponentEvent(r);jsxComponents=[];jsxCmpCurrentIndex=0;solidGoldenFactory=new dp;solidGoldenComponentRef=this.solidGoldenFactory.create("solid view");constructor(r,a){this.jsxComponents=r,console.log("[App] JSXes",this.jsxComponents),this.solidGoldenFactory.setJsxComponents(this.jsxComponents),this.solidGoldenComponentRef=this.solidGoldenFactory.create("solid view"),a&&a.hasOwnProperty("useVirtualEventBinding")&&(this._useVirtualEventBinding=a.useVirtualEventBinding);const d=document.querySelector("#controls");if(d===null)throw new Error("controlsElement not found");this._controlsElement=d;const y=document.querySelector("#layoutContainer");if(y===null)throw new Error("layoutContainerElement not found");this._layoutElement=y,this._goldenLayout=new q0(this._layoutElement,this._bindComponentEventListener,this._unbindComponentEventListener),this._goldenLayout.resizeWithContainerAutomatically=!0,this._goldenLayout.beforeResizingEvent=Zt=>this.handleBeforeResizingEvent(Zt),this._goldenLayout.addEventListener("stackHeaderClick",Zt=>this.handleStackHeaderClick(Zt));const S=document.querySelector("#registerNotVirtualButton");if(S===null)throw new Error("Could not find RegisterNotVirtualButton");this._registerComponentTypesButton=S,this._registerComponentTypesButton.addEventListener("click",this._registerComponentTypesButtonClickListener,{passive:!0});const x=document.querySelector("#registerNotVirtualAllRadio");if(x===null)throw new Error("Could not find RegisterNotVirtualAllRadio");this._registerAllRadio=x;const u=document.querySelector("#registerNotVirtualColorEventRadio");if(u===null)throw new Error("Could not find RegisterNotVirtualColorEventRadio");this._registerColorEventRadio=u;const O=document.querySelector("#registerVirtualButton");if(O===null)throw new Error("Could not find RegisterVirtualButton");this._registerComponentTypesAsVirtualButton=O,this._registerComponentTypesAsVirtualButton.addEventListener("click",this._registerComponentTypesAsVirtualButtonClickListener,{passive:!0});const V=document.querySelector("#registerVirtualAllRadio");if(V===null)throw new Error("Could not find RegisterVirtualAllRadio");this._registerAllAsVirtualRadio=V;const W=document.querySelector("#registerVirtualTextBooleanRadio");if(W===null)throw new Error("Could not find RegisterVirtualTextBooleanRadio");this._registerTextBooleanAsVirtualRadio=W;const q=document.querySelector("#eventBindingVirtualRadio");if(q===null)throw new Error("Could not find EventBindingVirtualRadio");this._eventBindingVirtualRadio=q,this._eventBindingVirtualRadio.addEventListener("click",this._eventBindingVirtualRadioClickListener,{passive:!0});const F=document.querySelector("#eventBindingEmbeddedRadio");if(F===null)throw new Error("Could not find EventBindingEmbeddedRadio");this._eventBindingEmbeddedRadio=F,this._eventBindingEmbeddedRadio.addEventListener("click",this._eventBindingEmbeddedRadioClickListener,{passive:!0}),this._eventBindingVirtualRadio.checked=this._useVirtualEventBinding;const oe=document.querySelector("#clearButton");if(oe===null)throw new Error("Could not find ClearButton");this._clearButton=oe,this._clearButton.addEventListener("click",this._clearButtonClickListener,{passive:!0});const ie=document.querySelector("#registeredComponentTypesForAddSelect");if(ie===null)throw new Error;this._registeredComponentTypesForAddSelect=ie,this._registeredComponentTypesForAddSelect.addEventListener("change",this._registeredComponentTypesForAddSelectChangeListener,{passive:!0});const pe=document.querySelector("#addComponentButton");if(pe===null)throw new Error("Could not find addComponentButton");this._addComponentButton=pe,this._addComponentButton.addEventListener("click",this._addComponentButtonClickListener,{passive:!0});const ve=document.querySelector("#addComponentByDragButton");if(ve===null)throw new Error("Could not find addComponentByDragButton");if(this._goldenLayout.newDragSource(ve,()=>this.getDragComponentTypeAndState())===void 0)throw new Error("addComponentDragSource undefined");const je=document.querySelector("#layoutSelect");if(je===null)throw new Error;this._layoutSelect=je,this._layoutSelect.addEventListener("change",this._layoutSelectChangeListener,{passive:!0});const st=document.querySelector("#loadLayoutButton");if(st===null)throw new Error("Could not find loadLayoutButton");this._loadLayoutButton=st,this._loadLayoutButton.addEventListener("click",this._loadLayoutButtonClickListener,{passive:!0});const Qe=document.querySelector("#loadComponentAsRootButton");if(Qe===null)throw new Error("Could not find loadComponentAsRootButton");this._loadComponentAsRootButton=Qe,this._loadComponentAsRootButton.addEventListener("click",this._loadComponentAsRootClickListener,{passive:!0});const qe=document.querySelector("#registeredComponentTypesForReplaceSelect");if(qe===null)throw new Error;this._registeredComponentTypesForReplaceSelect=qe,this._registeredComponentTypesForReplaceSelect.addEventListener("change",this._registeredComponentTypesForReplaceSelectChangeListener,{passive:!0});const ct=document.querySelector("#replaceComponentButton");if(ct===null)throw new Error("Could not find replaceComponentButton");this._replaceComponentButton=ct,this._replaceComponentButton.addEventListener("click",this._replaceComponentButtonClickListener,{passive:!0});const We=document.querySelector("#saveLayoutButton");if(We===null)throw new Error("Could not find saveLayoutButton");this._saveLayoutButton=We,this._saveLayoutButton.addEventListener("click",this._saveLayoutButtonClickListener,{passive:!0});const It=document.querySelector("#reloadSavedLayoutButton");if(It===null)throw new Error("Could not find reloadSavedLayoutButton");this._reloadSavedLayoutButton=It,this._reloadSavedLayoutButton.disabled=!0,this._reloadSavedLayoutButton.addEventListener("click",this._reloadSavedLayoutButtonClickListener,{passive:!0});const Ve=document.querySelector("#lastVirtualRectingCountSpan");if(Ve===null)throw new Error("Could not find LastVirtualRectingCountSpan");this._lastVirtualRectingCountSpan=Ve,this._lastVirtualRectingCountSpan.innerText=this._lastVirtualRectingCount.toString();const pi=document.querySelector("#bubbleClickCountSpan");if(pi===null)throw new Error("Could not find bubbleClickCountSpan");this._bubbleClickCountSpan=pi,this._bubbleClickCountSpan.innerText=this._bubbleClickCount.toString();const tt=document.querySelector("#captureClickCountSpan");if(tt===null)throw new Error("Could not find captureClickCountSpan");this._captureClickCountSpan=tt,this._captureClickCountSpan.innerText=this._captureClickCount.toString();const oi=document.querySelector("#stackHeaderClickedDiv");if(oi===null)throw new Error("Could not find stackHeaderClickedDiv");this._stackHeaderClickedDiv=oi,this._stackHeaderClickedDiv.style.display="none";const St=document.querySelector("#stackHeaderClickedItemCountSpan");if(St===null)throw new Error("Could not find stackHeaderClickedItemCountSpan");this._stackHeaderClickedItemCountSpan=St,this._goldenLayout.isSubWindow&&(this._controlsElement.style.display="none",this._goldenLayout.checkAddDefaultPopinButton()),globalThis.addEventListener("click",this._globalBubbleClickListener,{passive:!0}),globalThis.addEventListener("click",this._globalCaptureClickListener,{capture:!0,passive:!0})}start(){this.loadComponentTypesForAddSelect(),this.loadComponentTypesForReplaceSelect(),this.loadLayoutSelect()}createComponent(r,a,d,y){switch(console.trace("[GL] Masuk sini",r,a,d,y),a){case Be.typeName:return new Be(r,d,y);case Rn.typeName:return new Rn(r,d,y);case ds.typeName:return new ds(r,d,y);case ps.typeName:return new ps(r,d,y);case this.solidGoldenComponentRef.typeName:return new this.solidGoldenComponentRef(r,d,y);default:throw new Error("createComponent: Unexpected componentTypeName: "+a)}}handleBindComponentEvent(r,a){console.log("[GL] Bind Listener",r,a);const d=ys.resolveComponentTypeName(a);if(d===void 0)throw new Error("handleBindComponentEvent: Undefined componentTypeName");const y=this.createComponent(r,d,a.componentState,this._useVirtualEventBinding);if(this._boundComponentMap.set(r,y),this._useVirtualEventBinding){const S=y.rootHtmlElement;return this._layoutElement.appendChild(S),r.virtualRectingRequiredEvent=(x,u,O)=>this.handleContainerVirtualRectingRequiredEvent(x,u,O),r.virtualVisibilityChangeRequiredEvent=(x,u)=>this.handleContainerVirtualVisibilityChangeRequiredEvent(x,u),r.virtualZIndexChangeRequiredEvent=(x,u,O)=>this.handleContainerVirtualZIndexChangeRequiredEvent(x,u,O),{component:y,virtual:!0}}else return{component:y,virtual:!1}}handleUnbindComponentEvent(r){const a=this._boundComponentMap.get(r);if(a===void 0)throw new Error("handleUnbindComponentEvent: Component not found");const d=a.rootHtmlElement;if(d===void 0)throw new Error("handleUnbindComponentEvent: Component does not have a root HTML element");r.virtual&&this._layoutElement.removeChild(d),this._boundComponentMap.delete(r)}handleBeforeResizingEvent(r){this._goldenLayoutBoundingClientRect=this._layoutElement.getBoundingClientRect(),this._lastVirtualRectingCount=r,this._lastVirtualRectingCountSpan.innerText=this._lastVirtualRectingCount.toString()}handleContainerVirtualRectingRequiredEvent(r,a,d){const y=this._boundComponentMap.get(r);if(y===void 0)throw new Error("handleContainerVirtualRectingRequiredEvent: Component not found");const S=y.rootHtmlElement;if(S===void 0)throw new Error("handleContainerVirtualRectingRequiredEvent: Component does not have a root HTML element");const x=r.element.getBoundingClientRect(),u=x.left-this._goldenLayoutBoundingClientRect.left;S.style.left=this.numberToPixels(u);const O=x.top-this._goldenLayoutBoundingClientRect.top;S.style.top=this.numberToPixels(O),S.style.width=this.numberToPixels(a),S.style.height=this.numberToPixels(d)}handleContainerVirtualVisibilityChangeRequiredEvent(r,a){const d=this._boundComponentMap.get(r);if(d===void 0)throw new Error("handleContainerVisibilityChangeRequiredEvent: Component not found");const y=d.rootHtmlElement;if(y===void 0)throw new Error("handleContainerVisibilityChangeRequiredEvent: Component does not have a root HTML element");a?(y.classList.remove("lmcustom-hidden"),y.style.opacity="1"):(y.classList.add("lmcustom-hidden"),y.style.opacity="0")}handleContainerVirtualZIndexChangeRequiredEvent(r,a,d){const y=this._boundComponentMap.get(r);if(y===void 0)throw new Error("handleContainerVirtualZIndexChangeRequiredEvent: Component not found");const S=y.rootHtmlElement;if(S===void 0)throw new Error("handleContainerVirtualZIndexChangeRequiredEvent: Component does not have a root HTML element");S.style.zIndex=d}handleGlobalBubbleClickEvent(){this._bubbleClickCount++,this._bubbleClickCountSpan.innerText=this._bubbleClickCount.toString()}handleGlobalCaptureClickEvent(){this._captureClickCount++,this._captureClickCountSpan.innerText=this._captureClickCount.toString()}registerComponentTypes(){this._allComponentsRegistered||(this._goldenLayout.registerComponentConstructor(Be.typeName,Be),this._goldenLayout.registerComponentConstructor(ps.typeName,ps),this._registerComponentTypesButton.disabled=!0,this._registerAllRadio.disabled=!0,this._registerColorEventRadio.disabled=!0,this._registerAllRadio.checked?(this._goldenLayout.registerComponentConstructor(Rn.typeName,Rn),this._goldenLayout.registerComponentConstructor(ds.typeName,ds),this._allComponentsRegistered=!0,this._registerComponentTypesAsVirtualButton.disabled=!0,this._registerTextBooleanAsVirtualRadio.disabled=!0):this._registerTextBooleanAsVirtualRadio.checked=!0,this._registerAllAsVirtualRadio.disabled=!0)}registerComponentTypesAsVirtual(){this._allComponentsRegistered||(this._goldenLayout.registerComponentConstructor(Rn.typeName,Rn,!0),this._goldenLayout.registerComponentConstructor(ds.typeName,ds,!0),this._registerComponentTypesAsVirtualButton.disabled=!0,this._registerAllAsVirtualRadio.disabled=!0,this._registerTextBooleanAsVirtualRadio.disabled=!0,this._registerAllAsVirtualRadio.checked?(this._goldenLayout.registerComponentConstructor(Be.typeName,Be,!0),this._goldenLayout.registerComponentConstructor(ps.typeName,ps,!0),this._allComponentsRegistered=!0,this._registerComponentTypesButton.disabled=!0,this._registerColorEventRadio.disabled=!0):this._registerColorEventRadio.checked=!0,this._registerAllRadio.disabled=!0)}handleEventBindingVirtualRadioClick(){this._goldenLayout.clear(),this._useVirtualEventBinding=!0}handleEventBindingEmbeddedRadioClick(){this._goldenLayout.clear(),this._useVirtualEventBinding=!1}handleRegisteredComponentTypesForAddSelectChange(){}handleLayoutSelectChange(){}handleClearButtonClick(){this._goldenLayout.clear()}handleStackHeaderClick(r){const d=r.target.contentItems.length;this._stackHeaderClickedItemCountSpan.innerText=d.toString(),this._stackHeaderClickedDiv.style.display="",setTimeout(()=>{this._stackHeaderClickedDiv.style.display="none"},1e3)}handleAddComponentButtonClick(){const r=this._registeredComponentTypesForAddSelect.value;this._goldenLayout.addComponent(r)}getDragComponentTypeAndState(){return{type:"component",componentType:this._registeredComponentTypesForAddSelect.value}}handleLoadLayoutButtonClick(){const r=this._layoutSelect.value,d=Nd.allComponents.find(y=>y.name===r);if(d===void 0)throw new Error("handleLayoutSelectChange");this._goldenLayout.loadLayout(d.config)}handleLoadComponentAsRootButtonClick(){const r={type:"component",componentType:Be.typeName,componentState:"yellow"};this._goldenLayout.loadComponentAsRoot(r)}handleRegisteredComponentTypesForReplaceSelectChange(){}handleReplaceComponentButtonClick(){const a={componentType:this._registeredComponentTypesForReplaceSelect.value,type:"component"},d=this._goldenLayout.rootItem;if(d!==void 0){const y=[d];this.replaceComponentRecursively(y,a)}}handleSaveLayoutButtonClick(){this._savedLayout=this._goldenLayout.saveLayout(),this._reloadSavedLayoutButton.disabled=!1}handleReloadSavedLayoutButtonClick(){if(this._savedLayout===void 0)throw new Error("No saved layout");{const r=Qn.fromResolved(this._savedLayout);this._goldenLayout.loadLayout(r)}}getAllComponentTypeNames(){const r=[];return r.push(Be.typeName),r.push(Rn.typeName),r.push(ds.typeName),r.push(ps.typeName),r.push(this.solidGoldenComponentRef.typeName),r}loadComponentTypesForAddSelect(){this._registeredComponentTypesForAddSelect.options.length=0;const r=this.getAllComponentTypeNames();for(const a of r){const d=new Option(a);this._registeredComponentTypesForAddSelect.options.add(d)}}loadComponentTypesForReplaceSelect(){this._registeredComponentTypesForReplaceSelect.options.length=0;const r=this.getAllComponentTypeNames();for(const a of r){const d=new Option(a);this._registeredComponentTypesForReplaceSelect.options.add(d)}}loadLayoutSelect(){this._layoutSelect.options.length=0;const r=Nd.allComponents;for(const a of r){const d=new Option(a.name);this._layoutSelect.options.add(d)}}replaceComponentRecursively(r,a){for(const d of r)if(Bn.isComponentItem(d)){const y=d.container;y.componentType===Be.typeName&&y.replaceComponent(a)}else this.replaceComponentRecursively(d.contentItems,a)}numberToPixels(r){return r.toString(10)+"px"}goldenLoadLayout(r){this._goldenLayout.loadLayout(r)}goldenLoadPredefinedLayout(r){const a=r,d=Nd.allComponents,y=d.find(S=>S.name===a);if(y===void 0)throw console.log("Failed to Load predefined layout. Available layout IDs are : ",d.map(S=>S.name)),new Error("handleLayoutSelectChange");this._goldenLayout.loadLayout(y.config)}goldenRegisterComponent(r,a){this._goldenLayout.registerComponentConstructor(r,a)}goldenAppendView(r,a){this.jsxCmpCurrentIndex=r,this._goldenLayout.addComponent(this.solidGoldenComponentRef.typeName,{jsxIndex:r},a||void 0)}}var xv=Ht('<iframe width=100% height=100% src="https://www.youtube.com/embed/y7KYdqVND4o?autoplay=1&amp;mute=0"allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"allowfullscreen>');function bv(){return jt(xv)}function wv(p){return(...r)=>{for(const a of p)a&&a(...r)}}var Xt=p=>typeof p=="function"&&!p.length?p():p;function Cv(p,...r){return typeof p=="function"?p(...r):p}var Sv=/((?:--)?(?:\w+-?)+)\s*:\s*([^;]*)/g;function _f(p){const r={};let a;for(;a=Sv.exec(p);)r[a[1]]=a[2];return r}function pg(p,r){if(typeof p=="string"){if(typeof r=="string")return`${p};${r}`;p=_f(p)}else typeof r=="string"&&(r=_f(r));return{...p,...r}}function xo(...p){return wv(p)}function yf(p,r){const a=[...p],d=a.indexOf(r);return d!==-1&&a.splice(d,1),a}function Iv(p){return Object.prototype.toString.call(p)==="[object String]"}function Tv(p){return typeof p=="function"}function pp(p){return r=>`${p()}-${r}`}function gs(p,r){return p?p===r||p.contains(r):!1}function Rc(p,r=!1){const{activeElement:a}=go(p);if(!a?.nodeName)return null;if(mg(a)&&a.contentDocument)return Rc(a.contentDocument.body,r);if(r){const d=a.getAttribute("aria-activedescendant");if(d){const y=go(a).getElementById(d);if(y)return y}}return a}function go(p){return p?p.ownerDocument||p:document}function mg(p){return p.tagName==="IFRAME"}var fg=(p=>(p.Escape="Escape",p.Enter="Enter",p.Tab="Tab",p.Space=" ",p.ArrowDown="ArrowDown",p.ArrowLeft="ArrowLeft",p.ArrowRight="ArrowRight",p.ArrowUp="ArrowUp",p.End="End",p.Home="Home",p.PageDown="PageDown",p.PageUp="PageUp",p))(fg||{});function Ev(p){return typeof window<"u"&&window.navigator!=null?p.test(window.navigator.userAgentData?.platform||window.navigator.platform):!1}function Pv(){return Ev(/^Mac/i)}function bh(p,r){return r&&(Tv(r)?r(p):r[0](r[1],p)),p?.defaultPrevented}function ph(p){return r=>{for(const a of p)bh(r,a)}}function Mv(p){return Pv()?p.metaKey&&!p.ctrlKey:p.ctrlKey&&!p.metaKey}function ms(p){if(p)if(kv())p.focus({preventScroll:!0});else{const r=Av(p);p.focus(),zv(r)}}var nh=null;function kv(){if(nh==null){nh=!1;try{document.createElement("div").focus({get preventScroll(){return nh=!0,!0}})}catch{}}return nh}function Av(p){let r=p.parentNode;const a=[],d=document.scrollingElement||document.documentElement;for(;r instanceof HTMLElement&&r!==d;)(r.offsetHeight<r.scrollHeight||r.offsetWidth<r.scrollWidth)&&a.push({element:r,scrollTop:r.scrollTop,scrollLeft:r.scrollLeft}),r=r.parentNode;return d instanceof HTMLElement&&a.push({element:d,scrollTop:d.scrollTop,scrollLeft:d.scrollLeft}),a}function zv(p){for(const{element:r,scrollTop:a,scrollLeft:d}of p)r.scrollTop=a,r.scrollLeft=d}var Dv=["input:not([type='hidden']):not([disabled])","select:not([disabled])","textarea:not([disabled])","button:not([disabled])","a[href]","area[href]","[tabindex]","iframe","object","embed","audio[controls]","video[controls]","[contenteditable]:not([contenteditable='false'])"],gg=`${Dv.join(":not([hidden]),")},[tabindex]:not([disabled]):not([hidden])`;function _g(p,r){const d=Array.from(p.querySelectorAll(gg)).filter(vf);return r&&vf(p)&&d.unshift(p),d.forEach((y,S)=>{if(mg(y)&&y.contentDocument){const x=y.contentDocument.body,u=_g(x,!1);d.splice(S,1,...u)}}),d}function vf(p){return yg(p)&&!Lv(p)}function yg(p){return p.matches(gg)&&vg(p)}function Lv(p){return Number.parseInt(p.getAttribute("tabindex")||"0",10)<0}function vg(p,r){return p.nodeName!=="#comment"&&Rv(p)&&Bv(p,r)&&(!p.parentElement||vg(p.parentElement,p))}function Rv(p){if(!(p instanceof HTMLElement)&&!(p instanceof SVGElement))return!1;const{display:r,visibility:a}=p.style;let d=r!=="none"&&a!=="hidden"&&a!=="collapse";if(d){if(!p.ownerDocument.defaultView)return d;const{getComputedStyle:y}=p.ownerDocument.defaultView,{display:S,visibility:x}=y(p);d=S!=="none"&&x!=="hidden"&&x!=="collapse"}return d}function Bv(p,r){return!p.hasAttribute("hidden")&&(p.nodeName==="DETAILS"&&r&&r.nodeName!=="SUMMARY"?p.hasAttribute("open"):!0)}function Fv(){}function nr(p,r){return Li(p,r)}var Mc=new Map,xf=new Set;function bf(){if(typeof window>"u")return;const p=a=>{if(!a.target)return;let d=Mc.get(a.target);d||(d=new Set,Mc.set(a.target,d),a.target.addEventListener("transitioncancel",r)),d.add(a.propertyName)},r=a=>{if(!a.target)return;const d=Mc.get(a.target);if(d&&(d.delete(a.propertyName),d.size===0&&(a.target.removeEventListener("transitioncancel",r),Mc.delete(a.target)),Mc.size===0)){for(const y of xf)y();xf.clear()}};document.body.addEventListener("transitionrun",p),document.body.addEventListener("transitionend",r)}typeof document<"u"&&(document.readyState!=="loading"?bf():document.addEventListener("DOMContentLoaded",bf));var Ov={border:"0",clip:"rect(0 0 0 0)","clip-path":"inset(50%)",height:"1px",margin:"0 -1px -1px 0",overflow:"hidden",padding:"0",position:"absolute",width:"1px","white-space":"nowrap"};function xg(p,r){const[a,d]=qt(wf(r?.()));return Yt(()=>{d(p()?.tagName.toLowerCase()||wf(r?.()))}),a}function wf(p){return Iv(p)?p:void 0}function Hr(p){const[r,a]=Xi(p,["as"]);if(!r.as)throw new Error("[kobalte]: Polymorphic is missing the required `as` prop.");return Ye(lg,Li(a,{get component(){return r.as}}))}var Nv=Object.defineProperty,mp=(p,r)=>{for(var a in r)Nv(p,a,{get:r[a],enumerable:!0})},Vv={};mp(Vv,{Button:()=>bg,Root:()=>wh});var Uv=["button","color","file","image","reset","submit"];function $v(p){const r=p.tagName.toLowerCase();return r==="button"?!0:r==="input"&&p.type?Uv.indexOf(p.type)!==-1:!1}function wh(p){let r;const a=nr({type:"button"},p),[d,y]=Xi(a,["ref","type","disabled"]),S=xg(()=>r,()=>"button"),x=Ot(()=>{const V=S();return V==null?!1:$v({tagName:V,type:d.type})}),u=Ot(()=>S()==="input"),O=Ot(()=>S()==="a"&&r?.getAttribute("href")!=null);return Ye(Hr,Li({as:"button",ref(V){var W=xo(q=>r=q,d.ref);typeof W=="function"&&W(V)},get type(){return x()||u()?d.type:void 0},get role(){return!x()&&!O()?"button":void 0},get tabIndex(){return!x()&&!O()&&!d.disabled?0:void 0},get disabled(){return x()||u()?d.disabled:void 0},get"aria-disabled"(){return!x()&&!u()&&d.disabled?!0:void 0},get"data-disabled"(){return d.disabled?"":void 0}},y))}var bg=wh,jv=Ht('<svg width=58 height=58 viewBox="0 0 58 58"fill=none xmlns=http://www.w3.org/2000/svg><g filter=url(#filter0_d_434_169)><path d="M33.5998 18.0241C32.6633 17.788 31.6897 17.7532 30.7396 17.9217C29.7895 18.0903 28.8832 18.4586 28.077 19.0039C28.0175 19.0446 27.9674 19.0983 27.9301 19.1611C27.8928 19.2239 27.8692 19.2943 27.8611 19.3675C27.8529 19.4406 27.8604 19.5148 27.8829 19.5847C27.9054 19.6545 27.9425 19.7185 27.9915 19.7721C28.0947 19.8912 28.2355 19.9687 28.3889 19.9909C28.5422 20.0132 28.6983 19.9787 28.8293 19.8936C29.4921 19.4451 30.2372 19.1422 31.0184 19.0036C31.7995 18.8651 32.6 18.8938 33.3699 19.0882C34.7223 19.3277 35.9283 20.1083 36.7256 21.2603C37.5229 22.4123 37.847 23.8424 37.6274 25.2396L37.5761 25.4728C37.5146 25.75 37.4307 26.0214 37.3253 26.2841C37.271 26.4383 37.2737 26.6077 37.333 26.7599C37.3922 26.9121 37.5038 27.0365 37.6464 27.1091C37.7113 27.1479 37.7832 27.1723 37.8577 27.1808C37.9322 27.1893 38.0077 27.1817 38.0792 27.1585C38.1507 27.1353 38.2167 27.0969 38.273 27.0459C38.3293 26.9949 38.3747 26.9323 38.4063 26.8622C38.5749 26.4558 38.6986 26.0312 38.7749 25.5962L38.792 25.5198C39.0589 23.8167 38.6632 22.0738 37.6908 20.6701C36.7185 19.2664 35.2482 18.3155 33.5998 18.0241ZM39.2993 43.6762H37.5495L39.569 41.405C39.791 41.1174 39.9133 40.7615 39.9164 40.3939C39.9195 40.0263 39.8032 39.6682 39.5861 39.3767C39.3536 39.077 39.0569 38.8368 38.7195 38.675C38.382 38.5132 38.0128 38.4341 37.6407 38.4439C37.0575 38.3845 36.4749 38.5622 36.0169 38.9392C35.5588 39.3162 35.2614 39.8627 35.188 40.4624C35.2287 40.6485 35.3296 40.8149 35.4741 40.9341C35.6186 41.0533 35.7981 41.1182 35.9831 41.1182C36.1681 41.1182 36.3476 41.0533 36.4921 40.9341C36.6366 40.8149 36.7375 40.6485 36.7782 40.4624C36.8057 40.2497 36.9127 40.0565 37.0763 39.924C37.2399 39.7915 37.4472 39.7301 37.654 39.753C37.7621 39.7511 37.8691 39.7757 37.9662 39.8248C38.0633 39.8738 38.1477 39.9459 38.2126 40.0352C38.2801 40.1256 38.3196 40.2349 38.3261 40.3488C38.3325 40.4628 38.3055 40.5761 38.2487 40.674L35.34 43.9447C35.2555 44.0337 35.2029 44.1497 35.1908 44.2737C35.1788 44.3976 35.2079 44.5221 35.2735 44.6267C35.3541 44.7417 35.4609 44.8344 35.5845 44.8966C35.7081 44.9588 35.8447 44.9886 35.9822 44.9833H39.2974C39.3925 45.0056 39.4913 45.0056 39.5864 44.9831C39.6815 44.9606 39.7704 44.9164 39.8467 44.8536C39.9229 44.7908 39.9845 44.7111 40.0268 44.6204C40.0691 44.5298 40.0911 44.4304 40.0911 44.3298C40.0911 44.2292 40.0691 44.1298 40.0268 44.0391C39.9845 43.9485 39.9229 43.8688 39.8467 43.806C39.7704 43.7432 39.6815 43.699 39.5864 43.6765C39.4913 43.654 39.3944 43.6539 39.2993 43.6762ZM23.0425 40.3173C22.5835 40.4994 22.096 40.5924 21.6043 40.5917C20.8309 40.6711 20.058 40.4359 19.4502 39.9363C18.8423 39.4367 18.4475 38.7121 18.3499 37.9167C18.4475 37.1214 18.8423 36.3968 19.4502 35.8972C20.058 35.3976 20.8309 35.1624 21.6043 35.2418C22.0905 35.2411 22.5728 35.3321 23.0273 35.5103C23.2115 35.5897 23.4162 35.6031 23.6087 35.5484C23.8013 35.4937 23.9704 35.374 24.0893 35.2085C24.1324 35.128 24.157 35.0383 24.1613 34.9465C24.1656 34.8546 24.1495 34.763 24.114 34.6786C24.0786 34.5942 24.0249 34.5193 23.9571 34.4596C23.8892 34.3999 23.809 34.3571 23.7226 34.3345C23.0458 34.0707 22.3277 33.9378 21.6043 33.9425C20.4533 33.8258 19.3035 34.1764 18.3989 34.9199C17.4944 35.6634 16.9064 36.7412 16.7597 37.9246C16.906 39.1083 17.4938 40.1866 18.3983 40.9305C19.3029 41.6744 20.453 42.0253 21.6043 41.9086C22.3372 41.9102 23.064 41.7706 23.7473 41.4971C23.8337 41.4741 23.9138 41.431 23.9814 41.3709C24.0491 41.3109 24.1024 41.2356 24.1373 41.151C24.1722 41.0663 24.1877 40.9744 24.1827 40.8825C24.1777 40.7907 24.1522 40.7012 24.1083 40.6211C23.9895 40.4543 23.8198 40.3337 23.6264 40.2786C23.4331 40.2235 23.2274 40.2371 23.0425 40.3173ZM29.4088 33.9288C28.2578 33.8111 27.1077 34.1614 26.2032 34.9051C25.2988 35.6488 24.7114 36.7272 24.5661 37.9109C24.7123 39.0942 25.2999 40.1722 26.204 40.9161C27.1082 41.6599 28.2578 42.011 29.4088 41.8949C30.5601 42.0116 31.7101 41.6607 32.6147 40.9168C33.5193 40.1729 34.1071 39.0946 34.2533 37.9109C34.1066 36.7275 33.5186 35.6497 32.6141 34.9062C31.7096 34.1627 30.5598 33.8121 29.4088 33.9288ZM29.4088 40.5917C28.6339 40.6721 27.8593 40.4366 27.2504 39.9357C26.6416 39.4347 26.2469 38.708 26.1506 37.9109C26.2482 37.1159 26.6427 36.3916 27.2502 35.892C27.8576 35.3925 28.63 35.1571 29.4031 35.2359C30.1765 35.1565 30.9494 35.3917 31.5572 35.8913C32.165 36.3909 32.5598 37.1155 32.6575 37.9109C32.5598 38.7051 32.1658 39.4288 31.5593 39.9282C30.9527 40.4277 30.1812 40.6636 29.4088 40.5858V40.5917ZM21.7582 32.1416C21.9202 32.1324 22.0727 32.0596 22.1843 31.938C22.2958 31.8164 22.358 31.6554 22.358 31.488C22.358 31.3206 22.2958 31.1596 22.1843 31.038C22.0727 30.9165 21.9202 30.8436 21.7582 30.8345H17.0808C15.7146 30.8361 14.3917 30.3408 13.3445 29.4358C12.2973 28.5308 11.5929 27.274 11.3551 25.8863C11.1174 24.4986 11.3615 23.0689 12.0445 21.8485C12.7276 20.6281 13.8059 19.6951 15.0898 19.2136C15.2412 19.1547 15.365 19.0381 15.4357 18.888C15.5064 18.7378 15.5186 18.5654 15.4697 18.4062C15.1522 17.4213 15.0284 16.381 15.1058 15.3462C15.1832 14.3113 15.4601 13.3029 15.9203 12.3799C16.3806 11.4569 17.0149 10.6381 17.786 9.97131C18.5571 9.30457 19.4496 8.80337 20.411 8.49712C21.3724 8.19087 22.3834 8.08573 23.3847 8.18788C24.386 8.29002 25.3575 8.59739 26.2421 9.09195C27.1267 9.58652 27.9067 10.2583 28.5363 11.068C29.1659 11.8776 29.6324 12.8087 29.9084 13.8068C29.9445 13.9227 30.0107 14.0261 30.0998 14.1059C30.1889 14.1858 30.2975 14.2389 30.4138 14.2595C30.5301 14.2796 30.6496 14.2654 30.7585 14.2186C30.8674 14.1719 30.9612 14.0943 31.0293 13.995C31.6174 13.1522 32.3908 12.4654 33.2861 11.9908C34.1815 11.5163 35.1731 11.2676 36.1797 11.2651H36.2215C37.0697 11.2631 37.9093 11.4403 38.6886 11.7858C39.4679 12.1312 40.1703 12.6377 40.7526 13.2738C41.3472 13.9093 41.8105 14.6626 42.1146 15.4883C42.4186 16.3139 42.557 17.1946 42.5214 18.077C42.5178 18.2475 42.5789 18.4128 42.6918 18.5375C42.8046 18.6623 42.9602 18.7367 43.1254 18.7448C43.2906 18.753 43.4523 18.6943 43.5762 18.5813C43.7001 18.4683 43.7763 18.3098 43.7885 18.1397C43.8321 17.0798 43.6667 16.0218 43.3023 15.0298C42.9378 14.0377 42.382 13.1323 41.6683 12.3684C40.9694 11.6065 40.1274 10.9995 39.1935 10.5844C38.2597 10.1693 37.2536 9.95486 36.2367 9.9541C35.2119 9.95169 34.197 10.1615 33.2523 10.5712C32.3075 10.9809 31.4521 11.582 30.7367 12.339C29.9027 10.4451 28.465 8.90294 26.6631 7.96908C24.8611 7.03522 22.8034 6.76601 20.8325 7.20624C18.8615 7.64647 17.0962 8.7696 15.8301 10.3887C14.5641 12.0079 13.8737 14.0254 13.8739 16.1055C13.8745 16.8162 13.9548 17.5245 14.1133 18.2161C12.6479 18.9128 11.4575 20.1053 10.7394 21.5957C10.0212 23.0861 9.81857 24.785 10.165 26.4105C10.5114 28.036 11.386 29.4906 12.6439 30.533C13.9018 31.5754 15.4673 32.1429 17.0808 32.1416H21.7582ZM45.4091 19.1959C45.278 19.0951 45.1143 19.0503 44.9521 19.071C44.7898 19.0916 44.6415 19.1761 44.5381 19.3067C44.4347 19.4373 44.3842 19.6041 44.3971 19.7722C44.41 19.9404 44.4854 20.0968 44.6074 20.2091C45.5328 20.9924 46.201 22.0514 46.5207 23.2413C46.8404 24.4313 46.796 25.6941 46.3934 26.8569C45.9909 28.0198 45.2499 29.0261 44.2718 29.738C43.2938 30.45 42.1264 30.8329 40.9293 30.8345H24.3552C24.1932 30.8436 24.0407 30.9165 23.9291 31.038C23.8176 31.1596 23.7554 31.3206 23.7554 31.488C23.7554 31.6554 23.8176 31.8164 23.9291 31.938C24.0407 32.0596 24.1932 32.1324 24.3552 32.1416H40.9293C42.3881 32.1403 43.8108 31.674 45.0028 30.8066C46.1948 29.9391 47.0977 28.7129 47.5881 27.2958C48.0785 25.8786 48.1324 24.3398 47.7423 22.8899C47.3523 21.4399 46.5373 20.1498 45.4091 19.1959Z"fill=#E6E6E6></path></g><defs><filter id=filter0_d_434_169 x=0 y=0 width=58 height=58 filterUnits=userSpaceOnUse color-interpolation-filters=sRGB><feFlood flood-opacity=0 result=BackgroundImageFix></feFlood><feColorMatrix in=SourceAlpha type=matrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"result=hardAlpha></feColorMatrix><feOffset dy=3></feOffset><feGaussianBlur stdDeviation=5></feGaussianBlur><feComposite in2=hardAlpha operator=out></feComposite><feColorMatrix type=matrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"></feColorMatrix><feBlend mode=normal in2=BackgroundImageFix result=effect1_dropShadow_434_169></feBlend><feBlend mode=normal in=SourceGraphic in2=effect1_dropShadow_434_169 result=shape>');const wg=()=>jt(jv);var qv=Ht('<svg width=40 height=48 viewBox="0 0 40 48"fill=none xmlns=http://www.w3.org/2000/svg><g filter=url(#filter0_d_434_176)><path d="M19.3191 7C19.9988 9.16923 19.0278 11.2462 17.0858 11.9231C17.3528 12.7292 18.3602 13.5354 19.3555 13.8C20.0959 12.7108 20.7877 11.4985 20.5632 10.3957C21.3218 11.3569 21.6859 12.92 20.9273 13.7446C21.8558 13.4615 22.76 12.7908 22.9118 11.9231C23.2577 9.912 20.7088 7.98462 19.3191 7ZM10 11.3692L16.5396 18.4523V16.8277L12.5222 12.4769H16.1148V11.3692H10ZM23.8828 11.3692V12.4769H27.4754L23.4579 16.8277V19.3692H25.6427V18.2615H23.6339L30 11.3692H23.8828ZM18.603 15.3077V16.2923H21.3946V15.3077H18.603ZM17.632 17.4V19.2462H22.3656V17.4H17.632ZM26.735 17.4V20.2308H28.0095V17.4H26.735ZM16.1148 20.3538C16.1452 20.3538 15.7932 20.4585 15.423 20.7354C15.0528 21.0123 14.6219 21.4246 14.2214 21.8862C13.5963 22.6062 13.0805 23.48 12.8741 24.1692H24.4289V33.1538H12.777V35H27.2205V24.7231C27.2205 24.0154 26.5833 22.8154 25.7762 21.8862C25.3757 21.4246 24.9448 21.0123 24.5746 20.7354C24.2044 20.4585 23.8524 20.3538 23.8828 20.3538H16.1148ZM12.777 25.2769V32.0462H23.3366V25.2769H12.777Z"fill=#E6E6E6></path></g><defs><filter id=filter0_d_434_176 x=0 y=0 width=40 height=48 filterUnits=userSpaceOnUse color-interpolation-filters=sRGB><feFlood flood-opacity=0 result=BackgroundImageFix></feFlood><feColorMatrix in=SourceAlpha type=matrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 127 0"result=hardAlpha></feColorMatrix><feOffset dy=3></feOffset><feGaussianBlur stdDeviation=5></feGaussianBlur><feComposite in2=hardAlpha operator=out></feComposite><feColorMatrix type=matrix values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.25 0"></feColorMatrix><feBlend mode=normal in2=BackgroundImageFix result=effect1_dropShadow_434_176></feBlend><feBlend mode=normal in=SourceGraphic in2=effect1_dropShadow_434_176 result=shape>');const Cg=()=>jt(qv);var mh="data-kb-top-layer",Sg,Qd=!1,vs=[];function Xc(p){return vs.findIndex(r=>r.node===p)}function Hv(p){return vs[Xc(p)]}function Wv(p){return vs[vs.length-1].node===p}function Ig(){return vs.filter(p=>p.isPointerBlocking)}function Zv(){return[...Ig()].slice(-1)[0]}function fp(){return Ig().length>0}function Tg(p){const r=Xc(Zv()?.node);return Xc(p)<r}function Gv(p){vs.push(p)}function Xv(p){const r=Xc(p);r<0||vs.splice(r,1)}function Yv(){for(const{node:p}of vs)p.style.pointerEvents=Tg(p)?"none":"auto"}function Kv(p){if(fp()&&!Qd){const r=go(p);Sg=document.body.style.pointerEvents,r.body.style.pointerEvents="none",Qd=!0}}function Jv(p){if(fp())return;const r=go(p);r.body.style.pointerEvents=Sg,r.body.style.length===0&&r.body.removeAttribute("style"),Qd=!1}var Jn={layers:vs,isTopMostLayer:Wv,hasPointerBlockingLayer:fp,isBelowPointerBlockingLayer:Tg,addLayer:Gv,removeLayer:Xv,indexOf:Xc,find:Hv,assignPointerEventToLayers:Yv,disableBodyPointerEvents:Kv,restoreBodyPointerEvents:Jv},Ud="focusScope.autoFocusOnMount",$d="focusScope.autoFocusOnUnmount",Cf={bubbles:!1,cancelable:!0},Sf={stack:[],active(){return this.stack[0]},add(p){p!==this.active()&&this.active()?.pause(),this.stack=yf(this.stack,p),this.stack.unshift(p)},remove(p){this.stack=yf(this.stack,p),this.active()?.resume()}};function Qv(p,r){const[a,d]=qt(!1),y={pause(){d(!0)},resume(){d(!1)}};let S=null;const x=ie=>p.onMountAutoFocus?.(ie),u=ie=>p.onUnmountAutoFocus?.(ie),O=()=>go(r()),V=()=>{const ie=O().createElement("span");return ie.setAttribute("data-focus-trap",""),ie.tabIndex=0,Object.assign(ie.style,Ov),ie},W=()=>{const ie=r();return ie?_g(ie,!0).filter(pe=>!pe.hasAttribute("data-focus-trap")):[]},q=()=>{const ie=W();return ie.length>0?ie[0]:null},F=()=>{const ie=W();return ie.length>0?ie[ie.length-1]:null},oe=()=>{const ie=r();if(!ie)return!1;const pe=Rc(ie);return!pe||gs(ie,pe)?!1:yg(pe)};Yt(()=>{const ie=r();if(!ie)return;Sf.add(y);const pe=Rc(ie);if(!gs(ie,pe)){const Ce=new CustomEvent(Ud,Cf);ie.addEventListener(Ud,x),ie.dispatchEvent(Ce),Ce.defaultPrevented||setTimeout(()=>{ms(q()),Rc(ie)===pe&&ms(ie)},0)}si(()=>{ie.removeEventListener(Ud,x),setTimeout(()=>{const Ce=new CustomEvent($d,Cf);oe()&&Ce.preventDefault(),ie.addEventListener($d,u),ie.dispatchEvent(Ce),Ce.defaultPrevented||ms(pe??O().body),ie.removeEventListener($d,u),Sf.remove(y)},0)})}),Yt(()=>{const ie=r();if(!ie||!Xt(p.trapFocus)||a())return;const pe=Ce=>{const je=Ce.target;je?.closest(`[${mh}]`)||(gs(ie,je)?S=je:ms(S))},ve=Ce=>{const st=Ce.relatedTarget??Rc(ie);st?.closest(`[${mh}]`)||gs(ie,st)||ms(S)};O().addEventListener("focusin",pe),O().addEventListener("focusout",ve),si(()=>{O().removeEventListener("focusin",pe),O().removeEventListener("focusout",ve)})}),Yt(()=>{const ie=r();if(!ie||!Xt(p.trapFocus)||a())return;const pe=V();ie.insertAdjacentElement("afterbegin",pe);const ve=V();ie.insertAdjacentElement("beforeend",ve);function Ce(st){const Qe=q(),qe=F();st.relatedTarget===Qe?ms(qe):ms(Qe)}pe.addEventListener("focusin",Ce),ve.addEventListener("focusin",Ce);const je=new MutationObserver(st=>{for(const Qe of st)Qe.previousSibling===ve&&(ve.remove(),ie.insertAdjacentElement("beforeend",ve)),Qe.nextSibling===pe&&(pe.remove(),ie.insertAdjacentElement("afterbegin",pe))});je.observe(ie,{childList:!0,subtree:!1}),si(()=>{pe.removeEventListener("focusin",Ce),ve.removeEventListener("focusin",Ce),pe.remove(),ve.remove(),je.disconnect()})})}var ex="data-live-announcer";function tx(p){Yt(()=>{Xt(p.isDisabled)||si(ix(Xt(p.targets),Xt(p.root)))})}var kc=new WeakMap,gr=[];function ix(p,r=document.body){const a=new Set(p),d=new Set,y=O=>{for(const F of O.querySelectorAll(`[${ex}], [${mh}]`))a.add(F);const V=F=>{if(a.has(F)||F.parentElement&&d.has(F.parentElement)&&F.parentElement.getAttribute("role")!=="row")return NodeFilter.FILTER_REJECT;for(const oe of a)if(F.contains(oe))return NodeFilter.FILTER_SKIP;return NodeFilter.FILTER_ACCEPT},W=document.createTreeWalker(O,NodeFilter.SHOW_ELEMENT,{acceptNode:V}),q=V(O);if(q===NodeFilter.FILTER_ACCEPT&&S(O),q!==NodeFilter.FILTER_REJECT){let F=W.nextNode();for(;F!=null;)S(F),F=W.nextNode()}},S=O=>{const V=kc.get(O)??0;O.getAttribute("aria-hidden")==="true"&&V===0||(V===0&&O.setAttribute("aria-hidden","true"),d.add(O),kc.set(O,V+1))};gr.length&&gr[gr.length-1].disconnect(),y(r);const x=new MutationObserver(O=>{for(const V of O)if(!(V.type!=="childList"||V.addedNodes.length===0)&&![...a,...d].some(W=>W.contains(V.target))){for(const W of V.removedNodes)W instanceof Element&&(a.delete(W),d.delete(W));for(const W of V.addedNodes)(W instanceof HTMLElement||W instanceof SVGElement)&&(W.dataset.liveAnnouncer==="true"||W.dataset.reactAriaTopLayer==="true")?a.add(W):W instanceof Element&&y(W)}});x.observe(r,{childList:!0,subtree:!0});const u={observe(){x.observe(r,{childList:!0,subtree:!0})},disconnect(){x.disconnect()}};return gr.push(u),()=>{x.disconnect();for(const O of d){const V=kc.get(O);if(V==null)return;V===1?(O.removeAttribute("aria-hidden"),kc.delete(O)):kc.set(O,V-1)}u===gr[gr.length-1]?(gr.pop(),gr.length&&gr[gr.length-1].observe()):gr.splice(gr.indexOf(u),1)}}function nx(p){const r=a=>{a.key===fg.Escape&&p.onEscapeKeyDown?.(a)};Yt(()=>{if(Xt(p.isDisabled))return;const a=p.ownerDocument?.()??go();a.addEventListener("keydown",r),si(()=>{a.removeEventListener("keydown",r)})})}var If="interactOutside.pointerDownOutside",Tf="interactOutside.focusOutside";function rx(p,r){let a,d=Fv;const y=()=>go(r()),S=q=>p.onPointerDownOutside?.(q),x=q=>p.onFocusOutside?.(q),u=q=>p.onInteractOutside?.(q),O=q=>{const F=q.target;return!(F instanceof HTMLElement)||F.closest(`[${mh}]`)||!gs(y(),F)||gs(r(),F)?!1:!p.shouldExcludeElement?.(F)},V=q=>{function F(){const oe=r(),ie=q.target;if(!oe||!ie||!O(q))return;const pe=ph([S,u]);ie.addEventListener(If,pe,{once:!0});const ve=new CustomEvent(If,{bubbles:!1,cancelable:!0,detail:{originalEvent:q,isContextMenu:q.button===2||Mv(q)&&q.button===0}});ie.dispatchEvent(ve)}q.pointerType==="touch"?(y().removeEventListener("click",F),d=F,y().addEventListener("click",F,{once:!0})):F()},W=q=>{const F=r(),oe=q.target;if(!F||!oe||!O(q))return;const ie=ph([x,u]);oe.addEventListener(Tf,ie,{once:!0});const pe=new CustomEvent(Tf,{bubbles:!1,cancelable:!0,detail:{originalEvent:q,isContextMenu:!1}});oe.dispatchEvent(pe)};Yt(()=>{Xt(p.isDisabled)||(a=window.setTimeout(()=>{y().addEventListener("pointerdown",V,!0)},0),y().addEventListener("focusin",W,!0),si(()=>{window.clearTimeout(a),y().removeEventListener("click",d),y().removeEventListener("pointerdown",V,!0),y().removeEventListener("focusin",W,!0)}))})}var Eg=vo();function sx(){return ho(Eg)}function ox(p){let r;const a=sx(),[d,y]=Xi(p,["ref","disableOutsidePointerEvents","excludedElements","onEscapeKeyDown","onPointerDownOutside","onFocusOutside","onInteractOutside","onDismiss","bypassTopMostLayerCheck"]),S=new Set([]),x=q=>{S.add(q);const F=a?.registerNestedLayer(q);return()=>{S.delete(q),F?.()}};rx({shouldExcludeElement:q=>r?d.excludedElements?.some(F=>gs(F(),q))||[...S].some(F=>gs(F,q)):!1,onPointerDownOutside:q=>{!r||Jn.isBelowPointerBlockingLayer(r)||!d.bypassTopMostLayerCheck&&!Jn.isTopMostLayer(r)||(d.onPointerDownOutside?.(q),d.onInteractOutside?.(q),q.defaultPrevented||d.onDismiss?.())},onFocusOutside:q=>{d.onFocusOutside?.(q),d.onInteractOutside?.(q),q.defaultPrevented||d.onDismiss?.()}},()=>r),nx({ownerDocument:()=>go(r),onEscapeKeyDown:q=>{!r||!Jn.isTopMostLayer(r)||(d.onEscapeKeyDown?.(q),!q.defaultPrevented&&d.onDismiss&&(q.preventDefault(),d.onDismiss()))}}),yo(()=>{if(!r)return;Jn.addLayer({node:r,isPointerBlocking:d.disableOutsidePointerEvents,dismiss:d.onDismiss});const q=a?.registerNestedLayer(r);Jn.assignPointerEventToLayers(),Jn.disableBodyPointerEvents(r),si(()=>{r&&(Jn.removeLayer(r),q?.(),Jn.assignPointerEventToLayers(),Jn.restoreBodyPointerEvents(r))})}),Yt(lp([()=>r,()=>d.disableOutsidePointerEvents],([q,F])=>{if(!q)return;const oe=Jn.find(q);oe&&oe.isPointerBlocking!==F&&(oe.isPointerBlocking=F,Jn.assignPointerEventToLayers()),F&&Jn.disableBodyPointerEvents(q),si(()=>{Jn.restoreBodyPointerEvents(q)})},{defer:!0}));const W={registerNestedLayer:x};return Ye(Eg.Provider,{value:W,get children(){return Ye(Hr,Li({as:"div",ref(q){var F=xo(oe=>r=oe,d.ref);typeof F=="function"&&F(q)}},y))}})}function Pg(p){const[r,a]=qt(p.defaultValue?.()),d=Ot(()=>p.value?.()!==void 0),y=Ot(()=>d()?p.value?.():r());return[y,x=>{yh(()=>{const u=Cv(x,y());return Object.is(u,y())||(d()||a(u),p.onChange?.(u)),u})}]}function ax(p){const[r,a]=Pg(p);return[()=>r()??!1,a]}function lx(p={}){const[r,a]=ax({value:()=>Xt(p.open),defaultValue:()=>!!Xt(p.defaultOpen),onChange:x=>p.onOpenChange?.(x)}),d=()=>{a(!0)},y=()=>{a(!1)};return{isOpen:r,setIsOpen:a,open:d,close:y,toggle:()=>{r()?y():d()}}}function ia(p){return r=>(p(r),()=>p(void 0))}var pn=p=>typeof p=="function"?p():p,ep=(p,r)=>{if(p.contains(r))return!0;let a=r;for(;a;){if(a===p)return!0;a=a._$host??a.parentElement}return!1},rh=new Map,cx=p=>{Yt(()=>{const r=pn(p.style)??{},a=pn(p.properties)??[],d={};for(const S in r)d[S]=p.element.style[S];const y=rh.get(p.key);y?y.activeCount++:rh.set(p.key,{activeCount:1,originalStyles:d,properties:a.map(S=>S.key)}),Object.assign(p.element.style,p.style);for(const S of a)p.element.style.setProperty(S.key,S.value);si(()=>{const S=rh.get(p.key);if(S){if(S.activeCount!==1){S.activeCount--;return}rh.delete(p.key);for(const[x,u]of Object.entries(S.originalStyles))p.element.style[x]=u;for(const x of S.properties)p.element.style.removeProperty(x);p.element.style.length===0&&p.element.removeAttribute("style"),p.cleanup?.()}})})},Ef=cx,ux=(p,r)=>{switch(r){case"x":return[p.clientWidth,p.scrollLeft,p.scrollWidth];case"y":return[p.clientHeight,p.scrollTop,p.scrollHeight]}},hx=(p,r)=>{const a=getComputedStyle(p),d=r==="x"?a.overflowX:a.overflowY;return d==="auto"||d==="scroll"||p.tagName==="HTML"&&d==="visible"},dx=(p,r,a)=>{const d=r==="x"&&window.getComputedStyle(p).direction==="rtl"?-1:1;let y=p,S=0,x=0,u=!1;do{const[O,V,W]=ux(y,r),q=W-O-d*V;(V!==0||q!==0)&&hx(y,r)&&(S+=q,x+=V),y===(a??document.documentElement)?u=!0:y=y._$host??y.parentElement}while(y&&!u);return[S,x]},[Pf,Mf]=qt([]),px=p=>Pf().indexOf(p)===Pf().length-1,mx=p=>{const r=Li({element:null,enabled:!0,hideScrollbar:!0,preventScrollbarShift:!0,preventScrollbarShiftMode:"padding",restoreScrollPosition:!0,allowPinchZoom:!1},p),a=Jc();let d=[0,0],y=null,S=null;Yt(()=>{pn(r.enabled)&&(Mf(V=>[...V,a]),si(()=>{Mf(V=>V.filter(W=>W!==a))}))}),Yt(()=>{if(!pn(r.enabled)||!pn(r.hideScrollbar))return;const{body:V}=document,W=window.innerWidth-V.offsetWidth;if(pn(r.preventScrollbarShift)){const q={overflow:"hidden"},F=[];W>0&&(pn(r.preventScrollbarShiftMode)==="padding"?q.paddingRight=`calc(${window.getComputedStyle(V).paddingRight} + ${W}px)`:q.marginRight=`calc(${window.getComputedStyle(V).marginRight} + ${W}px)`,F.push({key:"--scrollbar-width",value:`${W}px`}));const oe=window.scrollY,ie=window.scrollX;Ef({key:"prevent-scroll",element:V,style:q,properties:F,cleanup:()=>{pn(r.restoreScrollPosition)&&W>0&&window.scrollTo(ie,oe)}})}else Ef({key:"prevent-scroll",element:V,style:{overflow:"hidden"}})}),Yt(()=>{!px(a)||!pn(r.enabled)||(document.addEventListener("wheel",u,{passive:!1}),document.addEventListener("touchstart",x,{passive:!1}),document.addEventListener("touchmove",O,{passive:!1}),si(()=>{document.removeEventListener("wheel",u),document.removeEventListener("touchstart",x),document.removeEventListener("touchmove",O)}))});const x=V=>{d=kf(V),y=null,S=null},u=V=>{const W=V.target,q=pn(r.element),F=fx(V),oe=Math.abs(F[0])>Math.abs(F[1])?"x":"y",ie=oe==="x"?F[0]:F[1],pe=Af(W,oe,ie,q);let ve;q&&ep(q,W)?ve=!pe:ve=!0,ve&&V.cancelable&&V.preventDefault()},O=V=>{const W=pn(r.element),q=V.target;let F;if(V.touches.length===2)F=!pn(r.allowPinchZoom);else{if(y==null||S===null){const oe=kf(V).map((pe,ve)=>d[ve]-pe),ie=Math.abs(oe[0])>Math.abs(oe[1])?"x":"y";y=ie,S=ie==="x"?oe[0]:oe[1]}if(q.type==="range")F=!1;else{const oe=Af(q,y,S,W);W&&ep(W,q)?F=!oe:F=!0}}F&&V.cancelable&&V.preventDefault()}},fx=p=>[p.deltaX,p.deltaY],kf=p=>p.changedTouches[0]?[p.changedTouches[0].clientX,p.changedTouches[0].clientY]:[0,0],Af=(p,r,a,d)=>{const y=d!==null&&ep(d,p),[S,x]=dx(p,r,y?d:void 0);return!(a>0&&Math.abs(S)<=1||a<0&&Math.abs(x)<1)},gx=mx,_x=gx,yx=p=>{const r=Ot(()=>{const x=pn(p.element);if(x)return getComputedStyle(x)}),a=()=>r()?.animationName??"none",[d,y]=qt(pn(p.show)?"present":"hidden");let S="none";return Yt(x=>{const u=pn(p.show);return yh(()=>{if(x===u)return u;const O=S,V=a();u?y("present"):V==="none"||r()?.display==="none"?y("hidden"):y(x===!0&&O!==V?"hiding":"hidden")}),u}),Yt(()=>{const x=pn(p.element);if(!x)return;const u=V=>{V.target===x&&(S=a())},O=V=>{const q=a().includes(V.animationName);V.target===x&&q&&d()==="hiding"&&y("hidden")};x.addEventListener("animationstart",u),x.addEventListener("animationcancel",O),x.addEventListener("animationend",O),si(()=>{x.removeEventListener("animationstart",u),x.removeEventListener("animationcancel",O),x.removeEventListener("animationend",O)})}),{present:()=>d()==="present"||d()==="hiding",state:d,setState:y}},vx=yx,zf=vx,xx={};mp(xx,{CloseButton:()=>kg,Content:()=>Ag,Description:()=>zg,Dialog:()=>oo,Overlay:()=>Dg,Portal:()=>Lg,Root:()=>Rg,Title:()=>Bg,Trigger:()=>Fg});var Mg=vo();function la(){const p=ho(Mg);if(p===void 0)throw new Error("[kobalte]: `useDialogContext` must be used within a `Dialog` component");return p}function kg(p){const r=la(),[a,d]=Xi(p,["aria-label","onClick"]);return Ye(wh,Li({get"aria-label"(){return a["aria-label"]||r.translations().dismiss},onClick:S=>{bh(S,a.onClick),r.close()}},d))}function Ag(p){let r;const a=la(),d=nr({id:a.generateId("content")},p),[y,S]=Xi(d,["ref","onOpenAutoFocus","onCloseAutoFocus","onPointerDownOutside","onFocusOutside","onInteractOutside"]);let x=!1,u=!1;const O=F=>{y.onPointerDownOutside?.(F),a.modal()&&F.detail.isContextMenu&&F.preventDefault()},V=F=>{y.onFocusOutside?.(F),a.modal()&&F.preventDefault()},W=F=>{y.onInteractOutside?.(F),!a.modal()&&(F.defaultPrevented||(x=!0,F.detail.originalEvent.type==="pointerdown"&&(u=!0)),gs(a.triggerRef(),F.target)&&F.preventDefault(),F.detail.originalEvent.type==="focusin"&&u&&F.preventDefault())},q=F=>{y.onCloseAutoFocus?.(F),a.modal()?(F.preventDefault(),ms(a.triggerRef())):(F.defaultPrevented||(x||ms(a.triggerRef()),F.preventDefault()),x=!1,u=!1)};return tx({isDisabled:()=>!(a.isOpen()&&a.modal()),targets:()=>r?[r]:[]}),_x({element:()=>r??null,enabled:()=>a.contentPresent()&&a.preventScroll()}),Qv({trapFocus:()=>a.isOpen()&&a.modal(),onMountAutoFocus:y.onOpenAutoFocus,onUnmountAutoFocus:q},()=>r),Yt(()=>si(a.registerContentId(S.id))),Ye(Pr,{get when(){return a.contentPresent()},get children(){return Ye(ox,Li({ref(F){var oe=xo(ie=>{a.setContentRef(ie),r=ie},y.ref);typeof oe=="function"&&oe(F)},role:"dialog",tabIndex:-1,get disableOutsidePointerEvents(){return Ot(()=>!!a.modal())()&&a.isOpen()},get excludedElements(){return[a.triggerRef]},get"aria-labelledby"(){return a.titleId()},get"aria-describedby"(){return a.descriptionId()},get"data-expanded"(){return a.isOpen()?"":void 0},get"data-closed"(){return a.isOpen()?void 0:""},onPointerDownOutside:O,onFocusOutside:V,onInteractOutside:W,get onDismiss(){return a.close}},S))}})}function zg(p){const r=la(),a=nr({id:r.generateId("description")},p),[d,y]=Xi(a,["id"]);return Yt(()=>si(r.registerDescriptionId(d.id))),Ye(Hr,Li({as:"p",get id(){return d.id}},y))}function Dg(p){const r=la(),[a,d]=Xi(p,["ref","style","onPointerDown"]),y=S=>{bh(S,a.onPointerDown),S.target===S.currentTarget&&S.preventDefault()};return Ye(Pr,{get when(){return r.overlayPresent()},get children(){return Ye(Hr,Li({as:"div",ref(S){var x=xo(r.setOverlayRef,a.ref);typeof x=="function"&&x(S)},get style(){return pg({"pointer-events":"auto"},a.style)},get"data-expanded"(){return r.isOpen()?"":void 0},get"data-closed"(){return r.isOpen()?void 0:""},onPointerDown:y},d))}})}function Lg(p){const r=la();return Ye(Pr,{get when(){return r.contentPresent()||r.overlayPresent()},get children(){return Ye(x0,p)}})}var Df={dismiss:"Dismiss"};function Rg(p){const r=`dialog-${Jc()}`,a=nr({id:r,modal:!0,translations:Df},p),[d,y]=qt(),[S,x]=qt(),[u,O]=qt(),[V,W]=qt(),[q,F]=qt(),[oe,ie]=qt(),pe=lx({open:()=>a.open,defaultOpen:()=>a.defaultOpen,onOpenChange:Qe=>a.onOpenChange?.(Qe)}),ve=()=>a.forceMount||pe.isOpen(),{present:Ce}=zf({show:ve,element:()=>V()??null}),{present:je}=zf({show:ve,element:()=>q()??null}),st={translations:()=>a.translations??Df,isOpen:pe.isOpen,modal:()=>a.modal??!0,preventScroll:()=>a.preventScroll??st.modal(),contentId:d,titleId:S,descriptionId:u,triggerRef:oe,overlayRef:V,setOverlayRef:W,contentRef:q,setContentRef:F,overlayPresent:Ce,contentPresent:je,close:pe.close,toggle:pe.toggle,setTriggerRef:ie,generateId:pp(()=>a.id),registerContentId:ia(y),registerTitleId:ia(x),registerDescriptionId:ia(O)};return Ye(Mg.Provider,{value:st,get children(){return a.children}})}function Bg(p){const r=la(),a=nr({id:r.generateId("title")},p),[d,y]=Xi(a,["id"]);return Yt(()=>si(r.registerTitleId(d.id))),Ye(Hr,Li({as:"h2",get id(){return d.id}},y))}function Fg(p){const r=la(),[a,d]=Xi(p,["ref","onClick"]);return Ye(wh,Li({ref(S){var x=xo(r.setTriggerRef,a.ref);typeof x=="function"&&x(S)},"aria-haspopup":"dialog",get"aria-expanded"(){return r.isOpen()},get"aria-controls"(){return Ot(()=>!!r.isOpen())()?r.contentId():void 0},get"data-expanded"(){return r.isOpen()?"":void 0},get"data-closed"(){return r.isOpen()?void 0:""},onClick:S=>{bh(S,a.onClick),r.toggle()}},d))}var oo=Object.assign(Rg,{CloseButton:kg,Content:Ag,Description:zg,Overlay:Dg,Portal:Lg,Title:Bg,Trigger:Fg}),bx=["id","name","validationState","required","disabled","readOnly"];function wx(p){const r=`form-control-${Jc()}`,a=nr({id:r},p),[d,y]=qt(),[S,x]=qt(),[u,O]=qt(),[V,W]=qt(),q=(pe,ve,Ce)=>{const je=Ce!=null||d()!=null;return[Ce,d(),je&&ve!=null?pe:void 0].filter(Boolean).join(" ")||void 0},F=pe=>[u(),V(),pe].filter(Boolean).join(" ")||void 0,oe=Ot(()=>({"data-valid":Xt(a.validationState)==="valid"?"":void 0,"data-invalid":Xt(a.validationState)==="invalid"?"":void 0,"data-required":Xt(a.required)?"":void 0,"data-disabled":Xt(a.disabled)?"":void 0,"data-readonly":Xt(a.readOnly)?"":void 0}));return{formControlContext:{name:()=>Xt(a.name)??Xt(a.id),dataset:oe,validationState:()=>Xt(a.validationState),isRequired:()=>Xt(a.required),isDisabled:()=>Xt(a.disabled),isReadOnly:()=>Xt(a.readOnly),labelId:d,fieldId:S,descriptionId:u,errorMessageId:V,getAriaLabelledBy:q,getAriaDescribedBy:F,generateId:pp(()=>Xt(a.id)),registerLabel:ia(y),registerField:ia(x),registerDescription:ia(O),registerErrorMessage:ia(W)}}}var Og=vo();function Qc(){const p=ho(Og);if(p===void 0)throw new Error("[kobalte]: `useFormControlContext` must be used within a `FormControlContext.Provider` component");return p}function Ng(p){const r=Qc(),a=nr({id:r.generateId("description")},p);return Yt(()=>si(r.registerDescription(a.id))),Ye(Hr,Li({as:"div"},()=>r.dataset(),a))}function Vg(p){const r=Qc(),a=nr({id:r.generateId("error-message")},p),[d,y]=Xi(a,["forceMount"]),S=()=>r.validationState()==="invalid";return Yt(()=>{S()&&si(r.registerErrorMessage(y.id))}),Ye(Pr,{get when(){return d.forceMount||S()},get children(){return Ye(Hr,Li({as:"div"},()=>r.dataset(),y))}})}function Ug(p){let r;const a=Qc(),d=nr({id:a.generateId("label")},p),[y,S]=Xi(d,["ref"]),x=xg(()=>r,()=>"label");return Yt(()=>si(a.registerLabel(S.id))),Ye(Hr,Li({as:"label",ref(u){var O=xo(V=>r=V,y.ref);typeof O=="function"&&O(u)},get for(){return Ot(()=>x()==="label")()?a.fieldId():void 0}},()=>a.dataset(),S))}var Cx=["id","aria-label","aria-labelledby","aria-describedby"];function Sx(p){const r=Qc(),a=nr({id:r.generateId("field")},p);return Yt(()=>si(r.registerField(Xt(a.id)))),{fieldProps:{id:()=>Xt(a.id),ariaLabel:()=>Xt(a["aria-label"]),ariaLabelledBy:()=>r.getAriaLabelledBy(Xt(a.id),Xt(a["aria-label"]),Xt(a["aria-labelledby"])),ariaDescribedBy:()=>r.getAriaDescribedBy(Xt(a["aria-describedby"]))}}}function Ix(p,r){Yt(lp(p,a=>{if(a==null)return;const d=Tx(a);d!=null&&(d.addEventListener("reset",r,{passive:!0}),si(()=>{d.removeEventListener("reset",r)}))}))}function Tx(p){return Ex(p)?p.form:p.closest("form")}function Ex(p){return p.matches("textarea, input, select, button")}var Px={};mp(Px,{Description:()=>Ng,ErrorMessage:()=>Vg,Input:()=>qg,Label:()=>Ug,Root:()=>Wg,TextArea:()=>Zg,TextField:()=>Jo});var $g=vo();function jg(){const p=ho($g);if(p===void 0)throw new Error("[kobalte]: `useTextFieldContext` must be used within a `TextField` component");return p}function qg(p){return Ye(Hg,Li({type:"text"},p))}function Hg(p){const r=Qc(),a=jg(),d=nr({id:a.generateId("input")},p),[y,S,x]=Xi(d,["onInput"],Cx),{fieldProps:u}=Sx(S);return Ye(Hr,Li({as:"input",get id(){return u.id()},get name(){return r.name()},get value(){return a.value()},get required(){return r.isRequired()},get disabled(){return r.isDisabled()},get readonly(){return r.isReadOnly()},get"aria-label"(){return u.ariaLabel()},get"aria-labelledby"(){return u.ariaLabelledBy()},get"aria-describedby"(){return u.ariaDescribedBy()},get"aria-invalid"(){return r.validationState()==="invalid"||void 0},get"aria-required"(){return r.isRequired()||void 0},get"aria-disabled"(){return r.isDisabled()||void 0},get"aria-readonly"(){return r.isReadOnly()||void 0},get onInput(){return ph([y.onInput,a.onInput])}},()=>r.dataset(),x))}function Wg(p){let r;const a=`textfield-${Jc()}`,d=nr({id:a},p),[y,S,x]=Xi(d,["ref","value","defaultValue","onChange"],bx),u=y.value,[O,V]=Pg({value:()=>u===void 0?void 0:y.value??"",defaultValue:()=>y.defaultValue,onChange:oe=>y.onChange?.(oe)}),{formControlContext:W}=wx(S);Ix(()=>r,()=>V(y.defaultValue??""));const q=oe=>{if(W.isReadOnly()||W.isDisabled())return;const ie=oe.target;V(ie.value),ie.value=O()??""},F={value:O,generateId:pp(()=>Xt(S.id)),onInput:q};return Ye(Og.Provider,{value:W,get children(){return Ye($g.Provider,{value:F,get children(){return Ye(Hr,Li({as:"div",ref(oe){var ie=xo(pe=>r=pe,y.ref);typeof ie=="function"&&ie(oe)},role:"group",get id(){return Xt(S.id)}},()=>W.dataset(),x))}})}})}function Zg(p){let r;const a=jg(),d=nr({id:a.generateId("textarea")},p),[y,S]=Xi(d,["ref","autoResize","submitOnEnter","onKeyPress"]);Yt(lp([()=>r,()=>y.autoResize,()=>a.value()],([u,O])=>{!u||!O||Mx(u)}));const x=u=>{r&&y.submitOnEnter&&u.key==="Enter"&&!u.shiftKey&&r.form&&(r.form.requestSubmit(),u.preventDefault())};return Ye(Hg,Li({as:"textarea",get"aria-multiline"(){return y.submitOnEnter?"false":void 0},get onKeyPress(){return ph([y.onKeyPress,x])},ref(u){var O=xo(V=>r=V,y.ref);typeof O=="function"&&O(u)}},S))}function Mx(p){const r=p.style.alignSelf,a=p.style.overflow;"MozAppearance"in p.style||(p.style.overflow="hidden"),p.style.alignSelf="start",p.style.height="auto",p.style.height=`${p.scrollHeight+(p.offsetHeight-p.clientHeight)}px`,p.style.overflow=a,p.style.alignSelf=r}var Jo=Object.assign(Wg,{Description:Ng,ErrorMessage:Vg,Input:qg,Label:Ug,TextArea:Zg}),kx=globalThis.fetch,Ax=p=>r=>{r.fetcher=a=>(p||kx)?.(...a).then(d=>{if(r.response=d,r.responseHandler)return r.responseHandler(d);const y=d.headers.get("content-type")??"";return y.includes("application/json")?d.json():y.includes("text/")?d.text():d.blob()}),r.wrapResource()},Gg=p=>typeof p=="object"&&["name","initialValue","fetch","request"].some(r=>r in p),Lf=p=>{const r=typeof p[0]=="function"?p[0]():p[0];if(!r)return;const a=typeof p[1]=="function"?p[1]():Gg(p[1])||Array.isArray(p[1])?void 0:p[1];return[r,a]};function rl(...p){const r=[p[2],p[1]].find(Gg)||{},a=r.disable?()=>{}:typeof p[0]=="function"||typeof p[1]=="function"?Ot(()=>Lf(p)):(x=>()=>x)(Lf(p)),d=(()=>{for(let x=p.length-1;x>=1;x--)if(Array.isArray(p[x]))return p[x];return[]})();d.unshift(r.request||Ax(r.fetch));let y=0;const S={urlAccessor:a,responseHandler:r.responseHandler,wrapResource:()=>{const x=d[y++];return typeof x=="function"&&x(S),S.resource||(S.resource=b0(S.urlAccessor,S.fetcher,r)),S.resource}};return S.wrapResource(),S.resource}var Xg=(p,r)=>{const a=p.fetcher;if(!a)throw new Error("could not read resource fetcher");p.fetcher=r(a)||a},sl=()=>p=>{const[r,a]=qt();Xg(p,y=>(S,x)=>y(S,x).catch(u=>(a(u),Promise.resolve(x.value)))),p.wrapResource();const d=p.resource;p.resource=[Object.defineProperties(()=>d?.[0](),{...Object.getOwnPropertyDescriptors(d?.[0]),error:{get:()=>r()}}),d?.[1]]},ol=p=>r=>{Xg(r,a=>(...d)=>a(...d).then(y=>{const S=p?p(y):y,x=r.resource?.[0]();return Array.isArray(x)?Array.isArray(S)?[...x,...S]:[...x,S]:typeof x=="object"&&typeof S=="object"?{...x,...S}:typeof x=="string"&&typeof S=="string"?x+S:x!=null?[x,S]:S})),r.wrapResource()};const Uc={aqiCfg:{baseUrl:"json",cnt:1},getCfg:function(){return this.aqiCfg},setCfg:function(p){this.aqiCfg=p},externalTimingAPI:function(p){const r="https://www.timeapi.io/api/time/current/zone?timeZone=Asia%2FJakarta",[a,{mutate:d,refetch:y}]=rl(r,{method:"GET"},{},[sl(),ol(S=>(p&&p(S),S))]);return{mutate:d,refetch:y,resource:a}},getAirQuality:function(p,r){const a=`${this.aqiCfg.baseUrl}/first_data${this.aqiCfg.baseUrl=="json"?".json":""}?location=${p}`,[d,{mutate:y,refetch:S}]=rl(a,{method:"GET"},{},[sl(),ol(x=>(r&&r(x),x))]);return{mutate:y,refetch:S,resource:d}},getRealtimeAirQuality:function(p,r,a){const d=`${this.aqiCfg.baseUrl}/last_update${this.aqiCfg.baseUrl=="json"?".json":""}?location=${p}&date=${r}`,[y,{mutate:S,refetch:x}]=rl(d,{method:this.aqiCfg.baseUrl=="json"?"GET":"POST",...this.aqiCfg.baseUrl!=="json"?{body:JSON.stringify({location:p,date:r})}:{}},{},[sl(),ol(u=>{const O=u;return a&&a(O),O})]);return{mutate:S,refetch:x,resource:y}},getLocations:function(p){const r=`${this.aqiCfg.baseUrl}/list_location${this.aqiCfg.baseUrl=="json"?".json":""}`,[a,{mutate:d,refetch:y}]=rl(r,{method:"GET"},{},[sl(),ol(S=>(p&&p(S),S))]);return{mutate:d,refetch:y,resource:a}},addLocation:function(p,r){const a=`${this.aqiCfg.baseUrl}/first_data${this.aqiCfg.baseUrl=="json"?".json":""}`,[d,{mutate:y,refetch:S}]=rl(a,{method:this.aqiCfg.baseUrl=="json"?"GET":"POST"},{},[sl(),ol(x=>(r&&r(x),x))]);return{mutate:y,refetch:S,resource:d}},getCurrentWeather:function(p){const r="https://api.open-meteo.com/v1/forecast?latitude=-6.18605745941392&longitude=106.81439570783567&current=temperature_2m,apparent_temperature,soil_temperature_0cm,weather_code",[a,{mutate:d,refetch:y}]=rl(r,{method:"GET"},{},[sl(),ol(S=>(p&&p(S),S))]);return{mutate:d,refetch:y,resource:a}}};var jd=(p,r,a)=>{const d=a(p,r);return si(()=>clearInterval(d))},Yg=(p,r,a)=>{if(typeof r=="number"){jd(p,r,a);return}let d=!1,y=performance.now(),S=0,x=!1;const u=()=>{yh(p),y=performance.now(),d=a===setTimeout};Yt(O=>{if(d)return;const V=r();if(V===!1)return O&&(S+=(performance.now()-y)/O),V;if(O===!1&&(y=performance.now()),x){if(O&&(S+=(performance.now()-y)/O),y=performance.now(),S>=1)S=0,u();else if(S>0){const[W,q]=qt(void 0,{equals:!1});return W(),jd(()=>{S=0,x=!1,q(),u()},(1-S)*V,setTimeout),V}}return x=!0,jd(u,V,a),V})},zx=Ht("<div class=dialog__header>"),Dx=Ht("<button class=button type=button>Batal"),Lx=Ht("<form><!$><!/><!$><!/><div><!$><!/><button class=button type=submit>Tambah"),Rx=Ht("<div class=dialog__positioner>"),Bx=Ht('<div class="t-center text-white h-full overflow-auto p-2"><!$><!/><!$><!/>'),Fx=Ht("<div><!$><!/> <!$><!/>"),Ox=Ht('<button class="block w-full ripple"><div><div class="flex flex-col text-left flex-1"><div class=text-xl></div><div class=text-sm></div><div class="text-xl pt-2">Index Quality</div><div class=text-center></div></div><div class="shadow-xl bg-[#D9D9D933] rounded-lg py-4 px-4 flex-1 flex flex-col justify-center relative w-full"><div class="flex flex-row absolute top-0 left-0 w-full"><div class="flex-1 text-left"><div class=p-4>LPG</div></div><div></div></div><h2 class=text-6xl></h2><h4>PPM</h4></div><div class="shadow-xl bg-[#D9D9D933] rounded-lg py-4 px-4 flex-1 flex flex-col justify-center relative w-full"><div class="flex flex-row absolute top-0 left-0 w-full"><div class="flex-1 text-left"><div class=p-4>CO<sup>2</sup></div></div><div></div></div><h2 class=text-6xl></h2><h4>PPM');function Nx(p){const[r,a]=qt(),[d,y]=qt(1e4),S=()=>d,x=p.aqiCtx?.ctx.aqiDataAll,u=oe=>{oe.preventDefault(),alert(oe+"")};yo(()=>{a(Uc.getLocations(oe=>{oe?(console.log("Locations OK",oe),O(oe)):console.log("Locations",oe)}))});const O=oe=>{oe.forEach(ie=>{V(ie)})},V=oe=>{Uc.getAirQuality(oe.name,ie=>{const pe=p.aqiCtx?.ctx.aqiDataAll.val();pe[oe.name]=ie,p.aqiCtx?.ctx.aqiDataAll.set(JSON.parse(JSON.stringify(pe)))})},W=oe=>{const ie=p.aqiCtx?.ctx.aqiDataAll,pe=ie.val()&&ie.val()[oe.name];Uc.getRealtimeAirQuality(oe.name,pe&&pe.length?pe[0].period:"",ve=>{const Ce=p.aqiCtx?.ctx.aqiUpdateAll.val();Ce[oe.name]=ve,p.aqiCtx?.ctx.aqiUpdateAll.set(JSON.parse(JSON.stringify(Ce)))})},q=oe=>{const ie=p.aqiCtx?.ctx.aqiSelectedLocation;ie.val()?(ie.set(oe),W(oe)):(ie.set(oe),W(oe),Yg(()=>{W(oe)},S(),setInterval))},F=()=>{d()?(y(!1),console.log("Stopped")):(y(1e4),console.log("Running"))};return si(()=>{y(!1)}),(()=>{var oe=jt(Bx),ie=oe.firstChild,[pe,ve]=Sn(ie.nextSibling),Ce=pe.nextSibling,[je,st]=Sn(Ce.nextSibling);return bt(oe,Ye(Pr,{get when(){return Ot(()=>!!(r()&&r()?.resource.state=="ready"))()&&r()?.resource()},get fallback(){return(()=>{var Qe=jt(Fx),qe=Qe.firstChild,[ct,We]=Sn(qe.nextSibling),It=ct.nextSibling,Ve=It.nextSibling,[pi,tt]=Sn(Ve.nextSibling);return bt(Qe,()=>r()?.resource.state,ct,We),bt(Qe,(()=>{var oi=Ot(()=>!!r()?.resource.error);return()=>oi()&&r()?.resource.error.message})(),pi,tt),Qe})()},get children(){return Ye(cg,{get each(){return r()?.resource()},children:Qe=>(()=>{var qe=jt(Ox),ct=qe.firstChild,We=ct.firstChild,It=We.firstChild,Ve=It.nextSibling,pi=Ve.nextSibling,tt=pi.nextSibling,oi=We.nextSibling,St=oi.firstChild,Zt=St.firstChild,Ri=Zt.nextSibling,rr=St.nextSibling,li=oi.nextSibling,yr=li.firstChild,Fn=yr.firstChild,mn=Fn.nextSibling,Vi=yr.nextSibling;return qe.$$click=()=>{q(Qe)},bt(It,()=>Qe.name),bt(Ve,()=>Qe.address),bt(tt,Ye(bg,{class:"button w-full",onClick:F,children:"GOOD?"})),bt(Ri,Ye(Cg,{})),bt(rr,(()=>{var Yi=Ot(()=>!!(x?.val()[Qe.name]&&x?.val()[Qe.name][0]));return()=>Yi()&&x?.val()[Qe.name][0].lpg})()),bt(mn,Ye(wg,{})),bt(Vi,(()=>{var Yi=Ot(()=>!!(x?.val()[Qe.name]&&x?.val()[Qe.name][0]));return()=>Yi()&&x?.val()[Qe.name][0].co2})()),cp(()=>w0(ct,"flex flex-row aqi-flex-responsive bg-[#D9D9D973] hover:bg-[#D9D9D933] transition duration-300 p-4 rounded-md mb-2 gap-2 w-full "+(p.aqiCtx?.ctx.aqiSelectedLocation.val()?.name==Qe.name?"bg-[#D9D9D933]":"bg-[#AAAAAA33]"))),og(),qe})()})}}),pe,ve),bt(oe,Ye(oo,{get children(){return Ye(oo.Portal,{get children(){return[Ye(oo.Overlay,{class:"dialog__overlay"}),(()=>{var Qe=jt(Rx);return bt(Qe,Ye(oo.Content,{class:"dialog__content",get children(){return[(()=>{var qe=jt(zx);return bt(qe,Ye(oo.Title,{class:"dialog__title",children:"Tambah Lokasi"})),qe})(),Ye(oo.Description,{class:"dialog__description",get children(){var qe=jt(Lx),ct=qe.firstChild,[We,It]=Sn(ct.nextSibling),Ve=We.nextSibling,[pi,tt]=Sn(Ve.nextSibling),oi=pi.nextSibling,St=oi.firstChild,[Zt,Ri]=Sn(St.nextSibling);return Zt.nextSibling,qe.addEventListener("submit",u),bt(qe,Ye(Jo,{class:"text-field",name:"location",get children(){return[Ye(Jo.Label,{class:"text-field__label",children:"Lokasi"}),Ye(Jo.Input,{class:"text-field__input"})]}}),We,It),bt(qe,Ye(Jo,{class:"text-field",name:"date",get children(){return[Ye(Jo.Label,{class:"text-field__label",children:"Tanggal"}),Ye(Jo.Input,{class:"text-field__input"})]}}),pi,tt),bt(oi,Ye(oo.CloseButton,{get children(){return jt(Dx)}}),Zt,Ri),qe}})]}})),Qe})()]}})}}),je,st),oe})()}sg(["click"]);var Vx=Ht('<div class="t-center text-white flex flex-col items-center justify-center h-full"><div class=inline-block><img src=images/umb.png></div><h1 class=text-2xl>Monitoring Polusi Udara</h1><h2>Teknik Elektro');function Ux(){return jt(Vx)}const Kg=6048e5,$x=864e5,gp=6e4,_p=36e5,jx=1e3,Rf=Symbol.for("constructDateFrom");function Ni(p,r){return typeof p=="function"?p(r):p&&typeof p=="object"&&Rf in p?p[Rf](r):p instanceof Date?new p.constructor(r):new Date(r)}function Mi(p,r){return Ni(r||p,p)}function Jg(p,r){const a=()=>Ni(r?.in,NaN),y=Zx(p);let S;if(y.date){const V=Gx(y.date,2);S=Xx(V.restDateString,V.year)}if(!S||isNaN(+S))return a();const x=+S;let u=0,O;if(y.time&&(u=Yx(y.time),isNaN(u)))return a();if(y.timezone){if(O=Kx(y.timezone),isNaN(O))return a()}else{const V=new Date(x+u),W=Mi(0,r?.in);return W.setFullYear(V.getUTCFullYear(),V.getUTCMonth(),V.getUTCDate()),W.setHours(V.getUTCHours(),V.getUTCMinutes(),V.getUTCSeconds(),V.getUTCMilliseconds()),W}return Mi(x+u+O,r?.in)}const sh={dateTimeDelimiter:/[T ]/,timeZoneDelimiter:/[Z ]/i,timezone:/([Z+-].*)$/},qx=/^-?(?:(\d{3})|(\d{2})(?:-?(\d{2}))?|W(\d{2})(?:-?(\d{1}))?|)$/,Hx=/^(\d{2}(?:[.,]\d*)?)(?::?(\d{2}(?:[.,]\d*)?))?(?::?(\d{2}(?:[.,]\d*)?))?$/,Wx=/^([+-])(\d{2})(?::?(\d{2}))?$/;function Zx(p){const r={},a=p.split(sh.dateTimeDelimiter);let d;if(a.length>2)return r;if(/:/.test(a[0])?d=a[0]:(r.date=a[0],d=a[1],sh.timeZoneDelimiter.test(r.date)&&(r.date=p.split(sh.timeZoneDelimiter)[0],d=p.substr(r.date.length,p.length))),d){const y=sh.timezone.exec(d);y?(r.time=d.replace(y[1],""),r.timezone=y[1]):r.time=d}return r}function Gx(p,r){const a=new RegExp("^(?:(\\d{4}|[+-]\\d{"+(4+r)+"})|(\\d{2}|[+-]\\d{"+(2+r)+"})$)"),d=p.match(a);if(!d)return{year:NaN,restDateString:""};const y=d[1]?parseInt(d[1]):null,S=d[2]?parseInt(d[2]):null;return{year:S===null?y:S*100,restDateString:p.slice((d[1]||d[2]).length)}}function Xx(p,r){if(r===null)return new Date(NaN);const a=p.match(qx);if(!a)return new Date(NaN);const d=!!a[4],y=Ac(a[1]),S=Ac(a[2])-1,x=Ac(a[3]),u=Ac(a[4]),O=Ac(a[5])-1;if(d)return ib(r,u,O)?Jx(r,u,O):new Date(NaN);{const V=new Date(0);return!eb(r,S,x)||!tb(r,y)?new Date(NaN):(V.setUTCFullYear(r,S,Math.max(y,x)),V)}}function Ac(p){return p?parseInt(p):1}function Yx(p){const r=p.match(Hx);if(!r)return NaN;const a=qd(r[1]),d=qd(r[2]),y=qd(r[3]);return nb(a,d,y)?a*_p+d*gp+y*1e3:NaN}function qd(p){return p&&parseFloat(p.replace(",","."))||0}function Kx(p){if(p==="Z")return 0;const r=p.match(Wx);if(!r)return 0;const a=r[1]==="+"?-1:1,d=parseInt(r[2]),y=r[3]&&parseInt(r[3])||0;return rb(d,y)?a*(d*_p+y*gp):NaN}function Jx(p,r,a){const d=new Date(0);d.setUTCFullYear(p,0,4);const y=d.getUTCDay()||7,S=(r-1)*7+a+1-y;return d.setUTCDate(d.getUTCDate()+S),d}const Qx=[31,null,31,30,31,30,31,31,30,31,30,31];function Qg(p){return p%400===0||p%4===0&&p%100!==0}function eb(p,r,a){return r>=0&&r<=11&&a>=1&&a<=(Qx[r]||(Qg(p)?29:28))}function tb(p,r){return r>=1&&r<=(Qg(p)?366:365)}function ib(p,r,a){return r>=1&&r<=53&&a>=0&&a<=6}function nb(p,r,a){return p===24?r===0&&a===0:a>=0&&a<60&&r>=0&&r<60&&p>=0&&p<25}function rb(p,r){return r>=0&&r<=59}const sb={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},ob=(p,r,a)=>{let d;const y=sb[p];return typeof y=="string"?d=y:r===1?d=y.one:d=y.other.replace("{{count}}",r.toString()),a?.addSuffix?a.comparison&&a.comparison>0?"in "+d:d+" ago":d};function Hd(p){return(r={})=>{const a=r.width?String(r.width):p.defaultWidth;return p.formats[a]||p.formats[p.defaultWidth]}}const ab={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},lb={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},cb={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},ub={date:Hd({formats:ab,defaultWidth:"full"}),time:Hd({formats:lb,defaultWidth:"full"}),dateTime:Hd({formats:cb,defaultWidth:"full"})},hb={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},db=(p,r,a,d)=>hb[p];function zc(p){return(r,a)=>{const d=a?.context?String(a.context):"standalone";let y;if(d==="formatting"&&p.formattingValues){const x=p.defaultFormattingWidth||p.defaultWidth,u=a?.width?String(a.width):x;y=p.formattingValues[u]||p.formattingValues[x]}else{const x=p.defaultWidth,u=a?.width?String(a.width):p.defaultWidth;y=p.values[u]||p.values[x]}const S=p.argumentCallback?p.argumentCallback(r):r;return y[S]}}const pb={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},mb={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},fb={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},gb={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},_b={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},yb={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},vb=(p,r)=>{const a=Number(p),d=a%100;if(d>20||d<10)switch(d%10){case 1:return a+"st";case 2:return a+"nd";case 3:return a+"rd"}return a+"th"},xb={ordinalNumber:vb,era:zc({values:pb,defaultWidth:"wide"}),quarter:zc({values:mb,defaultWidth:"wide",argumentCallback:p=>p-1}),month:zc({values:fb,defaultWidth:"wide"}),day:zc({values:gb,defaultWidth:"wide"}),dayPeriod:zc({values:_b,defaultWidth:"wide",formattingValues:yb,defaultFormattingWidth:"wide"})};function Dc(p){return(r,a={})=>{const d=a.width,y=d&&p.matchPatterns[d]||p.matchPatterns[p.defaultMatchWidth],S=r.match(y);if(!S)return null;const x=S[0],u=d&&p.parsePatterns[d]||p.parsePatterns[p.defaultParseWidth],O=Array.isArray(u)?wb(u,q=>q.test(x)):bb(u,q=>q.test(x));let V;V=p.valueCallback?p.valueCallback(O):O,V=a.valueCallback?a.valueCallback(V):V;const W=r.slice(x.length);return{value:V,rest:W}}}function bb(p,r){for(const a in p)if(Object.prototype.hasOwnProperty.call(p,a)&&r(p[a]))return a}function wb(p,r){for(let a=0;a<p.length;a++)if(r(p[a]))return a}function Cb(p){return(r,a={})=>{const d=r.match(p.matchPattern);if(!d)return null;const y=d[0],S=r.match(p.parsePattern);if(!S)return null;let x=p.valueCallback?p.valueCallback(S[0]):S[0];x=a.valueCallback?a.valueCallback(x):x;const u=r.slice(y.length);return{value:x,rest:u}}}const Sb=/^(\d+)(th|st|nd|rd)?/i,Ib=/\d+/i,Tb={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Eb={any:[/^b/i,/^(a|c)/i]},Pb={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},Mb={any:[/1/i,/2/i,/3/i,/4/i]},kb={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},Ab={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},zb={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},Db={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},Lb={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},Rb={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},Bb={ordinalNumber:Cb({matchPattern:Sb,parsePattern:Ib,valueCallback:p=>parseInt(p,10)}),era:Dc({matchPatterns:Tb,defaultMatchWidth:"wide",parsePatterns:Eb,defaultParseWidth:"any"}),quarter:Dc({matchPatterns:Pb,defaultMatchWidth:"wide",parsePatterns:Mb,defaultParseWidth:"any",valueCallback:p=>p+1}),month:Dc({matchPatterns:kb,defaultMatchWidth:"wide",parsePatterns:Ab,defaultParseWidth:"any"}),day:Dc({matchPatterns:zb,defaultMatchWidth:"wide",parsePatterns:Db,defaultParseWidth:"any"}),dayPeriod:Dc({matchPatterns:Lb,defaultMatchWidth:"any",parsePatterns:Rb,defaultParseWidth:"any"})},e_={code:"en-US",formatDistance:ob,formatLong:ub,formatRelative:db,localize:xb,match:Bb,options:{weekStartsOn:0,firstWeekContainsDate:1}};let Fb={};function xl(){return Fb}function fh(p){const r=Mi(p),a=new Date(Date.UTC(r.getFullYear(),r.getMonth(),r.getDate(),r.getHours(),r.getMinutes(),r.getSeconds(),r.getMilliseconds()));return a.setUTCFullYear(r.getFullYear()),+p-+a}function Ob(p,...r){const a=Ni.bind(null,r.find(d=>typeof d=="object"));return r.map(a)}function Bf(p,r){const a=Mi(p,r?.in);return a.setHours(0,0,0,0),a}function Nb(p,r,a){const[d,y]=Ob(a?.in,p,r),S=Bf(d),x=Bf(y),u=+S-fh(S),O=+x-fh(x);return Math.round((u-O)/$x)}function Vb(p,r){const a=Mi(p,r?.in);return a.setFullYear(a.getFullYear(),0,1),a.setHours(0,0,0,0),a}function Ub(p,r){const a=Mi(p,r?.in);return Nb(a,Vb(a))+1}function _o(p,r){const a=xl(),d=r?.weekStartsOn??r?.locale?.options?.weekStartsOn??a.weekStartsOn??a.locale?.options?.weekStartsOn??0,y=Mi(p,r?.in),S=y.getDay(),x=(S<d?7:0)+S-d;return y.setDate(y.getDate()-x),y.setHours(0,0,0,0),y}function fl(p,r){return _o(p,{...r,weekStartsOn:1})}function t_(p,r){const a=Mi(p,r?.in),d=a.getFullYear(),y=Ni(a,0);y.setFullYear(d+1,0,4),y.setHours(0,0,0,0);const S=fl(y),x=Ni(a,0);x.setFullYear(d,0,4),x.setHours(0,0,0,0);const u=fl(x);return a.getTime()>=S.getTime()?d+1:a.getTime()>=u.getTime()?d:d-1}function $b(p,r){const a=t_(p,r),d=Ni(p,0);return d.setFullYear(a,0,4),d.setHours(0,0,0,0),fl(d)}function i_(p,r){const a=Mi(p,r?.in),d=+fl(a)-+$b(a);return Math.round(d/Kg)+1}function yp(p,r){const a=Mi(p,r?.in),d=a.getFullYear(),y=xl(),S=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??y.firstWeekContainsDate??y.locale?.options?.firstWeekContainsDate??1,x=Ni(r?.in||p,0);x.setFullYear(d+1,0,S),x.setHours(0,0,0,0);const u=_o(x,r),O=Ni(r?.in||p,0);O.setFullYear(d,0,S),O.setHours(0,0,0,0);const V=_o(O,r);return+a>=+u?d+1:+a>=+V?d:d-1}function jb(p,r){const a=xl(),d=r?.firstWeekContainsDate??r?.locale?.options?.firstWeekContainsDate??a.firstWeekContainsDate??a.locale?.options?.firstWeekContainsDate??1,y=yp(p,r),S=Ni(r?.in||p,0);return S.setFullYear(y,0,d),S.setHours(0,0,0,0),_o(S,r)}function n_(p,r){const a=Mi(p,r?.in),d=+_o(a,r)-+jb(a,r);return Math.round(d/Kg)+1}function Qt(p,r){const a=p<0?"-":"",d=Math.abs(p).toString().padStart(r,"0");return a+d}const ro={y(p,r){const a=p.getFullYear(),d=a>0?a:1-a;return Qt(r==="yy"?d%100:d,r.length)},M(p,r){const a=p.getMonth();return r==="M"?String(a+1):Qt(a+1,2)},d(p,r){return Qt(p.getDate(),r.length)},a(p,r){const a=p.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.toUpperCase();case"aaa":return a;case"aaaaa":return a[0];case"aaaa":default:return a==="am"?"a.m.":"p.m."}},h(p,r){return Qt(p.getHours()%12||12,r.length)},H(p,r){return Qt(p.getHours(),r.length)},m(p,r){return Qt(p.getMinutes(),r.length)},s(p,r){return Qt(p.getSeconds(),r.length)},S(p,r){const a=r.length,d=p.getMilliseconds(),y=Math.trunc(d*Math.pow(10,a-3));return Qt(y,r.length)}},al={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Ff={G:function(p,r,a){const d=p.getFullYear()>0?1:0;switch(r){case"G":case"GG":case"GGG":return a.era(d,{width:"abbreviated"});case"GGGGG":return a.era(d,{width:"narrow"});case"GGGG":default:return a.era(d,{width:"wide"})}},y:function(p,r,a){if(r==="yo"){const d=p.getFullYear(),y=d>0?d:1-d;return a.ordinalNumber(y,{unit:"year"})}return ro.y(p,r)},Y:function(p,r,a,d){const y=yp(p,d),S=y>0?y:1-y;if(r==="YY"){const x=S%100;return Qt(x,2)}return r==="Yo"?a.ordinalNumber(S,{unit:"year"}):Qt(S,r.length)},R:function(p,r){const a=t_(p);return Qt(a,r.length)},u:function(p,r){const a=p.getFullYear();return Qt(a,r.length)},Q:function(p,r,a){const d=Math.ceil((p.getMonth()+1)/3);switch(r){case"Q":return String(d);case"QQ":return Qt(d,2);case"Qo":return a.ordinalNumber(d,{unit:"quarter"});case"QQQ":return a.quarter(d,{width:"abbreviated",context:"formatting"});case"QQQQQ":return a.quarter(d,{width:"narrow",context:"formatting"});case"QQQQ":default:return a.quarter(d,{width:"wide",context:"formatting"})}},q:function(p,r,a){const d=Math.ceil((p.getMonth()+1)/3);switch(r){case"q":return String(d);case"qq":return Qt(d,2);case"qo":return a.ordinalNumber(d,{unit:"quarter"});case"qqq":return a.quarter(d,{width:"abbreviated",context:"standalone"});case"qqqqq":return a.quarter(d,{width:"narrow",context:"standalone"});case"qqqq":default:return a.quarter(d,{width:"wide",context:"standalone"})}},M:function(p,r,a){const d=p.getMonth();switch(r){case"M":case"MM":return ro.M(p,r);case"Mo":return a.ordinalNumber(d+1,{unit:"month"});case"MMM":return a.month(d,{width:"abbreviated",context:"formatting"});case"MMMMM":return a.month(d,{width:"narrow",context:"formatting"});case"MMMM":default:return a.month(d,{width:"wide",context:"formatting"})}},L:function(p,r,a){const d=p.getMonth();switch(r){case"L":return String(d+1);case"LL":return Qt(d+1,2);case"Lo":return a.ordinalNumber(d+1,{unit:"month"});case"LLL":return a.month(d,{width:"abbreviated",context:"standalone"});case"LLLLL":return a.month(d,{width:"narrow",context:"standalone"});case"LLLL":default:return a.month(d,{width:"wide",context:"standalone"})}},w:function(p,r,a,d){const y=n_(p,d);return r==="wo"?a.ordinalNumber(y,{unit:"week"}):Qt(y,r.length)},I:function(p,r,a){const d=i_(p);return r==="Io"?a.ordinalNumber(d,{unit:"week"}):Qt(d,r.length)},d:function(p,r,a){return r==="do"?a.ordinalNumber(p.getDate(),{unit:"date"}):ro.d(p,r)},D:function(p,r,a){const d=Ub(p);return r==="Do"?a.ordinalNumber(d,{unit:"dayOfYear"}):Qt(d,r.length)},E:function(p,r,a){const d=p.getDay();switch(r){case"E":case"EE":case"EEE":return a.day(d,{width:"abbreviated",context:"formatting"});case"EEEEE":return a.day(d,{width:"narrow",context:"formatting"});case"EEEEEE":return a.day(d,{width:"short",context:"formatting"});case"EEEE":default:return a.day(d,{width:"wide",context:"formatting"})}},e:function(p,r,a,d){const y=p.getDay(),S=(y-d.weekStartsOn+8)%7||7;switch(r){case"e":return String(S);case"ee":return Qt(S,2);case"eo":return a.ordinalNumber(S,{unit:"day"});case"eee":return a.day(y,{width:"abbreviated",context:"formatting"});case"eeeee":return a.day(y,{width:"narrow",context:"formatting"});case"eeeeee":return a.day(y,{width:"short",context:"formatting"});case"eeee":default:return a.day(y,{width:"wide",context:"formatting"})}},c:function(p,r,a,d){const y=p.getDay(),S=(y-d.weekStartsOn+8)%7||7;switch(r){case"c":return String(S);case"cc":return Qt(S,r.length);case"co":return a.ordinalNumber(S,{unit:"day"});case"ccc":return a.day(y,{width:"abbreviated",context:"standalone"});case"ccccc":return a.day(y,{width:"narrow",context:"standalone"});case"cccccc":return a.day(y,{width:"short",context:"standalone"});case"cccc":default:return a.day(y,{width:"wide",context:"standalone"})}},i:function(p,r,a){const d=p.getDay(),y=d===0?7:d;switch(r){case"i":return String(y);case"ii":return Qt(y,r.length);case"io":return a.ordinalNumber(y,{unit:"day"});case"iii":return a.day(d,{width:"abbreviated",context:"formatting"});case"iiiii":return a.day(d,{width:"narrow",context:"formatting"});case"iiiiii":return a.day(d,{width:"short",context:"formatting"});case"iiii":default:return a.day(d,{width:"wide",context:"formatting"})}},a:function(p,r,a){const y=p.getHours()/12>=1?"pm":"am";switch(r){case"a":case"aa":return a.dayPeriod(y,{width:"abbreviated",context:"formatting"});case"aaa":return a.dayPeriod(y,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return a.dayPeriod(y,{width:"narrow",context:"formatting"});case"aaaa":default:return a.dayPeriod(y,{width:"wide",context:"formatting"})}},b:function(p,r,a){const d=p.getHours();let y;switch(d===12?y=al.noon:d===0?y=al.midnight:y=d/12>=1?"pm":"am",r){case"b":case"bb":return a.dayPeriod(y,{width:"abbreviated",context:"formatting"});case"bbb":return a.dayPeriod(y,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return a.dayPeriod(y,{width:"narrow",context:"formatting"});case"bbbb":default:return a.dayPeriod(y,{width:"wide",context:"formatting"})}},B:function(p,r,a){const d=p.getHours();let y;switch(d>=17?y=al.evening:d>=12?y=al.afternoon:d>=4?y=al.morning:y=al.night,r){case"B":case"BB":case"BBB":return a.dayPeriod(y,{width:"abbreviated",context:"formatting"});case"BBBBB":return a.dayPeriod(y,{width:"narrow",context:"formatting"});case"BBBB":default:return a.dayPeriod(y,{width:"wide",context:"formatting"})}},h:function(p,r,a){if(r==="ho"){let d=p.getHours()%12;return d===0&&(d=12),a.ordinalNumber(d,{unit:"hour"})}return ro.h(p,r)},H:function(p,r,a){return r==="Ho"?a.ordinalNumber(p.getHours(),{unit:"hour"}):ro.H(p,r)},K:function(p,r,a){const d=p.getHours()%12;return r==="Ko"?a.ordinalNumber(d,{unit:"hour"}):Qt(d,r.length)},k:function(p,r,a){let d=p.getHours();return d===0&&(d=24),r==="ko"?a.ordinalNumber(d,{unit:"hour"}):Qt(d,r.length)},m:function(p,r,a){return r==="mo"?a.ordinalNumber(p.getMinutes(),{unit:"minute"}):ro.m(p,r)},s:function(p,r,a){return r==="so"?a.ordinalNumber(p.getSeconds(),{unit:"second"}):ro.s(p,r)},S:function(p,r){return ro.S(p,r)},X:function(p,r,a){const d=p.getTimezoneOffset();if(d===0)return"Z";switch(r){case"X":return Nf(d);case"XXXX":case"XX":return Qo(d);case"XXXXX":case"XXX":default:return Qo(d,":")}},x:function(p,r,a){const d=p.getTimezoneOffset();switch(r){case"x":return Nf(d);case"xxxx":case"xx":return Qo(d);case"xxxxx":case"xxx":default:return Qo(d,":")}},O:function(p,r,a){const d=p.getTimezoneOffset();switch(r){case"O":case"OO":case"OOO":return"GMT"+Of(d,":");case"OOOO":default:return"GMT"+Qo(d,":")}},z:function(p,r,a){const d=p.getTimezoneOffset();switch(r){case"z":case"zz":case"zzz":return"GMT"+Of(d,":");case"zzzz":default:return"GMT"+Qo(d,":")}},t:function(p,r,a){const d=Math.trunc(+p/1e3);return Qt(d,r.length)},T:function(p,r,a){return Qt(+p,r.length)}};function Of(p,r=""){const a=p>0?"-":"+",d=Math.abs(p),y=Math.trunc(d/60),S=d%60;return S===0?a+String(y):a+String(y)+r+Qt(S,2)}function Nf(p,r){return p%60===0?(p>0?"-":"+")+Qt(Math.abs(p)/60,2):Qo(p,r)}function Qo(p,r=""){const a=p>0?"-":"+",d=Math.abs(p),y=Qt(Math.trunc(d/60),2),S=Qt(d%60,2);return a+y+r+S}const Vf=(p,r)=>{switch(p){case"P":return r.date({width:"short"});case"PP":return r.date({width:"medium"});case"PPP":return r.date({width:"long"});case"PPPP":default:return r.date({width:"full"})}},r_=(p,r)=>{switch(p){case"p":return r.time({width:"short"});case"pp":return r.time({width:"medium"});case"ppp":return r.time({width:"long"});case"pppp":default:return r.time({width:"full"})}},qb=(p,r)=>{const a=p.match(/(P+)(p+)?/)||[],d=a[1],y=a[2];if(!y)return Vf(p,r);let S;switch(d){case"P":S=r.dateTime({width:"short"});break;case"PP":S=r.dateTime({width:"medium"});break;case"PPP":S=r.dateTime({width:"long"});break;case"PPPP":default:S=r.dateTime({width:"full"});break}return S.replace("{{date}}",Vf(d,r)).replace("{{time}}",r_(y,r))},tp={p:r_,P:qb},Hb=/^D+$/,Wb=/^Y+$/,Zb=["D","DD","YY","YYYY"];function s_(p){return Hb.test(p)}function o_(p){return Wb.test(p)}function ip(p,r,a){const d=Gb(p,r,a);if(console.warn(d),Zb.includes(p))throw new RangeError(d)}function Gb(p,r,a){const d=p[0]==="Y"?"years":"days of the month";return`Use \`${p.toLowerCase()}\` instead of \`${p}\` (in \`${r}\`) for formatting ${d} to the input \`${a}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}function Xb(p){return p instanceof Date||typeof p=="object"&&Object.prototype.toString.call(p)==="[object Date]"}function Yb(p){return!(!Xb(p)&&typeof p!="number"||isNaN(+Mi(p)))}const Kb=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Jb=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,Qb=/^'([^]*?)'?$/,e1=/''/g,t1=/[a-zA-Z]/;function np(p,r,a){const d=xl(),y=d.locale??e_,S=d.firstWeekContainsDate??d.locale?.options?.firstWeekContainsDate??1,x=d.weekStartsOn??d.locale?.options?.weekStartsOn??0,u=Mi(p,a?.in);if(!Yb(u))throw new RangeError("Invalid time value");let O=r.match(Jb).map(W=>{const q=W[0];if(q==="p"||q==="P"){const F=tp[q];return F(W,y.formatLong)}return W}).join("").match(Kb).map(W=>{if(W==="''")return{isToken:!1,value:"'"};const q=W[0];if(q==="'")return{isToken:!1,value:i1(W)};if(Ff[q])return{isToken:!0,value:W};if(q.match(t1))throw new RangeError("Format string contains an unescaped latin alphabet character `"+q+"`");return{isToken:!1,value:W}});y.localize.preprocessor&&(O=y.localize.preprocessor(u,O));const V={firstWeekContainsDate:S,weekStartsOn:x,locale:y};return O.map(W=>{if(!W.isToken)return W.value;const q=W.value;(o_(q)||s_(q))&&ip(q,r,String(p));const F=Ff[q[0]];return F(u,q,y.localize,V)}).join("")}function i1(p){const r=p.match(Qb);return r?r[1].replace(e1,"'"):p}const oh={0:{day:{description:"Sunny",image:"http://openweathermap.org/img/wn/01d@2x.png"},night:{description:"Clear",image:"http://openweathermap.org/img/wn/01n@2x.png"}},1:{day:{description:"Mainly Sunny",image:"http://openweathermap.org/img/wn/01d@2x.png"},night:{description:"Mainly Clear",image:"http://openweathermap.org/img/wn/01n@2x.png"}},2:{day:{description:"Partly Cloudy",image:"http://openweathermap.org/img/wn/02d@2x.png"},night:{description:"Partly Cloudy",image:"http://openweathermap.org/img/wn/02n@2x.png"}},3:{day:{description:"Cloudy",image:"http://openweathermap.org/img/wn/03d@2x.png"},night:{description:"Cloudy",image:"http://openweathermap.org/img/wn/03n@2x.png"}},45:{day:{description:"Foggy",image:"http://openweathermap.org/img/wn/50d@2x.png"},night:{description:"Foggy",image:"http://openweathermap.org/img/wn/50n@2x.png"}},48:{day:{description:"Rime Fog",image:"http://openweathermap.org/img/wn/50d@2x.png"},night:{description:"Rime Fog",image:"http://openweathermap.org/img/wn/50n@2x.png"}},51:{day:{description:"Light Drizzle",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Light Drizzle",image:"http://openweathermap.org/img/wn/09n@2x.png"}},53:{day:{description:"Drizzle",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Drizzle",image:"http://openweathermap.org/img/wn/09n@2x.png"}},55:{day:{description:"Heavy Drizzle",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Heavy Drizzle",image:"http://openweathermap.org/img/wn/09n@2x.png"}},56:{day:{description:"Light Freezing Drizzle",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Light Freezing Drizzle",image:"http://openweathermap.org/img/wn/09n@2x.png"}},57:{day:{description:"Freezing Drizzle",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Freezing Drizzle",image:"http://openweathermap.org/img/wn/09n@2x.png"}},61:{day:{description:"Light Rain",image:"http://openweathermap.org/img/wn/10d@2x.png"},night:{description:"Light Rain",image:"http://openweathermap.org/img/wn/10n@2x.png"}},63:{day:{description:"Rain",image:"http://openweathermap.org/img/wn/10d@2x.png"},night:{description:"Rain",image:"http://openweathermap.org/img/wn/10n@2x.png"}},65:{day:{description:"Heavy Rain",image:"http://openweathermap.org/img/wn/10d@2x.png"},night:{description:"Heavy Rain",image:"http://openweathermap.org/img/wn/10n@2x.png"}},66:{day:{description:"Light Freezing Rain",image:"http://openweathermap.org/img/wn/10d@2x.png"},night:{description:"Light Freezing Rain",image:"http://openweathermap.org/img/wn/10n@2x.png"}},67:{day:{description:"Freezing Rain",image:"http://openweathermap.org/img/wn/10d@2x.png"},night:{description:"Freezing Rain",image:"http://openweathermap.org/img/wn/10n@2x.png"}},71:{day:{description:"Light Snow",image:"http://openweathermap.org/img/wn/13d@2x.png"},night:{description:"Light Snow",image:"http://openweathermap.org/img/wn/13n@2x.png"}},73:{day:{description:"Snow",image:"http://openweathermap.org/img/wn/13d@2x.png"},night:{description:"Snow",image:"http://openweathermap.org/img/wn/13n@2x.png"}},75:{day:{description:"Heavy Snow",image:"http://openweathermap.org/img/wn/13d@2x.png"},night:{description:"Heavy Snow",image:"http://openweathermap.org/img/wn/13n@2x.png"}},77:{day:{description:"Snow Grains",image:"http://openweathermap.org/img/wn/13d@2x.png"},night:{description:"Snow Grains",image:"http://openweathermap.org/img/wn/13n@2x.png"}},80:{day:{description:"Light Showers",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Light Showers",image:"http://openweathermap.org/img/wn/09n@2x.png"}},81:{day:{description:"Showers",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Showers",image:"http://openweathermap.org/img/wn/09n@2x.png"}},82:{day:{description:"Heavy Showers",image:"http://openweathermap.org/img/wn/09d@2x.png"},night:{description:"Heavy Showers",image:"http://openweathermap.org/img/wn/09n@2x.png"}},85:{day:{description:"Light Snow Showers",image:"http://openweathermap.org/img/wn/13d@2x.png"},night:{description:"Light Snow Showers",image:"http://openweathermap.org/img/wn/13n@2x.png"}},86:{day:{description:"Snow Showers",image:"http://openweathermap.org/img/wn/13d@2x.png"},night:{description:"Snow Showers",image:"http://openweathermap.org/img/wn/13n@2x.png"}},95:{day:{description:"Thunderstorm",image:"http://openweathermap.org/img/wn/11d@2x.png"},night:{description:"Thunderstorm",image:"http://openweathermap.org/img/wn/11n@2x.png"}},96:{day:{description:"Light Thunderstorms With Hail",image:"http://openweathermap.org/img/wn/11d@2x.png"},night:{description:"Light Thunderstorms With Hail",image:"http://openweathermap.org/img/wn/11n@2x.png"}},99:{day:{description:"Thunderstorm With Hail",image:"http://openweathermap.org/img/wn/11d@2x.png"},night:{description:"Thunderstorm With Hail",image:"http://openweathermap.org/img/wn/11n@2x.png"}}};var n1=Ht('<img class="w-20 h-20">'),r1=Ht('<div class="t-center text-white h-full flex flex-col gap-4 p-4 overflow-auto"><div class="flex flex-row items-center justify-center gap-2"><div class="flex-1 t-center"></div><div class="text-3xl drop-shadow-md flex-1"></div><div class="flex flex-col flex-1 text-right"><div class=drop-shadow-md></div><div></div></div></div><div class="flex flex-row justify-center gap-2 flex-1 aqi-flex-responsive"><div class="shadow-xl bg-[#D9D9D933] rounded-lg py-4 px-4 flex-1 flex flex-col justify-center relative"><div class="flex flex-row absolute top-0 left-0 w-full"><div class="flex-1 text-left"><div class=p-4>LPG</div></div><div></div></div><h2 class=text-6xl></h2><h4>PPM</h4></div><div class="shadow-xl bg-[#D9D9D933] rounded-lg py-4 px-4 flex-1 flex flex-col justify-center relative"><div class="flex flex-row absolute top-0 left-0 w-full"><div class="flex-1 text-left"><div class=p-4>CO<sup>2</sup></div></div><div></div></div><h2 class=text-6xl></h2><h4>PPM'),s1=Ht("<img src=images/icons8-night-64.png>"),o1=Ht("<div>--");function a1(p){const[r,a]=qt(),[d,y]=qt(),S=p.aqiCtx?.ctx.aqiUpdateAll,x=p.aqiCtx?.ctx.aqiSelectedLocation;return yo(()=>{a(Uc.getCurrentWeather(u=>{u&&(console.log("Weather",u),y(u))}))}),si(()=>{}),(()=>{var u=jt(r1),O=u.firstChild,V=O.firstChild,W=V.nextSibling,q=W.nextSibling,F=q.firstChild,oe=F.nextSibling,ie=O.nextSibling,pe=ie.firstChild,ve=pe.firstChild,Ce=ve.firstChild,je=Ce.nextSibling,st=ve.nextSibling,Qe=pe.nextSibling,qe=Qe.firstChild,ct=qe.firstChild,We=ct.nextSibling,It=qe.nextSibling;return bt(V,Ye(Pr,{get when(){return Ot(()=>r()?.resource.state=="ready")()&&d()},get fallback(){return jt(s1)},get children(){var Ve=jt(n1);return cp(()=>C0(Ve,"src",oh[d()?.current.weather_code]?oh[d()?.current.weather_code].day.image:"images/icons8-night-64.png")),Ve}})),bt(W,Ye(Pr,{get when(){return Ot(()=>r()?.resource.state=="ready")()&&d()},get fallback(){return jt(o1)},get children(){return[Ot(()=>d()?.current.temperature_2m),Ot(()=>d()?.current_units.temperature_2m)]}})),bt(F,(()=>{var Ve=Ot(()=>!!p.aqiCtx?.ctx.externalDateTimeUTC.val());return()=>Ve()&&np(Jg(p.aqiCtx?.ctx.externalDateTimeUTC.val()),"hh:mm:ss aa")})()),bt(oe,Ye(Pr,{get when(){return Ot(()=>r()?.resource.state=="ready")()&&d()},fallback:"--",get children(){return Ot(()=>!!oh[d()?.current.weather_code])()?oh[d()?.current.weather_code].day.description:"--"}})),bt(je,Ye(Cg,{})),bt(st,(()=>{var Ve=Ot(()=>!!(S?.val()&&x?.val()&&S.val()[x.val()?.name]&&S.val()[x.val()?.name].length));return()=>Ve()&&S.val()[x.val()?.name][0].lpg||"--"})()),bt(We,Ye(wg,{})),bt(It,(()=>{var Ve=Ot(()=>!!(S?.val()&&x?.val()&&S.val()[x.val()?.name]&&S.val()[x.val()?.name].length));return()=>Ve()&&S.val()[x.val()?.name][0].co2||"--"})()),u})()}var ah={exports:{}};/**
 * MapLibre GL JS
 * @license 3-Clause BSD. Full text of license: https://github.com/maplibre/maplibre-gl-js/blob/v4.7.1/LICENSE.txt
 */var l1=ah.exports,Uf;function c1(){return Uf||(Uf=1,function(p,r){(function(a,d){p.exports=d()})(l1,function(){var a={},d={};function y(x,u,O){if(d[x]=O,x==="index"){var V="var sharedModule = {}; ("+d.shared+")(sharedModule); ("+d.worker+")(sharedModule);",W={};return d.shared(W),d.index(a,W),typeof window<"u"&&a.setWorkerUrl(window.URL.createObjectURL(new Blob([V],{type:"text/javascript"}))),a}}y("shared",["exports"],function(x){function u(i,t,n,o){return new(n||(n=Promise))(function(h,g){function _(T){try{w(o.next(T))}catch(E){g(E)}}function v(T){try{w(o.throw(T))}catch(E){g(E)}}function w(T){var E;T.done?h(T.value):(E=T.value,E instanceof n?E:new n(function(M){M(E)})).then(_,v)}w((o=o.apply(i,t||[])).next())})}function O(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}typeof SuppressedError=="function"&&SuppressedError;var V=W;function W(i,t){this.x=i,this.y=t}W.prototype={clone:function(){return new W(this.x,this.y)},add:function(i){return this.clone()._add(i)},sub:function(i){return this.clone()._sub(i)},multByPoint:function(i){return this.clone()._multByPoint(i)},divByPoint:function(i){return this.clone()._divByPoint(i)},mult:function(i){return this.clone()._mult(i)},div:function(i){return this.clone()._div(i)},rotate:function(i){return this.clone()._rotate(i)},rotateAround:function(i,t){return this.clone()._rotateAround(i,t)},matMult:function(i){return this.clone()._matMult(i)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(i){return this.x===i.x&&this.y===i.y},dist:function(i){return Math.sqrt(this.distSqr(i))},distSqr:function(i){var t=i.x-this.x,n=i.y-this.y;return t*t+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(i){return Math.atan2(this.y-i.y,this.x-i.x)},angleWith:function(i){return this.angleWithSep(i.x,i.y)},angleWithSep:function(i,t){return Math.atan2(this.x*t-this.y*i,this.x*i+this.y*t)},_matMult:function(i){var t=i[2]*this.x+i[3]*this.y;return this.x=i[0]*this.x+i[1]*this.y,this.y=t,this},_add:function(i){return this.x+=i.x,this.y+=i.y,this},_sub:function(i){return this.x-=i.x,this.y-=i.y,this},_mult:function(i){return this.x*=i,this.y*=i,this},_div:function(i){return this.x/=i,this.y/=i,this},_multByPoint:function(i){return this.x*=i.x,this.y*=i.y,this},_divByPoint:function(i){return this.x/=i.x,this.y/=i.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var i=this.y;return this.y=this.x,this.x=-i,this},_rotate:function(i){var t=Math.cos(i),n=Math.sin(i),o=n*this.x+t*this.y;return this.x=t*this.x-n*this.y,this.y=o,this},_rotateAround:function(i,t){var n=Math.cos(i),o=Math.sin(i),h=t.y+o*(this.x-t.x)+n*(this.y-t.y);return this.x=t.x+n*(this.x-t.x)-o*(this.y-t.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},W.convert=function(i){return i instanceof W?i:Array.isArray(i)?new W(i[0],i[1]):i};var q=O(V),F=oe;function oe(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}oe.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var h=this.sampleCurveX(n)-i;if(Math.abs(h)<t)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var _=0,v=1;for(n=i,o=0;o<20&&(h=this.sampleCurveX(n),!(Math.abs(h-i)<t));o++)i>h?_=n:v=n,n=.5*(v-_)+_;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var ie=O(F);let pe,ve;function Ce(){return pe==null&&(pe=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),pe}function je(){if(ve==null&&(ve=!1,Ce())){const t=new OffscreenCanvas(5,5).getContext("2d",{willReadFrequently:!0});if(t){for(let o=0;o<5*5;o++){const h=4*o;t.fillStyle=`rgb(${h},${h+1},${h+2})`,t.fillRect(o%5,Math.floor(o/5),1,1)}const n=t.getImageData(0,0,5,5).data;for(let o=0;o<5*5*4;o++)if(o%4!=3&&n[o]!==o){ve=!0;break}}}return ve||!1}function st(i,t,n,o){const h=new ie(i,t,n,o);return g=>h.solve(g)}const Qe=st(.25,.1,.25,1);function qe(i,t,n){return Math.min(n,Math.max(t,i))}function ct(i,t,n){const o=n-t,h=((i-t)%o+o)%o+t;return h===t?n:h}function We(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}let It=1;function Ve(i,t,n){const o={};for(const h in i)o[h]=t.call(this,i[h],h,i);return o}function pi(i,t,n){const o={};for(const h in i)t.call(this,i[h],h,i)&&(o[h]=i[h]);return o}function tt(i){return Array.isArray(i)?i.map(tt):typeof i=="object"&&i?Ve(i,tt):i}const oi={};function St(i){oi[i]||(typeof console<"u"&&console.warn(i),oi[i]=!0)}function Zt(i,t,n){return(n.y-i.y)*(t.x-i.x)>(t.y-i.y)*(n.x-i.x)}function Ri(i){return typeof WorkerGlobalScope<"u"&&i!==void 0&&i instanceof WorkerGlobalScope}let rr=null;function li(i){return typeof ImageBitmap<"u"&&i instanceof ImageBitmap}const yr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Fn(i,t,n,o,h){return u(this,void 0,void 0,function*(){if(typeof VideoFrame>"u")throw new Error("VideoFrame not supported");const g=new VideoFrame(i,{timestamp:0});try{const _=g?.format;if(!_||!_.startsWith("BGR")&&!_.startsWith("RGB"))throw new Error(`Unrecognized format ${_}`);const v=_.startsWith("BGR"),w=new Uint8ClampedArray(o*h*4);if(yield g.copyTo(w,function(T,E,M,z,R){const N=4*Math.max(-E,0),U=(Math.max(0,M)-M)*z*4+N,G=4*z,J=Math.max(0,E),de=Math.max(0,M);return{rect:{x:J,y:de,width:Math.min(T.width,E+z)-J,height:Math.min(T.height,M+R)-de},layout:[{offset:U,stride:G}]}}(i,t,n,o,h)),v)for(let T=0;T<w.length;T+=4){const E=w[T];w[T]=w[T+2],w[T+2]=E}return w}finally{g.close()}})}let mn,Vi;const Yi="AbortError";function xs(){return new Error(Yi)}const Mr={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};function sr(i){return Mr.REGISTERED_PROTOCOLS[i.substring(0,i.indexOf("://"))]}const bs="global-dispatcher";class fn extends Error{constructor(t,n,o,h){super(`AJAXError: ${n} (${t}): ${o}`),this.status=t,this.statusText=n,this.url=o,this.body=h}}const On=()=>Ri(self)?self.worker&&self.worker.referrer:(window.location.protocol==="blob:"?window.parent:window).location.href,Wr=function(i,t){if(/:\/\//.test(i.url)&&!/^https?:|^file:/.test(i.url)){const o=sr(i.url);if(o)return o(i,t);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,targetMapId:bs},t)}if(!(/^file:/.test(n=i.url)||/^file:/.test(On())&&!/^\w+:/.test(n))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return function(o,h){return u(this,void 0,void 0,function*(){const g=new Request(o.url,{method:o.method||"GET",body:o.body,credentials:o.credentials,headers:o.headers,cache:o.cache,referrer:On(),signal:h.signal});o.type!=="json"||g.headers.has("Accept")||g.headers.set("Accept","application/json");const _=yield fetch(g);if(!_.ok){const T=yield _.blob();throw new fn(_.status,_.statusText,o.url,T)}let v;v=o.type==="arrayBuffer"||o.type==="image"?_.arrayBuffer():o.type==="json"?_.json():_.text();const w=yield v;if(h.signal.aborted)throw xs();return{data:w,cacheControl:_.headers.get("Cache-Control"),expires:_.headers.get("Expires")}})}(i,t);if(Ri(self)&&self.worker&&self.worker.actor)return self.worker.actor.sendAsync({type:"GR",data:i,mustQueue:!0,targetMapId:bs},t)}var n;return function(o,h){return new Promise((g,_)=>{var v;const w=new XMLHttpRequest;w.open(o.method||"GET",o.url,!0),o.type!=="arrayBuffer"&&o.type!=="image"||(w.responseType="arraybuffer");for(const T in o.headers)w.setRequestHeader(T,o.headers[T]);o.type==="json"&&(w.responseType="text",!((v=o.headers)===null||v===void 0)&&v.Accept||w.setRequestHeader("Accept","application/json")),w.withCredentials=o.credentials==="include",w.onerror=()=>{_(new Error(w.statusText))},w.onload=()=>{if(!h.signal.aborted)if((w.status>=200&&w.status<300||w.status===0)&&w.response!==null){let T=w.response;if(o.type==="json")try{T=JSON.parse(w.response)}catch(E){return void _(E)}g({data:T,cacheControl:w.getResponseHeader("Cache-Control"),expires:w.getResponseHeader("Expires")})}else{const T=new Blob([w.response],{type:w.getResponseHeader("Content-Type")});_(new fn(w.status,w.statusText,o.url,T))}},h.signal.addEventListener("abort",()=>{w.abort(),_(xs())}),w.send(o.body)})}(i,t)};function Zr(i){if(!i||i.indexOf("://")<=0||i.indexOf("data:image/")===0||i.indexOf("blob:")===0)return!0;const t=new URL(i),n=window.location;return t.protocol===n.protocol&&t.host===n.host}function bo(i,t,n){n[i]&&n[i].indexOf(t)!==-1||(n[i]=n[i]||[],n[i].push(t))}function vr(i,t,n){if(n&&n[i]){const o=n[i].indexOf(t);o!==-1&&n[i].splice(o,1)}}class kr{constructor(t,n={}){We(this,n),this.type=t}}class Ar extends kr{constructor(t,n={}){super("error",We({error:t},n))}}class ws{on(t,n){return this._listeners=this._listeners||{},bo(t,n,this._listeners),this}off(t,n){return vr(t,n,this._listeners),vr(t,n,this._oneTimeListeners),this}once(t,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},bo(t,n,this._oneTimeListeners),this):new Promise(o=>this.once(t,o))}fire(t,n){typeof t=="string"&&(t=new kr(t,n||{}));const o=t.type;if(this.listens(o)){t.target=this;const h=this._listeners&&this._listeners[o]?this._listeners[o].slice():[];for(const v of h)v.call(this,t);const g=this._oneTimeListeners&&this._oneTimeListeners[o]?this._oneTimeListeners[o].slice():[];for(const v of g)vr(o,v,this._oneTimeListeners),v.call(this,t);const _=this._eventedParent;_&&(We(t,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),_.fire(t))}else t instanceof Ar&&console.error(t.error);return this}listens(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)}setEventedParent(t,n){return this._eventedParent=t,this._eventedParentData=n,this}}var ge={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sky:{type:"sky"},projection:{type:"projection"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{},custom:{}},default:"mapbox"},redFactor:{type:"number",default:1},blueFactor:{type:"number",default:1},greenFactor:{type:"number",default:1},baseShift:{type:"number",default:0},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-variable-anchor-offset":{type:"variableAnchorOffsetCollection",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},sky:{"sky-color":{type:"color","property-type":"data-constant",default:"#88C6FC",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-color":{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fog-ground-blend":{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-fog-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"sky-horizon-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"atmosphere-blend":{type:"number","property-type":"data-constant",default:.8,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},projection:{type:{type:"enum",default:"mercator",values:{mercator:{},globe:{}}}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Gr=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function wo(i,t){const n={};for(const o in i)o!=="ref"&&(n[o]=i[o]);return Gr.forEach(o=>{o in t&&(n[o]=t[o])}),n}function At(i,t){if(Array.isArray(i)){if(!Array.isArray(t)||i.length!==t.length)return!1;for(let n=0;n<i.length;n++)if(!At(i[n],t[n]))return!1;return!0}if(typeof i=="object"&&i!==null&&t!==null){if(typeof t!="object"||Object.keys(i).length!==Object.keys(t).length)return!1;for(const n in i)if(!At(i[n],t[n]))return!1;return!0}return i===t}function ci(i,t){i.push(t)}function Co(i,t,n){ci(n,{command:"addSource",args:[i,t[i]]})}function zr(i,t,n){ci(t,{command:"removeSource",args:[i]}),n[i]=!0}function xr(i,t,n,o){zr(i,n,o),Co(i,t,n)}function Cs(i,t,n){let o;for(o in i[n])if(Object.prototype.hasOwnProperty.call(i[n],o)&&o!=="data"&&!At(i[n][o],t[n][o]))return!1;for(o in t[n])if(Object.prototype.hasOwnProperty.call(t[n],o)&&o!=="data"&&!At(i[n][o],t[n][o]))return!1;return!0}function In(i,t,n,o,h,g){i=i||{},t=t||{};for(const _ in i)Object.prototype.hasOwnProperty.call(i,_)&&(At(i[_],t[_])||n.push({command:g,args:[o,_,t[_],h]}));for(const _ in t)Object.prototype.hasOwnProperty.call(t,_)&&!Object.prototype.hasOwnProperty.call(i,_)&&(At(i[_],t[_])||n.push({command:g,args:[o,_,t[_],h]}))}function So(i){return i.id}function Io(i,t){return i[t.id]=t,i}class Ee{constructor(t,n,o,h){this.message=(t?`${t}: `:"")+o,h&&(this.identifier=h),n!=null&&n.__line__&&(this.line=n.__line__)}}function or(i,...t){for(const n of t)for(const o in n)i[o]=n[o];return i}class Ki extends Error{constructor(t,n){super(n),this.message=n,this.key=t}}class ar{constructor(t,n=[]){this.parent=t,this.bindings={};for(const[o,h]of n)this.bindings[o]=h}concat(t){return new ar(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Dr={kind:"null"},Ae={kind:"number"},ft={kind:"string"},ot={kind:"boolean"},rn={kind:"color"},Nn={kind:"object"},ht={kind:"value"},lr={kind:"collator"},br={kind:"formatted"},Lr={kind:"padding"},cr={kind:"resolvedImage"},K={kind:"variableAnchorOffsetCollection"};function L(i,t){return{kind:"array",itemType:i,N:t}}function D(i){if(i.kind==="array"){const t=D(i.itemType);return typeof i.N=="number"?`array<${t}, ${i.N}>`:i.itemType.kind==="value"?"array":`array<${t}>`}return i.kind}const j=[Dr,Ae,ft,ot,rn,br,Nn,L(ht),Lr,cr,K];function X(i,t){if(t.kind==="error")return null;if(i.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!X(i.itemType,t.itemType))&&(typeof i.N!="number"||i.N===t.N))return null}else{if(i.kind===t.kind)return null;if(i.kind==="value"){for(const n of j)if(!X(n,t))return null}}return`Expected ${D(i)} but found ${D(t)} instead.`}function se(i,t){return t.some(n=>n.kind===i.kind)}function le(i,t){return t.some(n=>n==="null"?i===null:n==="array"?Array.isArray(i):n==="object"?i&&!Array.isArray(i)&&typeof i=="object":n===typeof i)}function he(i,t){return i.kind==="array"&&t.kind==="array"?i.itemType.kind===t.itemType.kind&&typeof i.N=="number":i.kind===t.kind}const te=.96422,ye=.82521,we=4/29,fe=6/29,Pe=3*fe*fe,et=fe*fe*fe,it=Math.PI/180,Et=180/Math.PI;function dt(i){return(i%=360)<0&&(i+=360),i}function Pt([i,t,n,o]){let h,g;const _=xi((.2225045*(i=vt(i))+.7168786*(t=vt(t))+.0606169*(n=vt(n)))/1);i===t&&t===n?h=g=_:(h=xi((.4360747*i+.3850649*t+.1430804*n)/te),g=xi((.0139322*i+.0971045*t+.7141733*n)/ye));const v=116*_-16;return[v<0?0:v,500*(h-_),200*(_-g),o]}function vt(i){return i<=.04045?i/12.92:Math.pow((i+.055)/1.055,2.4)}function xi(i){return i>et?Math.pow(i,1/3):i/Pe+we}function ui([i,t,n,o]){let h=(i+16)/116,g=isNaN(t)?h:h+t/500,_=isNaN(n)?h:h-n/200;return h=1*Bt(h),g=te*Bt(g),_=ye*Bt(_),[gt(3.1338561*g-1.6168667*h-.4906146*_),gt(-.9787684*g+1.9161415*h+.033454*_),gt(.0719453*g-.2289914*h+1.4052427*_),o]}function gt(i){return(i=i<=.00304?12.92*i:1.055*Math.pow(i,1/2.4)-.055)<0?0:i>1?1:i}function Bt(i){return i>fe?i*i*i:Pe*(i-we)}function ai(i){return parseInt(i.padEnd(2,i),16)/255}function ki(i,t){return Bi(t?i/100:i,0,1)}function Bi(i,t,n){return Math.min(Math.max(t,i),n)}function Ji(i){return!i.some(Number.isNaN)}const Ss={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Ft{constructor(t,n,o,h=1,g=!0){this.r=t,this.g=n,this.b=o,this.a=h,g||(this.r*=h,this.g*=h,this.b*=h,h||this.overwriteGetter("rgb",[t,n,o,h]))}static parse(t){if(t instanceof Ft)return t;if(typeof t!="string")return;const n=function(o){if((o=o.toLowerCase().trim())==="transparent")return[0,0,0,0];const h=Ss[o];if(h){const[_,v,w]=h;return[_/255,v/255,w/255,1]}if(o.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(o)){const _=o.length<6?1:2;let v=1;return[ai(o.slice(v,v+=_)),ai(o.slice(v,v+=_)),ai(o.slice(v,v+=_)),ai(o.slice(v,v+_)||"ff")]}if(o.startsWith("rgb")){const _=o.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(_){const[v,w,T,E,M,z,R,N,U,G,J,de]=_,re=[E||" ",R||" ",G].join("");if(re==="  "||re==="  /"||re===",,"||re===",,,"){const ue=[T,z,U].join(""),_e=ue==="%%%"?100:ue===""?255:0;if(_e){const Se=[Bi(+w/_e,0,1),Bi(+M/_e,0,1),Bi(+N/_e,0,1),J?ki(+J,de):1];if(Ji(Se))return Se}}return}}const g=o.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(g){const[_,v,w,T,E,M,z,R,N]=g,U=[w||" ",E||" ",z].join("");if(U==="  "||U==="  /"||U===",,"||U===",,,"){const G=[+v,Bi(+T,0,100),Bi(+M,0,100),R?ki(+R,N):1];if(Ji(G))return function([J,de,re,ue]){function _e(Se){const Oe=(Se+J/30)%12,nt=de*Math.min(re,1-re);return re-nt*Math.max(-1,Math.min(Oe-3,9-Oe,1))}return J=dt(J),de/=100,re/=100,[_e(0),_e(8),_e(4),ue]}(G)}}}(t);return n?new Ft(...n,!1):void 0}get rgb(){const{r:t,g:n,b:o,a:h}=this,g=h||1/0;return this.overwriteGetter("rgb",[t/g,n/g,o/g,h])}get hcl(){return this.overwriteGetter("hcl",function(t){const[n,o,h,g]=Pt(t),_=Math.sqrt(o*o+h*h);return[Math.round(1e4*_)?dt(Math.atan2(h,o)*Et):NaN,_,n,g]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Pt(this.rgb))}overwriteGetter(t,n){return Object.defineProperty(this,t,{value:n}),n}toString(){const[t,n,o,h]=this.rgb;return`rgba(${[t,n,o].map(g=>Math.round(255*g)).join(",")},${h})`}}Ft.black=new Ft(0,0,0,1),Ft.white=new Ft(1,1,1,1),Ft.transparent=new Ft(0,0,0,0),Ft.red=new Ft(1,0,0,1);class bl{constructor(t,n,o){this.sensitivity=t?n?"variant":"case":n?"accent":"base",this.locale=o,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,n){return this.collator.compare(t,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class wl{constructor(t,n,o,h,g){this.text=t,this.image=n,this.scale=o,this.fontStack=h,this.textColor=g}}class gn{constructor(t){this.sections=t}static fromString(t){return new gn([new wl(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||t.image&&t.image.name.length!==0)}static factory(t){return t instanceof gn?t:gn.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}}class _n{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof _n)return t;if(typeof t=="number")return new _n([t,t,t,t]);if(Array.isArray(t)&&!(t.length<1||t.length>4)){for(const n of t)if(typeof n!="number")return;switch(t.length){case 1:t=[t[0],t[0],t[0],t[0]];break;case 2:t=[t[0],t[1],t[0],t[1]];break;case 3:t=[t[0],t[1],t[2],t[1]]}return new _n(t)}}toString(){return JSON.stringify(this.values)}}const Sh=new Set(["center","left","right","top","bottom","top-left","top-right","bottom-left","bottom-right"]);class Tn{constructor(t){this.values=t.slice()}static parse(t){if(t instanceof Tn)return t;if(Array.isArray(t)&&!(t.length<1)&&t.length%2==0){for(let n=0;n<t.length;n+=2){const o=t[n],h=t[n+1];if(typeof o!="string"||!Sh.has(o)||!Array.isArray(h)||h.length!==2||typeof h[0]!="number"||typeof h[1]!="number")return}return new Tn(t)}}toString(){return JSON.stringify(this.values)}}class yn{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new yn({name:t,available:!1}):null}}function Is(i,t,n,o){return typeof i=="number"&&i>=0&&i<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof n=="number"&&n>=0&&n<=255?o===void 0||typeof o=="number"&&o>=0&&o<=1?null:`Invalid rgba value [${[i,t,n,o].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof o=="number"?[i,t,n,o]:[i,t,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xr(i){if(i===null||typeof i=="string"||typeof i=="boolean"||typeof i=="number"||i instanceof Ft||i instanceof bl||i instanceof gn||i instanceof _n||i instanceof Tn||i instanceof yn)return!0;if(Array.isArray(i)){for(const t of i)if(!Xr(t))return!1;return!0}if(typeof i=="object"){for(const t in i)if(!Xr(i[t]))return!1;return!0}return!1}function bi(i){if(i===null)return Dr;if(typeof i=="string")return ft;if(typeof i=="boolean")return ot;if(typeof i=="number")return Ae;if(i instanceof Ft)return rn;if(i instanceof bl)return lr;if(i instanceof gn)return br;if(i instanceof _n)return Lr;if(i instanceof Tn)return K;if(i instanceof yn)return cr;if(Array.isArray(i)){const t=i.length;let n;for(const o of i){const h=bi(o);if(n){if(n===h)continue;n=ht;break}n=h}return L(n||ht,t)}return Nn}function To(i){const t=typeof i;return i===null?"":t==="string"||t==="number"||t==="boolean"?String(i):i instanceof Ft||i instanceof gn||i instanceof _n||i instanceof Tn||i instanceof yn?i.toString():JSON.stringify(i)}class Vn{constructor(t,n){this.type=t,this.value=n}static parse(t,n){if(t.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Xr(t[1]))return n.error("invalid value");const o=t[1];let h=bi(o);const g=n.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Vn(h,o)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class _i{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ca={string:ft,number:Ae,boolean:ot,object:Nn};class Un{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");let o,h=1;const g=t[0];if(g==="array"){let v,w;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in ca)||T==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);v=ca[T],h++}else v=ht;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return n.error('The length argument to "array" must be a positive integer literal',2);w=t[2],h++}o=L(v,w)}else{if(!ca[g])throw new Error(`Types doesn't contain name = ${g}`);o=ca[g]}const _=[];for(;h<t.length;h++){const v=n.parse(t[h],h,ht);if(!v)return null;_.push(v)}return new Un(o,_)}evaluate(t){for(let n=0;n<this.args.length;n++){const o=this.args[n].evaluate(t);if(!X(this.type,bi(o)))return o;if(n===this.args.length-1)throw new _i(`Expected value to be of type ${D(this.type)}, but found ${D(bi(o))} instead.`)}throw new Error}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Cl={"to-boolean":ot,"to-color":rn,"to-number":Ae,"to-string":ft};class $n{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[0];if(!Cl[o])throw new Error(`Can't parse ${o} as it is not part of the known types`);if((o==="to-boolean"||o==="to-string")&&t.length!==2)return n.error("Expected one argument.");const h=Cl[o],g=[];for(let _=1;_<t.length;_++){const v=n.parse(t[_],_,ht);if(!v)return null;g.push(v)}return new $n(h,g)}evaluate(t){switch(this.type.kind){case"boolean":return!!this.args[0].evaluate(t);case"color":{let n,o;for(const h of this.args){if(n=h.evaluate(t),o=null,n instanceof Ft)return n;if(typeof n=="string"){const g=t.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(o=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Is(n[0],n[1],n[2],n[3]),!o))return new Ft(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new _i(o||`Could not parse color from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"padding":{let n;for(const o of this.args){n=o.evaluate(t);const h=_n.parse(n);if(h)return h}throw new _i(`Could not parse padding from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"variableAnchorOffsetCollection":{let n;for(const o of this.args){n=o.evaluate(t);const h=Tn.parse(n);if(h)return h}throw new _i(`Could not parse variableAnchorOffsetCollection from value '${typeof n=="string"?n:JSON.stringify(n)}'`)}case"number":{let n=null;for(const o of this.args){if(n=o.evaluate(t),n===null)return 0;const h=Number(n);if(!isNaN(h))return h}throw new _i(`Could not convert ${JSON.stringify(n)} to number.`)}case"formatted":return gn.fromString(To(this.args[0].evaluate(t)));case"resolvedImage":return yn.fromString(To(this.args[0].evaluate(t)));default:return To(this.args[0].evaluate(t))}}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}const Ih=["Unknown","Point","LineString","Polygon"];class ua{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ih[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(t){let n=this._parseColorCache[t];return n||(n=this._parseColorCache[t]=Ft.parse(t)),n}}class Yr{constructor(t,n,o=[],h,g=new ar,_=[]){this.registry=t,this.path=o,this.key=o.map(v=>`[${v}]`).join(""),this.scope=g,this.errors=_,this.expectedType=h,this._isConstant=n}parse(t,n,o,h,g={}){return n?this.concat(n,o,h)._parse(t,g):this._parse(t,g)}_parse(t,n){function o(h,g,_){return _==="assert"?new Un(g,[h]):_==="coerce"?new $n(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=t[0];if(typeof h!="string")return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let _=g.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,w=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||w.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||w.kind!=="value"&&w.kind!=="string")if(v.kind!=="padding"||w.kind!=="value"&&w.kind!=="number"&&w.kind!=="array")if(v.kind!=="variableAnchorOffsetCollection"||w.kind!=="value"&&w.kind!=="array"){if(this.checkSubtype(v,w))return null}else _=o(_,v,n.typeAnnotation||"coerce");else _=o(_,v,n.typeAnnotation||"coerce");else _=o(_,v,n.typeAnnotation||"coerce");else _=o(_,v,n.typeAnnotation||"assert")}if(!(_ instanceof Vn)&&_.type.kind!=="resolvedImage"&&this._isConstant(_)){const v=new ua;try{_=new Vn(_.type,_.evaluate(v))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,n,o){const h=typeof t=="number"?this.path.concat(t):this.path,g=o?this.scope.concat(o):this.scope;return new Yr(this.registry,this._isConstant,h,n||null,g,this.errors)}error(t,...n){const o=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Ki(o,t))}checkSubtype(t,n){const o=X(t,n);return o&&this.error(o),o}}class Rr{constructor(t,n){this.type=n.type,this.bindings=[].concat(t),this.result=n}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const n of this.bindings)t(n[1]);t(this.result)}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const o=[];for(let g=1;g<t.length-1;g+=2){const _=t[g];if(typeof _!="string")return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const v=n.parse(t[g+1],g+1);if(!v)return null;o.push([_,v])}const h=n.parse(t[t.length-1],t.length-1,n.expectedType,o);return h?new Rr(o,h):null}outputDefined(){return this.result.outputDefined()}}class zt{constructor(t,n){this.type=n.type,this.name=t,this.boundExpression=n}static parse(t,n){if(t.length!==2||typeof t[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");const o=t[1];return n.scope.has(o)?new zt(o,n.scope.get(o)):n.error(`Unknown variable "${o}". Make sure "${o}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}}class Sl{constructor(t,n,o){this.type=t,this.index=n,this.input=o}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,Ae),h=n.parse(t[2],2,L(n.expectedType||ht));return o&&h?new Sl(h.type.itemType,o,h):null}evaluate(t){const n=this.index.evaluate(t),o=this.input.evaluate(t);if(n<0)throw new _i(`Array index out of bounds: ${n} < 0.`);if(n>=o.length)throw new _i(`Array index out of bounds: ${n} > ${o.length-1}.`);if(n!==Math.floor(n))throw new _i(`Array index must be an integer, but found ${n} instead.`);return o[n]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}}class Il{constructor(t,n){this.type=ot,this.needle=t,this.haystack=n}static parse(t,n){if(t.length!==3)return n.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,ht),h=n.parse(t[2],2,ht);return o&&h?se(o.type,[ot,ft,Ae,Dr,ht])?new Il(o,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(o.type)} instead`):null}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!o)return!1;if(!le(n,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${D(bi(n))} instead.`);if(!le(o,["string","array"]))throw new _i(`Expected second argument to be of type array or string, but found ${D(bi(o))} instead.`);return o.indexOf(n)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}}class Ts{constructor(t,n,o){this.type=Ae,this.needle=t,this.haystack=n,this.fromIndex=o}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,ht),h=n.parse(t[2],2,ht);if(!o||!h)return null;if(!se(o.type,[ot,ft,Ae,Dr,ht]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${D(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,Ae);return g?new Ts(o,h,g):null}return new Ts(o,h)}evaluate(t){const n=this.needle.evaluate(t),o=this.haystack.evaluate(t);if(!le(n,["boolean","string","number","null"]))throw new _i(`Expected first argument to be of type boolean, string, number or null, but found ${D(bi(n))} instead.`);let h;if(this.fromIndex&&(h=this.fromIndex.evaluate(t)),le(o,["string"])){const g=o.indexOf(n,h);return g===-1?-1:[...o.slice(0,g)].length}if(le(o,["array"]))return o.indexOf(n,h);throw new _i(`Expected second argument to be of type array or string, but found ${D(bi(o))} instead.`)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}}class Tl{constructor(t,n,o,h,g,_){this.inputType=t,this.type=n,this.input=o,this.cases=h,this.outputs=g,this.otherwise=_}static parse(t,n){if(t.length<5)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return n.error("Expected an even number of arguments.");let o,h;n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);const g={},_=[];for(let T=2;T<t.length-1;T+=2){let E=t[T];const M=t[T+1];Array.isArray(E)||(E=[E]);const z=n.concat(T);if(E.length===0)return z.error("Expected at least one branch label.");for(const N of E){if(typeof N!="number"&&typeof N!="string")return z.error("Branch labels must be numbers or strings.");if(typeof N=="number"&&Math.abs(N)>Number.MAX_SAFE_INTEGER)return z.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof N=="number"&&Math.floor(N)!==N)return z.error("Numeric branch labels must be integer values.");if(o){if(z.checkSubtype(o,bi(N)))return null}else o=bi(N);if(g[String(N)]!==void 0)return z.error("Branch labels must be unique.");g[String(N)]=_.length}const R=n.parse(M,T,h);if(!R)return null;h=h||R.type,_.push(R)}const v=n.parse(t[1],1,ht);if(!v)return null;const w=n.parse(t[t.length-1],t.length-1,h);return w?v.type.kind!=="value"&&n.concat(1).checkSubtype(o,v.type)?null:new Tl(o,h,v,g,_,w):null}evaluate(t){const n=this.input.evaluate(t);return(bi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}}class ha{constructor(t,n,o){this.type=t,this.branches=n,this.otherwise=o}static parse(t,n){if(t.length<4)return n.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return n.error("Expected an odd number of arguments.");let o;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);const h=[];for(let _=1;_<t.length-1;_+=2){const v=n.parse(t[_],_,ot);if(!v)return null;const w=n.parse(t[_+1],_+1,o);if(!w)return null;h.push([v,w]),o=o||w.type}const g=n.parse(t[t.length-1],t.length-1,o);if(!g)return null;if(!o)throw new Error("Can't infer output type");return new ha(o,h,g)}evaluate(t){for(const[n,o]of this.branches)if(n.evaluate(t))return o.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[n,o]of this.branches)t(n),t(o);t(this.otherwise)}outputDefined(){return this.branches.every(([t,n])=>n.outputDefined())&&this.otherwise.outputDefined()}}class Eo{constructor(t,n,o,h){this.type=t,this.input=n,this.beginIndex=o,this.endIndex=h}static parse(t,n){if(t.length<=2||t.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const o=n.parse(t[1],1,ht),h=n.parse(t[2],2,Ae);if(!o||!h)return null;if(!se(o.type,[L(ht),ft,ht]))return n.error(`Expected first argument to be of type array or string, but found ${D(o.type)} instead`);if(t.length===4){const g=n.parse(t[3],3,Ae);return g?new Eo(o.type,o,h,g):null}return new Eo(o.type,o,h)}evaluate(t){const n=this.input.evaluate(t),o=this.beginIndex.evaluate(t);let h;if(this.endIndex&&(h=this.endIndex.evaluate(t)),le(n,["string"]))return[...n].slice(o,h).join("");if(le(n,["array"]))return n.slice(o,h);throw new _i(`Expected first argument to be of type array or string, but found ${D(bi(n))} instead.`)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}}function da(i,t){const n=i.length-1;let o,h,g=0,_=n,v=0;for(;g<=_;)if(v=Math.floor((g+_)/2),o=i[v],h=i[v+1],o<=t){if(v===n||t<h)return v;g=v+1}else{if(!(o>t))throw new _i("Input is not a number.");_=v-1}return 0}class Es{constructor(t,n,o){this.type=t,this.input=n,this.labels=[],this.outputs=[];for(const[h,g]of o)this.labels.push(h),this.outputs.push(g)}static parse(t,n){if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");const o=n.parse(t[1],1,Ae);if(!o)return null;const h=[];let g=null;n.expectedType&&n.expectedType.kind!=="value"&&(g=n.expectedType);for(let _=1;_<t.length;_+=2){const v=_===1?-1/0:t[_],w=t[_+1],T=_,E=_+1;if(typeof v!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=v)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const M=n.parse(w,E,g);if(!M)return null;g=g||M.type,h.push([v,M])}return new Es(g,o,h)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return o[0].evaluate(t);const g=n.length;return h>=n[g-1]?o[g-1].evaluate(t):o[da(n,h)].evaluate(t)}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function eu(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Th=tu;function tu(i,t,n,o){this.cx=3*i,this.bx=3*(n-i)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(o-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=i,this.p1y=t,this.p2x=n,this.p2y=o}tu.prototype={sampleCurveX:function(i){return((this.ax*i+this.bx)*i+this.cx)*i},sampleCurveY:function(i){return((this.ay*i+this.by)*i+this.cy)*i},sampleCurveDerivativeX:function(i){return(3*this.ax*i+2*this.bx)*i+this.cx},solveCurveX:function(i,t){if(t===void 0&&(t=1e-6),i<0)return 0;if(i>1)return 1;for(var n=i,o=0;o<8;o++){var h=this.sampleCurveX(n)-i;if(Math.abs(h)<t)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var _=0,v=1;for(n=i,o=0;o<20&&(h=this.sampleCurveX(n),!(Math.abs(h-i)<t));o++)i>h?_=n:v=n,n=.5*(v-_)+_;return n},solve:function(i,t){return this.sampleCurveY(this.solveCurveX(i,t))}};var Eh=eu(Th);function Kr(i,t,n){return i+n*(t-i)}function Po(i,t,n){return i.map((o,h)=>Kr(o,t[h],n))}const sn={number:Kr,color:function(i,t,n,o="rgb"){switch(o){case"rgb":{const[h,g,_,v]=Po(i.rgb,t.rgb,n);return new Ft(h,g,_,v,!1)}case"hcl":{const[h,g,_,v]=i.hcl,[w,T,E,M]=t.hcl;let z,R;if(isNaN(h)||isNaN(w))isNaN(h)?isNaN(w)?z=NaN:(z=w,_!==1&&_!==0||(R=T)):(z=h,E!==1&&E!==0||(R=g));else{let de=w-h;w>h&&de>180?de-=360:w<h&&h-w>180&&(de+=360),z=h+n*de}const[N,U,G,J]=function([de,re,ue,_e]){return de=isNaN(de)?0:de*it,ui([ue,Math.cos(de)*re,Math.sin(de)*re,_e])}([z,R??Kr(g,T,n),Kr(_,E,n),Kr(v,M,n)]);return new Ft(N,U,G,J,!1)}case"lab":{const[h,g,_,v]=ui(Po(i.lab,t.lab,n));return new Ft(h,g,_,v,!1)}}},array:Po,padding:function(i,t,n){return new _n(Po(i.values,t.values,n))},variableAnchorOffsetCollection:function(i,t,n){const o=i.values,h=t.values;if(o.length!==h.length)throw new _i(`Cannot interpolate values of different length. from: ${i.toString()}, to: ${t.toString()}`);const g=[];for(let _=0;_<o.length;_+=2){if(o[_]!==h[_])throw new _i(`Cannot interpolate values containing mismatched anchors. from[${_}]: ${o[_]}, to[${_}]: ${h[_]}`);g.push(o[_]);const[v,w]=o[_+1],[T,E]=h[_+1];g.push([Kr(v,T,n),Kr(w,E,n)])}return new Tn(g)}};class on{constructor(t,n,o,h,g){this.type=t,this.operator=n,this.interpolation=o,this.input=h,this.labels=[],this.outputs=[];for(const[_,v]of g)this.labels.push(_),this.outputs.push(v)}static interpolationFactor(t,n,o,h){let g=0;if(t.name==="exponential")g=pa(n,t.base,o,h);else if(t.name==="linear")g=pa(n,1,o,h);else if(t.name==="cubic-bezier"){const _=t.controlPoints;g=new Eh(_[0],_[1],_[2],_[3]).solve(pa(n,1,o,h))}return g}static parse(t,n){let[o,h,g,..._]=t;if(!Array.isArray(h)||h.length===0)return n.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const T=h[1];if(typeof T!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if(h[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(T.length!==4||T.some(E=>typeof E!="number"||E<0||E>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Ae),!g)return null;const v=[];let w=null;o==="interpolate-hcl"||o==="interpolate-lab"?w=rn:n.expectedType&&n.expectedType.kind!=="value"&&(w=n.expectedType);for(let T=0;T<_.length;T+=2){const E=_[T],M=_[T+1],z=T+3,R=T+4;if(typeof E!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',z);if(v.length&&v[v.length-1][0]>=E)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',z);const N=n.parse(M,R,w);if(!N)return null;w=w||N.type,v.push([E,N])}return he(w,Ae)||he(w,rn)||he(w,Lr)||he(w,K)||he(w,L(Ae))?new on(w,o,h,g,v):n.error(`Type ${D(w)} is not interpolatable.`)}evaluate(t){const n=this.labels,o=this.outputs;if(n.length===1)return o[0].evaluate(t);const h=this.input.evaluate(t);if(h<=n[0])return o[0].evaluate(t);const g=n.length;if(h>=n[g-1])return o[g-1].evaluate(t);const _=da(n,h),v=on.interpolationFactor(this.interpolation,h,n[_],n[_+1]),w=o[_].evaluate(t),T=o[_+1].evaluate(t);switch(this.operator){case"interpolate":return sn[this.type.kind](w,T,v);case"interpolate-hcl":return sn.color(w,T,v,"hcl");case"interpolate-lab":return sn.color(w,T,v,"lab")}}eachChild(t){t(this.input);for(const n of this.outputs)t(n)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}}function pa(i,t,n,o){const h=o-n,g=i-n;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class ma{constructor(t,n){this.type=t,this.args=n}static parse(t,n){if(t.length<2)return n.error("Expectected at least one argument.");let o=null;const h=n.expectedType;h&&h.kind!=="value"&&(o=h);const g=[];for(const v of t.slice(1)){const w=n.parse(v,1+g.length,o,void 0,{typeAnnotation:"omit"});if(!w)return null;o=o||w.type,g.push(w)}if(!o)throw new Error("No output type");const _=h&&g.some(v=>X(h,v.type));return new ma(_?ht:o,g)}evaluate(t){let n,o=null,h=0;for(const g of this.args)if(h++,o=g.evaluate(t),o&&o instanceof yn&&!o.available&&(n||(n=o.name),o=null,h===this.args.length&&(o=n)),o!==null)break;return o}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}}function fa(i,t){return i==="=="||i==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function iu(i,t,n,o){return o.compare(t,n)===0}function Ps(i,t,n){const o=i!=="=="&&i!=="!=";return class a_{constructor(g,_,v){this.type=ot,this.lhs=g,this.rhs=_,this.collator=v,this.hasUntypedArgument=g.type.kind==="value"||_.type.kind==="value"}static parse(g,_){if(g.length!==3&&g.length!==4)return _.error("Expected two or three arguments.");const v=g[0];let w=_.parse(g[1],1,ht);if(!w)return null;if(!fa(v,w.type))return _.concat(1).error(`"${v}" comparisons are not supported for type '${D(w.type)}'.`);let T=_.parse(g[2],2,ht);if(!T)return null;if(!fa(v,T.type))return _.concat(2).error(`"${v}" comparisons are not supported for type '${D(T.type)}'.`);if(w.type.kind!==T.type.kind&&w.type.kind!=="value"&&T.type.kind!=="value")return _.error(`Cannot compare types '${D(w.type)}' and '${D(T.type)}'.`);o&&(w.type.kind==="value"&&T.type.kind!=="value"?w=new Un(T.type,[w]):w.type.kind!=="value"&&T.type.kind==="value"&&(T=new Un(w.type,[T])));let E=null;if(g.length===4){if(w.type.kind!=="string"&&T.type.kind!=="string"&&w.type.kind!=="value"&&T.type.kind!=="value")return _.error("Cannot use collator to compare non-string types.");if(E=_.parse(g[3],3,lr),!E)return null}return new a_(w,T,E)}evaluate(g){const _=this.lhs.evaluate(g),v=this.rhs.evaluate(g);if(o&&this.hasUntypedArgument){const w=bi(_),T=bi(v);if(w.kind!==T.kind||w.kind!=="string"&&w.kind!=="number")throw new _i(`Expected arguments for "${i}" to be (string, string) or (number, number), but found (${w.kind}, ${T.kind}) instead.`)}if(this.collator&&!o&&this.hasUntypedArgument){const w=bi(_),T=bi(v);if(w.kind!=="string"||T.kind!=="string")return t(g,_,v)}return this.collator?n(g,_,v,this.collator.evaluate(g)):t(g,_,v)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}}}const Ph=Ps("==",function(i,t,n){return t===n},iu),nu=Ps("!=",function(i,t,n){return t!==n},function(i,t,n,o){return!iu(0,t,n,o)}),ru=Ps("<",function(i,t,n){return t<n},function(i,t,n,o){return o.compare(t,n)<0}),Mh=Ps(">",function(i,t,n){return t>n},function(i,t,n,o){return o.compare(t,n)>0}),kh=Ps("<=",function(i,t,n){return t<=n},function(i,t,n,o){return o.compare(t,n)<=0}),su=Ps(">=",function(i,t,n){return t>=n},function(i,t,n,o){return o.compare(t,n)>=0});class Mo{constructor(t,n,o){this.type=lr,this.locale=o,this.caseSensitive=t,this.diacriticSensitive=n}static parse(t,n){if(t.length!==2)return n.error("Expected one argument.");const o=t[1];if(typeof o!="object"||Array.isArray(o))return n.error("Collator options argument must be an object.");const h=n.parse(o["case-sensitive"]!==void 0&&o["case-sensitive"],1,ot);if(!h)return null;const g=n.parse(o["diacritic-sensitive"]!==void 0&&o["diacritic-sensitive"],1,ot);if(!g)return null;let _=null;return o.locale&&(_=n.parse(o.locale,1,ft),!_)?null:new Mo(h,g,_)}evaluate(t){return new bl(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}}class El{constructor(t,n,o,h,g){this.type=ft,this.number=t,this.locale=n,this.currency=o,this.minFractionDigits=h,this.maxFractionDigits=g}static parse(t,n){if(t.length!==3)return n.error("Expected two arguments.");const o=n.parse(t[1],1,Ae);if(!o)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,ft),!g))return null;let _=null;if(h.currency&&(_=n.parse(h.currency,1,ft),!_))return null;let v=null;if(h["min-fraction-digits"]&&(v=n.parse(h["min-fraction-digits"],1,Ae),!v))return null;let w=null;return h["max-fraction-digits"]&&(w=n.parse(h["max-fraction-digits"],1,Ae),!w)?null:new El(o,g,_,v,w)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}}class ga{constructor(t){this.type=br,this.sections=t}static parse(t,n){if(t.length<2)return n.error("Expected at least one argument.");const o=t[1];if(!Array.isArray(o)&&typeof o=="object")return n.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=t.length-1;++_){const v=t[_];if(g&&typeof v=="object"&&!Array.isArray(v)){g=!1;let w=null;if(v["font-scale"]&&(w=n.parse(v["font-scale"],1,Ae),!w))return null;let T=null;if(v["text-font"]&&(T=n.parse(v["text-font"],1,L(ft)),!T))return null;let E=null;if(v["text-color"]&&(E=n.parse(v["text-color"],1,rn),!E))return null;const M=h[h.length-1];M.scale=w,M.font=T,M.textColor=E}else{const w=n.parse(t[_],1,ht);if(!w)return null;const T=w.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new ga(h)}evaluate(t){return new gn(this.sections.map(n=>{const o=n.content.evaluate(t);return bi(o)===cr?new wl("",o,null,null,null):new wl(To(o),null,n.scale?n.scale.evaluate(t):null,n.font?n.font.evaluate(t).join(","):null,n.textColor?n.textColor.evaluate(t):null)}))}eachChild(t){for(const n of this.sections)t(n.content),n.scale&&t(n.scale),n.font&&t(n.font),n.textColor&&t(n.textColor)}outputDefined(){return!1}}class Pl{constructor(t){this.type=cr,this.input=t}static parse(t,n){if(t.length!==2)return n.error("Expected two arguments.");const o=n.parse(t[1],1,ft);return o?new Pl(o):n.error("No image name provided.")}evaluate(t){const n=this.input.evaluate(t),o=yn.fromString(n);return o&&t.availableImages&&(o.available=t.availableImages.indexOf(n)>-1),o}eachChild(t){t(this.input)}outputDefined(){return!1}}class Ml{constructor(t){this.type=Ae,this.input=t}static parse(t,n){if(t.length!==2)return n.error(`Expected 1 argument, but found ${t.length-1} instead.`);const o=n.parse(t[1],1);return o?o.type.kind!=="array"&&o.type.kind!=="string"&&o.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${D(o.type)} instead.`):new Ml(o):null}evaluate(t){const n=this.input.evaluate(t);if(typeof n=="string")return[...n].length;if(Array.isArray(n))return n.length;throw new _i(`Expected value to be of type string or array, but found ${D(bi(n))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}}const ur=8192;function Ah(i,t){const n=(180+i[0])/360,o=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(n*h*ur),Math.round(o*h*ur)]}function kl(i,t){const n=Math.pow(2,t.z);return[(h=(i[0]/ur+t.x)/n,360*h-180),(o=(i[1]/ur+t.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90)];var o,h}function Jr(i,t){i[0]=Math.min(i[0],t[0]),i[1]=Math.min(i[1],t[1]),i[2]=Math.max(i[2],t[0]),i[3]=Math.max(i[3],t[1])}function Br(i,t){return!(i[0]<=t[0]||i[2]>=t[2]||i[1]<=t[1]||i[3]>=t[3])}function Dt(i,t,n){const o=i[0]-t[0],h=i[1]-t[1],g=i[0]-n[0],_=i[1]-n[1];return o*_-g*h==0&&o*g<=0&&h*_<=0}function _a(i,t,n,o){return(h=[o[0]-n[0],o[1]-n[1]])[0]*(g=[t[0]-i[0],t[1]-i[1]])[1]-h[1]*g[0]!=0&&!(!au(i,t,n,o)||!au(n,o,i,t));var h,g}function zh(i,t,n){for(const o of n)for(let h=0;h<o.length-1;++h)if(_a(i,t,o[h],o[h+1]))return!0;return!1}function Ms(i,t,n=!1){let o=!1;for(const v of t)for(let w=0;w<v.length-1;w++){if(Dt(i,v[w],v[w+1]))return n;(g=v[w])[1]>(h=i)[1]!=(_=v[w+1])[1]>h[1]&&h[0]<(_[0]-g[0])*(h[1]-g[1])/(_[1]-g[1])+g[0]&&(o=!o)}var h,g,_;return o}function Dh(i,t){for(const n of t)if(Ms(i,n))return!0;return!1}function ou(i,t){for(const n of i)if(!Ms(n,t))return!1;for(let n=0;n<i.length-1;++n)if(zh(i[n],i[n+1],t))return!1;return!0}function Lh(i,t){for(const n of t)if(ou(i,n))return!0;return!1}function au(i,t,n,o){const h=o[0]-n[0],g=o[1]-n[1],_=(i[0]-n[0])*g-h*(i[1]-n[1]),v=(t[0]-n[0])*g-h*(t[1]-n[1]);return _>0&&v<0||_<0&&v>0}function Al(i,t,n){const o=[];for(let h=0;h<i.length;h++){const g=[];for(let _=0;_<i[h].length;_++){const v=Ah(i[h][_],n);Jr(t,v),g.push(v)}o.push(g)}return o}function lu(i,t,n){const o=[];for(let h=0;h<i.length;h++){const g=Al(i[h],t,n);o.push(g)}return o}function cu(i,t,n,o){if(i[0]<n[0]||i[0]>n[2]){const h=.5*o;let g=i[0]-n[0]>h?-o:n[0]-i[0]>h?o:0;g===0&&(g=i[0]-n[2]>h?-o:n[2]-i[0]>h?o:0),i[0]+=g}Jr(t,i)}function uu(i,t,n,o){const h=Math.pow(2,o.z)*ur,g=[o.x*ur,o.y*ur],_=[];for(const v of i)for(const w of v){const T=[w.x+g[0],w.y+g[1]];cu(T,t,n,h),_.push(T)}return _}function hu(i,t,n,o){const h=Math.pow(2,o.z)*ur,g=[o.x*ur,o.y*ur],_=[];for(const w of i){const T=[];for(const E of w){const M=[E.x+g[0],E.y+g[1]];Jr(t,M),T.push(M)}_.push(T)}if(t[2]-t[0]<=h/2){(v=t)[0]=v[1]=1/0,v[2]=v[3]=-1/0;for(const w of _)for(const T of w)cu(T,t,n,h)}var v;return _}class Qr{constructor(t,n){this.type=ot,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Xr(t[1])){const o=t[1];if(o.type==="FeatureCollection"){const h=[];for(const g of o.features){const{type:_,coordinates:v}=g.geometry;_==="Polygon"&&h.push(v),_==="MultiPolygon"&&h.push(...v)}if(h.length)return new Qr(o,{type:"MultiPolygon",coordinates:h})}else if(o.type==="Feature"){const h=o.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new Qr(o,o.geometry)}else if(o.type==="Polygon"||o.type==="MultiPolygon")return new Qr(o,o)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=Al(o.coordinates,g,_),w=uu(n.geometry(),h,g,_);if(!Br(h,g))return!1;for(const T of w)if(!Ms(T,v))return!1}if(o.type==="MultiPolygon"){const v=lu(o.coordinates,g,_),w=uu(n.geometry(),h,g,_);if(!Br(h,g))return!1;for(const T of w)if(!Dh(T,v))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(o.type==="Polygon"){const v=Al(o.coordinates,g,_),w=hu(n.geometry(),h,g,_);if(!Br(h,g))return!1;for(const T of w)if(!ou(T,v))return!1}if(o.type==="MultiPolygon"){const v=lu(o.coordinates,g,_),w=hu(n.geometry(),h,g,_);if(!Br(h,g))return!1;for(const T of w)if(!Lh(T,v))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}let du=class{constructor(i=[],t=(n,o)=>n<o?-1:n>o?1:0){if(this.data=i,this.length=this.data.length,this.compare=t,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(i){this.data.push(i),this._up(this.length++)}pop(){if(this.length===0)return;const i=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),i}peek(){return this.data[0]}_up(i){const{data:t,compare:n}=this,o=t[i];for(;i>0;){const h=i-1>>1,g=t[h];if(n(o,g)>=0)break;t[i]=g,i=h}t[i]=o}_down(i){const{data:t,compare:n}=this,o=this.length>>1,h=t[i];for(;i<o;){let g=1+(i<<1);const _=g+1;if(_<this.length&&n(t[_],t[g])<0&&(g=_),n(t[g],h)>=0)break;t[i]=t[g],i=g}t[i]=h}};function Rh(i,t,n,o,h){pu(i,t,n,o||i.length-1,h||Bh)}function pu(i,t,n,o,h){for(;o>n;){if(o-n>600){var g=o-n+1,_=t-n+1,v=Math.log(g),w=.5*Math.exp(2*v/3),T=.5*Math.sqrt(v*w*(g-w)/g)*(_-g/2<0?-1:1);pu(i,t,Math.max(n,Math.floor(t-_*w/g+T)),Math.min(o,Math.floor(t+(g-_)*w/g+T)),h)}var E=i[t],M=n,z=o;for(ko(i,n,t),h(i[o],E)>0&&ko(i,n,o);M<z;){for(ko(i,M,z),M++,z--;h(i[M],E)<0;)M++;for(;h(i[z],E)>0;)z--}h(i[n],E)===0?ko(i,n,z):ko(i,++z,o),z<=t&&(n=z+1),t<=z&&(o=z-1)}}function ko(i,t,n){var o=i[t];i[t]=i[n],i[n]=o}function Bh(i,t){return i<t?-1:i>t?1:0}function ya(i,t){if(i.length<=1)return[i];const n=[];let o,h;for(const g of i){const _=Oh(g);_!==0&&(g.area=Math.abs(_),h===void 0&&(h=_<0),h===_<0?(o&&n.push(o),o=[g]):o.push(g))}if(o&&n.push(o),t>1)for(let g=0;g<n.length;g++)n[g].length<=t||(Rh(n[g],t,1,n[g].length-1,Fh),n[g]=n[g].slice(0,t));return n}function Fh(i,t){return t.area-i.area}function Oh(i){let t=0;for(let n,o,h=0,g=i.length,_=g-1;h<g;_=h++)n=i[h],o=i[_],t+=(o.x-n.x)*(n.y+o.y);return t}const mu=1/298.257223563,fu=mu*(2-mu),gu=Math.PI/180;class zl{constructor(t){const n=6378.137*gu*1e3,o=Math.cos(t*gu),h=1/(1-fu*(1-o*o)),g=Math.sqrt(h);this.kx=n*g*o,this.ky=n*g*h*(1-fu)}distance(t,n){const o=this.wrap(t[0]-n[0])*this.kx,h=(t[1]-n[1])*this.ky;return Math.sqrt(o*o+h*h)}pointOnLine(t,n){let o,h,g,_,v=1/0;for(let w=0;w<t.length-1;w++){let T=t[w][0],E=t[w][1],M=this.wrap(t[w+1][0]-T)*this.kx,z=(t[w+1][1]-E)*this.ky,R=0;M===0&&z===0||(R=(this.wrap(n[0]-T)*this.kx*M+(n[1]-E)*this.ky*z)/(M*M+z*z),R>1?(T=t[w+1][0],E=t[w+1][1]):R>0&&(T+=M/this.kx*R,E+=z/this.ky*R)),M=this.wrap(n[0]-T)*this.kx,z=(n[1]-E)*this.ky;const N=M*M+z*z;N<v&&(v=N,o=T,h=E,g=w,_=R)}return{point:[o,h],index:g,t:Math.max(0,Math.min(1,_))}}wrap(t){for(;t<-180;)t+=360;for(;t>180;)t-=360;return t}}function _u(i,t){return t[0]-i[0]}function va(i){return i[1]-i[0]+1}function wr(i,t){return i[1]>=i[0]&&i[1]<t}function Dl(i,t){if(i[0]>i[1])return[null,null];const n=va(i);if(t){if(n===2)return[i,null];const h=Math.floor(n/2);return[[i[0],i[0]+h],[i[0]+h,i[1]]]}if(n===1)return[i,null];const o=Math.floor(n/2)-1;return[[i[0],i[0]+o],[i[0]+o+1,i[1]]]}function Ll(i,t){if(!wr(t,i.length))return[1/0,1/0,-1/0,-1/0];const n=[1/0,1/0,-1/0,-1/0];for(let o=t[0];o<=t[1];++o)Jr(n,i[o]);return n}function Rl(i){const t=[1/0,1/0,-1/0,-1/0];for(const n of i)for(const o of n)Jr(t,o);return t}function xa(i){return i[0]!==-1/0&&i[1]!==-1/0&&i[2]!==1/0&&i[3]!==1/0}function Bl(i,t,n){if(!xa(i)||!xa(t))return NaN;let o=0,h=0;return i[2]<t[0]&&(o=t[0]-i[2]),i[0]>t[2]&&(o=i[0]-t[2]),i[1]>t[3]&&(h=i[1]-t[3]),i[3]<t[1]&&(h=t[1]-i[3]),n.distance([0,0],[o,h])}function es(i,t,n){const o=n.pointOnLine(t,i);return n.distance(i,o.point)}function Fl(i,t,n,o,h){const g=Math.min(es(i,[n,o],h),es(t,[n,o],h)),_=Math.min(es(n,[i,t],h),es(o,[i,t],h));return Math.min(g,_)}function Nh(i,t,n,o,h){if(!wr(t,i.length)||!wr(o,n.length))return 1/0;let g=1/0;for(let _=t[0];_<t[1];++_){const v=i[_],w=i[_+1];for(let T=o[0];T<o[1];++T){const E=n[T],M=n[T+1];if(_a(v,w,E,M))return 0;g=Math.min(g,Fl(v,w,E,M,h))}}return g}function mi(i,t,n,o,h){if(!wr(t,i.length)||!wr(o,n.length))return NaN;let g=1/0;for(let _=t[0];_<=t[1];++_)for(let v=o[0];v<=o[1];++v)if(g=Math.min(g,h.distance(i[_],n[v])),g===0)return g;return g}function Vh(i,t,n){if(Ms(i,t,!0))return 0;let o=1/0;for(const h of t){const g=h[0],_=h[h.length-1];if(g!==_&&(o=Math.min(o,es(i,[_,g],n)),o===0))return o;const v=n.pointOnLine(h,i);if(o=Math.min(o,n.distance(i,v.point)),o===0)return o}return o}function yt(i,t,n,o){if(!wr(t,i.length))return NaN;for(let g=t[0];g<=t[1];++g)if(Ms(i[g],n,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g){const _=i[g],v=i[g+1];for(const w of n)for(let T=0,E=w.length,M=E-1;T<E;M=T++){const z=w[M],R=w[T];if(_a(_,v,z,R))return 0;h=Math.min(h,Fl(_,v,z,R,o))}}return h}function ba(i,t){for(const n of i)for(const o of n)if(Ms(o,t,!0))return!0;return!1}function Kt(i,t,n,o=1/0){const h=Rl(i),g=Rl(t);if(o!==1/0&&Bl(h,g,n)>=o)return o;if(Br(h,g)){if(ba(i,t))return 0}else if(ba(t,i))return 0;let _=1/0;for(const v of i)for(let w=0,T=v.length,E=T-1;w<T;E=w++){const M=v[E],z=v[w];for(const R of t)for(let N=0,U=R.length,G=U-1;N<U;G=N++){const J=R[G],de=R[N];if(_a(M,z,J,de))return 0;_=Math.min(_,Fl(M,z,J,de,n))}}return _}function Vt(i,t,n,o,h,g){if(!g)return;const _=Bl(Ll(o,g),h,n);_<t&&i.push([_,g,[0,0]])}function ts(i,t,n,o,h,g,_){if(!g||!_)return;const v=Bl(Ll(o,g),Ll(h,_),n);v<t&&i.push([v,g,_])}function Ao(i,t,n,o,h=1/0){let g=Math.min(o.distance(i[0],n[0][0]),h);if(g===0)return g;const _=new du([[0,[0,i.length-1],[0,0]]],_u),v=Rl(n);for(;_.length>0;){const w=_.pop();if(w[0]>=g)continue;const T=w[1],E=t?50:100;if(va(T)<=E){if(!wr(T,i.length))return NaN;if(t){const M=yt(i,T,n,o);if(isNaN(M)||M===0)return M;g=Math.min(g,M)}else for(let M=T[0];M<=T[1];++M){const z=Vh(i[M],n,o);if(g=Math.min(g,z),g===0)return 0}}else{const M=Dl(T,t);Vt(_,g,o,i,v,M[0]),Vt(_,g,o,i,v,M[1])}}return g}function zo(i,t,n,o,h,g=1/0){let _=Math.min(g,h.distance(i[0],n[0]));if(_===0)return _;const v=new du([[0,[0,i.length-1],[0,n.length-1]]],_u);for(;v.length>0;){const w=v.pop();if(w[0]>=_)continue;const T=w[1],E=w[2],M=t?50:100,z=o?50:100;if(va(T)<=M&&va(E)<=z){if(!wr(T,i.length)&&wr(E,n.length))return NaN;let R;if(t&&o)R=Nh(i,T,n,E,h),_=Math.min(_,R);else if(t&&!o){const N=i.slice(T[0],T[1]+1);for(let U=E[0];U<=E[1];++U)if(R=es(n[U],N,h),_=Math.min(_,R),_===0)return _}else if(!t&&o){const N=n.slice(E[0],E[1]+1);for(let U=T[0];U<=T[1];++U)if(R=es(i[U],N,h),_=Math.min(_,R),_===0)return _}else R=mi(i,T,n,E,h),_=Math.min(_,R)}else{const R=Dl(T,t),N=Dl(E,o);ts(v,_,h,i,n,R[0],N[0]),ts(v,_,h,i,n,R[0],N[1]),ts(v,_,h,i,n,R[1],N[0]),ts(v,_,h,i,n,R[1],N[1])}}return _}function Ol(i){return i.type==="MultiPolygon"?i.coordinates.map(t=>({type:"Polygon",coordinates:t})):i.type==="MultiLineString"?i.coordinates.map(t=>({type:"LineString",coordinates:t})):i.type==="MultiPoint"?i.coordinates.map(t=>({type:"Point",coordinates:t})):[i]}class is{constructor(t,n){this.type=Ae,this.geojson=t,this.geometries=n}static parse(t,n){if(t.length!==2)return n.error(`'distance' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Xr(t[1])){const o=t[1];if(o.type==="FeatureCollection")return new is(o,o.features.map(h=>Ol(h.geometry)).flat());if(o.type==="Feature")return new is(o,Ol(o.geometry));if("type"in o&&"coordinates"in o)return new is(o,Ol(o))}return n.error("'distance' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(n,o){const h=n.geometry(),g=h.flat().map(w=>kl([w.x,w.y],n.canonical));if(h.length===0)return NaN;const _=new zl(g[0][1]);let v=1/0;for(const w of o){switch(w.type){case"Point":v=Math.min(v,zo(g,!1,[w.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,zo(g,!1,w.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Ao(g,!1,w.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="LineString")return function(n,o){const h=n.geometry(),g=h.flat().map(w=>kl([w.x,w.y],n.canonical));if(h.length===0)return NaN;const _=new zl(g[0][1]);let v=1/0;for(const w of o){switch(w.type){case"Point":v=Math.min(v,zo(g,!0,[w.coordinates],!1,_,v));break;case"LineString":v=Math.min(v,zo(g,!0,w.coordinates,!0,_,v));break;case"Polygon":v=Math.min(v,Ao(g,!0,w.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries);if(t.geometryType()==="Polygon")return function(n,o){const h=n.geometry();if(h.length===0||h[0].length===0)return NaN;const g=ya(h,0).map(w=>w.map(T=>T.map(E=>kl([E.x,E.y],n.canonical)))),_=new zl(g[0][0][0][1]);let v=1/0;for(const w of o)for(const T of g){switch(w.type){case"Point":v=Math.min(v,Ao([w.coordinates],!1,T,_,v));break;case"LineString":v=Math.min(v,Ao(w.coordinates,!0,T,_,v));break;case"Polygon":v=Math.min(v,Kt(T,w.coordinates,_,v))}if(v===0)return v}return v}(t,this.geometries)}return NaN}eachChild(){}outputDefined(){return!0}}const ks={"==":Ph,"!=":nu,">":Mh,"<":ru,">=":su,"<=":kh,array:Un,at:Sl,boolean:Un,case:ha,coalesce:ma,collator:Mo,format:ga,image:Pl,in:Il,"index-of":Ts,interpolate:on,"interpolate-hcl":on,"interpolate-lab":on,length:Ml,let:Rr,literal:Vn,match:Tl,number:Un,"number-format":El,object:Un,slice:Eo,step:Es,string:Un,"to-boolean":$n,"to-color":$n,"to-number":$n,"to-string":$n,var:zt,within:Qr,distance:is};class En{constructor(t,n,o,h){this.name=t,this.type=n,this._evaluate=o,this.args=h}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}static parse(t,n){const o=t[0],h=En.definitions[o];if(!h)return n.error(`Unknown expression "${o}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,v=_.filter(([T])=>!Array.isArray(T)||T.length===t.length-1);let w=null;for(const[T,E]of v){w=new Yr(n.registry,Do,n.path,null,n.scope);const M=[];let z=!1;for(let R=1;R<t.length;R++){const N=t[R],U=Array.isArray(T)?T[R-1]:T.type,G=w.parse(N,1+M.length,U);if(!G){z=!0;break}M.push(G)}if(!z)if(Array.isArray(T)&&T.length!==M.length)w.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let R=0;R<M.length;R++){const N=Array.isArray(T)?T[R]:T.type,U=M[R];w.concat(R+1).checkSubtype(N,U.type)}if(w.errors.length===0)return new En(o,g,E,M)}}if(v.length===1)n.errors.push(...w.errors);else{const T=(v.length?v:_).map(([M])=>{return z=M,Array.isArray(z)?`(${z.map(D).join(", ")})`:`(${D(z.type)}...)`;var z}).join(" | "),E=[];for(let M=1;M<t.length;M++){const z=n.parse(t[M],1+E.length);if(!z)return null;E.push(D(z.type))}n.error(`Expected arguments of type ${T}, but found (${E.join(", ")}) instead.`)}return null}static register(t,n){En.definitions=n;for(const o in n)t[o]=En}}function Nl(i,[t,n,o,h]){t=t.evaluate(i),n=n.evaluate(i),o=o.evaluate(i);const g=h?h.evaluate(i):1,_=Is(t,n,o,g);if(_)throw new _i(_);return new Ft(t/255,n/255,o/255,g,!1)}function Vl(i,t){return i in t}function Ul(i,t){const n=t[i];return n===void 0?null:n}function ns(i){return{type:i}}function Do(i){if(i instanceof zt)return Do(i.boundExpression);if(i instanceof En&&i.name==="error"||i instanceof Mo||i instanceof Qr||i instanceof is)return!1;const t=i instanceof $n||i instanceof Un;let n=!0;return i.eachChild(o=>{n=t?n&&Do(o):n&&o instanceof Vn}),!!n&&Lo(i)&&Ro(i,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Lo(i){if(i instanceof En&&(i.name==="get"&&i.args.length===1||i.name==="feature-state"||i.name==="has"&&i.args.length===1||i.name==="properties"||i.name==="geometry-type"||i.name==="id"||/^filter-/.test(i.name))||i instanceof Qr||i instanceof is)return!1;let t=!0;return i.eachChild(n=>{t&&!Lo(n)&&(t=!1)}),t}function As(i){if(i instanceof En&&i.name==="feature-state")return!1;let t=!0;return i.eachChild(n=>{t&&!As(n)&&(t=!1)}),t}function Ro(i,t){if(i instanceof En&&t.indexOf(i.name)>=0)return!1;let n=!0;return i.eachChild(o=>{n&&!Ro(o,t)&&(n=!1)}),n}function wa(i){return{result:"success",value:i}}function zs(i){return{result:"error",value:i}}function Ds(i){return i["property-type"]==="data-driven"||i["property-type"]==="cross-faded-data-driven"}function yu(i){return!!i.expression&&i.expression.parameters.indexOf("zoom")>-1}function $l(i){return!!i.expression&&i.expression.interpolated}function Mt(i){return i instanceof Number?"number":i instanceof String?"string":i instanceof Boolean?"boolean":Array.isArray(i)?"array":i===null?"null":typeof i}function Ca(i){return typeof i=="object"&&i!==null&&!Array.isArray(i)}function Uh(i){return i}function vu(i,t){const n=t.type==="color",o=i.stops&&typeof i.stops[0][0]=="object",h=o||!(o||i.property!==void 0),g=i.type||($l(t)?"exponential":"interval");if(n||t.type==="padding"){const E=n?Ft.parse:_n.parse;(i=or({},i)).stops&&(i.stops=i.stops.map(M=>[M[0],E(M[1])])),i.default=E(i.default?i.default:t.default)}if(i.colorSpace&&(_=i.colorSpace)!=="rgb"&&_!=="hcl"&&_!=="lab")throw new Error(`Unknown color space: "${i.colorSpace}"`);var _;let v,w,T;if(g==="exponential")v=bu;else if(g==="interval")v=Sa;else if(g==="categorical"){v=xu,w=Object.create(null);for(const E of i.stops)w[E[0]]=E[1];T=typeof i.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);v=wu}if(o){const E={},M=[];for(let N=0;N<i.stops.length;N++){const U=i.stops[N],G=U[0].zoom;E[G]===void 0&&(E[G]={zoom:G,type:i.type,property:i.property,default:i.default,stops:[]},M.push(G)),E[G].stops.push([U[0].value,U[1]])}const z=[];for(const N of M)z.push([E[N].zoom,vu(E[N],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:on.interpolationFactor.bind(void 0,R),zoomStops:z.map(N=>N[0]),evaluate:({zoom:N},U)=>bu({stops:z,base:i.base},t,N).evaluate(N,U)}}if(h){const E=g==="exponential"?{name:"exponential",base:i.base!==void 0?i.base:1}:null;return{kind:"camera",interpolationType:E,interpolationFactor:on.interpolationFactor.bind(void 0,E),zoomStops:i.stops.map(M=>M[0]),evaluate:({zoom:M})=>v(i,t,M,w,T)}}return{kind:"source",evaluate(E,M){const z=M&&M.properties?M.properties[i.property]:void 0;return z===void 0?Ls(i.default,t.default):v(i,t,z,w,T)}}}function Ls(i,t,n){return i!==void 0?i:t!==void 0?t:n!==void 0?n:void 0}function xu(i,t,n,o,h){return Ls(typeof n===h?o[n]:void 0,i.default,t.default)}function Sa(i,t,n){if(Mt(n)!=="number")return Ls(i.default,t.default);const o=i.stops.length;if(o===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[o-1][0])return i.stops[o-1][1];const h=da(i.stops.map(g=>g[0]),n);return i.stops[h][1]}function bu(i,t,n){const o=i.base!==void 0?i.base:1;if(Mt(n)!=="number")return Ls(i.default,t.default);const h=i.stops.length;if(h===1||n<=i.stops[0][0])return i.stops[0][1];if(n>=i.stops[h-1][0])return i.stops[h-1][1];const g=da(i.stops.map(E=>E[0]),n),_=function(E,M,z,R){const N=R-z,U=E-z;return N===0?0:M===1?U/N:(Math.pow(M,U)-1)/(Math.pow(M,N)-1)}(n,o,i.stops[g][0],i.stops[g+1][0]),v=i.stops[g][1],w=i.stops[g+1][1],T=sn[t.type]||Uh;return typeof v.evaluate=="function"?{evaluate(...E){const M=v.evaluate.apply(void 0,E),z=w.evaluate.apply(void 0,E);if(M!==void 0&&z!==void 0)return T(M,z,_,i.colorSpace)}}:T(v,w,_,i.colorSpace)}function wu(i,t,n){switch(t.type){case"color":n=Ft.parse(n);break;case"formatted":n=gn.fromString(n.toString());break;case"resolvedImage":n=yn.fromString(n.toString());break;case"padding":n=_n.parse(n);break;default:Mt(n)===t.type||t.type==="enum"&&t.values[n]||(n=void 0)}return Ls(n,i.default,t.default)}En.register(ks,{error:[{kind:"error"},[ft],(i,[t])=>{throw new _i(t.evaluate(i))}],typeof:[ft,[ht],(i,[t])=>D(bi(t.evaluate(i)))],"to-rgba":[L(Ae,4),[rn],(i,[t])=>{const[n,o,h,g]=t.evaluate(i).rgb;return[255*n,255*o,255*h,g]}],rgb:[rn,[Ae,Ae,Ae],Nl],rgba:[rn,[Ae,Ae,Ae,Ae],Nl],has:{type:ot,overloads:[[[ft],(i,[t])=>Vl(t.evaluate(i),i.properties())],[[ft,Nn],(i,[t,n])=>Vl(t.evaluate(i),n.evaluate(i))]]},get:{type:ht,overloads:[[[ft],(i,[t])=>Ul(t.evaluate(i),i.properties())],[[ft,Nn],(i,[t,n])=>Ul(t.evaluate(i),n.evaluate(i))]]},"feature-state":[ht,[ft],(i,[t])=>Ul(t.evaluate(i),i.featureState||{})],properties:[Nn,[],i=>i.properties()],"geometry-type":[ft,[],i=>i.geometryType()],id:[ht,[],i=>i.id()],zoom:[Ae,[],i=>i.globals.zoom],"heatmap-density":[Ae,[],i=>i.globals.heatmapDensity||0],"line-progress":[Ae,[],i=>i.globals.lineProgress||0],accumulated:[ht,[],i=>i.globals.accumulated===void 0?null:i.globals.accumulated],"+":[Ae,ns(Ae),(i,t)=>{let n=0;for(const o of t)n+=o.evaluate(i);return n}],"*":[Ae,ns(Ae),(i,t)=>{let n=1;for(const o of t)n*=o.evaluate(i);return n}],"-":{type:Ae,overloads:[[[Ae,Ae],(i,[t,n])=>t.evaluate(i)-n.evaluate(i)],[[Ae],(i,[t])=>-t.evaluate(i)]]},"/":[Ae,[Ae,Ae],(i,[t,n])=>t.evaluate(i)/n.evaluate(i)],"%":[Ae,[Ae,Ae],(i,[t,n])=>t.evaluate(i)%n.evaluate(i)],ln2:[Ae,[],()=>Math.LN2],pi:[Ae,[],()=>Math.PI],e:[Ae,[],()=>Math.E],"^":[Ae,[Ae,Ae],(i,[t,n])=>Math.pow(t.evaluate(i),n.evaluate(i))],sqrt:[Ae,[Ae],(i,[t])=>Math.sqrt(t.evaluate(i))],log10:[Ae,[Ae],(i,[t])=>Math.log(t.evaluate(i))/Math.LN10],ln:[Ae,[Ae],(i,[t])=>Math.log(t.evaluate(i))],log2:[Ae,[Ae],(i,[t])=>Math.log(t.evaluate(i))/Math.LN2],sin:[Ae,[Ae],(i,[t])=>Math.sin(t.evaluate(i))],cos:[Ae,[Ae],(i,[t])=>Math.cos(t.evaluate(i))],tan:[Ae,[Ae],(i,[t])=>Math.tan(t.evaluate(i))],asin:[Ae,[Ae],(i,[t])=>Math.asin(t.evaluate(i))],acos:[Ae,[Ae],(i,[t])=>Math.acos(t.evaluate(i))],atan:[Ae,[Ae],(i,[t])=>Math.atan(t.evaluate(i))],min:[Ae,ns(Ae),(i,t)=>Math.min(...t.map(n=>n.evaluate(i)))],max:[Ae,ns(Ae),(i,t)=>Math.max(...t.map(n=>n.evaluate(i)))],abs:[Ae,[Ae],(i,[t])=>Math.abs(t.evaluate(i))],round:[Ae,[Ae],(i,[t])=>{const n=t.evaluate(i);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ae,[Ae],(i,[t])=>Math.floor(t.evaluate(i))],ceil:[Ae,[Ae],(i,[t])=>Math.ceil(t.evaluate(i))],"filter-==":[ot,[ft,ht],(i,[t,n])=>i.properties()[t.value]===n.value],"filter-id-==":[ot,[ht],(i,[t])=>i.id()===t.value],"filter-type-==":[ot,[ft],(i,[t])=>i.geometryType()===t.value],"filter-<":[ot,[ft,ht],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o<h}],"filter-id-<":[ot,[ht],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<o}],"filter->":[ot,[ft,ht],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o>h}],"filter-id->":[ot,[ht],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>o}],"filter-<=":[ot,[ft,ht],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o<=h}],"filter-id-<=":[ot,[ht],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n<=o}],"filter->=":[ot,[ft,ht],(i,[t,n])=>{const o=i.properties()[t.value],h=n.value;return typeof o==typeof h&&o>=h}],"filter-id->=":[ot,[ht],(i,[t])=>{const n=i.id(),o=t.value;return typeof n==typeof o&&n>=o}],"filter-has":[ot,[ht],(i,[t])=>t.value in i.properties()],"filter-has-id":[ot,[],i=>i.id()!==null&&i.id()!==void 0],"filter-type-in":[ot,[L(ft)],(i,[t])=>t.value.indexOf(i.geometryType())>=0],"filter-id-in":[ot,[L(ht)],(i,[t])=>t.value.indexOf(i.id())>=0],"filter-in-small":[ot,[ft,L(ht)],(i,[t,n])=>n.value.indexOf(i.properties()[t.value])>=0],"filter-in-large":[ot,[ft,L(ht)],(i,[t,n])=>function(o,h,g,_){for(;g<=_;){const v=g+_>>1;if(h[v]===o)return!0;h[v]>o?_=v-1:g=v+1}return!1}(i.properties()[t.value],n.value,0,n.value.length-1)],all:{type:ot,overloads:[[[ot,ot],(i,[t,n])=>t.evaluate(i)&&n.evaluate(i)],[ns(ot),(i,t)=>{for(const n of t)if(!n.evaluate(i))return!1;return!0}]]},any:{type:ot,overloads:[[[ot,ot],(i,[t,n])=>t.evaluate(i)||n.evaluate(i)],[ns(ot),(i,t)=>{for(const n of t)if(n.evaluate(i))return!0;return!1}]]},"!":[ot,[ot],(i,[t])=>!t.evaluate(i)],"is-supported-script":[ot,[ft],(i,[t])=>{const n=i.globals&&i.globals.isSupportedScript;return!n||n(t.evaluate(i))}],upcase:[ft,[ft],(i,[t])=>t.evaluate(i).toUpperCase()],downcase:[ft,[ft],(i,[t])=>t.evaluate(i).toLowerCase()],concat:[ft,ns(ht),(i,t)=>t.map(n=>To(n.evaluate(i))).join("")],"resolved-locale":[ft,[lr],(i,[t])=>t.evaluate(i).resolvedLocale()]});class Ia{constructor(t,n){var o;this.expression=t,this._warningHistory={},this._evaluator=new ua,this._defaultValue=n?(o=n).type==="color"&&Ca(o.default)?new Ft(0,0,0,0):o.type==="color"?Ft.parse(o.default)||null:o.type==="padding"?_n.parse(o.default)||null:o.type==="variableAnchorOffsetCollection"?Tn.parse(o.default)||null:o.default===void 0?null:o.default:null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(t,n,o,h,g,_){return this._evaluator.globals=t,this._evaluator.feature=n,this._evaluator.featureState=o,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this.expression.evaluate(this._evaluator)}evaluate(t,n,o,h,g,_){this._evaluator.globals=t,this._evaluator.feature=n||null,this._evaluator.featureState=o||null,this._evaluator.canonical=h,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null;try{const v=this.expression.evaluate(this._evaluator);if(v==null||typeof v=="number"&&v!=v)return this._defaultValue;if(this._enumValues&&!(v in this._enumValues))throw new _i(`Expected value to be one of ${Object.keys(this._enumValues).map(w=>JSON.stringify(w)).join(", ")}, but found ${JSON.stringify(v)} instead.`);return v}catch(v){return this._warningHistory[v.message]||(this._warningHistory[v.message]=!0,typeof console<"u"&&console.warn(v.message)),this._defaultValue}}}function Ta(i){return Array.isArray(i)&&i.length>0&&typeof i[0]=="string"&&i[0]in ks}function Rs(i,t){const n=new Yr(ks,Do,[],t?function(h){const g={color:rn,string:ft,number:Ae,enum:ft,boolean:ot,formatted:br,padding:Lr,resolvedImage:cr,variableAnchorOffsetCollection:K};return h.type==="array"?L(g[h.value]||ht,h.length):g[h.type]}(t):void 0),o=n.parse(i,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return o?wa(new Ia(o,t)):zs(n.errors)}class Bs{constructor(t,n){this.kind=t,this._styleExpression=n,this.isStateDependent=t!=="constant"&&!As(n.expression)}evaluateWithoutErrorHandling(t,n,o,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,h,g,_)}evaluate(t,n,o,h,g,_){return this._styleExpression.evaluate(t,n,o,h,g,_)}}class Fs{constructor(t,n,o,h){this.kind=t,this.zoomStops=o,this._styleExpression=n,this.isStateDependent=t!=="camera"&&!As(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,n,o,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(t,n,o,h,g,_)}evaluate(t,n,o,h,g,_){return this._styleExpression.evaluate(t,n,o,h,g,_)}interpolationFactor(t,n,o){return this.interpolationType?on.interpolationFactor(this.interpolationType,t,n,o):0}}function jl(i,t){const n=Rs(i,t);if(n.result==="error")return n;const o=n.value.expression,h=Lo(o);if(!h&&!Ds(t))return zs([new Ki("","data expressions not supported")]);const g=Ro(o,["zoom"]);if(!g&&!yu(t))return zs([new Ki("","zoom expressions not supported")]);const _=Bo(o);return _||g?_ instanceof Ki?zs([_]):_ instanceof on&&!$l(t)?zs([new Ki("",'"interpolate" expressions cannot be used with this property')]):wa(_?new Fs(h?"camera":"composite",n.value,_.labels,_ instanceof on?_.interpolation:void 0):new Bs(h?"constant":"source",n.value)):zs([new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Os{constructor(t,n){this._parameters=t,this._specification=n,or(this,vu(this._parameters,this._specification))}static deserialize(t){return new Os(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Bo(i){let t=null;if(i instanceof Rr)t=Bo(i.result);else if(i instanceof ma){for(const n of i.args)if(t=Bo(n),t)break}else(i instanceof Es||i instanceof on)&&i.input instanceof En&&i.input.name==="zoom"&&(t=i);return t instanceof Ki||i.eachChild(n=>{const o=Bo(n);o instanceof Ki?t=o:!t&&o?t=new Ki("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):t&&o&&t!==o&&(t=new Ki("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}function Ea(i){if(i===!0||i===!1)return!0;if(!Array.isArray(i)||i.length===0)return!1;switch(i[0]){case"has":return i.length>=2&&i[1]!=="$id"&&i[1]!=="$type";case"in":return i.length>=3&&(typeof i[1]!="string"||Array.isArray(i[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return i.length!==3||Array.isArray(i[1])||Array.isArray(i[2]);case"any":case"all":for(const t of i.slice(1))if(!Ea(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}const Pa={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function ql(i){if(i==null)return{filter:()=>!0,needGeometry:!1};Ea(i)||(i=Ma(i));const t=Rs(i,Pa);if(t.result==="error")throw new Error(t.value.map(n=>`${n.key}: ${n.message}`).join(", "));return{filter:(n,o,h)=>t.value.evaluate(n,o,{},h),needGeometry:Cu(i)}}function $h(i,t){return i<t?-1:i>t?1:0}function Cu(i){if(!Array.isArray(i))return!1;if(i[0]==="within"||i[0]==="distance")return!0;for(let t=1;t<i.length;t++)if(Cu(i[t]))return!0;return!1}function Ma(i){if(!i)return!0;const t=i[0];return i.length<=1?t!=="any":t==="=="?Hl(i[1],i[2],"=="):t==="!="?Ui(Hl(i[1],i[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Hl(i[1],i[2],t):t==="any"?(n=i.slice(1),["any"].concat(n.map(Ma))):t==="all"?["all"].concat(i.slice(1).map(Ma)):t==="none"?["all"].concat(i.slice(1).map(Ma).map(Ui)):t==="in"?Fo(i[1],i.slice(2)):t==="!in"?Ui(Fo(i[1],i.slice(2))):t==="has"?Oo(i[1]):t!=="!has"||Ui(Oo(i[1]));var n}function Hl(i,t,n){switch(i){case"$type":return[`filter-type-${n}`,t];case"$id":return[`filter-id-${n}`,t];default:return[`filter-${n}`,i,t]}}function Fo(i,t){if(t.length===0)return!1;switch(i){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(n=>typeof n!=typeof t[0])?["filter-in-large",i,["literal",t.sort($h)]]:["filter-in-small",i,["literal",t]]}}function Oo(i){switch(i){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",i]}}function Ui(i){return["!",i]}function rs(i){const t=typeof i;if(t==="number"||t==="boolean"||t==="string"||i==null)return JSON.stringify(i);if(Array.isArray(i)){let h="[";for(const g of i)h+=`${rs(g)},`;return`${h}]`}const n=Object.keys(i).sort();let o="{";for(let h=0;h<n.length;h++)o+=`${JSON.stringify(n[h])}:${rs(i[n[h]])},`;return`${o}}`}function Su(i){let t="";for(const n of Gr)t+=`/${rs(i[n])}`;return t}function Iu(i){const t=i.value;return t?[new Ee(i.key,t,"constants have been deprecated as of v8")]:[]}function fi(i){return i instanceof Number||i instanceof String||i instanceof Boolean?i.valueOf():i}function jn(i){if(Array.isArray(i))return i.map(jn);if(i instanceof Object&&!(i instanceof Number||i instanceof String||i instanceof Boolean)){const t={};for(const n in i)t[n]=jn(i[n]);return t}return fi(i)}function vn(i){const t=i.key,n=i.value,o=i.valueSpec||{},h=i.objectElementValidators||{},g=i.style,_=i.styleSpec,v=i.validateSpec;let w=[];const T=Mt(n);if(T!=="object")return[new Ee(t,n,`object expected, ${T} found`)];for(const E in n){const M=E.split(".")[0],z=o[M]||o["*"];let R;if(h[M])R=h[M];else if(o[M])R=v;else if(h["*"])R=h["*"];else{if(!o["*"]){w.push(new Ee(t,n[E],`unknown property "${E}"`));continue}R=v}w=w.concat(R({key:(t&&`${t}.`)+E,value:n[E],valueSpec:z,style:g,styleSpec:_,object:n,objectKey:E,validateSpec:v},n))}for(const E in o)h[E]||o[E].required&&o[E].default===void 0&&n[E]===void 0&&w.push(new Ee(t,n,`missing required property "${E}"`));return w}function No(i){const t=i.value,n=i.valueSpec,o=i.style,h=i.styleSpec,g=i.key,_=i.arrayElementValidator||i.validateSpec;if(Mt(t)!=="array")return[new Ee(g,t,`array expected, ${Mt(t)} found`)];if(n.length&&t.length!==n.length)return[new Ee(g,t,`array length ${n.length} expected, length ${t.length} found`)];if(n["min-length"]&&t.length<n["min-length"])return[new Ee(g,t,`array length at least ${n["min-length"]} expected, length ${t.length} found`)];let v={type:n.value,values:n.values};h.$version<7&&(v.function=n.function),Mt(n.value)==="object"&&(v=n.value);let w=[];for(let T=0;T<t.length;T++)w=w.concat(_({array:t,arrayIndex:T,value:t[T],valueSpec:v,validateSpec:i.validateSpec,style:o,styleSpec:h,key:`${g}[${T}]`}));return w}function Wl(i){const t=i.key,n=i.value,o=i.valueSpec;let h=Mt(n);return h==="number"&&n!=n&&(h="NaN"),h!=="number"?[new Ee(t,n,`number expected, ${h} found`)]:"minimum"in o&&n<o.minimum?[new Ee(t,n,`${n} is less than the minimum value ${o.minimum}`)]:"maximum"in o&&n>o.maximum?[new Ee(t,n,`${n} is greater than the maximum value ${o.maximum}`)]:[]}function ka(i){const t=i.valueSpec,n=fi(i.value.type);let o,h,g,_={};const v=n!=="categorical"&&i.value.property===void 0,w=!v,T=Mt(i.value.stops)==="array"&&Mt(i.value.stops[0])==="array"&&Mt(i.value.stops[0][0])==="object",E=vn({key:i.key,value:i.value,valueSpec:i.styleSpec.function,validateSpec:i.validateSpec,style:i.style,styleSpec:i.styleSpec,objectElementValidators:{stops:function(R){if(n==="identity")return[new Ee(R.key,R.value,'identity function may not have a "stops" property')];let N=[];const U=R.value;return N=N.concat(No({key:R.key,value:U,valueSpec:R.valueSpec,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,arrayElementValidator:M})),Mt(U)==="array"&&U.length===0&&N.push(new Ee(R.key,U,"array must have at least one stop")),N},default:function(R){return R.validateSpec({key:R.key,value:R.value,valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec})}}});return n==="identity"&&v&&E.push(new Ee(i.key,i.value,'missing required property "property"')),n==="identity"||i.value.stops||E.push(new Ee(i.key,i.value,'missing required property "stops"')),n==="exponential"&&i.valueSpec.expression&&!$l(i.valueSpec)&&E.push(new Ee(i.key,i.value,"exponential functions not supported")),i.styleSpec.$version>=8&&(w&&!Ds(i.valueSpec)?E.push(new Ee(i.key,i.value,"property functions not supported")):v&&!yu(i.valueSpec)&&E.push(new Ee(i.key,i.value,"zoom functions not supported"))),n!=="categorical"&&!T||i.value.property!==void 0||E.push(new Ee(i.key,i.value,'"property" property is required')),E;function M(R){let N=[];const U=R.value,G=R.key;if(Mt(U)!=="array")return[new Ee(G,U,`array expected, ${Mt(U)} found`)];if(U.length!==2)return[new Ee(G,U,`array length 2 expected, length ${U.length} found`)];if(T){if(Mt(U[0])!=="object")return[new Ee(G,U,`object expected, ${Mt(U[0])} found`)];if(U[0].zoom===void 0)return[new Ee(G,U,"object stop key must have zoom")];if(U[0].value===void 0)return[new Ee(G,U,"object stop key must have value")];if(g&&g>fi(U[0].zoom))return[new Ee(G,U[0].zoom,"stop zoom values must appear in ascending order")];fi(U[0].zoom)!==g&&(g=fi(U[0].zoom),h=void 0,_={}),N=N.concat(vn({key:`${G}[0]`,value:U[0],valueSpec:{zoom:{}},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec,objectElementValidators:{zoom:Wl,value:z}}))}else N=N.concat(z({key:`${G}[0]`,value:U[0],valueSpec:{},validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec},U));return Ta(jn(U[1]))?N.concat([new Ee(`${G}[1]`,U[1],"expressions are not allowed in function stops.")]):N.concat(R.validateSpec({key:`${G}[1]`,value:U[1],valueSpec:t,validateSpec:R.validateSpec,style:R.style,styleSpec:R.styleSpec}))}function z(R,N){const U=Mt(R.value),G=fi(R.value),J=R.value!==null?R.value:N;if(o){if(U!==o)return[new Ee(R.key,J,`${U} stop domain type must match previous stop domain type ${o}`)]}else o=U;if(U!=="number"&&U!=="string"&&U!=="boolean")return[new Ee(R.key,J,"stop domain value must be a number, string, or boolean")];if(U!=="number"&&n!=="categorical"){let de=`number expected, ${U} found`;return Ds(t)&&n===void 0&&(de+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ee(R.key,J,de)]}return n!=="categorical"||U!=="number"||isFinite(G)&&Math.floor(G)===G?n!=="categorical"&&U==="number"&&h!==void 0&&G<h?[new Ee(R.key,J,"stop domain values must appear in ascending order")]:(h=G,n==="categorical"&&G in _?[new Ee(R.key,J,"stop domain values must be unique")]:(_[G]=!0,[])):[new Ee(R.key,J,`integer expected, found ${G}`)]}}function Ns(i){const t=(i.expressionContext==="property"?jl:Rs)(jn(i.value),i.valueSpec);if(t.result==="error")return t.value.map(o=>new Ee(`${i.key}${o.key}`,i.value,o.message));const n=t.value.expression||t.value._styleExpression.expression;if(i.expressionContext==="property"&&i.propertyKey==="text-font"&&!n.outputDefined())return[new Ee(i.key,i.value,`Invalid data expression for "${i.propertyKey}". Output values must be contained as literals within the expression.`)];if(i.expressionContext==="property"&&i.propertyType==="layout"&&!As(n))return[new Ee(i.key,i.value,'"feature-state" data expressions are not supported with layout properties.')];if(i.expressionContext==="filter"&&!As(n))return[new Ee(i.key,i.value,'"feature-state" data expressions are not supported with filters.')];if(i.expressionContext&&i.expressionContext.indexOf("cluster")===0){if(!Ro(n,["zoom","feature-state"]))return[new Ee(i.key,i.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(i.expressionContext==="cluster-initial"&&!Lo(n))return[new Ee(i.key,i.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Cr(i){const t=i.key,n=i.value,o=i.valueSpec,h=[];return Array.isArray(o.values)?o.values.indexOf(fi(n))===-1&&h.push(new Ee(t,n,`expected one of [${o.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(o.values).indexOf(fi(n))===-1&&h.push(new Ee(t,n,`expected one of [${Object.keys(o.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function Zl(i){return Ea(jn(i.value))?Ns(or({},i,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Aa(i)}function Aa(i){const t=i.value,n=i.key;if(Mt(t)!=="array")return[new Ee(n,t,`array expected, ${Mt(t)} found`)];const o=i.styleSpec;let h,g=[];if(t.length<1)return[new Ee(n,t,"filter array must have at least 1 element")];switch(g=g.concat(Cr({key:`${n}[0]`,value:t[0],valueSpec:o.filter_operator,style:i.style,styleSpec:i.styleSpec})),fi(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&fi(t[1])==="$type"&&g.push(new Ee(n,t,`"$type" cannot be use with operator "${t[0]}"`));case"==":case"!=":t.length!==3&&g.push(new Ee(n,t,`filter array for operator "${t[0]}" must have 3 elements`));case"in":case"!in":t.length>=2&&(h=Mt(t[1]),h!=="string"&&g.push(new Ee(`${n}[1]`,t[1],`string expected, ${h} found`)));for(let _=2;_<t.length;_++)h=Mt(t[_]),fi(t[1])==="$type"?g=g.concat(Cr({key:`${n}[${_}]`,value:t[_],valueSpec:o.geometry_type,style:i.style,styleSpec:i.styleSpec})):h!=="string"&&h!=="number"&&h!=="boolean"&&g.push(new Ee(`${n}[${_}]`,t[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<t.length;_++)g=g.concat(Aa({key:`${n}[${_}]`,value:t[_],style:i.style,styleSpec:i.styleSpec}));break;case"has":case"!has":h=Mt(t[1]),t.length!==2?g.push(new Ee(n,t,`filter array for "${t[0]}" operator must have 2 elements`)):h!=="string"&&g.push(new Ee(`${n}[1]`,t[1],`string expected, ${h} found`))}return g}function Gl(i,t){const n=i.key,o=i.validateSpec,h=i.style,g=i.styleSpec,_=i.value,v=i.objectKey,w=g[`${t}_${i.layerType}`];if(!w)return[];const T=v.match(/^(.*)-transition$/);if(t==="paint"&&T&&w[T[1]]&&w[T[1]].transition)return o({key:n,value:_,valueSpec:g.transition,style:h,styleSpec:g});const E=i.valueSpec||w[v];if(!E)return[new Ee(n,_,`unknown property "${v}"`)];let M;if(Mt(_)==="string"&&Ds(E)&&!E.tokens&&(M=/^{([^}]+)}$/.exec(_)))return[new Ee(n,_,`"${v}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const z=[];return i.layerType==="symbol"&&(v==="text-field"&&h&&!h.glyphs&&z.push(new Ee(n,_,'use of "text-field" requires a style "glyphs" property')),v==="text-font"&&Ca(jn(_))&&fi(_.type)==="identity"&&z.push(new Ee(n,_,'"text-font" does not support identity functions'))),z.concat(o({key:i.key,value:_,valueSpec:E,style:h,styleSpec:g,expressionContext:"property",propertyType:t,propertyKey:v}))}function za(i){return Gl(i,"paint")}function Xl(i){return Gl(i,"layout")}function Yl(i){let t=[];const n=i.value,o=i.key,h=i.style,g=i.styleSpec;n.type||n.ref||t.push(new Ee(o,n,'either "type" or "ref" is required'));let _=fi(n.type);const v=fi(n.ref);if(n.id){const w=fi(n.id);for(let T=0;T<i.arrayIndex;T++){const E=h.layers[T];fi(E.id)===w&&t.push(new Ee(o,n.id,`duplicate layer id "${n.id}", previously used at line ${E.id.__line__}`))}}if("ref"in n){let w;["type","source","source-layer","filter","layout"].forEach(T=>{T in n&&t.push(new Ee(o,n[T],`"${T}" is prohibited for ref layers`))}),h.layers.forEach(T=>{fi(T.id)===v&&(w=T)}),w?w.ref?t.push(new Ee(o,n.ref,"ref cannot reference another ref layer")):_=fi(w.type):t.push(new Ee(o,n.ref,`ref layer "${v}" not found`))}else if(_!=="background")if(n.source){const w=h.sources&&h.sources[n.source],T=w&&fi(w.type);w?T==="vector"&&_==="raster"?t.push(new Ee(o,n.source,`layer "${n.id}" requires a raster source`)):T!=="raster-dem"&&_==="hillshade"?t.push(new Ee(o,n.source,`layer "${n.id}" requires a raster-dem source`)):T==="raster"&&_!=="raster"?t.push(new Ee(o,n.source,`layer "${n.id}" requires a vector source`)):T!=="vector"||n["source-layer"]?T==="raster-dem"&&_!=="hillshade"?t.push(new Ee(o,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):_!=="line"||!n.paint||!n.paint["line-gradient"]||T==="geojson"&&w.lineMetrics||t.push(new Ee(o,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):t.push(new Ee(o,n,`layer "${n.id}" must specify a "source-layer"`)):t.push(new Ee(o,n.source,`source "${n.source}" not found`))}else t.push(new Ee(o,n,'missing required property "source"'));return t=t.concat(vn({key:o,value:n,valueSpec:g.layer,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,objectElementValidators:{"*":()=>[],type:()=>i.validateSpec({key:`${o}.type`,value:n.type,valueSpec:g.layer.type,style:i.style,styleSpec:i.styleSpec,validateSpec:i.validateSpec,object:n,objectKey:"type"}),filter:Zl,layout:w=>vn({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":T=>Xl(or({layerType:_},T))}}),paint:w=>vn({layer:n,key:w.key,value:w.value,style:w.style,styleSpec:w.styleSpec,validateSpec:w.validateSpec,objectElementValidators:{"*":T=>za(or({layerType:_},T))}})}})),t}function ss(i){const t=i.value,n=i.key,o=Mt(t);return o!=="string"?[new Ee(n,t,`string expected, ${o} found`)]:[]}const Da={promoteId:function({key:i,value:t}){if(Mt(t)==="string")return ss({key:i,value:t});{const n=[];for(const o in t)n.push(...ss({key:`${i}.${o}`,value:t[o]}));return n}}};function Vo(i){const t=i.value,n=i.key,o=i.styleSpec,h=i.style,g=i.validateSpec;if(!t.type)return[new Ee(n,t,'"type" is required')];const _=fi(t.type);let v;switch(_){case"vector":case"raster":return v=vn({key:n,value:t,valueSpec:o[`source_${_.replace("-","_")}`],style:i.style,styleSpec:o,objectElementValidators:Da,validateSpec:g}),v;case"raster-dem":return v=function(w){var T;const E=(T=w.sourceName)!==null&&T!==void 0?T:"",M=w.value,z=w.styleSpec,R=z.source_raster_dem,N=w.style;let U=[];const G=Mt(M);if(M===void 0)return U;if(G!=="object")return U.push(new Ee("source_raster_dem",M,`object expected, ${G} found`)),U;const J=fi(M.encoding)==="custom",de=["redFactor","greenFactor","blueFactor","baseShift"],re=w.value.encoding?`"${w.value.encoding}"`:"Default";for(const ue in M)!J&&de.includes(ue)?U.push(new Ee(ue,M[ue],`In "${E}": "${ue}" is only valid when "encoding" is set to "custom". ${re} encoding found`)):R[ue]?U=U.concat(w.validateSpec({key:ue,value:M[ue],valueSpec:R[ue],validateSpec:w.validateSpec,style:N,styleSpec:z})):U.push(new Ee(ue,M[ue],`unknown property "${ue}"`));return U}({sourceName:n,value:t,style:i.style,styleSpec:o,validateSpec:g}),v;case"geojson":if(v=vn({key:n,value:t,valueSpec:o.source_geojson,style:h,styleSpec:o,validateSpec:g,objectElementValidators:Da}),t.cluster)for(const w in t.clusterProperties){const[T,E]=t.clusterProperties[w],M=typeof T=="string"?[T,["accumulated"],["get",w]]:T;v.push(...Ns({key:`${n}.${w}.map`,value:E,validateSpec:g,expressionContext:"cluster-map"})),v.push(...Ns({key:`${n}.${w}.reduce`,value:M,validateSpec:g,expressionContext:"cluster-reduce"}))}return v;case"video":return vn({key:n,value:t,valueSpec:o.source_video,style:h,validateSpec:g,styleSpec:o});case"image":return vn({key:n,value:t,valueSpec:o.source_image,style:h,validateSpec:g,styleSpec:o});case"canvas":return[new Ee(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Cr({key:`${n}.type`,value:t.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,validateSpec:g,styleSpec:o})}}function Kl(i){const t=i.value,n=i.styleSpec,o=n.light,h=i.style;let g=[];const _=Mt(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ee("light",t,`object expected, ${_} found`)]),g;for(const v in t){const w=v.match(/^(.*)-transition$/);g=g.concat(w&&o[w[1]]&&o[w[1]].transition?i.validateSpec({key:v,value:t[v],valueSpec:n.transition,validateSpec:i.validateSpec,style:h,styleSpec:n}):o[v]?i.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new Ee(v,t[v],`unknown property "${v}"`)])}return g}function Jl(i){const t=i.value,n=i.styleSpec,o=n.sky,h=i.style,g=Mt(t);if(t===void 0)return[];if(g!=="object")return[new Ee("sky",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?i.validateSpec({key:v,value:t[v],valueSpec:o[v],style:h,styleSpec:n}):[new Ee(v,t[v],`unknown property "${v}"`)]);return _}function Ql(i){const t=i.value,n=i.styleSpec,o=n.terrain,h=i.style;let g=[];const _=Mt(t);if(t===void 0)return g;if(_!=="object")return g=g.concat([new Ee("terrain",t,`object expected, ${_} found`)]),g;for(const v in t)g=g.concat(o[v]?i.validateSpec({key:v,value:t[v],valueSpec:o[v],validateSpec:i.validateSpec,style:h,styleSpec:n}):[new Ee(v,t[v],`unknown property "${v}"`)]);return g}function ec(i){let t=[];const n=i.value,o=i.key;if(Array.isArray(n)){const h=[],g=[];for(const _ in n)n[_].id&&h.includes(n[_].id)&&t.push(new Ee(o,n,`all the sprites' ids must be unique, but ${n[_].id} is duplicated`)),h.push(n[_].id),n[_].url&&g.includes(n[_].url)&&t.push(new Ee(o,n,`all the sprites' URLs must be unique, but ${n[_].url} is duplicated`)),g.push(n[_].url),t=t.concat(vn({key:`${o}[${_}]`,value:n[_],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:i.validateSpec}));return t}return ss({key:o,value:n})}const La={"*":()=>[],array:No,boolean:function(i){const t=i.value,n=i.key,o=Mt(t);return o!=="boolean"?[new Ee(n,t,`boolean expected, ${o} found`)]:[]},number:Wl,color:function(i){const t=i.key,n=i.value,o=Mt(n);return o!=="string"?[new Ee(t,n,`color expected, ${o} found`)]:Ft.parse(String(n))?[]:[new Ee(t,n,`color expected, "${n}" found`)]},constants:Iu,enum:Cr,filter:Zl,function:ka,layer:Yl,object:vn,source:Vo,light:Kl,sky:Jl,terrain:Ql,projection:function(i){const t=i.value,n=i.styleSpec,o=n.projection,h=i.style,g=Mt(t);if(t===void 0)return[];if(g!=="object")return[new Ee("projection",t,`object expected, ${g} found`)];let _=[];for(const v in t)_=_.concat(o[v]?i.validateSpec({key:v,value:t[v],valueSpec:o[v],style:h,styleSpec:n}):[new Ee(v,t[v],`unknown property "${v}"`)]);return _},string:ss,formatted:function(i){return ss(i).length===0?[]:Ns(i)},resolvedImage:function(i){return ss(i).length===0?[]:Ns(i)},padding:function(i){const t=i.key,n=i.value;if(Mt(n)==="array"){if(n.length<1||n.length>4)return[new Ee(t,n,`padding requires 1 to 4 values; ${n.length} values found`)];const o={type:"number"};let h=[];for(let g=0;g<n.length;g++)h=h.concat(i.validateSpec({key:`${t}[${g}]`,value:n[g],validateSpec:i.validateSpec,valueSpec:o}));return h}return Wl({key:t,value:n,valueSpec:{}})},variableAnchorOffsetCollection:function(i){const t=i.key,n=i.value,o=Mt(n),h=i.styleSpec;if(o!=="array"||n.length<1||n.length%2!=0)return[new Ee(t,n,"variableAnchorOffsetCollection requires a non-empty array of even length")];let g=[];for(let _=0;_<n.length;_+=2)g=g.concat(Cr({key:`${t}[${_}]`,value:n[_],valueSpec:h.layout_symbol["text-anchor"]})),g=g.concat(No({key:`${t}[${_+1}]`,value:n[_+1],valueSpec:{length:2,value:"number"},validateSpec:i.validateSpec,style:i.style,styleSpec:h}));return g},sprite:ec};function Vs(i){const t=i.value,n=i.valueSpec,o=i.styleSpec;return i.validateSpec=Vs,n.expression&&Ca(fi(t))?ka(i):n.expression&&Ta(jn(t))?Ns(i):n.type&&La[n.type]?La[n.type](i):vn(or({},i,{valueSpec:n.type?o[n.type]:n}))}function Tu(i){const t=i.value,n=i.key,o=ss(i);return o.length||(t.indexOf("{fontstack}")===-1&&o.push(new Ee(n,t,'"glyphs" url must include a "{fontstack}" token')),t.indexOf("{range}")===-1&&o.push(new Ee(n,t,'"glyphs" url must include a "{range}" token'))),o}function Pn(i,t=ge){let n=[];return n=n.concat(Vs({key:"",value:i,valueSpec:t.$root,styleSpec:t,style:i,validateSpec:Vs,objectElementValidators:{glyphs:Tu,"*":()=>[]}})),i.constants&&(n=n.concat(Iu({key:"constants",value:i.constants,style:i,styleSpec:t,validateSpec:Vs}))),tc(n)}function hr(i){return function(t){return i({...t,validateSpec:Vs})}}function tc(i){return[].concat(i).sort((t,n)=>t.line-n.line)}function qn(i){return function(...t){return tc(i.apply(this,t))}}Pn.source=qn(hr(Vo)),Pn.sprite=qn(hr(ec)),Pn.glyphs=qn(hr(Tu)),Pn.light=qn(hr(Kl)),Pn.sky=qn(hr(Jl)),Pn.terrain=qn(hr(Ql)),Pn.layer=qn(hr(Yl)),Pn.filter=qn(hr(Zl)),Pn.paintProperty=qn(hr(za)),Pn.layoutProperty=qn(hr(Xl));const os=Pn,jh=os.light,qh=os.sky,Eu=os.paintProperty,Pu=os.layoutProperty;function ic(i,t){let n=!1;if(t&&t.length)for(const o of t)i.fire(new Ar(new Error(o.message))),n=!0;return n}class Us{constructor(t,n,o){const h=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;const _=new Int32Array(this.arrayBuffer);t=_[0],this.d=(n=_[1])+2*(o=_[2]);for(let w=0;w<this.d*this.d;w++){const T=_[3+w],E=_[3+w+1];h.push(T===E?null:_.subarray(T,E))}const v=_[3+h.length+1];this.keys=_.subarray(_[3+h.length],v),this.bboxes=_.subarray(v),this.insert=this._insertReadonly}else{this.d=n+2*o;for(let _=0;_<this.d*this.d;_++)h.push([]);this.keys=[],this.bboxes=[]}this.n=n,this.extent=t,this.padding=o,this.scale=n/t,this.uid=0;const g=o/n*t;this.min=-g,this.max=t+g}insert(t,n,o,h,g){this._forEachCell(n,o,h,g,this._insertCell,this.uid++,void 0,void 0),this.keys.push(t),this.bboxes.push(n),this.bboxes.push(o),this.bboxes.push(h),this.bboxes.push(g)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(t,n,o,h,g,_){this.cells[g].push(_)}query(t,n,o,h,g){const _=this.min,v=this.max;if(t<=_&&n<=_&&v<=o&&v<=h&&!g)return Array.prototype.slice.call(this.keys);{const w=[];return this._forEachCell(t,n,o,h,this._queryCell,w,{},g),w}}_queryCell(t,n,o,h,g,_,v,w){const T=this.cells[g];if(T!==null){const E=this.keys,M=this.bboxes;for(let z=0;z<T.length;z++){const R=T[z];if(v[R]===void 0){const N=4*R;(w?w(M[N+0],M[N+1],M[N+2],M[N+3]):t<=M[N+2]&&n<=M[N+3]&&o>=M[N+0]&&h>=M[N+1])?(v[R]=!0,_.push(E[R])):v[R]=!1}}}}_forEachCell(t,n,o,h,g,_,v,w){const T=this._convertToCellCoord(t),E=this._convertToCellCoord(n),M=this._convertToCellCoord(o),z=this._convertToCellCoord(h);for(let R=T;R<=M;R++)for(let N=E;N<=z;N++){const U=this.d*N+R;if((!w||w(this._convertFromCellCoord(R),this._convertFromCellCoord(N),this._convertFromCellCoord(R+1),this._convertFromCellCoord(N+1)))&&g.call(this,t,n,o,h,U,_,v,w))return}}_convertFromCellCoord(t){return(t-this.padding)/this.scale}_convertToCellCoord(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const t=this.cells,n=3+this.cells.length+1+1;let o=0;for(let _=0;_<this.cells.length;_++)o+=this.cells[_].length;const h=new Int32Array(n+o+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;let g=n;for(let _=0;_<t.length;_++){const v=t[_];h[3+_]=g,h.set(v,g),g+=v.length}return h[3+t.length]=g,h.set(this.keys,g),g+=this.keys.length,h[3+t.length+1]=g,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer}static serialize(t,n){const o=t.toArrayBuffer();return n&&n.push(o),{buffer:o}}static deserialize(t){return new Us(t.buffer)}}const Mn={};function $e(i,t,n={}){if(Mn[i])throw new Error(`${i} is already registered.`);Object.defineProperty(t,"_classRegistryKey",{value:i,writeable:!1}),Mn[i]={klass:t,omit:n.omit||[],shallow:n.shallow||[]}}$e("Object",Object),$e("TransferableGridIndex",Us),$e("Color",Ft),$e("Error",Error),$e("AJAXError",fn),$e("ResolvedImage",yn),$e("StylePropertyFunction",Os),$e("StyleExpression",Ia,{omit:["_evaluator"]}),$e("ZoomDependentExpression",Fs),$e("ZoomConstantExpression",Bs),$e("CompoundExpression",En,{omit:["_evaluate"]});for(const i in ks)ks[i]._classRegistryKey||$e(`Expression_${i}`,ks[i]);function Ra(i){return i&&typeof ArrayBuffer<"u"&&(i instanceof ArrayBuffer||i.constructor&&i.constructor.name==="ArrayBuffer")}function nc(i){return i.$name||i.constructor._classRegistryKey}function Mu(i){return!function(t){if(t===null||typeof t!="object")return!1;const n=nc(t);return!(!n||n==="Object")}(i)&&(i==null||typeof i=="boolean"||typeof i=="number"||typeof i=="string"||i instanceof Boolean||i instanceof Number||i instanceof String||i instanceof Date||i instanceof RegExp||i instanceof Blob||i instanceof Error||Ra(i)||li(i)||ArrayBuffer.isView(i)||i instanceof ImageData)}function $s(i,t){if(Mu(i))return(Ra(i)||li(i))&&t&&t.push(i),ArrayBuffer.isView(i)&&t&&t.push(i.buffer),i instanceof ImageData&&t&&t.push(i.data.buffer),i;if(Array.isArray(i)){const g=[];for(const _ of i)g.push($s(_,t));return g}if(typeof i!="object")throw new Error("can't serialize object of type "+typeof i);const n=nc(i);if(!n)throw new Error(`can't serialize object of unregistered class ${i.constructor.name}`);if(!Mn[n])throw new Error(`${n} is not registered.`);const{klass:o}=Mn[n],h=o.serialize?o.serialize(i,t):{};if(o.serialize){if(t&&h===t[t.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const g in i){if(!i.hasOwnProperty(g)||Mn[n].omit.indexOf(g)>=0)continue;const _=i[g];h[g]=Mn[n].shallow.indexOf(g)>=0?_:$s(_,t)}i instanceof Error&&(h.message=i.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return n!=="Object"&&(h.$name=n),h}function js(i){if(Mu(i))return i;if(Array.isArray(i))return i.map(js);if(typeof i!="object")throw new Error("can't deserialize object of type "+typeof i);const t=nc(i)||"Object";if(!Mn[t])throw new Error(`can't deserialize unregistered class ${t}`);const{klass:n}=Mn[t];if(!n)throw new Error(`can't deserialize unregistered class ${t}`);if(n.deserialize)return n.deserialize(i);const o=Object.create(n.prototype);for(const h of Object.keys(i)){if(h==="$name")continue;const g=i[h];o[h]=Mn[t].shallow.indexOf(h)>=0?g:js(g)}return o}class rc{constructor(){this.first=!0}update(t,n){const o=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=o,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=o,!0):(this.lastFloorZoom>o?(this.lastIntegerZoom=o+1,this.lastIntegerZoomTime=n):this.lastFloorZoom<o&&(this.lastIntegerZoom=o,this.lastIntegerZoomTime=n),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=o,!0))}}const wt={"Latin-1 Supplement":i=>i>=128&&i<=255,"Hangul Jamo":i=>i>=4352&&i<=4607,Khmer:i=>i>=6016&&i<=6143,"General Punctuation":i=>i>=8192&&i<=8303,"Letterlike Symbols":i=>i>=8448&&i<=8527,"Number Forms":i=>i>=8528&&i<=8591,"Miscellaneous Technical":i=>i>=8960&&i<=9215,"Control Pictures":i=>i>=9216&&i<=9279,"Optical Character Recognition":i=>i>=9280&&i<=9311,"Enclosed Alphanumerics":i=>i>=9312&&i<=9471,"Geometric Shapes":i=>i>=9632&&i<=9727,"Miscellaneous Symbols":i=>i>=9728&&i<=9983,"Miscellaneous Symbols and Arrows":i=>i>=11008&&i<=11263,"Ideographic Description Characters":i=>i>=12272&&i<=12287,"CJK Symbols and Punctuation":i=>i>=12288&&i<=12351,Katakana:i=>i>=12448&&i<=12543,Kanbun:i=>i>=12688&&i<=12703,"CJK Strokes":i=>i>=12736&&i<=12783,"Enclosed CJK Letters and Months":i=>i>=12800&&i<=13055,"CJK Compatibility":i=>i>=13056&&i<=13311,"Yijing Hexagram Symbols":i=>i>=19904&&i<=19967,"Private Use Area":i=>i>=57344&&i<=63743,"Vertical Forms":i=>i>=65040&&i<=65055,"CJK Compatibility Forms":i=>i>=65072&&i<=65103,"Small Form Variants":i=>i>=65104&&i<=65135,"Halfwidth and Fullwidth Forms":i=>i>=65280&&i<=65519};function sc(i){for(const t of i)if(ac(t.charCodeAt(0)))return!0;return!1}function Hh(i){for(const t of i)if(!qs(t.charCodeAt(0)))return!1;return!0}function oc(i){const t=i.map(n=>{try{return new RegExp(`\\p{sc=${n}}`,"u").source}catch{return null}}).filter(n=>n);return new RegExp(t.join("|"),"u")}const Wh=oc(["Arab","Dupl","Mong","Ougr","Syrc"]);function qs(i){return!Wh.test(String.fromCodePoint(i))}const ku=oc(["Bopo","Hani","Hira","Kana","Kits","Nshu","Tang","Yiii"]);function ac(i){return!(i!==746&&i!==747&&(i<4352||!(wt["CJK Compatibility Forms"](i)&&!(i>=65097&&i<=65103)||wt["CJK Compatibility"](i)||wt["CJK Strokes"](i)||!(!wt["CJK Symbols and Punctuation"](i)||i>=12296&&i<=12305||i>=12308&&i<=12319||i===12336)||wt["Enclosed CJK Letters and Months"](i)||wt["Ideographic Description Characters"](i)||wt.Kanbun(i)||wt.Katakana(i)&&i!==12540||!(!wt["Halfwidth and Fullwidth Forms"](i)||i===65288||i===65289||i===65293||i>=65306&&i<=65310||i===65339||i===65341||i===65343||i>=65371&&i<=65503||i===65507||i>=65512&&i<=65519)||!(!wt["Small Form Variants"](i)||i>=65112&&i<=65118||i>=65123&&i<=65126)||wt["Vertical Forms"](i)||wt["Yijing Hexagram Symbols"](i)||/\p{sc=Cans}/u.test(String.fromCodePoint(i))||/\p{sc=Hang}/u.test(String.fromCodePoint(i))||ku.test(String.fromCodePoint(i)))))}function Au(i){return!(ac(i)||function(t){return!!(wt["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||wt["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||wt["Letterlike Symbols"](t)||wt["Number Forms"](t)||wt["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||wt["Control Pictures"](t)&&t!==9251||wt["Optical Character Recognition"](t)||wt["Enclosed Alphanumerics"](t)||wt["Geometric Shapes"](t)||wt["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||wt["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||wt["CJK Symbols and Punctuation"](t)||wt.Katakana(t)||wt["Private Use Area"](t)||wt["CJK Compatibility Forms"](t)||wt["Small Form Variants"](t)||wt["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(i))}const Zh=oc(["Adlm","Arab","Armi","Avst","Chrs","Cprt","Egyp","Elym","Gara","Hatr","Hebr","Hung","Khar","Lydi","Mand","Mani","Mend","Merc","Mero","Narb","Nbat","Nkoo","Orkh","Palm","Phli","Phlp","Phnx","Prti","Rohg","Samr","Sarb","Sogo","Syrc","Thaa","Todr","Yezi"]);function lc(i){return Zh.test(String.fromCodePoint(i))}function Gh(i,t){return!(!t&&lc(i)||i>=2304&&i<=3583||i>=3840&&i<=4255||wt.Khmer(i))}function Xh(i){for(const t of i)if(lc(t.charCodeAt(0)))return!0;return!1}const xn=new class{constructor(){this.applyArabicShaping=null,this.processBidirectionalText=null,this.processStyledBidirectionalText=null,this.pluginStatus="unavailable",this.pluginURL=null}setState(i){this.pluginStatus=i.pluginStatus,this.pluginURL=i.pluginURL}getState(){return{pluginStatus:this.pluginStatus,pluginURL:this.pluginURL}}setMethods(i){this.applyArabicShaping=i.applyArabicShaping,this.processBidirectionalText=i.processBidirectionalText,this.processStyledBidirectionalText=i.processStyledBidirectionalText}isParsed(){return this.applyArabicShaping!=null&&this.processBidirectionalText!=null&&this.processStyledBidirectionalText!=null}getPluginURL(){return this.pluginURL}getRTLTextPluginStatus(){return this.pluginStatus}};class ei{constructor(t,n){this.zoom=t,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.zoomHistory=n.zoomHistory,this.transition=n.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new rc,this.transition={})}isSupportedScript(t){return function(n,o){for(const h of n)if(!Gh(h.charCodeAt(0),o))return!1;return!0}(t,xn.getRTLTextPluginStatus()==="loaded")}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,n=t-Math.floor(t),o=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:n+(1-n)*o}:{fromScale:.5,toScale:1,t:1-(1-o)*n}}}class Hs{constructor(t,n){this.property=t,this.value=n,this.expression=function(o,h){if(Ca(o))return new Os(o,h);if(Ta(o)){const g=jl(o,h);if(g.result==="error")throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=o;return h.type==="color"&&typeof o=="string"?g=Ft.parse(o):h.type!=="padding"||typeof o!="number"&&!Array.isArray(o)?h.type==="variableAnchorOffsetCollection"&&Array.isArray(o)&&(g=Tn.parse(o)):g=_n.parse(o),{kind:"constant",evaluate:()=>g}}}(n===void 0?t.specification.default:n,t.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,n,o){return this.property.possiblyEvaluate(this,t,n,o)}}class Ba{constructor(t){this.property=t,this.value=new Hs(t,void 0)}transitioned(t,n){return new zu(this.property,this.value,n,We({},t.transition,this.transition),t.now)}untransitioned(){return new zu(this.property,this.value,null,{},0)}}class Fa{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return tt(this._values[t].value.value)}setValue(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ba(this._values[t].property)),this._values[t].value=new Hs(this._values[t].property,n===null?void 0:tt(n))}getTransition(t){return tt(this._values[t].transition)}setTransition(t,n){Object.prototype.hasOwnProperty.call(this._values,t)||(this._values[t]=new Ba(this._values[t].property)),this._values[t].transition=tt(n)||void 0}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o);const h=this.getTransition(n);h!==void 0&&(t[`${n}-transition`]=h)}return t}transitioned(t,n){const o=new Uo(this._properties);for(const h of Object.keys(this._values))o._values[h]=this._values[h].transitioned(t,n._values[h]);return o}untransitioned(){const t=new Uo(this._properties);for(const n of Object.keys(this._values))t._values[n]=this._values[n].untransitioned();return t}}class zu{constructor(t,n,o,h,g){this.property=t,this.value=n,this.begin=g+h.delay||0,this.end=this.begin+h.duration||0,t.specification.transition&&(h.delay||h.duration)&&(this.prior=o)}possiblyEvaluate(t,n,o){const h=t.now||0,g=this.value.possiblyEvaluate(t,n,o),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(t,n,o);{const v=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(t,n,o),g,function(w){if(w<=0)return 0;if(w>=1)return 1;const T=w*w,E=T*w;return 4*(w<.5?E:3*(w-T)+E-.75)}(v))}}return g}}class Uo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,n,o){const h=new jo(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,o);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class $o{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}hasValue(t){return this._values[t].value!==void 0}getValue(t){return tt(this._values[t].value)}setValue(t,n){this._values[t]=new Hs(this._values[t].property,n===null?void 0:tt(n))}serialize(){const t={};for(const n of Object.keys(this._values)){const o=this.getValue(n);o!==void 0&&(t[n]=o)}return t}possiblyEvaluate(t,n,o){const h=new jo(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,n,o);return h}}class dr{constructor(t,n,o){this.property=t,this.value=n,this.parameters=o}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,n,o,h){return this.property.evaluate(this.value,this.parameters,t,n,o,h)}}class jo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Ze{constructor(t){this.specification=t}possiblyEvaluate(t,n){if(t.isDataDriven())throw new Error("Value should not be data driven");return t.expression.evaluate(n)}interpolate(t,n,o){const h=sn[this.specification.type];return h?h(t,n,o):t}}class rt{constructor(t,n){this.specification=t,this.overrides=n}possiblyEvaluate(t,n,o,h){return new dr(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(n,null,{},o,h)}:t.expression,n)}interpolate(t,n,o){if(t.value.kind!=="constant"||n.value.kind!=="constant")return t;if(t.value.value===void 0||n.value.value===void 0)return new dr(this,{kind:"constant",value:void 0},t.parameters);const h=sn[this.specification.type];if(h){const g=h(t.value.value,n.value.value,o);return new dr(this,{kind:"constant",value:g},t.parameters)}return t}evaluate(t,n,o,h,g,_){return t.kind==="constant"?t.value:t.evaluate(n,o,h,g,_)}}class Oa extends rt{possiblyEvaluate(t,n,o,h){if(t.value===void 0)return new dr(this,{kind:"constant",value:void 0},n);if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,h),_=t.property.specification.type==="resolvedImage"&&typeof g!="string"?g.name:g,v=this._calculate(_,_,_,n);return new dr(this,{kind:"constant",value:v},n)}if(t.expression.kind==="camera"){const g=this._calculate(t.expression.evaluate({zoom:n.zoom-1}),t.expression.evaluate({zoom:n.zoom}),t.expression.evaluate({zoom:n.zoom+1}),n);return new dr(this,{kind:"constant",value:g},n)}return new dr(this,t.expression,n)}evaluate(t,n,o,h,g,_){if(t.kind==="source"){const v=t.evaluate(n,o,h,g,_);return this._calculate(v,v,v,n)}return t.kind==="composite"?this._calculate(t.evaluate({zoom:Math.floor(n.zoom)-1},o,h),t.evaluate({zoom:Math.floor(n.zoom)},o,h),t.evaluate({zoom:Math.floor(n.zoom)+1},o,h),n):t.value}_calculate(t,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class Na{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,h){if(t.value!==void 0){if(t.expression.kind==="constant"){const g=t.expression.evaluate(n,null,{},o,h);return this._calculate(g,g,g,n)}return this._calculate(t.expression.evaluate(new ei(Math.floor(n.zoom-1),n)),t.expression.evaluate(new ei(Math.floor(n.zoom),n)),t.expression.evaluate(new ei(Math.floor(n.zoom+1),n)),n)}}_calculate(t,n,o,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:t,to:n}:{from:o,to:n}}interpolate(t){return t}}class cc{constructor(t){this.specification=t}possiblyEvaluate(t,n,o,h){return!!t.expression.evaluate(n,null,{},o,h)}interpolate(){return!1}}class f{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const n in t){const o=t[n];o.specification.overridable&&this.overridableProperties.push(n);const h=this.defaultPropertyValues[n]=new Hs(o,void 0),g=this.defaultTransitionablePropertyValues[n]=new Ba(o);this.defaultTransitioningPropertyValues[n]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[n]=h.possiblyEvaluate({})}}}$e("DataDrivenProperty",rt),$e("DataConstantProperty",Ze),$e("CrossFadedDataDrivenProperty",Oa),$e("CrossFadedProperty",Na),$e("ColorRampProperty",cc);const e="-transition";class s extends ws{constructor(t,n){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1},t.type!=="custom"&&(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type!=="background"&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),n.layout&&(this._unevaluatedLayout=new $o(n.layout)),n.paint)){this._transitionablePaint=new Fa(n.paint);for(const o in t.paint)this.setPaintProperty(o,t.paint[o],{validate:!1});for(const o in t.layout)this.setLayoutProperty(o,t.layout[o],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new jo(n.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,n,o={}){n!=null&&this._validate(Pu,`layers.${this.id}.layout.${t}`,t,n,o)||(t!=="visibility"?this._unevaluatedLayout.setValue(t,n):this.visibility=n)}getPaintProperty(t){return t.endsWith(e)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,n,o={}){if(n!=null&&this._validate(Eu,`layers.${this.id}.paint.${t}`,t,n,o))return!1;if(t.endsWith(e))return this._transitionablePaint.setTransition(t.slice(0,-11),n||void 0),!1;{const h=this._transitionablePaint._values[t],g=h.property.specification["property-type"]==="cross-faded-data-driven",_=h.value.isDataDriven(),v=h.value;this._transitionablePaint.setValue(t,n),this._handleSpecialPaintPropertyUpdate(t);const w=this._transitionablePaint._values[t].value;return w.isDataDriven()||_||g||this._handleOverridablePaintPropertyUpdate(t,v,w)}}_handleSpecialPaintPropertyUpdate(t){}_handleOverridablePaintPropertyUpdate(t,n,o){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,n){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,n)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),pi(t,(n,o)=>!(n===void 0||o==="layout"&&!Object.keys(n).length||o==="paint"&&!Object.keys(n).length))}_validate(t,n,o,h,g={}){return(!g||g.validate!==!1)&&ic(this,t.call(os,{key:n,layerType:this.type,objectKey:o,value:h,styleSpec:ge,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const n=this.paint.get(t);if(n instanceof dr&&Ds(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}}const l={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class c{constructor(t,n){this._structArray=t,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class m{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,n){return t._trim(),n&&(t.isTransferred=!0,n.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const n=Object.create(this.prototype);return n.arrayBuffer=t.arrayBuffer,n.length=t.length,n.capacity=t.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function b(i,t=1){let n=0,o=0;return{members:i.map(h=>{const g=l[h.type].BYTES_PER_ELEMENT,_=n=C(n,Math.max(t,g)),v=h.components||1;return o=Math.max(o,g),n+=g*v,{name:h.name,type:h.type,components:v,offset:_}}),size:C(n,Math.max(o,t)),alignment:t}}function C(i,t){return Math.ceil(i/t)*t}class I extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.int16[h+0]=n,this.int16[h+1]=o,t}}I.prototype.bytesPerElement=4,$e("StructArrayLayout2i4",I);class P extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.int16[g+0]=n,this.int16[g+1]=o,this.int16[g+2]=h,t}}P.prototype.bytesPerElement=6,$e("StructArrayLayout3i6",P);class k extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,h)}emplace(t,n,o,h,g){const _=4*t;return this.int16[_+0]=n,this.int16[_+1]=o,this.int16[_+2]=h,this.int16[_+3]=g,t}}k.prototype.bytesPerElement=8,$e("StructArrayLayout4i8",k);class A extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,v){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=_,this.int16[w+5]=v,t}}A.prototype.bytesPerElement=12,$e("StructArrayLayout2i4i12",A);class B extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,v){const w=4*t,T=8*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.uint8[T+4]=h,this.uint8[T+5]=g,this.uint8[T+6]=_,this.uint8[T+7]=v,t}}B.prototype.bytesPerElement=8,$e("StructArrayLayout2i4ub8",B);class $ extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.float32[h+0]=n,this.float32[h+1]=o,t}}$.prototype.bytesPerElement=8,$e("StructArrayLayout2f8",$);class H extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,v,w,T,E){const M=this.length;return this.resize(M+1),this.emplace(M,t,n,o,h,g,_,v,w,T,E)}emplace(t,n,o,h,g,_,v,w,T,E,M){const z=10*t;return this.uint16[z+0]=n,this.uint16[z+1]=o,this.uint16[z+2]=h,this.uint16[z+3]=g,this.uint16[z+4]=_,this.uint16[z+5]=v,this.uint16[z+6]=w,this.uint16[z+7]=T,this.uint16[z+8]=E,this.uint16[z+9]=M,t}}H.prototype.bytesPerElement=20,$e("StructArrayLayout10ui20",H);class Y extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,v,w,T,E,M,z){const R=this.length;return this.resize(R+1),this.emplace(R,t,n,o,h,g,_,v,w,T,E,M,z)}emplace(t,n,o,h,g,_,v,w,T,E,M,z,R){const N=12*t;return this.int16[N+0]=n,this.int16[N+1]=o,this.int16[N+2]=h,this.int16[N+3]=g,this.uint16[N+4]=_,this.uint16[N+5]=v,this.uint16[N+6]=w,this.uint16[N+7]=T,this.int16[N+8]=E,this.int16[N+9]=M,this.int16[N+10]=z,this.int16[N+11]=R,t}}Y.prototype.bytesPerElement=24,$e("StructArrayLayout4i4ui4i24",Y);class Q extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.float32[g+0]=n,this.float32[g+1]=o,this.float32[g+2]=h,t}}Q.prototype.bytesPerElement=12,$e("StructArrayLayout3f12",Q);class ee extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint32[1*t+0]=n,t}}ee.prototype.bytesPerElement=4,$e("StructArrayLayout1ul4",ee);class ne extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,v,w,T){const E=this.length;return this.resize(E+1),this.emplace(E,t,n,o,h,g,_,v,w,T)}emplace(t,n,o,h,g,_,v,w,T,E){const M=10*t,z=5*t;return this.int16[M+0]=n,this.int16[M+1]=o,this.int16[M+2]=h,this.int16[M+3]=g,this.int16[M+4]=_,this.int16[M+5]=v,this.uint32[z+3]=w,this.uint16[M+8]=T,this.uint16[M+9]=E,t}}ne.prototype.bytesPerElement=20,$e("StructArrayLayout6i1ul2ui20",ne);class Z extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,v){const w=6*t;return this.int16[w+0]=n,this.int16[w+1]=o,this.int16[w+2]=h,this.int16[w+3]=g,this.int16[w+4]=_,this.int16[w+5]=v,t}}Z.prototype.bytesPerElement=12,$e("StructArrayLayout2i2i2i12",Z);class ae extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,t,n,o,h,g)}emplace(t,n,o,h,g,_){const v=4*t,w=8*t;return this.float32[v+0]=n,this.float32[v+1]=o,this.float32[v+2]=h,this.int16[w+6]=g,this.int16[w+7]=_,t}}ae.prototype.bytesPerElement=16,$e("StructArrayLayout2f1f2i16",ae);class ce extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,n,o,h,g,_)}emplace(t,n,o,h,g,_,v){const w=16*t,T=4*t,E=8*t;return this.uint8[w+0]=n,this.uint8[w+1]=o,this.float32[T+1]=h,this.float32[T+2]=g,this.int16[E+6]=_,this.int16[E+7]=v,t}}ce.prototype.bytesPerElement=16,$e("StructArrayLayout2ub2f2i16",ce);class me extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.uint16[g+0]=n,this.uint16[g+1]=o,this.uint16[g+2]=h,t}}me.prototype.bytesPerElement=6,$e("StructArrayLayout3ui6",me);class be extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,v,w,T,E,M,z,R,N,U,G,J){const de=this.length;return this.resize(de+1),this.emplace(de,t,n,o,h,g,_,v,w,T,E,M,z,R,N,U,G,J)}emplace(t,n,o,h,g,_,v,w,T,E,M,z,R,N,U,G,J,de){const re=24*t,ue=12*t,_e=48*t;return this.int16[re+0]=n,this.int16[re+1]=o,this.uint16[re+2]=h,this.uint16[re+3]=g,this.uint32[ue+2]=_,this.uint32[ue+3]=v,this.uint32[ue+4]=w,this.uint16[re+10]=T,this.uint16[re+11]=E,this.uint16[re+12]=M,this.float32[ue+7]=z,this.float32[ue+8]=R,this.uint8[_e+36]=N,this.uint8[_e+37]=U,this.uint8[_e+38]=G,this.uint32[ue+10]=J,this.int16[re+22]=de,t}}be.prototype.bytesPerElement=48,$e("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",be);class Ie extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h,g,_,v,w,T,E,M,z,R,N,U,G,J,de,re,ue,_e,Se,Oe,nt,Re,De,Ke,He){const Ue=this.length;return this.resize(Ue+1),this.emplace(Ue,t,n,o,h,g,_,v,w,T,E,M,z,R,N,U,G,J,de,re,ue,_e,Se,Oe,nt,Re,De,Ke,He)}emplace(t,n,o,h,g,_,v,w,T,E,M,z,R,N,U,G,J,de,re,ue,_e,Se,Oe,nt,Re,De,Ke,He,Ue){const xe=32*t,Je=16*t;return this.int16[xe+0]=n,this.int16[xe+1]=o,this.int16[xe+2]=h,this.int16[xe+3]=g,this.int16[xe+4]=_,this.int16[xe+5]=v,this.int16[xe+6]=w,this.int16[xe+7]=T,this.uint16[xe+8]=E,this.uint16[xe+9]=M,this.uint16[xe+10]=z,this.uint16[xe+11]=R,this.uint16[xe+12]=N,this.uint16[xe+13]=U,this.uint16[xe+14]=G,this.uint16[xe+15]=J,this.uint16[xe+16]=de,this.uint16[xe+17]=re,this.uint16[xe+18]=ue,this.uint16[xe+19]=_e,this.uint16[xe+20]=Se,this.uint16[xe+21]=Oe,this.uint16[xe+22]=nt,this.uint32[Je+12]=Re,this.float32[Je+13]=De,this.float32[Je+14]=Ke,this.uint16[xe+30]=He,this.uint16[xe+31]=Ue,t}}Ie.prototype.bytesPerElement=64,$e("StructArrayLayout8i15ui1ul2f2ui64",Ie);class Le extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.float32[1*t+0]=n,t}}Le.prototype.bytesPerElement=4,$e("StructArrayLayout1f4",Le);class Ne extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=3*t;return this.uint16[6*t+0]=n,this.float32[g+1]=o,this.float32[g+2]=h,t}}Ne.prototype.bytesPerElement=12,$e("StructArrayLayout1ui2f12",Ne);class ke extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n,o){const h=this.length;return this.resize(h+1),this.emplace(h,t,n,o)}emplace(t,n,o,h){const g=4*t;return this.uint32[2*t+0]=n,this.uint16[g+2]=o,this.uint16[g+3]=h,t}}ke.prototype.bytesPerElement=8,$e("StructArrayLayout1ul2ui8",ke);class Me extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,n){const o=this.length;return this.resize(o+1),this.emplace(o,t,n)}emplace(t,n,o){const h=2*t;return this.uint16[h+0]=n,this.uint16[h+1]=o,t}}Me.prototype.bytesPerElement=4,$e("StructArrayLayout2ui4",Me);class Ge extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const n=this.length;return this.resize(n+1),this.emplace(n,t)}emplace(t,n){return this.uint16[1*t+0]=n,t}}Ge.prototype.bytesPerElement=2,$e("StructArrayLayout1ui2",Ge);class ut extends m{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,n,o,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,n,o,h)}emplace(t,n,o,h,g){const _=4*t;return this.float32[_+0]=n,this.float32[_+1]=o,this.float32[_+2]=h,this.float32[_+3]=g,t}}ut.prototype.bytesPerElement=16,$e("StructArrayLayout4f16",ut);class ze extends c{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new q(this.anchorPointX,this.anchorPointY)}}ze.prototype.size=20;class Fe extends ne{get(t){return new ze(this,t)}}$e("CollisionBoxArray",Fe);class at extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(t){this._structArray.uint8[this._pos1+37]=t}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(t){this._structArray.uint8[this._pos1+38]=t}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(t){this._structArray.uint32[this._pos4+10]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}at.prototype.size=48;class ti extends be{get(t){return new at(this,t)}}$e("PlacedSymbolArray",ti);class pt extends c{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(t){this._structArray.uint32[this._pos4+12]=t}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+14]}get textAnchorOffsetStartIndex(){return this._structArray.uint16[this._pos2+30]}get textAnchorOffsetEndIndex(){return this._structArray.uint16[this._pos2+31]}}pt.prototype.size=64;class xt extends Ie{get(t){return new pt(this,t)}}$e("SymbolInstanceArray",xt);class ii extends Le{getoffsetX(t){return this.float32[1*t+0]}}$e("GlyphOffsetArray",ii);class $i extends P{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}$e("SymbolLineVertexArray",$i);class Hn extends c{get textAnchor(){return this._structArray.uint16[this._pos2+0]}get textOffset0(){return this._structArray.float32[this._pos4+1]}get textOffset1(){return this._structArray.float32[this._pos4+2]}}Hn.prototype.size=12;class ni extends Ne{get(t){return new Hn(this,t)}}$e("TextAnchorOffsetArray",ni);class an extends c{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}an.prototype.size=8;class Qi extends ke{get(t){return new an(this,t)}}$e("FeatureIndexArray",Qi);class ji extends I{}class en extends I{}class pr extends I{}class Ws extends A{}class Va extends B{}class Zs extends ${}class kn extends H{}class Ua extends Y{}class uc extends Q{}class An extends ee{}class zn extends Z{}class Fr extends ce{}class Wn extends me{}class Fi extends Me{}const qi=b([{name:"a_pos",components:2,type:"Int16"}],4),{members:bn}=qi;class Ct{constructor(t=[]){this.segments=t}prepareSegment(t,n,o,h){let g=this.segments[this.segments.length-1];return t>Ct.MAX_VERTEX_ARRAY_LENGTH&&St(`Max vertices per segment is ${Ct.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>Ct.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:o.length,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const t of this.segments)for(const n in t.vaos)t.vaos[n].destroy()}static simpleSegment(t,n,o,h){return new Ct([{vertexOffset:t,primitiveOffset:n,vertexLength:o,primitiveLength:h,vaos:{},sortKey:0}])}}function as(i,t){return 256*(i=qe(Math.floor(i),0,255))+qe(Math.floor(t),0,255)}Ct.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$e("SegmentVector",Ct);const Gs=b([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Xs={exports:{}},Du={exports:{}};Du.exports=function(i,t){var n,o,h,g,_,v,w,T;for(o=i.length-(n=3&i.length),h=t,_=3432918353,v=461845907,T=0;T<o;)w=255&i.charCodeAt(T)|(255&i.charCodeAt(++T))<<8|(255&i.charCodeAt(++T))<<16|(255&i.charCodeAt(++T))<<24,++T,h=27492+(65535&(g=5*(65535&(h=(h^=w=(65535&(w=(w=(65535&w)*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(w=0,n){case 3:w^=(255&i.charCodeAt(T+2))<<16;case 2:w^=(255&i.charCodeAt(T+1))<<8;case 1:h^=w=(65535&(w=(w=(65535&(w^=255&i.charCodeAt(T)))*_+(((w>>>16)*_&65535)<<16)&4294967295)<<15|w>>>17))*v+(((w>>>16)*v&65535)<<16)&4294967295}return h^=i.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var Yh=Du.exports,Lu={exports:{}};Lu.exports=function(i,t){for(var n,o=i.length,h=t^o,g=0;o>=4;)n=1540483477*(65535&(n=255&i.charCodeAt(g)|(255&i.charCodeAt(++g))<<8|(255&i.charCodeAt(++g))<<16|(255&i.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),o-=4,++g;switch(o){case 3:h^=(255&i.charCodeAt(g+2))<<16;case 2:h^=(255&i.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&i.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var Or=Yh,Ru=Lu.exports;Xs.exports=Or,Xs.exports.murmur3=Or,Xs.exports.murmur2=Ru;var $a=O(Xs.exports);class qo{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,n,o,h){this.ids.push(ja(t)),this.positions.push(n,o,h)}getPositions(t){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const n=ja(t);let o=0,h=this.ids.length-1;for(;o<h;){const _=o+h>>1;this.ids[_]>=n?h=_:o=_+1}const g=[];for(;this.ids[o]===n;)g.push({index:this.positions[3*o],start:this.positions[3*o+1],end:this.positions[3*o+2]}),o++;return g}static serialize(t,n){const o=new Float64Array(t.ids),h=new Uint32Array(t.positions);return qa(o,h,0,o.length-1),n&&n.push(o.buffer,h.buffer),{ids:o,positions:h}}static deserialize(t){const n=new qo;return n.ids=t.ids,n.positions=t.positions,n.indexed=!0,n}}function ja(i){const t=+i;return!isNaN(t)&&t<=Number.MAX_SAFE_INTEGER?t:$a(String(i))}function qa(i,t,n,o){for(;n<o;){const h=i[n+o>>1];let g=n-1,_=o+1;for(;;){do g++;while(i[g]<h);do _--;while(i[_]>h);if(g>=_)break;Ys(i,g,_),Ys(t,3*g,3*_),Ys(t,3*g+1,3*_+1),Ys(t,3*g+2,3*_+2)}_-n<o-_?(qa(i,t,n,_),n=_+1):(qa(i,t,_+1,o),o=_)}}function Ys(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}$e("FeaturePositionMap",qo);class Ho{constructor(t,n){this.gl=t.gl,this.location=n}}class Bu extends Ho{constructor(t,n){super(t,n),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Cp extends Ho{constructor(t,n){super(t,n),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class Sp extends Ho{constructor(t,n){super(t,n),this.current=Ft.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const P_=new Float32Array(16);function Kh(i){return[as(255*i.r,255*i.g),as(255*i.b,255*i.a)]}class hc{constructor(t,n,o){this.value=t,this.uniformNames=n.map(h=>`u_${h}`),this.type=o}setUniform(t,n,o){t.set(o.constantOr(this.value))}getBinding(t,n,o){return this.type==="color"?new Sp(t,n):new Bu(t,n)}}class Ha{constructor(t,n){this.uniformNames=n.map(o=>`u_${o}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,n){this.pixelRatioFrom=n.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=n.tlbr,this.patternTo=t.tlbr}setUniform(t,n,o,h){const g=h==="u_pattern_to"?this.patternTo:h==="u_pattern_from"?this.patternFrom:h==="u_pixel_ratio_to"?this.pixelRatioTo:h==="u_pixel_ratio_from"?this.pixelRatioFrom:null;g&&t.set(g)}getBinding(t,n,o){return o.substr(0,9)==="u_pattern"?new Cp(t,n):new Bu(t,n)}}class ls{constructor(t,n,o,h){this.expression=t,this.type=o,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:o==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,n,o,h,g){const _=this.paintVertexArray.length,v=this.expression.evaluate(new ei(0),n,{},h,[],g);this.paintVertexArray.resize(t),this._setPaintValue(_,t,v)}updatePaintArray(t,n,o,h){const g=this.expression.evaluate({zoom:0},o,h);this._setPaintValue(t,n,g)}_setPaintValue(t,n,o){if(this.type==="color"){const h=Kh(o);for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=t;h<n;h++)this.paintVertexArray.emplace(h,o);this.maxValue=Math.max(this.maxValue,Math.abs(o))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Sr{constructor(t,n,o,h,g,_){this.expression=t,this.uniformNames=n.map(v=>`u_${v}_t`),this.type=o,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(v=>({name:`a_${v}`,type:"Float32",components:o==="color"?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(t,n,o,h,g){const _=this.expression.evaluate(new ei(this.zoom),n,{},h,[],g),v=this.expression.evaluate(new ei(this.zoom+1),n,{},h,[],g),w=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(w,t,_,v)}updatePaintArray(t,n,o,h){const g=this.expression.evaluate({zoom:this.zoom},o,h),_=this.expression.evaluate({zoom:this.zoom+1},o,h);this._setPaintValue(t,n,g,_)}_setPaintValue(t,n,o,h){if(this.type==="color"){const g=Kh(o),_=Kh(h);for(let v=t;v<n;v++)this.paintVertexArray.emplace(v,g[0],g[1],_[0],_[1])}else{for(let g=t;g<n;g++)this.paintVertexArray.emplace(g,o,h);this.maxValue=Math.max(this.maxValue,Math.abs(o),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,n){const o=this.useIntegerZoom?Math.floor(n.zoom):n.zoom,h=qe(this.expression.interpolationFactor(o,this.zoom,this.zoom+1),0,1);t.set(h)}getBinding(t,n,o){return new Bu(t,n)}}class Ks{constructor(t,n,o,h,g,_){this.expression=t,this.type=n,this.useIntegerZoom=o,this.zoom=h,this.layerId=_,this.zoomInPaintVertexArray=new g,this.zoomOutPaintVertexArray=new g}populatePaintArray(t,n,o){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(h,t,n.patterns&&n.patterns[this.layerId],o)}updatePaintArray(t,n,o,h,g){this._setPaintValues(t,n,o.patterns&&o.patterns[this.layerId],g)}_setPaintValues(t,n,o,h){if(!h||!o)return;const{min:g,mid:_,max:v}=o,w=h[g],T=h[_],E=h[v];if(w&&T&&E)for(let M=t;M<n;M++)this.zoomInPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],w.tl[0],w.tl[1],w.br[0],w.br[1],T.pixelRatio,w.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],E.tl[0],E.tl[1],E.br[0],E.br[1],T.pixelRatio,E.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,Gs.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,Gs.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Ip{constructor(t,n,o){this.binders={},this._buffers=[];const h=[];for(const g in t.paint._values){if(!o(g))continue;const _=t.paint.get(g);if(!(_ instanceof dr&&Ds(_.property.specification)))continue;const v=M_(g,t.type),w=_.value,T=_.property.specification.type,E=_.property.useIntegerZoom,M=_.property.specification["property-type"],z=M==="cross-faded"||M==="cross-faded-data-driven";if(w.kind==="constant")this.binders[g]=z?new Ha(w.value,v):new hc(w.value,v,T),h.push(`/u_${g}`);else if(w.kind==="source"||z){const R=Tp(g,T,"source");this.binders[g]=z?new Ks(w,T,E,n,R,t.id):new ls(w,v,T,R),h.push(`/a_${g}`)}else{const R=Tp(g,T,"composite");this.binders[g]=new Sr(w,v,T,E,n,R),h.push(`/z_${g}`)}}this.cacheKey=h.sort().join("")}getMaxValue(t){const n=this.binders[t];return n instanceof ls||n instanceof Sr?n.maxValue:0}populatePaintArrays(t,n,o,h,g){for(const _ in this.binders){const v=this.binders[_];(v instanceof ls||v instanceof Sr||v instanceof Ks)&&v.populatePaintArray(t,n,o,h,g)}}setConstantPatternPositions(t,n){for(const o in this.binders){const h=this.binders[o];h instanceof Ha&&h.setConstantPatternPositions(t,n)}}updatePaintArrays(t,n,o,h,g){let _=!1;for(const v in t){const w=n.getPositions(v);for(const T of w){const E=o.feature(T.index);for(const M in this.binders){const z=this.binders[M];if((z instanceof ls||z instanceof Sr||z instanceof Ks)&&z.expression.isStateDependent===!0){const R=h.paint.get(M);z.expression=R.value,z.updatePaintArray(T.start,T.end,E,t[v],g),_=!0}}}}return _}defines(){const t=[];for(const n in this.binders){const o=this.binders[n];(o instanceof hc||o instanceof Ha)&&t.push(...o.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof ls||o instanceof Sr)for(let h=0;h<o.paintVertexAttributes.length;h++)t.push(o.paintVertexAttributes[h].name);else if(o instanceof Ks)for(let h=0;h<Gs.members.length;h++)t.push(Gs.members[h].name)}return t}getBinderUniforms(){const t=[];for(const n in this.binders){const o=this.binders[n];if(o instanceof hc||o instanceof Ha||o instanceof Sr)for(const h of o.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,n){const o=[];for(const h in this.binders){const g=this.binders[h];if(g instanceof hc||g instanceof Ha||g instanceof Sr){for(const _ of g.uniformNames)if(n[_]){const v=g.getBinding(t,n[_],_);o.push({name:_,property:h,binding:v})}}}return o}setUniforms(t,n,o,h){for(const{name:g,property:_,binding:v}of n)this.binders[_].setUniform(v,h,o.get(_),g)}updatePaintBuffers(t){this._buffers=[];for(const n in this.binders){const o=this.binders[n];if(t&&o instanceof Ks){const h=t.fromScale===2?o.zoomInPaintVertexBuffer:o.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(o instanceof ls||o instanceof Sr)&&o.paintVertexBuffer&&this._buffers.push(o.paintVertexBuffer)}}upload(t){for(const n in this.binders){const o=this.binders[n];(o instanceof ls||o instanceof Sr||o instanceof Ks)&&o.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const n=this.binders[t];(n instanceof ls||n instanceof Sr||n instanceof Ks)&&n.destroy()}}}class Wo{constructor(t,n,o=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new Ip(h,n,o);this.needsUpload=!1,this._featureMap=new qo,this._bufferOffset=0}populatePaintArrays(t,n,o,h,g,_){for(const v in this.programConfigurations)this.programConfigurations[v].populatePaintArrays(t,n,h,g,_);n.id!==void 0&&this._featureMap.add(n.id,o,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,n,o,h){for(const g of o)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(t,this._featureMap,n,g,h)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}function M_(i,t){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[i]||[i.replace(`${t}-`,"").replace(/-/g,"_")]}function Tp(i,t,n){const o={color:{source:$,composite:ut},number:{source:Le,composite:$}},h=function(g){return{"line-pattern":{source:kn,composite:kn},"fill-pattern":{source:kn,composite:kn},"fill-extrusion-pattern":{source:kn,composite:kn}}[g]}(i);return h&&h[n]||o[t][n]}$e("ConstantBinder",hc),$e("CrossFadedConstantBinder",Ha),$e("SourceExpressionBinder",ls),$e("CrossFadedCompositeBinder",Ks),$e("CompositeExpressionBinder",Sr),$e("ProgramConfiguration",Ip,{omit:["_buffers"]}),$e("ProgramConfigurationSet",Wo);const wi=8192,Jh=Math.pow(2,14)-1,Ep=-Jh-1;function Zo(i){const t=wi/i.extent,n=i.loadGeometry();for(let o=0;o<n.length;o++){const h=n[o];for(let g=0;g<h.length;g++){const _=h[g],v=Math.round(_.x*t),w=Math.round(_.y*t);_.x=qe(v,Ep,Jh),_.y=qe(w,Ep,Jh),(v<_.x||v>_.x+1||w<_.y||w>_.y+1)&&St("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return n}function Go(i,t){return{type:i.type,id:i.id,properties:i.properties,geometry:t?Zo(i):[]}}function Fu(i,t,n,o,h){i.emplaceBack(2*t+(o+1)/2,2*n+(h+1)/2)}class Qh{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new en,this.indexArray=new Wn,this.segments=new Ct,this.programConfigurations=new Wo(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){const h=this.layers[0],g=[];let _=null,v=!1;h.type==="circle"&&(_=h.layout.get("circle-sort-key"),v=!_.isConstant());for(const{feature:w,id:T,index:E,sourceLayerIndex:M}of t){const z=this.layers[0]._featureFilter.needGeometry,R=Go(w,z);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),R,o))continue;const N=v?_.evaluate(R,{},o):void 0,U={id:T,properties:w.properties,type:w.type,sourceLayerIndex:M,index:E,geometry:z?R.geometry:Zo(w),patterns:{},sortKey:N};g.push(U)}v&&g.sort((w,T)=>w.sortKey-T.sortKey);for(const w of g){const{geometry:T,index:E,sourceLayerIndex:M}=w,z=t[E].feature;this.addFeature(w,T,E,o),n.featureIndex.insert(z,T,E,M,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,bn),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,n,o,h){for(const g of n)for(const _ of g){const v=_.x,w=_.y;if(v<0||v>=wi||w<0||w>=wi)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),E=T.vertexLength;Fu(this.layoutVertexArray,v,w,-1,-1),Fu(this.layoutVertexArray,v,w,1,-1),Fu(this.layoutVertexArray,v,w,1,1),Fu(this.layoutVertexArray,v,w,-1,1),this.indexArray.emplaceBack(E,E+1,E+2),this.indexArray.emplaceBack(E,E+3,E+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,{},h)}}function Pp(i,t){for(let n=0;n<i.length;n++)if(Wa(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(Wa(i,t[n]))return!0;return!!ed(i,t)}function k_(i,t,n){return!!Wa(i,t)||!!td(t,i,n)}function Mp(i,t){if(i.length===1)return Ap(t,i[0]);for(let n=0;n<t.length;n++){const o=t[n];for(let h=0;h<o.length;h++)if(Wa(i,o[h]))return!0}for(let n=0;n<i.length;n++)if(Ap(t,i[n]))return!0;for(let n=0;n<t.length;n++)if(ed(i,t[n]))return!0;return!1}function A_(i,t,n){if(i.length>1){if(ed(i,t))return!0;for(let o=0;o<t.length;o++)if(td(t[o],i,n))return!0}for(let o=0;o<i.length;o++)if(td(i[o],t,n))return!0;return!1}function ed(i,t){if(i.length===0||t.length===0)return!1;for(let n=0;n<i.length-1;n++){const o=i[n],h=i[n+1];for(let g=0;g<t.length-1;g++)if(z_(o,h,t[g],t[g+1]))return!0}return!1}function z_(i,t,n,o){return Zt(i,n,o)!==Zt(t,n,o)&&Zt(i,t,n)!==Zt(i,t,o)}function td(i,t,n){const o=n*n;if(t.length===1)return i.distSqr(t[0])<o;for(let h=1;h<t.length;h++)if(kp(i,t[h-1],t[h])<o)return!0;return!1}function kp(i,t,n){const o=t.distSqr(n);if(o===0)return i.distSqr(t);const h=((i.x-t.x)*(n.x-t.x)+(i.y-t.y)*(n.y-t.y))/o;return i.distSqr(h<0?t:h>1?n:n.sub(t)._mult(h)._add(t))}function Ap(i,t){let n,o,h,g=!1;for(let _=0;_<i.length;_++){n=i[_];for(let v=0,w=n.length-1;v<n.length;w=v++)o=n[v],h=n[w],o.y>t.y!=h.y>t.y&&t.x<(h.x-o.x)*(t.y-o.y)/(h.y-o.y)+o.x&&(g=!g)}return g}function Wa(i,t){let n=!1;for(let o=0,h=i.length-1;o<i.length;h=o++){const g=i[o],_=i[h];g.y>t.y!=_.y>t.y&&t.x<(_.x-g.x)*(t.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function D_(i,t,n){const o=n[0],h=n[2];if(i.x<o.x&&t.x<o.x||i.x>h.x&&t.x>h.x||i.y<o.y&&t.y<o.y||i.y>h.y&&t.y>h.y)return!1;const g=Zt(i,t,n[0]);return g!==Zt(i,t,n[1])||g!==Zt(i,t,n[2])||g!==Zt(i,t,n[3])}function dc(i,t,n){const o=t.paint.get(i).value;return o.kind==="constant"?o.value:n.programConfigurations.get(t.id).getMaxValue(i)}function Ou(i){return Math.sqrt(i[0]*i[0]+i[1]*i[1])}function Nu(i,t,n,o,h){if(!t[0]&&!t[1])return i;const g=q.convert(t)._mult(h);n==="viewport"&&g._rotate(-o);const _=[];for(let v=0;v<i.length;v++)_.push(i[v].sub(g));return _}let zp,Dp;$e("CircleBucket",Qh,{omit:["layers"]});var L_={get paint(){return Dp=Dp||new f({"circle-radius":new rt(ge.paint_circle["circle-radius"]),"circle-color":new rt(ge.paint_circle["circle-color"]),"circle-blur":new rt(ge.paint_circle["circle-blur"]),"circle-opacity":new rt(ge.paint_circle["circle-opacity"]),"circle-translate":new Ze(ge.paint_circle["circle-translate"]),"circle-translate-anchor":new Ze(ge.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ze(ge.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ze(ge.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new rt(ge.paint_circle["circle-stroke-width"]),"circle-stroke-color":new rt(ge.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new rt(ge.paint_circle["circle-stroke-opacity"])})},get layout(){return zp=zp||new f({"circle-sort-key":new rt(ge.layout_circle["circle-sort-key"])})}},ln=1e-6,Za=typeof Float32Array<"u"?Float32Array:Array;function id(i){return i[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i}function Lp(i,t,n){var o=t[0],h=t[1],g=t[2],_=t[3],v=t[4],w=t[5],T=t[6],E=t[7],M=t[8],z=t[9],R=t[10],N=t[11],U=t[12],G=t[13],J=t[14],de=t[15],re=n[0],ue=n[1],_e=n[2],Se=n[3];return i[0]=re*o+ue*v+_e*M+Se*U,i[1]=re*h+ue*w+_e*z+Se*G,i[2]=re*g+ue*T+_e*R+Se*J,i[3]=re*_+ue*E+_e*N+Se*de,i[4]=(re=n[4])*o+(ue=n[5])*v+(_e=n[6])*M+(Se=n[7])*U,i[5]=re*h+ue*w+_e*z+Se*G,i[6]=re*g+ue*T+_e*R+Se*J,i[7]=re*_+ue*E+_e*N+Se*de,i[8]=(re=n[8])*o+(ue=n[9])*v+(_e=n[10])*M+(Se=n[11])*U,i[9]=re*h+ue*w+_e*z+Se*G,i[10]=re*g+ue*T+_e*R+Se*J,i[11]=re*_+ue*E+_e*N+Se*de,i[12]=(re=n[12])*o+(ue=n[13])*v+(_e=n[14])*M+(Se=n[15])*U,i[13]=re*h+ue*w+_e*z+Se*G,i[14]=re*g+ue*T+_e*R+Se*J,i[15]=re*_+ue*E+_e*N+Se*de,i}Math.hypot||(Math.hypot=function(){for(var i=0,t=arguments.length;t--;)i+=arguments[t]*arguments[t];return Math.sqrt(i)});var pc,R_=Lp;function Vu(i,t,n){var o=t[0],h=t[1],g=t[2],_=t[3];return i[0]=n[0]*o+n[4]*h+n[8]*g+n[12]*_,i[1]=n[1]*o+n[5]*h+n[9]*g+n[13]*_,i[2]=n[2]*o+n[6]*h+n[10]*g+n[14]*_,i[3]=n[3]*o+n[7]*h+n[11]*g+n[15]*_,i}pc=new Za(4),Za!=Float32Array&&(pc[0]=0,pc[1]=0,pc[2]=0,pc[3]=0);class B_ extends s{constructor(t){super(t,L_)}createBucket(t){return new Qh(t)}queryRadius(t){const n=t;return dc("circle-radius",this,n)+dc("circle-stroke-width",this,n)+Ou(this.paint.get("circle-translate"))}queryIntersectsFeature(t,n,o,h,g,_,v,w){const T=Nu(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,v),E=this.paint.get("circle-radius").evaluate(n,o)+this.paint.get("circle-stroke-width").evaluate(n,o),M=this.paint.get("circle-pitch-alignment")==="map",z=M?T:function(N,U){return N.map(G=>Rp(G,U))}(T,w),R=M?E*v:E;for(const N of h)for(const U of N){const G=M?U:Rp(U,w);let J=R;const de=Vu([],[U.x,U.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?J*=de[3]/_.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(J*=_.cameraToCenterDistance/de[3]),k_(z,G,J))return!0}return!1}}function Rp(i,t){const n=Vu([],[i.x,i.y,0,1],t);return new q(n[0]/n[3],n[1]/n[3])}class Bp extends Qh{}let Fp;$e("HeatmapBucket",Bp,{omit:["layers"]});var F_={get paint(){return Fp=Fp||new f({"heatmap-radius":new rt(ge.paint_heatmap["heatmap-radius"]),"heatmap-weight":new rt(ge.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ze(ge.paint_heatmap["heatmap-intensity"]),"heatmap-color":new cc(ge.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ze(ge.paint_heatmap["heatmap-opacity"])})}};function nd(i,{width:t,height:n},o,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*n*o)throw new RangeError(`mismatched image size. expected: ${h.length} but got: ${t*n*o}`)}else h=new Uint8Array(t*n*o);return i.width=t,i.height=n,i.data=h,i}function Op(i,{width:t,height:n},o){if(t===i.width&&n===i.height)return;const h=nd({},{width:t,height:n},o);rd(i,h,{x:0,y:0},{x:0,y:0},{width:Math.min(i.width,t),height:Math.min(i.height,n)},o),i.width=t,i.height=n,i.data=h.data}function rd(i,t,n,o,h,g){if(h.width===0||h.height===0)return t;if(h.width>i.width||h.height>i.height||n.x>i.width-h.width||n.y>i.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||o.x>t.width-h.width||o.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=i.data,v=t.data;if(_===v)throw new Error("srcData equals dstData, so image is already copied");for(let w=0;w<h.height;w++){const T=((n.y+w)*i.width+n.x)*g,E=((o.y+w)*t.width+o.x)*g;for(let M=0;M<h.width*g;M++)v[E+M]=_[T+M]}return t}class mc{constructor(t,n){nd(this,t,1,n)}resize(t){Op(this,t,1)}clone(){return new mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,h,g){rd(t,n,o,h,g,1)}}class Zn{constructor(t,n){nd(this,t,4,n)}resize(t){Op(this,t,4)}replace(t,n){n?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Zn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,n,o,h,g){rd(t,n,o,h,g,4)}}function Np(i){const t={},n=i.resolution||256,o=i.clips?i.clips.length:1,h=i.image||new Zn({width:n,height:o});if(Math.log(n)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${n}`);const g=(_,v,w)=>{t[i.evaluationKey]=w;const T=i.expression.evaluate(t);h.data[_+v+0]=Math.floor(255*T.r/T.a),h.data[_+v+1]=Math.floor(255*T.g/T.a),h.data[_+v+2]=Math.floor(255*T.b/T.a),h.data[_+v+3]=Math.floor(255*T.a)};if(i.clips)for(let _=0,v=0;_<o;++_,v+=4*n)for(let w=0,T=0;w<n;w++,T+=4){const E=w/(n-1),{start:M,end:z}=i.clips[_];g(v,T,M*(1-E)+z*E)}else for(let _=0,v=0;_<n;_++,v+=4)g(0,v,_/(n-1));return h}$e("AlphaImage",mc),$e("RGBAImage",Zn);const sd="big-fb";class O_ extends s{createBucket(t){return new Bp(t)}constructor(t){super(t,F_),this.heatmapFbos=new Map,this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Np({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbos.has(sd)&&this.heatmapFbos.delete(sd)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}}let Vp;var N_={get paint(){return Vp=Vp||new f({"hillshade-illumination-direction":new Ze(ge.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ze(ge.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ze(ge.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ze(ge.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ze(ge.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ze(ge.paint_hillshade["hillshade-accent-color"])})}};class V_ extends s{constructor(t){super(t,N_)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}}const U_=b([{name:"a_pos",components:2,type:"Int16"}],4),{members:$_}=U_;function Up(i,t,n=2){const o=t&&t.length,h=o?t[0]*n:i.length;let g=$p(i,0,h,n,!0);const _=[];if(!g||g.next===g.prev)return _;let v,w,T;if(o&&(g=function(E,M,z,R){const N=[];for(let U=0,G=M.length;U<G;U++){const J=$p(E,M[U]*R,U<G-1?M[U+1]*R:E.length,R,!1);J===J.next&&(J.steiner=!0),N.push(Y_(J))}N.sort(Z_);for(let U=0;U<N.length;U++)z=G_(N[U],z);return z}(i,t,g,n)),i.length>80*n){v=1/0,w=1/0;let E=-1/0,M=-1/0;for(let z=n;z<h;z+=n){const R=i[z],N=i[z+1];R<v&&(v=R),N<w&&(w=N),R>E&&(E=R),N>M&&(M=N)}T=Math.max(E-v,M-w),T=T!==0?32767/T:0}return fc(g,_,n,v,w,T,0),_}function $p(i,t,n,o,h){let g;if(h===function(_,v,w,T){let E=0;for(let M=v,z=w-T;M<w;M+=T)E+=(_[z]-_[M])*(_[M+1]+_[z+1]),z=M;return E}(i,t,n,o)>0)for(let _=t;_<n;_+=o)g=Hp(_/o|0,i[_],i[_+1],g);else for(let _=n-o;_>=t;_-=o)g=Hp(_/o|0,i[_],i[_+1],g);return g&&Uu(g,g.next)&&(_c(g),g=g.next),g}function Xo(i,t){if(!i)return i;t||(t=i);let n,o=i;do if(n=!1,o.steiner||!Uu(o,o.next)&&yi(o.prev,o,o.next)!==0)o=o.next;else{if(_c(o),o=t=o.prev,o===o.next)break;n=!0}while(n||o!==t);return t}function fc(i,t,n,o,h,g,_){if(!i)return;!_&&g&&function(w,T,E,M){let z=w;do z.z===0&&(z.z=od(z.x,z.y,T,E,M)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next;while(z!==w);z.prevZ.nextZ=null,z.prevZ=null,function(R){let N,U=1;do{let G,J=R;R=null;let de=null;for(N=0;J;){N++;let re=J,ue=0;for(let Se=0;Se<U&&(ue++,re=re.nextZ,re);Se++);let _e=U;for(;ue>0||_e>0&&re;)ue!==0&&(_e===0||!re||J.z<=re.z)?(G=J,J=J.nextZ,ue--):(G=re,re=re.nextZ,_e--),de?de.nextZ=G:R=G,G.prevZ=de,de=G;J=re}de.nextZ=null,U*=2}while(N>1)}(z)}(i,o,h,g);let v=i;for(;i.prev!==i.next;){const w=i.prev,T=i.next;if(g?q_(i,o,h,g):j_(i))t.push(w.i,i.i,T.i),_c(i),i=T.next,v=T.next;else if((i=T)===v){_?_===1?fc(i=H_(Xo(i),t),t,n,o,h,g,2):_===2&&W_(i,t,n,o,h,g):fc(Xo(i),t,n,o,h,g,1);break}}}function j_(i){const t=i.prev,n=i,o=i.next;if(yi(t,n,o)>=0)return!1;const h=t.x,g=n.x,_=o.x,v=t.y,w=n.y,T=o.y,E=h<g?h<_?h:_:g<_?g:_,M=v<w?v<T?v:T:w<T?w:T,z=h>g?h>_?h:_:g>_?g:_,R=v>w?v>T?v:T:w>T?w:T;let N=o.next;for(;N!==t;){if(N.x>=E&&N.x<=z&&N.y>=M&&N.y<=R&&Ga(h,v,g,w,_,T,N.x,N.y)&&yi(N.prev,N,N.next)>=0)return!1;N=N.next}return!0}function q_(i,t,n,o){const h=i.prev,g=i,_=i.next;if(yi(h,g,_)>=0)return!1;const v=h.x,w=g.x,T=_.x,E=h.y,M=g.y,z=_.y,R=v<w?v<T?v:T:w<T?w:T,N=E<M?E<z?E:z:M<z?M:z,U=v>w?v>T?v:T:w>T?w:T,G=E>M?E>z?E:z:M>z?M:z,J=od(R,N,t,n,o),de=od(U,G,t,n,o);let re=i.prevZ,ue=i.nextZ;for(;re&&re.z>=J&&ue&&ue.z<=de;){if(re.x>=R&&re.x<=U&&re.y>=N&&re.y<=G&&re!==h&&re!==_&&Ga(v,E,w,M,T,z,re.x,re.y)&&yi(re.prev,re,re.next)>=0||(re=re.prevZ,ue.x>=R&&ue.x<=U&&ue.y>=N&&ue.y<=G&&ue!==h&&ue!==_&&Ga(v,E,w,M,T,z,ue.x,ue.y)&&yi(ue.prev,ue,ue.next)>=0))return!1;ue=ue.nextZ}for(;re&&re.z>=J;){if(re.x>=R&&re.x<=U&&re.y>=N&&re.y<=G&&re!==h&&re!==_&&Ga(v,E,w,M,T,z,re.x,re.y)&&yi(re.prev,re,re.next)>=0)return!1;re=re.prevZ}for(;ue&&ue.z<=de;){if(ue.x>=R&&ue.x<=U&&ue.y>=N&&ue.y<=G&&ue!==h&&ue!==_&&Ga(v,E,w,M,T,z,ue.x,ue.y)&&yi(ue.prev,ue,ue.next)>=0)return!1;ue=ue.nextZ}return!0}function H_(i,t){let n=i;do{const o=n.prev,h=n.next.next;!Uu(o,h)&&jp(o,n,n.next,h)&&gc(o,h)&&gc(h,o)&&(t.push(o.i,n.i,h.i),_c(n),_c(n.next),n=i=h),n=n.next}while(n!==i);return Xo(n)}function W_(i,t,n,o,h,g){let _=i;do{let v=_.next.next;for(;v!==_.prev;){if(_.i!==v.i&&K_(_,v)){let w=qp(_,v);return _=Xo(_,_.next),w=Xo(w,w.next),fc(_,t,n,o,h,g,0),void fc(w,t,n,o,h,g,0)}v=v.next}_=_.next}while(_!==i)}function Z_(i,t){return i.x-t.x}function G_(i,t){const n=function(h,g){let _=g;const v=h.x,w=h.y;let T,E=-1/0;do{if(w<=_.y&&w>=_.next.y&&_.next.y!==_.y){const U=_.x+(w-_.y)*(_.next.x-_.x)/(_.next.y-_.y);if(U<=v&&U>E&&(E=U,T=_.x<_.next.x?_:_.next,U===v))return T}_=_.next}while(_!==g);if(!T)return null;const M=T,z=T.x,R=T.y;let N=1/0;_=T;do{if(v>=_.x&&_.x>=z&&v!==_.x&&Ga(w<R?v:E,w,z,R,w<R?E:v,w,_.x,_.y)){const U=Math.abs(w-_.y)/(v-_.x);gc(_,h)&&(U<N||U===N&&(_.x>T.x||_.x===T.x&&X_(T,_)))&&(T=_,N=U)}_=_.next}while(_!==M);return T}(i,t);if(!n)return t;const o=qp(n,i);return Xo(o,o.next),Xo(n,n.next)}function X_(i,t){return yi(i.prev,i,t.prev)<0&&yi(t.next,i,i.next)<0}function od(i,t,n,o,h){return(i=1431655765&((i=858993459&((i=252645135&((i=16711935&((i=(i-n)*h|0)|i<<8))|i<<4))|i<<2))|i<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-o)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Y_(i){let t=i,n=i;do(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next;while(t!==i);return n}function Ga(i,t,n,o,h,g,_,v){return(h-_)*(t-v)>=(i-_)*(g-v)&&(i-_)*(o-v)>=(n-_)*(t-v)&&(n-_)*(g-v)>=(h-_)*(o-v)}function K_(i,t){return i.next.i!==t.i&&i.prev.i!==t.i&&!function(n,o){let h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==o.i&&h.next.i!==o.i&&jp(h,h.next,n,o))return!0;h=h.next}while(h!==n);return!1}(i,t)&&(gc(i,t)&&gc(t,i)&&function(n,o){let h=n,g=!1;const _=(n.x+o.x)/2,v=(n.y+o.y)/2;do h.y>v!=h.next.y>v&&h.next.y!==h.y&&_<(h.next.x-h.x)*(v-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==n);return g}(i,t)&&(yi(i.prev,i,t.prev)||yi(i,t.prev,t))||Uu(i,t)&&yi(i.prev,i,i.next)>0&&yi(t.prev,t,t.next)>0)}function yi(i,t,n){return(t.y-i.y)*(n.x-t.x)-(t.x-i.x)*(n.y-t.y)}function Uu(i,t){return i.x===t.x&&i.y===t.y}function jp(i,t,n,o){const h=ju(yi(i,t,n)),g=ju(yi(i,t,o)),_=ju(yi(n,o,i)),v=ju(yi(n,o,t));return h!==g&&_!==v||!(h!==0||!$u(i,n,t))||!(g!==0||!$u(i,o,t))||!(_!==0||!$u(n,i,o))||!(v!==0||!$u(n,t,o))}function $u(i,t,n){return t.x<=Math.max(i.x,n.x)&&t.x>=Math.min(i.x,n.x)&&t.y<=Math.max(i.y,n.y)&&t.y>=Math.min(i.y,n.y)}function ju(i){return i>0?1:i<0?-1:0}function gc(i,t){return yi(i.prev,i,i.next)<0?yi(i,t,i.next)>=0&&yi(i,i.prev,t)>=0:yi(i,t,i.prev)<0||yi(i,i.next,t)<0}function qp(i,t){const n=ad(i.i,i.x,i.y),o=ad(t.i,t.x,t.y),h=i.next,g=t.prev;return i.next=t,t.prev=i,n.next=h,h.prev=n,o.next=n,n.prev=o,g.next=o,o.prev=g,o}function Hp(i,t,n,o){const h=ad(i,t,n);return o?(h.next=o.next,h.prev=o,o.next.prev=h,o.next=h):(h.prev=h,h.next=h),h}function _c(i){i.next.prev=i.prev,i.prev.next=i.next,i.prevZ&&(i.prevZ.nextZ=i.nextZ),i.nextZ&&(i.nextZ.prevZ=i.prevZ)}function ad(i,t,n){return{i,x:t,y:n,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function ld(i,t,n){const o=n.patternDependencies;let h=!1;for(const g of t){const _=g.paint.get(`${i}-pattern`);_.isConstant()||(h=!0);const v=_.constantOr(null);v&&(h=!0,o[v.to]=!0,o[v.from]=!0)}return h}function cd(i,t,n,o,h){const g=h.patternDependencies;for(const _ of t){const v=_.paint.get(`${i}-pattern`).value;if(v.kind!=="constant"){let w=v.evaluate({zoom:o-1},n,{},h.availableImages),T=v.evaluate({zoom:o},n,{},h.availableImages),E=v.evaluate({zoom:o+1},n,{},h.availableImages);w=w&&w.name?w.name:w,T=T&&T.name?T.name:T,E=E&&E.name?E.name:E,g[w]=!0,g[T]=!0,g[E]=!0,n.patterns[_.id]={min:w,mid:T,max:E}}}return n}class ud{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new pr,this.indexArray=new Wn,this.indexArray2=new Fi,this.programConfigurations=new Wo(t.layers,t.zoom),this.segments=new Ct,this.segments2=new Ct,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ld("fill",this.layers,n);const h=this.layers[0].layout.get("fill-sort-key"),g=!h.isConstant(),_=[];for(const{feature:v,id:w,index:T,sourceLayerIndex:E}of t){const M=this.layers[0]._featureFilter.needGeometry,z=Go(v,M);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),z,o))continue;const R=g?h.evaluate(z,{},o,n.availableImages):void 0,N={id:w,properties:v.properties,type:v.type,sourceLayerIndex:E,index:T,geometry:M?z.geometry:Zo(v),patterns:{},sortKey:R};_.push(N)}g&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:T,sourceLayerIndex:E}=v;if(this.hasPattern){const M=cd("fill",this.layers,v,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(v,w,T,o,{});n.featureIndex.insert(t[T].feature,w,T,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,$_),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,n,o,h,g){for(const _ of ya(n,500)){let v=0;for(const R of _)v+=R.length;const w=this.segments.prepareSegment(v,this.layoutVertexArray,this.indexArray),T=w.vertexLength,E=[],M=[];for(const R of _){if(R.length===0)continue;R!==_[0]&&M.push(E.length/2);const N=this.segments2.prepareSegment(R.length,this.layoutVertexArray,this.indexArray2),U=N.vertexLength;this.layoutVertexArray.emplaceBack(R[0].x,R[0].y),this.indexArray2.emplaceBack(U+R.length-1,U),E.push(R[0].x),E.push(R[0].y);for(let G=1;G<R.length;G++)this.layoutVertexArray.emplaceBack(R[G].x,R[G].y),this.indexArray2.emplaceBack(U+G-1,U+G),E.push(R[G].x),E.push(R[G].y);N.vertexLength+=R.length,N.primitiveLength+=R.length}const z=Up(E,M);for(let R=0;R<z.length;R+=3)this.indexArray.emplaceBack(T+z[R],T+z[R+1],T+z[R+2]);w.vertexLength+=v,w.primitiveLength+=z.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,h)}}let Wp,Zp;$e("FillBucket",ud,{omit:["layers","patternFeatures"]});var J_={get paint(){return Zp=Zp||new f({"fill-antialias":new Ze(ge.paint_fill["fill-antialias"]),"fill-opacity":new rt(ge.paint_fill["fill-opacity"]),"fill-color":new rt(ge.paint_fill["fill-color"]),"fill-outline-color":new rt(ge.paint_fill["fill-outline-color"]),"fill-translate":new Ze(ge.paint_fill["fill-translate"]),"fill-translate-anchor":new Ze(ge.paint_fill["fill-translate-anchor"]),"fill-pattern":new Oa(ge.paint_fill["fill-pattern"])})},get layout(){return Wp=Wp||new f({"fill-sort-key":new rt(ge.layout_fill["fill-sort-key"])})}};class Q_ extends s{constructor(t){super(t,J_)}recalculate(t,n){super.recalculate(t,n);const o=this.paint._values["fill-outline-color"];o.value.kind==="constant"&&o.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new ud(t)}queryRadius(){return Ou(this.paint.get("fill-translate"))}queryIntersectsFeature(t,n,o,h,g,_,v){return Mp(Nu(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,v),h)}isTileClipped(){return!0}}const ey=b([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),ty=b([{name:"a_centroid",components:2,type:"Int16"}],4),{members:iy}=ey;var Js={},ny=V,Gp=Xa;function Xa(i,t,n,o,h){this.properties={},this.extent=n,this.type=0,this._pbf=i,this._geometry=-1,this._keys=o,this._values=h,i.readFields(ry,this,t)}function ry(i,t,n){i==1?t.id=n.readVarint():i==2?function(o,h){for(var g=o.readVarint()+o.pos;o.pos<g;){var _=h._keys[o.readVarint()],v=h._values[o.readVarint()];h.properties[_]=v}}(n,t):i==3?t.type=n.readVarint():i==4&&(t._geometry=n.pos)}function sy(i){for(var t,n,o=0,h=0,g=i.length,_=g-1;h<g;_=h++)o+=((n=i[_]).x-(t=i[h]).x)*(t.y+n.y);return o}Xa.types=["Unknown","Point","LineString","Polygon"],Xa.prototype.loadGeometry=function(){var i=this._pbf;i.pos=this._geometry;for(var t,n=i.readVarint()+i.pos,o=1,h=0,g=0,_=0,v=[];i.pos<n;){if(h<=0){var w=i.readVarint();o=7&w,h=w>>3}if(h--,o===1||o===2)g+=i.readSVarint(),_+=i.readSVarint(),o===1&&(t&&v.push(t),t=[]),t.push(new ny(g,_));else{if(o!==7)throw new Error("unknown command "+o);t&&t.push(t[0].clone())}}return t&&v.push(t),v},Xa.prototype.bbox=function(){var i=this._pbf;i.pos=this._geometry;for(var t=i.readVarint()+i.pos,n=1,o=0,h=0,g=0,_=1/0,v=-1/0,w=1/0,T=-1/0;i.pos<t;){if(o<=0){var E=i.readVarint();n=7&E,o=E>>3}if(o--,n===1||n===2)(h+=i.readSVarint())<_&&(_=h),h>v&&(v=h),(g+=i.readSVarint())<w&&(w=g),g>T&&(T=g);else if(n!==7)throw new Error("unknown command "+n)}return[_,w,v,T]},Xa.prototype.toGeoJSON=function(i,t,n){var o,h,g=this.extent*Math.pow(2,n),_=this.extent*i,v=this.extent*t,w=this.loadGeometry(),T=Xa.types[this.type];function E(R){for(var N=0;N<R.length;N++){var U=R[N];R[N]=[360*(U.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+v)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(o=0;o<w.length;o++)M[o]=w[o][0];E(w=M);break;case 2:for(o=0;o<w.length;o++)E(w[o]);break;case 3:for(w=function(R){var N=R.length;if(N<=1)return[R];for(var U,G,J=[],de=0;de<N;de++){var re=sy(R[de]);re!==0&&(G===void 0&&(G=re<0),G===re<0?(U&&J.push(U),U=[R[de]]):U.push(R[de]))}return U&&J.push(U),J}(w),o=0;o<w.length;o++)for(h=0;h<w[o].length;h++)E(w[o][h])}w.length===1?w=w[0]:T="Multi"+T;var z={type:"Feature",geometry:{type:T,coordinates:w},properties:this.properties};return"id"in this&&(z.id=this.id),z};var oy=Gp,Xp=Yp;function Yp(i,t){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=i,this._keys=[],this._values=[],this._features=[],i.readFields(ay,this,t),this.length=this._features.length}function ay(i,t,n){i===15?t.version=n.readVarint():i===1?t.name=n.readString():i===5?t.extent=n.readVarint():i===2?t._features.push(n.pos):i===3?t._keys.push(n.readString()):i===4&&t._values.push(function(o){for(var h=null,g=o.readVarint()+o.pos;o.pos<g;){var _=o.readVarint()>>3;h=_===1?o.readString():_===2?o.readFloat():_===3?o.readDouble():_===4?o.readVarint64():_===5?o.readVarint():_===6?o.readSVarint():_===7?o.readBoolean():null}return h}(n))}Yp.prototype.feature=function(i){if(i<0||i>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[i];var t=this._pbf.readVarint()+this._pbf.pos;return new oy(this._pbf,t,this.extent,this._keys,this._values)};var ly=Xp;function cy(i,t,n){if(i===3){var o=new ly(n,n.readVarint()+n.pos);o.length&&(t[o.name]=o)}}Js.VectorTile=function(i,t){this.layers=i.readFields(cy,{},t)},Js.VectorTileFeature=Gp,Js.VectorTileLayer=Xp;const uy=Js.VectorTileFeature.types,hd=Math.pow(2,13);function yc(i,t,n,o,h,g,_,v){i.emplaceBack(t,n,2*Math.floor(o*hd)+_,h*hd*2,g*hd*2,Math.round(v))}class dd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ws,this.centroidVertexArray=new ji,this.indexArray=new Wn,this.programConfigurations=new Wo(t.layers,t.zoom),this.segments=new Ct,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.features=[],this.hasPattern=ld("fill-extrusion",this.layers,n);for(const{feature:h,id:g,index:_,sourceLayerIndex:v}of t){const w=this.layers[0]._featureFilter.needGeometry,T=Go(h,w);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),T,o))continue;const E={id:g,sourceLayerIndex:v,index:_,geometry:w?T.geometry:Zo(h),properties:h.properties,type:h.type,patterns:{}};this.hasPattern?this.features.push(cd("fill-extrusion",this.layers,E,this.zoom,n)):this.addFeature(E,E.geometry,_,o,{}),n.featureIndex.insert(h,E.geometry,_,v,this.index,!0)}}addFeatures(t,n,o){for(const h of this.features){const{geometry:g}=h;this.addFeature(h,g,h.index,n,o)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iy),this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,ty.members,!0),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(t,n,o,h,g){for(const _ of ya(n,500)){const v={x:0,y:0,vertexCount:0};let w=0;for(const N of _)w+=N.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const N of _){if(N.length===0||dy(N))continue;let U=0;for(let G=0;G<N.length;G++){const J=N[G];if(G>=1){const de=N[G-1];if(!hy(J,de)){T.vertexLength+4>Ct.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const re=J.sub(de)._perp()._unit(),ue=de.dist(J);U+ue>32768&&(U=0),yc(this.layoutVertexArray,J.x,J.y,re.x,re.y,0,0,U),yc(this.layoutVertexArray,J.x,J.y,re.x,re.y,0,1,U),v.x+=2*J.x,v.y+=2*J.y,v.vertexCount+=2,U+=ue,yc(this.layoutVertexArray,de.x,de.y,re.x,re.y,0,0,U),yc(this.layoutVertexArray,de.x,de.y,re.x,re.y,0,1,U),v.x+=2*de.x,v.y+=2*de.y,v.vertexCount+=2;const _e=T.vertexLength;this.indexArray.emplaceBack(_e,_e+2,_e+1),this.indexArray.emplaceBack(_e+1,_e+2,_e+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+w>Ct.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray)),uy[t.type]!=="Polygon")continue;const E=[],M=[],z=T.vertexLength;for(const N of _)if(N.length!==0){N!==_[0]&&M.push(E.length/2);for(let U=0;U<N.length;U++){const G=N[U];yc(this.layoutVertexArray,G.x,G.y,0,0,1,1,0),v.x+=G.x,v.y+=G.y,v.vertexCount+=1,E.push(G.x),E.push(G.y)}}const R=Up(E,M);for(let N=0;N<R.length;N+=3)this.indexArray.emplaceBack(z+R[N],z+R[N+2],z+R[N+1]);T.primitiveLength+=R.length/3,T.vertexLength+=w;for(let N=0;N<v.vertexCount;N++){const U=Math.floor(v.x/v.vertexCount),G=Math.floor(v.y/v.vertexCount);this.centroidVertexArray.emplaceBack(U,G)}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,h)}}function hy(i,t){return i.x===t.x&&(i.x<0||i.x>wi)||i.y===t.y&&(i.y<0||i.y>wi)}function dy(i){return i.every(t=>t.x<0)||i.every(t=>t.x>wi)||i.every(t=>t.y<0)||i.every(t=>t.y>wi)}let Kp;$e("FillExtrusionBucket",dd,{omit:["layers","features"]});var py={get paint(){return Kp=Kp||new f({"fill-extrusion-opacity":new Ze(ge["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new rt(ge["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ze(ge["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ze(ge["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Oa(ge["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new rt(ge["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new rt(ge["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ze(ge["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};class my extends s{constructor(t){super(t,py)}createBucket(t){return new dd(t)}queryRadius(){return Ou(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(t,n,o,h,g,_,v,w){const T=Nu(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,v),E=this.paint.get("fill-extrusion-height").evaluate(n,o),M=this.paint.get("fill-extrusion-base").evaluate(n,o),z=function(N,U,G,J){const de=[];for(const re of N){const ue=[re.x,re.y,0,1];Vu(ue,ue,U),de.push(new q(ue[0]/ue[3],ue[1]/ue[3]))}return de}(T,w),R=function(N,U,G,J){const de=[],re=[],ue=J[8]*U,_e=J[9]*U,Se=J[10]*U,Oe=J[11]*U,nt=J[8]*G,Re=J[9]*G,De=J[10]*G,Ke=J[11]*G;for(const He of N){const Ue=[],xe=[];for(const Je of He){const Xe=Je.x,lt=Je.y,Gt=J[0]*Xe+J[4]*lt+J[12],$t=J[1]*Xe+J[5]*lt+J[13],Ai=J[2]*Xe+J[6]*lt+J[14],mr=J[3]*Xe+J[7]*lt+J[15],Wi=Ai+Se,zi=mr+Oe,cn=Gt+nt,un=$t+Re,hn=Ai+De,gi=mr+Ke,Di=new q((Gt+ue)/zi,($t+_e)/zi);Di.z=Wi/zi,Ue.push(Di);const tn=new q(cn/gi,un/gi);tn.z=hn/gi,xe.push(tn)}de.push(Ue),re.push(xe)}return[de,re]}(h,M,E,w);return function(N,U,G){let J=1/0;Mp(G,U)&&(J=Jp(G,U[0]));for(let de=0;de<U.length;de++){const re=U[de],ue=N[de];for(let _e=0;_e<re.length-1;_e++){const Se=re[_e],Oe=[Se,re[_e+1],ue[_e+1],ue[_e],Se];Pp(G,Oe)&&(J=Math.min(J,Jp(G,Oe)))}}return J!==1/0&&J}(R[0],R[1],z)}}function vc(i,t){return i.x*t.x+i.y*t.y}function Jp(i,t){if(i.length===1){let n=0;const o=t[n++];let h;for(;!h||o.equals(h);)if(h=t[n++],!h)return 1/0;for(;n<t.length;n++){const g=t[n],_=i[0],v=h.sub(o),w=g.sub(o),T=_.sub(o),E=vc(v,v),M=vc(v,w),z=vc(w,w),R=vc(T,v),N=vc(T,w),U=E*z-M*M,G=(z*R-M*N)/U,J=(E*N-M*R)/U,de=o.z*(1-G-J)+h.z*G+g.z*J;if(isFinite(de))return de}return 1/0}{let n=1/0;for(const o of t)n=Math.min(n,o.z);return n}}const fy=b([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:gy}=fy,_y=b([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:yy}=_y,vy=Js.VectorTileFeature.types,xy=Math.cos(Math.PI/180*37.5),Qp=Math.pow(2,14)/.5;class pd{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(n=>n.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new Va,this.layoutVertexArray2=new Zs,this.indexArray=new Wn,this.programConfigurations=new Wo(t.layers,t.zoom),this.segments=new Ct,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(t,n,o){this.hasPattern=ld("line",this.layers,n);const h=this.layers[0].layout.get("line-sort-key"),g=!h.isConstant(),_=[];for(const{feature:v,id:w,index:T,sourceLayerIndex:E}of t){const M=this.layers[0]._featureFilter.needGeometry,z=Go(v,M);if(!this.layers[0]._featureFilter.filter(new ei(this.zoom),z,o))continue;const R=g?h.evaluate(z,{},o):void 0,N={id:w,properties:v.properties,type:v.type,sourceLayerIndex:E,index:T,geometry:M?z.geometry:Zo(v),patterns:{},sortKey:R};_.push(N)}g&&_.sort((v,w)=>v.sortKey-w.sortKey);for(const v of _){const{geometry:w,index:T,sourceLayerIndex:E}=v;if(this.hasPattern){const M=cd("line",this.layers,v,this.zoom,n);this.patternFeatures.push(M)}else this.addFeature(v,w,T,o,{});n.featureIndex.insert(t[T].feature,w,T,E,this.index)}}update(t,n,o){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,n,this.stateDependentLayers,o)}addFeatures(t,n,o){for(const h of this.patternFeatures)this.addFeature(h,h.geometry,h.index,n,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,yy)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,gy),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(t.properties,"mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,n,o,h,g){const _=this.layers[0].layout,v=_.get("line-join").evaluate(t,{}),w=_.get("line-cap"),T=_.get("line-miter-limit"),E=_.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const M of n)this.addLine(M,t,v,w,T,E);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,o,g,h)}addLine(t,n,o,h,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let J=0;J<t.length-1;J++)this.totalDistance+=t[J].dist(t[J+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const v=vy[n.type]==="Polygon";let w=t.length;for(;w>=2&&t[w-1].equals(t[w-2]);)w--;let T=0;for(;T<w-1&&t[T].equals(t[T+1]);)T++;if(w<(v?3:2))return;o==="bevel"&&(g=1.05);const E=this.overscaling<=16?15*wi/(512*this.overscaling):0,M=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let z,R,N,U,G;this.e1=this.e2=-1,v&&(z=t[w-2],G=t[T].sub(z)._unit()._perp());for(let J=T;J<w;J++){if(N=J===w-1?v?t[T+1]:void 0:t[J+1],N&&t[J].equals(N))continue;G&&(U=G),z&&(R=z),z=t[J],G=N?N.sub(z)._unit()._perp():U,U=U||G;let de=U.add(G);de.x===0&&de.y===0||de._unit();const re=U.x*G.x+U.y*G.y,ue=de.x*G.x+de.y*G.y,_e=ue!==0?1/ue:1/0,Se=2*Math.sqrt(2-2*ue),Oe=ue<xy&&R&&N,nt=U.x*G.y-U.y*G.x>0;if(Oe&&J>T){const Ke=z.dist(R);if(Ke>2*E){const He=z.sub(z.sub(R)._mult(E/Ke)._round());this.updateDistance(R,He),this.addCurrentVertex(He,U,0,0,M),R=He}}const Re=R&&N;let De=Re?o:v?"butt":h;if(Re&&De==="round"&&(_e<_?De="miter":_e<=2&&(De="fakeround")),De==="miter"&&_e>g&&(De="bevel"),De==="bevel"&&(_e>2&&(De="flipbevel"),_e<g&&(De="miter")),R&&this.updateDistance(R,z),De==="miter")de._mult(_e),this.addCurrentVertex(z,de,0,0,M);else if(De==="flipbevel"){if(_e>100)de=G.mult(-1);else{const Ke=_e*U.add(G).mag()/U.sub(G).mag();de._perp()._mult(Ke*(nt?-1:1))}this.addCurrentVertex(z,de,0,0,M),this.addCurrentVertex(z,de.mult(-1),0,0,M)}else if(De==="bevel"||De==="fakeround"){const Ke=-Math.sqrt(_e*_e-1),He=nt?Ke:0,Ue=nt?0:Ke;if(R&&this.addCurrentVertex(z,U,He,Ue,M),De==="fakeround"){const xe=Math.round(180*Se/Math.PI/20);for(let Je=1;Je<xe;Je++){let Xe=Je/xe;if(Xe!==.5){const Gt=Xe-.5;Xe+=Xe*Gt*(Xe-1)*((1.0904+re*(re*(3.55645-1.43519*re)-3.2452))*Gt*Gt+(.848013+re*(.215638*re-1.06021)))}const lt=G.sub(U)._mult(Xe)._add(U)._unit()._mult(nt?-1:1);this.addHalfVertex(z,lt.x,lt.y,!1,nt,0,M)}}N&&this.addCurrentVertex(z,G,-He,-Ue,M)}else if(De==="butt")this.addCurrentVertex(z,de,0,0,M);else if(De==="square"){const Ke=R?1:-1;this.addCurrentVertex(z,de,Ke,Ke,M)}else De==="round"&&(R&&(this.addCurrentVertex(z,U,0,0,M),this.addCurrentVertex(z,U,1,1,M,!0)),N&&(this.addCurrentVertex(z,G,-1,-1,M,!0),this.addCurrentVertex(z,G,0,0,M)));if(Oe&&J<w-1){const Ke=z.dist(N);if(Ke>2*E){const He=z.add(N.sub(z)._mult(E/Ke)._round());this.updateDistance(z,He),this.addCurrentVertex(He,G,0,0,M),z=He}}}}addCurrentVertex(t,n,o,h,g,_=!1){const v=n.y*h-n.x,w=-n.y-n.x*h;this.addHalfVertex(t,n.x+n.y*o,n.y-n.x*o,_,!1,o,g),this.addHalfVertex(t,v,w,_,!0,-h,g),this.distance>Qp/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(t,n,o,h,g,_))}addHalfVertex({x:t,y:n},o,h,g,_,v,w){const T=.5*(this.lineClips?this.scaledDistance*(Qp-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*o)+128,Math.round(63*h)+128,1+(v===0?0:v<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const E=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,E),w.primitiveLength++),_?this.e2=E:this.e1=E}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(t,n){this.distance+=t.dist(n),this.updateScaledDistance()}}let em,tm;$e("LineBucket",pd,{omit:["layers","patternFeatures"]});var im={get paint(){return tm=tm||new f({"line-opacity":new rt(ge.paint_line["line-opacity"]),"line-color":new rt(ge.paint_line["line-color"]),"line-translate":new Ze(ge.paint_line["line-translate"]),"line-translate-anchor":new Ze(ge.paint_line["line-translate-anchor"]),"line-width":new rt(ge.paint_line["line-width"]),"line-gap-width":new rt(ge.paint_line["line-gap-width"]),"line-offset":new rt(ge.paint_line["line-offset"]),"line-blur":new rt(ge.paint_line["line-blur"]),"line-dasharray":new Na(ge.paint_line["line-dasharray"]),"line-pattern":new Oa(ge.paint_line["line-pattern"]),"line-gradient":new cc(ge.paint_line["line-gradient"])})},get layout(){return em=em||new f({"line-cap":new Ze(ge.layout_line["line-cap"]),"line-join":new rt(ge.layout_line["line-join"]),"line-miter-limit":new Ze(ge.layout_line["line-miter-limit"]),"line-round-limit":new Ze(ge.layout_line["line-round-limit"]),"line-sort-key":new rt(ge.layout_line["line-sort-key"])})}};class by extends rt{possiblyEvaluate(t,n){return n=new ei(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),super.possiblyEvaluate(t,n)}evaluate(t,n,o,h){return n=We({},n,{zoom:Math.floor(n.zoom)}),super.evaluate(t,n,o,h)}}let qu;class wy extends s{constructor(t){super(t,im),this.gradientVersion=0,qu||(qu=new by(im.paint.properties["line-width"].specification),qu.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){const n=this.gradientExpression();this.stepInterpolant=!!function(o){return o._styleExpression!==void 0}(n)&&n._styleExpression.expression instanceof Es,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,n){super.recalculate(t,n),this.paint._values["line-floorwidth"]=qu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new pd(t)}queryRadius(t){const n=t,o=nm(dc("line-width",this,n),dc("line-gap-width",this,n)),h=dc("line-offset",this,n);return o/2+Math.abs(h)+Ou(this.paint.get("line-translate"))}queryIntersectsFeature(t,n,o,h,g,_,v){const w=Nu(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,v),T=v/2*nm(this.paint.get("line-width").evaluate(n,o),this.paint.get("line-gap-width").evaluate(n,o)),E=this.paint.get("line-offset").evaluate(n,o);return E&&(h=function(M,z){const R=[];for(let N=0;N<M.length;N++){const U=M[N],G=[];for(let J=0;J<U.length;J++){const de=U[J-1],re=U[J],ue=U[J+1],_e=J===0?new q(0,0):re.sub(de)._unit()._perp(),Se=J===U.length-1?new q(0,0):ue.sub(re)._unit()._perp(),Oe=_e._add(Se)._unit(),nt=Oe.x*Se.x+Oe.y*Se.y;nt!==0&&Oe._mult(1/nt),G.push(Oe._mult(z)._add(re))}R.push(G)}return R}(h,E*v)),function(M,z,R){for(let N=0;N<z.length;N++){const U=z[N];if(M.length>=3){for(let G=0;G<U.length;G++)if(Wa(M,U[G]))return!0}if(A_(M,U,R))return!0}return!1}(w,h,T)}isTileClipped(){return!0}}function nm(i,t){return t>0?t+2*i:i}const Cy=b([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Sy=b([{name:"a_projected_pos",components:3,type:"Float32"}],4);b([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Iy=b([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_box_real",components:2,type:"Int16"}]);b([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const rm=b([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Ty=b([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function Ey(i,t,n){return i.sections.forEach(o=>{o.text=function(h,g,_){const v=g.layout.get("text-transform").evaluate(_,{});return v==="uppercase"?h=h.toLocaleUpperCase():v==="lowercase"&&(h=h.toLocaleLowerCase()),xn.applyArabicShaping&&(h=xn.applyArabicShaping(h)),h}(o.text,t,n)}),i}b([{name:"triangle",components:3,type:"Uint16"}]),b([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),b([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Uint16",name:"textAnchorOffsetStartIndex"},{type:"Uint16",name:"textAnchorOffsetEndIndex"}]),b([{type:"Float32",name:"offsetX"}]),b([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]),b([{type:"Uint16",name:"textAnchor"},{type:"Float32",components:2,name:"textOffset"}]);const xc={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};var Ii=24,sm=Ut,om=function(i,t,n,o,h){var g,_,v=8*h-o-1,w=(1<<v)-1,T=w>>1,E=-7,M=h-1,z=-1,R=i[t+M];for(M+=z,g=R&(1<<-E)-1,R>>=-E,E+=v;E>0;g=256*g+i[t+M],M+=z,E-=8);for(_=g&(1<<-E)-1,g>>=-E,E+=o;E>0;_=256*_+i[t+M],M+=z,E-=8);if(g===0)g=1-T;else{if(g===w)return _?NaN:1/0*(R?-1:1);_+=Math.pow(2,o),g-=T}return(R?-1:1)*_*Math.pow(2,g-o)},am=function(i,t,n,o,h,g){var _,v,w,T=8*g-h-1,E=(1<<T)-1,M=E>>1,z=h===23?Math.pow(2,-24)-Math.pow(2,-77):0,R=0,N=1,U=t<0||t===0&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(v=isNaN(t)?1:0,_=E):(_=Math.floor(Math.log(t)/Math.LN2),t*(w=Math.pow(2,-_))<1&&(_--,w*=2),(t+=_+M>=1?z/w:z*Math.pow(2,1-M))*w>=2&&(_++,w/=2),_+M>=E?(v=0,_=E):_+M>=1?(v=(t*w-1)*Math.pow(2,h),_+=M):(v=t*Math.pow(2,M-1)*Math.pow(2,h),_=0));h>=8;i[n+R]=255&v,R+=N,v/=256,h-=8);for(_=_<<h|v,T+=h;T>0;i[n+R]=255&_,R+=N,_/=256,T-=8);i[n+R-N]|=128*U};function Ut(i){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(i)?i:new Uint8Array(i||0),this.pos=0,this.type=0,this.length=this.buf.length}Ut.Varint=0,Ut.Fixed64=1,Ut.Bytes=2,Ut.Fixed32=5;var md=4294967296,lm=1/md,cm=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");function cs(i){return i.type===Ut.Bytes?i.readVarint()+i.pos:i.pos+1}function Ya(i,t,n){return n?4294967296*t+(i>>>0):4294967296*(t>>>0)+(i>>>0)}function um(i,t,n){var o=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));n.realloc(o);for(var h=n.pos-1;h>=i;h--)n.buf[h+o]=n.buf[h]}function Py(i,t){for(var n=0;n<i.length;n++)t.writeVarint(i[n])}function My(i,t){for(var n=0;n<i.length;n++)t.writeSVarint(i[n])}function ky(i,t){for(var n=0;n<i.length;n++)t.writeFloat(i[n])}function Ay(i,t){for(var n=0;n<i.length;n++)t.writeDouble(i[n])}function zy(i,t){for(var n=0;n<i.length;n++)t.writeBoolean(i[n])}function Dy(i,t){for(var n=0;n<i.length;n++)t.writeFixed32(i[n])}function Ly(i,t){for(var n=0;n<i.length;n++)t.writeSFixed32(i[n])}function Ry(i,t){for(var n=0;n<i.length;n++)t.writeFixed64(i[n])}function By(i,t){for(var n=0;n<i.length;n++)t.writeSFixed64(i[n])}function Hu(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+16777216*i[t+3]}function Ka(i,t,n){i[n]=t,i[n+1]=t>>>8,i[n+2]=t>>>16,i[n+3]=t>>>24}function hm(i,t){return(i[t]|i[t+1]<<8|i[t+2]<<16)+(i[t+3]<<24)}Ut.prototype={destroy:function(){this.buf=null},readFields:function(i,t,n){for(n=n||this.length;this.pos<n;){var o=this.readVarint(),h=o>>3,g=this.pos;this.type=7&o,i(h,t,this),this.pos===g&&this.skip(o)}return t},readMessage:function(i,t){return this.readFields(i,t,this.readVarint()+this.pos)},readFixed32:function(){var i=Hu(this.buf,this.pos);return this.pos+=4,i},readSFixed32:function(){var i=hm(this.buf,this.pos);return this.pos+=4,i},readFixed64:function(){var i=Hu(this.buf,this.pos)+Hu(this.buf,this.pos+4)*md;return this.pos+=8,i},readSFixed64:function(){var i=Hu(this.buf,this.pos)+hm(this.buf,this.pos+4)*md;return this.pos+=8,i},readFloat:function(){var i=om(this.buf,this.pos,!0,23,4);return this.pos+=4,i},readDouble:function(){var i=om(this.buf,this.pos,!0,52,8);return this.pos+=8,i},readVarint:function(i){var t,n,o=this.buf;return t=127&(n=o[this.pos++]),n<128?t:(t|=(127&(n=o[this.pos++]))<<7,n<128?t:(t|=(127&(n=o[this.pos++]))<<14,n<128?t:(t|=(127&(n=o[this.pos++]))<<21,n<128?t:function(h,g,_){var v,w,T=_.buf;if(v=(112&(w=T[_.pos++]))>>4,w<128||(v|=(127&(w=T[_.pos++]))<<3,w<128)||(v|=(127&(w=T[_.pos++]))<<10,w<128)||(v|=(127&(w=T[_.pos++]))<<17,w<128)||(v|=(127&(w=T[_.pos++]))<<24,w<128)||(v|=(1&(w=T[_.pos++]))<<31,w<128))return Ya(h,v,g);throw new Error("Expected varint not more than 10 bytes")}(t|=(15&(n=o[this.pos]))<<28,i,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var i=this.readVarint();return i%2==1?(i+1)/-2:i/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var i=this.readVarint()+this.pos,t=this.pos;return this.pos=i,i-t>=12&&cm?function(n,o,h){return cm.decode(n.subarray(o,h))}(this.buf,t,i):function(n,o,h){for(var g="",_=o;_<h;){var v,w,T,E=n[_],M=null,z=E>239?4:E>223?3:E>191?2:1;if(_+z>h)break;z===1?E<128&&(M=E):z===2?(192&(v=n[_+1]))==128&&(M=(31&E)<<6|63&v)<=127&&(M=null):z===3?(w=n[_+2],(192&(v=n[_+1]))==128&&(192&w)==128&&((M=(15&E)<<12|(63&v)<<6|63&w)<=2047||M>=55296&&M<=57343)&&(M=null)):z===4&&(w=n[_+2],T=n[_+3],(192&(v=n[_+1]))==128&&(192&w)==128&&(192&T)==128&&((M=(15&E)<<18|(63&v)<<12|(63&w)<<6|63&T)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,z=1):M>65535&&(M-=65536,g+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),g+=String.fromCharCode(M),_+=z}return g}(this.buf,t,i)},readBytes:function(){var i=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,i);return this.pos=i,t},readPackedVarint:function(i,t){if(this.type!==Ut.Bytes)return i.push(this.readVarint(t));var n=cs(this);for(i=i||[];this.pos<n;)i.push(this.readVarint(t));return i},readPackedSVarint:function(i){if(this.type!==Ut.Bytes)return i.push(this.readSVarint());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readSVarint());return i},readPackedBoolean:function(i){if(this.type!==Ut.Bytes)return i.push(this.readBoolean());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readBoolean());return i},readPackedFloat:function(i){if(this.type!==Ut.Bytes)return i.push(this.readFloat());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readFloat());return i},readPackedDouble:function(i){if(this.type!==Ut.Bytes)return i.push(this.readDouble());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readDouble());return i},readPackedFixed32:function(i){if(this.type!==Ut.Bytes)return i.push(this.readFixed32());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed32());return i},readPackedSFixed32:function(i){if(this.type!==Ut.Bytes)return i.push(this.readSFixed32());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed32());return i},readPackedFixed64:function(i){if(this.type!==Ut.Bytes)return i.push(this.readFixed64());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readFixed64());return i},readPackedSFixed64:function(i){if(this.type!==Ut.Bytes)return i.push(this.readSFixed64());var t=cs(this);for(i=i||[];this.pos<t;)i.push(this.readSFixed64());return i},skip:function(i){var t=7&i;if(t===Ut.Varint)for(;this.buf[this.pos++]>127;);else if(t===Ut.Bytes)this.pos=this.readVarint()+this.pos;else if(t===Ut.Fixed32)this.pos+=4;else{if(t!==Ut.Fixed64)throw new Error("Unimplemented type: "+t);this.pos+=8}},writeTag:function(i,t){this.writeVarint(i<<3|t)},realloc:function(i){for(var t=this.length||16;t<this.pos+i;)t*=2;if(t!==this.length){var n=new Uint8Array(t);n.set(this.buf),this.buf=n,this.length=t}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(i){this.realloc(4),Ka(this.buf,i,this.pos),this.pos+=4},writeSFixed32:function(i){this.realloc(4),Ka(this.buf,i,this.pos),this.pos+=4},writeFixed64:function(i){this.realloc(8),Ka(this.buf,-1&i,this.pos),Ka(this.buf,Math.floor(i*lm),this.pos+4),this.pos+=8},writeSFixed64:function(i){this.realloc(8),Ka(this.buf,-1&i,this.pos),Ka(this.buf,Math.floor(i*lm),this.pos+4),this.pos+=8},writeVarint:function(i){(i=+i||0)>268435455||i<0?function(t,n){var o,h;if(t>=0?(o=t%4294967296|0,h=t/4294967296|0):(h=~(-t/4294967296),4294967295^(o=~(-t%4294967296))?o=o+1|0:(o=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(g,_,v){v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,g>>>=7,v.buf[v.pos++]=127&g|128,v.buf[v.pos]=127&(g>>>=7)}(o,0,n),function(g,_){var v=(7&g)<<4;_.buf[_.pos++]|=v|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(h,n)}(i,this):(this.realloc(4),this.buf[this.pos++]=127&i|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=127&(i>>>=7)|(i>127?128:0),i<=127||(this.buf[this.pos++]=i>>>7&127))))},writeSVarint:function(i){this.writeVarint(i<0?2*-i-1:2*i)},writeBoolean:function(i){this.writeVarint(!!i)},writeString:function(i){i=String(i),this.realloc(4*i.length),this.pos++;var t=this.pos;this.pos=function(o,h,g){for(var _,v,w=0;w<h.length;w++){if((_=h.charCodeAt(w))>55295&&_<57344){if(!v){_>56319||w+1===h.length?(o[g++]=239,o[g++]=191,o[g++]=189):v=_;continue}if(_<56320){o[g++]=239,o[g++]=191,o[g++]=189,v=_;continue}_=v-55296<<10|_-56320|65536,v=null}else v&&(o[g++]=239,o[g++]=191,o[g++]=189,v=null);_<128?o[g++]=_:(_<2048?o[g++]=_>>6|192:(_<65536?o[g++]=_>>12|224:(o[g++]=_>>18|240,o[g++]=_>>12&63|128),o[g++]=_>>6&63|128),o[g++]=63&_|128)}return g}(this.buf,i,this.pos);var n=this.pos-t;n>=128&&um(t,n,this),this.pos=t-1,this.writeVarint(n),this.pos+=n},writeFloat:function(i){this.realloc(4),am(this.buf,i,this.pos,!0,23,4),this.pos+=4},writeDouble:function(i){this.realloc(8),am(this.buf,i,this.pos,!0,52,8),this.pos+=8},writeBytes:function(i){var t=i.length;this.writeVarint(t),this.realloc(t);for(var n=0;n<t;n++)this.buf[this.pos++]=i[n]},writeRawMessage:function(i,t){this.pos++;var n=this.pos;i(t,this);var o=this.pos-n;o>=128&&um(n,o,this),this.pos=n-1,this.writeVarint(o),this.pos+=o},writeMessage:function(i,t,n){this.writeTag(i,Ut.Bytes),this.writeRawMessage(t,n)},writePackedVarint:function(i,t){t.length&&this.writeMessage(i,Py,t)},writePackedSVarint:function(i,t){t.length&&this.writeMessage(i,My,t)},writePackedBoolean:function(i,t){t.length&&this.writeMessage(i,zy,t)},writePackedFloat:function(i,t){t.length&&this.writeMessage(i,ky,t)},writePackedDouble:function(i,t){t.length&&this.writeMessage(i,Ay,t)},writePackedFixed32:function(i,t){t.length&&this.writeMessage(i,Dy,t)},writePackedSFixed32:function(i,t){t.length&&this.writeMessage(i,Ly,t)},writePackedFixed64:function(i,t){t.length&&this.writeMessage(i,Ry,t)},writePackedSFixed64:function(i,t){t.length&&this.writeMessage(i,By,t)},writeBytesField:function(i,t){this.writeTag(i,Ut.Bytes),this.writeBytes(t)},writeFixed32Field:function(i,t){this.writeTag(i,Ut.Fixed32),this.writeFixed32(t)},writeSFixed32Field:function(i,t){this.writeTag(i,Ut.Fixed32),this.writeSFixed32(t)},writeFixed64Field:function(i,t){this.writeTag(i,Ut.Fixed64),this.writeFixed64(t)},writeSFixed64Field:function(i,t){this.writeTag(i,Ut.Fixed64),this.writeSFixed64(t)},writeVarintField:function(i,t){this.writeTag(i,Ut.Varint),this.writeVarint(t)},writeSVarintField:function(i,t){this.writeTag(i,Ut.Varint),this.writeSVarint(t)},writeStringField:function(i,t){this.writeTag(i,Ut.Bytes),this.writeString(t)},writeFloatField:function(i,t){this.writeTag(i,Ut.Fixed32),this.writeFloat(t)},writeDoubleField:function(i,t){this.writeTag(i,Ut.Fixed64),this.writeDouble(t)},writeBooleanField:function(i,t){this.writeVarintField(i,!!t)}};var fd=O(sm);const gd=3;function Fy(i,t,n){i===1&&n.readMessage(Oy,t)}function Oy(i,t,n){if(i===3){const{id:o,bitmap:h,width:g,height:_,left:v,top:w,advance:T}=n.readMessage(Ny,{});t.push({id:o,bitmap:new mc({width:g+2*gd,height:_+2*gd},h),metrics:{width:g,height:_,left:v,top:w,advance:T}})}}function Ny(i,t,n){i===1?t.id=n.readVarint():i===2?t.bitmap=n.readBytes():i===3?t.width=n.readVarint():i===4?t.height=n.readVarint():i===5?t.left=n.readSVarint():i===6?t.top=n.readSVarint():i===7&&(t.advance=n.readVarint())}const dm=gd;function pm(i){let t=0,n=0;for(const _ of i)t+=_.w*_.h,n=Math.max(n,_.w);i.sort((_,v)=>v.h-_.h);const o=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),n),h:1/0}];let h=0,g=0;for(const _ of i)for(let v=o.length-1;v>=0;v--){const w=o[v];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){const T=o.pop();v<o.length&&(o[v]=T)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(o.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}const wn=1;class _d{constructor(t,{pixelRatio:n,version:o,stretchX:h,stretchY:g,content:_,textFitWidth:v,textFitHeight:w}){this.paddedRect=t,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=_,this.version=o,this.textFitWidth=v,this.textFitHeight=w}get tl(){return[this.paddedRect.x+wn,this.paddedRect.y+wn]}get br(){return[this.paddedRect.x+this.paddedRect.w-wn,this.paddedRect.y+this.paddedRect.h-wn]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*wn)/this.pixelRatio,(this.paddedRect.h-2*wn)/this.pixelRatio]}}class mm{constructor(t,n){const o={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(t,o,g),this.addImages(n,h,g);const{w:_,h:v}=pm(g),w=new Zn({width:_||1,height:v||1});for(const T in t){const E=t[T],M=o[T].paddedRect;Zn.copy(E.data,w,{x:0,y:0},{x:M.x+wn,y:M.y+wn},E.data)}for(const T in n){const E=n[T],M=h[T].paddedRect,z=M.x+wn,R=M.y+wn,N=E.data.width,U=E.data.height;Zn.copy(E.data,w,{x:0,y:0},{x:z,y:R},E.data),Zn.copy(E.data,w,{x:0,y:U-1},{x:z,y:R-1},{width:N,height:1}),Zn.copy(E.data,w,{x:0,y:0},{x:z,y:R+U},{width:N,height:1}),Zn.copy(E.data,w,{x:N-1,y:0},{x:z-1,y:R},{width:1,height:U}),Zn.copy(E.data,w,{x:0,y:0},{x:z+N,y:R},{width:1,height:U})}this.image=w,this.iconPositions=o,this.patternPositions=h}addImages(t,n,o){for(const h in t){const g=t[h],_={x:0,y:0,w:g.data.width+2*wn,h:g.data.height+2*wn};o.push(_),n[h]=new _d(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(t,n){t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const o in t.updatedImages)this.patchUpdatedImage(this.iconPositions[o],t.getImage(o),n),this.patchUpdatedImage(this.patternPositions[o],t.getImage(o),n)}patchUpdatedImage(t,n,o){if(!t||!n||t.version===n.version)return;t.version=n.version;const[h,g]=t.tl;o.update(n.data,void 0,{x:h,y:g})}}var Qs;$e("ImagePosition",_d),$e("ImageAtlas",mm),x.ah=void 0,(Qs=x.ah||(x.ah={}))[Qs.none=0]="none",Qs[Qs.horizontal=1]="horizontal",Qs[Qs.vertical=2]="vertical",Qs[Qs.horizontalOnly=3]="horizontalOnly";const bc=-17;class wc{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,n){const o=new wc;return o.scale=t||1,o.fontStack=n,o}static forImage(t){const n=new wc;return n.imageName=t,n}}class Ja{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,n){const o=new Ja;for(let h=0;h<t.sections.length;h++){const g=t.sections[h];g.image?o.addImageSection(g):o.addTextSection(g,n)}return o}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(){this.text=function(t){let n="";for(let o=0;o<t.length;o++){const h=t.charCodeAt(o+1)||null,g=t.charCodeAt(o-1)||null;n+=h&&Au(h)&&!xc[t[o+1]]||g&&Au(g)&&!xc[t[o-1]]||!xc[t[o]]?t[o]:xc[t[o]]}return n}(this.text)}trim(){let t=0;for(let o=0;o<this.text.length&&Zu[this.text.charCodeAt(o)];o++)t++;let n=this.text.length;for(let o=this.text.length-1;o>=0&&o>=t&&Zu[this.text.charCodeAt(o)];o--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)}substring(t,n){const o=new Ja;return o.text=this.text.substring(t,n),o.sectionIndex=this.sectionIndex.slice(t,n),o.sections=this.sections,o}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,n)=>Math.max(t,this.sections[n].scale),0)}addTextSection(t,n){this.text+=t.text,this.sections.push(wc.forText(t.scale,t.fontStack||n));const o=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(o)}addImageSection(t){const n=t.image?t.image.name:"";if(n.length===0)return void St("Can't add FormattedSection with an empty image.");const o=this.getNextImageSectionCharCode();o?(this.text+=String.fromCharCode(o),this.sections.push(wc.forImage(n)),this.sectionIndex.push(this.sections.length-1)):St("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Wu(i,t,n,o,h,g,_,v,w,T,E,M,z,R,N){const U=Ja.fromFeature(i,h);let G;M===x.ah.vertical&&U.verticalizePunctuation();const{processBidirectionalText:J,processStyledBidirectionalText:de}=xn;if(J&&U.sections.length===1){G=[];const _e=J(U.toString(),yd(U,T,g,t,o,R));for(const Se of _e){const Oe=new Ja;Oe.text=Se,Oe.sections=U.sections;for(let nt=0;nt<Se.length;nt++)Oe.sectionIndex.push(0);G.push(Oe)}}else if(de){G=[];const _e=de(U.text,U.sectionIndex,yd(U,T,g,t,o,R));for(const Se of _e){const Oe=new Ja;Oe.text=Se[0],Oe.sectionIndex=Se[1],Oe.sections=U.sections,G.push(Oe)}}else G=function(_e,Se){const Oe=[],nt=_e.text;let Re=0;for(const De of Se)Oe.push(_e.substring(Re,De)),Re=De;return Re<nt.length&&Oe.push(_e.substring(Re,nt.length)),Oe}(U,yd(U,T,g,t,o,R));const re=[],ue={positionedLines:re,text:U.toString(),top:E[1],bottom:E[1],left:E[0],right:E[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(_e,Se,Oe,nt,Re,De,Ke,He,Ue,xe,Je,Xe){let lt=0,Gt=bc,$t=0,Ai=0;const mr=He==="right"?1:He==="left"?0:.5;let Wi=0;for(const gi of Re){gi.trim();const Di=gi.getMaxScale(),tn=(Di-1)*Ii,Zi={positionedGlyphs:[],lineOffset:0};_e.positionedLines[Wi]=Zi;const dn=Zi.positionedGlyphs;let Gi=0;if(!gi.length()){Gt+=De,++Wi;continue}for(let Cn=0;Cn<gi.length();Cn++){const kt=gi.getSection(Cn),Jt=gi.getSectionIndex(Cn),ri=gi.getCharCode(Cn);let Dn=0,hi=null,il=null,Vr=null,Ur=Ii;const fr=!(Ue===x.ah.horizontal||!Je&&!ac(ri)||Je&&(Zu[ri]||(zi=ri,/\p{sc=Arab}/u.test(String.fromCodePoint(zi)))));if(kt.imageName){const Yn=nt[kt.imageName];if(!Yn)continue;Vr=kt.imageName,_e.iconsInText=_e.iconsInText||!0,il=Yn.paddedRect;const Oi=Yn.displaySize;kt.scale=kt.scale*Ii/Xe,hi={width:Oi[0],height:Oi[1],left:wn,top:-dm,advance:fr?Oi[1]:Oi[0]},Dn=tn+(Ii-Oi[1]*kt.scale),Ur=hi.advance;const us=fr?Oi[0]*kt.scale-Ii*Di:Oi[1]*kt.scale-Ii*Di;us>0&&us>Gi&&(Gi=us)}else{const Yn=Oe[kt.fontStack],Oi=Yn&&Yn[ri];if(Oi&&Oi.rect)il=Oi.rect,hi=Oi.metrics;else{const us=Se[kt.fontStack],Pc=us&&us[ri];if(!Pc)continue;hi=Pc.metrics}Dn=(Di-kt.scale)*Ii}fr?(_e.verticalizable=!0,dn.push({glyph:ri,imageName:Vr,x:lt,y:Gt+Dn,vertical:fr,scale:kt.scale,fontStack:kt.fontStack,sectionIndex:Jt,metrics:hi,rect:il}),lt+=Ur*kt.scale+xe):(dn.push({glyph:ri,imageName:Vr,x:lt,y:Gt+Dn,vertical:fr,scale:kt.scale,fontStack:kt.fontStack,sectionIndex:Jt,metrics:hi,rect:il}),lt+=hi.advance*kt.scale+xe)}dn.length!==0&&($t=Math.max(lt-xe,$t),jy(dn,0,dn.length-1,mr,Gi)),lt=0;const Xn=De*Di+Gi;Zi.lineOffset=Math.max(Gi,tn),Gt+=Xn,Ai=Math.max(Xn,Ai),++Wi}var zi;const cn=Gt-bc,{horizontalAlign:un,verticalAlign:hn}=vd(Ke);(function(gi,Di,tn,Zi,dn,Gi,Xn,Cn,kt){const Jt=(Di-tn)*dn;let ri=0;ri=Gi!==Xn?-Cn*Zi-bc:(-Zi*kt+.5)*Xn;for(const Dn of gi)for(const hi of Dn.positionedGlyphs)hi.x+=Jt,hi.y+=ri})(_e.positionedLines,mr,un,hn,$t,Ai,De,cn,Re.length),_e.top+=-hn*cn,_e.bottom=_e.top+cn,_e.left+=-un*$t,_e.right=_e.left+$t}(ue,t,n,o,G,_,v,w,M,T,z,N),!function(_e){for(const Se of _e)if(Se.positionedGlyphs.length!==0)return!1;return!0}(re)&&ue}const Zu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Vy={10:!0,32:!0,38:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0},Uy={40:!0};function fm(i,t,n,o,h,g){if(t.imageName){const _=o[t.imageName];return _?_.displaySize[0]*t.scale*Ii/g+h:0}{const _=n[t.fontStack],v=_&&_[i];return v?v.metrics.advance*t.scale+h:0}}function gm(i,t,n,o){const h=Math.pow(i-t,2);return o?i<t?h/2:2*h:h+Math.abs(n)*n}function $y(i,t,n){let o=0;return i===10&&(o-=1e4),n&&(o+=150),i!==40&&i!==65288||(o+=50),t!==41&&t!==65289||(o+=50),o}function _m(i,t,n,o,h,g){let _=null,v=gm(t,n,h,g);for(const w of o){const T=gm(t-w.x,n,h,g)+w.badness;T<=v&&(_=w,v=T)}return{index:i,x:t,priorBreak:_,badness:v}}function ym(i){return i?ym(i.priorBreak).concat(i.index):[]}function yd(i,t,n,o,h,g){if(!i)return[];const _=[],v=function(M,z,R,N,U,G){let J=0;for(let de=0;de<M.length();de++){const re=M.getSection(de);J+=fm(M.getCharCode(de),re,N,U,z,G)}return J/Math.max(1,Math.ceil(J/R))}(i,t,n,o,h,g),w=i.text.indexOf("")>=0;let T=0;for(let M=0;M<i.length();M++){const z=i.getSection(M),R=i.getCharCode(M);if(Zu[R]||(T+=fm(R,z,o,h,t,g)),M<i.length()-1){const N=!((E=R)<11904)&&(!!wt["CJK Compatibility Forms"](E)||!!wt["CJK Compatibility"](E)||!!wt["CJK Strokes"](E)||!!wt["CJK Symbols and Punctuation"](E)||!!wt["Enclosed CJK Letters and Months"](E)||!!wt["Halfwidth and Fullwidth Forms"](E)||!!wt["Ideographic Description Characters"](E)||!!wt["Vertical Forms"](E)||ku.test(String.fromCodePoint(E)));(Vy[R]||N||z.imageName||M!==i.length()-2&&Uy[i.getCharCode(M+1)])&&_.push(_m(M+1,T,v,_,$y(R,i.getCharCode(M+1),N&&w),!1))}}var E;return ym(_m(i.length(),T,v,_,0,!0))}function vd(i){let t=.5,n=.5;switch(i){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(i){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:t,verticalAlign:n}}function jy(i,t,n,o,h){if(!o&&!h)return;const g=i[n],_=(i[n].x+g.metrics.advance*g.scale)*o;for(let v=t;v<=n;v++)i[v].x-=_,i[v].y+=h}function qy(i,t,n){const{horizontalAlign:o,verticalAlign:h}=vd(n),g=t[0]-i.displaySize[0]*o,_=t[1]-i.displaySize[1]*h;return{image:i,top:_,bottom:_+i.displaySize[1],left:g,right:g+i.displaySize[0]}}function vm(i){var t,n;let o=i.left,h=i.top,g=i.right-o,_=i.bottom-h;const v=(t=i.image.textFitWidth)!==null&&t!==void 0?t:"stretchOrShrink",w=(n=i.image.textFitHeight)!==null&&n!==void 0?n:"stretchOrShrink",T=(i.image.content[2]-i.image.content[0])/(i.image.content[3]-i.image.content[1]);if(w==="proportional"){if(v==="stretchOnly"&&g/_<T||v==="proportional"){const E=Math.ceil(_*T);o*=E/g,g=E}}else if(v==="proportional"&&w==="stretchOnly"&&T!==0&&g/_>T){const E=Math.ceil(g/T);h*=E/_,_=E}return{x1:o,y1:h,x2:o+g,y2:h+_}}function xm(i,t,n,o,h,g){const _=i.image;let v;if(_.content){const G=_.content,J=_.pixelRatio||1;v=[G[0]/J,G[1]/J,_.displaySize[0]-G[2]/J,_.displaySize[1]-G[3]/J]}const w=t.left*g,T=t.right*g;let E,M,z,R;n==="width"||n==="both"?(R=h[0]+w-o[3],M=h[0]+T+o[1]):(R=h[0]+(w+T-_.displaySize[0])/2,M=R+_.displaySize[0]);const N=t.top*g,U=t.bottom*g;return n==="height"||n==="both"?(E=h[1]+N-o[0],z=h[1]+U+o[2]):(E=h[1]+(N+U-_.displaySize[1])/2,z=E+_.displaySize[1]),{image:_,top:E,right:M,bottom:z,left:R,collisionPadding:v}}const Cc=255,Nr=128,eo=Cc*Nr;function bm(i,t){const{expression:n}=t;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new ei(i+1))};if(n.kind==="source")return{kind:"source"};{const{zoomStops:o,interpolationType:h}=n;let g=0;for(;g<o.length&&o[g]<=i;)g++;g=Math.max(0,g-1);let _=g;for(;_<o.length&&o[_]<i+1;)_++;_=Math.min(o.length-1,_);const v=o[g],w=o[_];return n.kind==="composite"?{kind:"composite",minZoom:v,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:v,maxZoom:w,minSize:n.evaluate(new ei(v)),maxSize:n.evaluate(new ei(w)),interpolationType:h}}}function xd(i,t,n){let o="never";const h=i.get(t);return h?o=h:i.get(n)&&(o="always"),o}const Hy=Js.VectorTileFeature.types,Wy=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gu(i,t,n,o,h,g,_,v,w,T,E,M,z){const R=v?Math.min(eo,Math.round(v[0])):0,N=v?Math.min(eo,Math.round(v[1])):0;i.emplaceBack(t,n,Math.round(32*o),Math.round(32*h),g,_,(R<<1)+(w?1:0),N,16*T,16*E,256*M,256*z)}function bd(i,t,n){i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n),i.emplaceBack(t.x,t.y,n)}function Zy(i){for(const t of i.sections)if(Xh(t.text))return!0;return!1}class wd{constructor(t){this.layoutVertexArray=new Ua,this.indexArray=new Wn,this.programConfigurations=t,this.segments=new Ct,this.dynamicLayoutVertexArray=new uc,this.opacityVertexArray=new An,this.hasVisibleVertices=!1,this.placedSymbolArray=new ti}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(t,n,o,h){this.isEmpty()||(o&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cy.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Sy.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Wy,!0),this.opacityVertexBuffer.itemSize=1),(o||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}$e("SymbolBuffers",wd);class Cd{constructor(t,n,o){this.layoutVertexArray=new t,this.layoutAttributes=n,this.indexArray=new o,this.segments=new Ct,this.collisionVertexArray=new Fr}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Iy.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}$e("CollisionBuffers",Cd);class Qa{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(_=>_.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=id([]),this.placementViewportMatrix=id([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=bm(this.zoom,n["text-size"]),this.iconSizeData=bm(this.zoom,n["icon-size"]);const o=this.layers[0].layout,h=o.get("symbol-sort-key"),g=o.get("symbol-z-order");this.canOverlap=xd(o,"text-overlap","text-allow-overlap")!=="never"||xd(o,"icon-overlap","icon-allow-overlap")!=="never"||o.get("text-ignore-placement")||o.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&!h.isConstant(),this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,o.get("symbol-placement")==="point"&&(this.writingModes=o.get("text-writing-mode").map(_=>x.ah[_])),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=t.sourceID}createArrays(){this.text=new wd(new Wo(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new wd(new Wo(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new ii,this.lineVertexArray=new $i,this.symbolInstances=new xt,this.textAnchorOffsets=new ni}calculateGlyphDependencies(t,n,o,h,g){for(let _=0;_<t.length;_++)if(n[t.charCodeAt(_)]=!0,(o||h)&&g){const v=xc[t.charAt(_)];v&&(n[v.charCodeAt(0)]=!0)}}populate(t,n,o){const h=this.layers[0],g=h.layout,_=g.get("text-font"),v=g.get("text-field"),w=g.get("icon-image"),T=(v.value.kind!=="constant"||v.value.value instanceof gn&&!v.value.value.isEmpty()||v.value.value.toString().length>0)&&(_.value.kind!=="constant"||_.value.value.length>0),E=w.value.kind!=="constant"||!!w.value.value||Object.keys(w.parameters).length>0,M=g.get("symbol-sort-key");if(this.features=[],!T&&!E)return;const z=n.iconDependencies,R=n.glyphDependencies,N=n.availableImages,U=new ei(this.zoom);for(const{feature:G,id:J,index:de,sourceLayerIndex:re}of t){const ue=h._featureFilter.needGeometry,_e=Go(G,ue);if(!h._featureFilter.filter(U,_e,o))continue;let Se,Oe;if(ue||(_e.geometry=Zo(G)),T){const Re=h.getValueAndResolveTokens("text-field",_e,o,N),De=gn.factory(Re),Ke=this.hasRTLText=this.hasRTLText||Zy(De);(!Ke||xn.getRTLTextPluginStatus()==="unavailable"||Ke&&xn.isParsed())&&(Se=Ey(De,h,_e))}if(E){const Re=h.getValueAndResolveTokens("icon-image",_e,o,N);Oe=Re instanceof yn?Re:yn.fromString(Re)}if(!Se&&!Oe)continue;const nt=this.sortFeaturesByKey?M.evaluate(_e,{},o):void 0;if(this.features.push({id:J,text:Se,icon:Oe,index:de,sourceLayerIndex:re,geometry:_e.geometry,properties:G.properties,type:Hy[G.type],sortKey:nt}),Oe&&(z[Oe.name]=!0),Se){const Re=_.evaluate(_e,{},o).join(","),De=g.get("text-rotation-alignment")!=="viewport"&&g.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(x.ah.vertical)>=0;for(const Ke of Se.sections)if(Ke.image)z[Ke.image.name]=!0;else{const He=sc(Se.toString()),Ue=Ke.fontStack||Re,xe=R[Ue]=R[Ue]||{};this.calculateGlyphDependencies(Ke.text,xe,De,this.allowVerticalPlacement,He)}}}g.get("symbol-placement")==="line"&&(this.features=function(G){const J={},de={},re=[];let ue=0;function _e(Re){re.push(G[Re]),ue++}function Se(Re,De,Ke){const He=de[Re];return delete de[Re],de[De]=He,re[He].geometry[0].pop(),re[He].geometry[0]=re[He].geometry[0].concat(Ke[0]),He}function Oe(Re,De,Ke){const He=J[De];return delete J[De],J[Re]=He,re[He].geometry[0].shift(),re[He].geometry[0]=Ke[0].concat(re[He].geometry[0]),He}function nt(Re,De,Ke){const He=Ke?De[0][De[0].length-1]:De[0][0];return`${Re}:${He.x}:${He.y}`}for(let Re=0;Re<G.length;Re++){const De=G[Re],Ke=De.geometry,He=De.text?De.text.toString():null;if(!He){_e(Re);continue}const Ue=nt(He,Ke),xe=nt(He,Ke,!0);if(Ue in de&&xe in J&&de[Ue]!==J[xe]){const Je=Oe(Ue,xe,Ke),Xe=Se(Ue,xe,re[Je].geometry);delete J[Ue],delete de[xe],de[nt(He,re[Xe].geometry,!0)]=Xe,re[Je].geometry=null}else Ue in de?Se(Ue,xe,Ke):xe in J?Oe(Ue,xe,Ke):(_e(Re),J[Ue]=ue-1,de[xe]=ue-1)}return re.filter(Re=>Re.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((G,J)=>G.sortKey-J.sortKey)}update(t,n,o){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,n,this.layers,o),this.icon.programConfigurations.updatePaintArrays(t,n,this.layers,o))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,n){const o=this.lineVertexArray.length;if(t.segment!==void 0){let h=t.dist(n[t.segment+1]),g=t.dist(n[t.segment]);const _={};for(let v=t.segment+1;v<n.length;v++)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:h},v<n.length-1&&(h+=n[v+1].dist(n[v]));for(let v=t.segment||0;v>=0;v--)_[v]={x:n[v].x,y:n[v].y,tileUnitDistanceFromAnchor:g},v>0&&(g+=n[v-1].dist(n[v]));for(let v=0;v<n.length;v++){const w=_[v];this.lineVertexArray.emplaceBack(w.x,w.y,w.tileUnitDistanceFromAnchor)}}return{lineStartIndex:o,lineLength:this.lineVertexArray.length-o}}addSymbols(t,n,o,h,g,_,v,w,T,E,M,z){const R=t.indexArray,N=t.layoutVertexArray,U=t.segments.prepareSegment(4*n.length,N,R,this.canOverlap?_.sortKey:void 0),G=this.glyphOffsetArray.length,J=U.vertexLength,de=this.allowVerticalPlacement&&v===x.ah.vertical?Math.PI/2:0,re=_.text&&_.text.sections;for(let ue=0;ue<n.length;ue++){const{tl:_e,tr:Se,bl:Oe,br:nt,tex:Re,pixelOffsetTL:De,pixelOffsetBR:Ke,minFontScaleX:He,minFontScaleY:Ue,glyphOffset:xe,isSDF:Je,sectionIndex:Xe}=n[ue],lt=U.vertexLength,Gt=xe[1];Gu(N,w.x,w.y,_e.x,Gt+_e.y,Re.x,Re.y,o,Je,De.x,De.y,He,Ue),Gu(N,w.x,w.y,Se.x,Gt+Se.y,Re.x+Re.w,Re.y,o,Je,Ke.x,De.y,He,Ue),Gu(N,w.x,w.y,Oe.x,Gt+Oe.y,Re.x,Re.y+Re.h,o,Je,De.x,Ke.y,He,Ue),Gu(N,w.x,w.y,nt.x,Gt+nt.y,Re.x+Re.w,Re.y+Re.h,o,Je,Ke.x,Ke.y,He,Ue),bd(t.dynamicLayoutVertexArray,w,de),R.emplaceBack(lt,lt+1,lt+2),R.emplaceBack(lt+1,lt+2,lt+3),U.vertexLength+=4,U.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(xe[0]),ue!==n.length-1&&Xe===n[ue+1].sectionIndex||t.programConfigurations.populatePaintArrays(N.length,_,_.index,{},z,re&&re[Xe])}t.placedSymbolArray.emplaceBack(w.x,w.y,G,this.glyphOffsetArray.length-G,J,T,E,w.segment,o?o[0]:0,o?o[1]:0,h[0],h[1],v,0,!1,0,M)}_addCollisionDebugVertex(t,n,o,h,g,_){return n.emplaceBack(0,0),t.emplaceBack(o.x,o.y,h,g,Math.round(_.x),Math.round(_.y))}addCollisionDebugVertices(t,n,o,h,g,_,v){const w=g.segments.prepareSegment(4,g.layoutVertexArray,g.indexArray),T=w.vertexLength,E=g.layoutVertexArray,M=g.collisionVertexArray,z=v.anchorX,R=v.anchorY;this._addCollisionDebugVertex(E,M,_,z,R,new q(t,n)),this._addCollisionDebugVertex(E,M,_,z,R,new q(o,n)),this._addCollisionDebugVertex(E,M,_,z,R,new q(o,h)),this._addCollisionDebugVertex(E,M,_,z,R,new q(t,h)),w.vertexLength+=4;const N=g.indexArray;N.emplaceBack(T,T+1),N.emplaceBack(T+1,T+2),N.emplaceBack(T+2,T+3),N.emplaceBack(T+3,T),w.primitiveLength+=4}addDebugCollisionBoxes(t,n,o,h){for(let g=t;g<n;g++){const _=this.collisionBoxArray.get(g);this.addCollisionDebugVertices(_.x1,_.y1,_.x2,_.y2,h?this.textCollisionBox:this.iconCollisionBox,_.anchorPoint,o)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Cd(zn,rm.members,Fi),this.iconCollisionBox=new Cd(zn,rm.members,Fi);for(let t=0;t<this.symbolInstances.length;t++){const n=this.symbolInstances.get(t);this.addDebugCollisionBoxes(n.textBoxStartIndex,n.textBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n,!0),this.addDebugCollisionBoxes(n.iconBoxStartIndex,n.iconBoxEndIndex,n,!1),this.addDebugCollisionBoxes(n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex,n,!1)}}_deserializeCollisionBoxesForSymbol(t,n,o,h,g,_,v,w,T){const E={};for(let M=n;M<o;M++){const z=t.get(M);E.textBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.textFeatureIndex=z.featureIndex;break}for(let M=h;M<g;M++){const z=t.get(M);E.verticalTextBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalTextFeatureIndex=z.featureIndex;break}for(let M=_;M<v;M++){const z=t.get(M);E.iconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.iconFeatureIndex=z.featureIndex;break}for(let M=w;M<T;M++){const z=t.get(M);E.verticalIconBox={x1:z.x1,y1:z.y1,x2:z.x2,y2:z.y2,anchorPointX:z.anchorPointX,anchorPointY:z.anchorPointY},E.verticalIconFeatureIndex=z.featureIndex;break}return E}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const o=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,o.textBoxStartIndex,o.textBoxEndIndex,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o.iconBoxStartIndex,o.iconBoxEndIndex,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,n){const o=t.placedSymbolArray.get(n),h=o.vertexStartIndex+4*o.numGlyphs;for(let g=o.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const n=Math.sin(t),o=Math.cos(t),h=[],g=[],_=[];for(let v=0;v<this.symbolInstances.length;++v){_.push(v);const w=this.symbolInstances.get(v);h.push(0|Math.round(n*w.anchorX+o*w.anchorY)),g.push(w.featureIndex)}return _.sort((v,w)=>h[v]-h[w]||g[w]-g[v]),_}addToSortKeyRanges(t,n){const o=this.sortKeyRanges[this.sortKeyRanges.length-1];o&&o.sortKey===n?o.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const o=this.symbolInstances.get(n);this.featureSortOrder.push(o.featureIndex),[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((h,g,_)=>{h>=0&&_.indexOf(h)===g&&this.addIndicesForPlacedSymbol(this.text,h)}),o.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,o.verticalPlacedTextSymbolIndex),o.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.placedIconSymbolIndex),o.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,o.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let wm,Cm;$e("SymbolBucket",Qa,{omit:["layers","collisionBoxArray","features","compareText"]}),Qa.MAX_GLYPHS=65535,Qa.addDynamicAttributes=bd;var Sd={get paint(){return Cm=Cm||new f({"icon-opacity":new rt(ge.paint_symbol["icon-opacity"]),"icon-color":new rt(ge.paint_symbol["icon-color"]),"icon-halo-color":new rt(ge.paint_symbol["icon-halo-color"]),"icon-halo-width":new rt(ge.paint_symbol["icon-halo-width"]),"icon-halo-blur":new rt(ge.paint_symbol["icon-halo-blur"]),"icon-translate":new Ze(ge.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ze(ge.paint_symbol["icon-translate-anchor"]),"text-opacity":new rt(ge.paint_symbol["text-opacity"]),"text-color":new rt(ge.paint_symbol["text-color"],{runtimeType:rn,getOverride:i=>i.textColor,hasOverride:i=>!!i.textColor}),"text-halo-color":new rt(ge.paint_symbol["text-halo-color"]),"text-halo-width":new rt(ge.paint_symbol["text-halo-width"]),"text-halo-blur":new rt(ge.paint_symbol["text-halo-blur"]),"text-translate":new Ze(ge.paint_symbol["text-translate"]),"text-translate-anchor":new Ze(ge.paint_symbol["text-translate-anchor"])})},get layout(){return wm=wm||new f({"symbol-placement":new Ze(ge.layout_symbol["symbol-placement"]),"symbol-spacing":new Ze(ge.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ze(ge.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new rt(ge.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ze(ge.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ze(ge.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Ze(ge.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Ze(ge.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ze(ge.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ze(ge.layout_symbol["icon-rotation-alignment"]),"icon-size":new rt(ge.layout_symbol["icon-size"]),"icon-text-fit":new Ze(ge.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ze(ge.layout_symbol["icon-text-fit-padding"]),"icon-image":new rt(ge.layout_symbol["icon-image"]),"icon-rotate":new rt(ge.layout_symbol["icon-rotate"]),"icon-padding":new rt(ge.layout_symbol["icon-padding"]),"icon-keep-upright":new Ze(ge.layout_symbol["icon-keep-upright"]),"icon-offset":new rt(ge.layout_symbol["icon-offset"]),"icon-anchor":new rt(ge.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ze(ge.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ze(ge.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ze(ge.layout_symbol["text-rotation-alignment"]),"text-field":new rt(ge.layout_symbol["text-field"]),"text-font":new rt(ge.layout_symbol["text-font"]),"text-size":new rt(ge.layout_symbol["text-size"]),"text-max-width":new rt(ge.layout_symbol["text-max-width"]),"text-line-height":new Ze(ge.layout_symbol["text-line-height"]),"text-letter-spacing":new rt(ge.layout_symbol["text-letter-spacing"]),"text-justify":new rt(ge.layout_symbol["text-justify"]),"text-radial-offset":new rt(ge.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ze(ge.layout_symbol["text-variable-anchor"]),"text-variable-anchor-offset":new rt(ge.layout_symbol["text-variable-anchor-offset"]),"text-anchor":new rt(ge.layout_symbol["text-anchor"]),"text-max-angle":new Ze(ge.layout_symbol["text-max-angle"]),"text-writing-mode":new Ze(ge.layout_symbol["text-writing-mode"]),"text-rotate":new rt(ge.layout_symbol["text-rotate"]),"text-padding":new Ze(ge.layout_symbol["text-padding"]),"text-keep-upright":new Ze(ge.layout_symbol["text-keep-upright"]),"text-transform":new rt(ge.layout_symbol["text-transform"]),"text-offset":new rt(ge.layout_symbol["text-offset"]),"text-allow-overlap":new Ze(ge.layout_symbol["text-allow-overlap"]),"text-overlap":new Ze(ge.layout_symbol["text-overlap"]),"text-ignore-placement":new Ze(ge.layout_symbol["text-ignore-placement"]),"text-optional":new Ze(ge.layout_symbol["text-optional"])})}};class Sm{constructor(t){if(t.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=t.property.overrides?t.property.overrides.runtimeType:Dr,this.defaultValue=t}evaluate(t){if(t.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(t.formattedSection))return n.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$e("FormatSectionOverride",Sm,{omit:["defaultValue"]});class Xu extends s{constructor(t){super(t,Sd)}recalculate(t,n){if(super.recalculate(t,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const o=this.layout.get("text-writing-mode");if(o){const h=[];for(const g of o)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(t,n,o,h){const g=this.layout.get(t).evaluate(n,{},o,h),_=this._unevaluatedLayout._values[t];return _.isDataDriven()||Ta(_.value)||!g?g:function(v,w){return w.replace(/{([^{}]+)}/g,(T,E)=>v&&E in v?String(v[E]):"")}(n.properties,g)}createBucket(t){return new Qa(t)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const t of Sd.paint.overridableProperties){if(!Xu.hasPaintOverride(this.layout,t))continue;const n=this.paint.get(t),o=new Sm(n),h=new Ia(o,n.property.specification);let g=null;g=n.value.kind==="constant"||n.value.kind==="source"?new Bs("source",h):new Fs("composite",h,n.value.zoomStops),this.paint._values[t]=new dr(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(t,n,o){return!(!this.layout||n.isDataDriven()||o.isDataDriven())&&Xu.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,n){const o=t.get("text-field"),h=Sd.paint.properties[n];let g=!1;const _=v=>{for(const w of v)if(h.overrides&&h.overrides.hasOverride(w))return void(g=!0)};if(o.value.kind==="constant"&&o.value.value instanceof gn)_(o.value.value.sections);else if(o.value.kind==="source"){const v=T=>{g||(T instanceof Vn&&bi(T.value)===br?_(T.value.sections):T instanceof ga?_(T.sections):T.eachChild(v))},w=o.value;w._styleExpression&&v(w._styleExpression.expression)}return g}}let Im;var Gy={get paint(){return Im=Im||new f({"background-color":new Ze(ge.paint_background["background-color"]),"background-pattern":new Na(ge.paint_background["background-pattern"]),"background-opacity":new Ze(ge.paint_background["background-opacity"])})}};class Xy extends s{constructor(t){super(t,Gy)}}let Tm;var Yy={get paint(){return Tm=Tm||new f({"raster-opacity":new Ze(ge.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ze(ge.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ze(ge.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ze(ge.paint_raster["raster-brightness-max"]),"raster-saturation":new Ze(ge.paint_raster["raster-saturation"]),"raster-contrast":new Ze(ge.paint_raster["raster-contrast"]),"raster-resampling":new Ze(ge.paint_raster["raster-resampling"]),"raster-fade-duration":new Ze(ge.paint_raster["raster-fade-duration"])})}};class Ky extends s{constructor(t){super(t,Yy)}}class Jy extends s{constructor(t){super(t,{}),this.onAdd=n=>{this.implementation.onAdd&&this.implementation.onAdd(n,n.painter.context.gl)},this.onRemove=n=>{this.implementation.onRemove&&this.implementation.onRemove(n,n.painter.context.gl)},this.implementation=t}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}class Qy{constructor(t){this._methodToThrottle=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._methodToThrottle()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._methodToThrottle()},0))}remove(){delete this._channel,this._methodToThrottle=()=>{}}}const Id=63710088e-1;class to{constructor(t,n){if(isNaN(t)||isNaN(n))throw new Error(`Invalid LngLat object: (${t}, ${n})`);if(this.lng=+t,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new to(ct(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const n=Math.PI/180,o=this.lat*n,h=t.lat*n,g=Math.sin(o)*Math.sin(h)+Math.cos(o)*Math.cos(h)*Math.cos((t.lng-this.lng)*n);return Id*Math.acos(Math.min(g,1))}static convert(t){if(t instanceof to)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new to(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new to(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const Em=2*Math.PI*Id;function Pm(i){return Em*Math.cos(i*Math.PI/180)}function Mm(i){return(180+i)/360}function km(i){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+i*Math.PI/360)))/360}function Am(i,t){return i/Pm(t)}function Td(i){return 360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90}class Sc{constructor(t,n,o=0){this.x=+t,this.y=+n,this.z=+o}static fromLngLat(t,n=0){const o=to.convert(t);return new Sc(Mm(o.lng),km(o.lat),Am(n,o.lat))}toLngLat(){return new to(360*this.x-180,Td(this.y))}toAltitude(){return this.z*Pm(Td(this.y))}meterInMercatorCoordinateUnits(){return 1/Em*(t=Td(this.y),1/Math.cos(t*Math.PI/180));var t}}function zm(i,t,n){var o=2*Math.PI*6378137/256/Math.pow(2,n);return[i*o-2*Math.PI*6378137/2,t*o-2*Math.PI*6378137/2]}class Ed{constructor(t,n,o){if(!function(h,g,_){return!(h<0||h>25||_<0||_>=Math.pow(2,h)||g<0||g>=Math.pow(2,h))}(t,n,o))throw new Error(`x=${n}, y=${o}, z=${t} outside of bounds. 0<=x<${Math.pow(2,t)}, 0<=y<${Math.pow(2,t)} 0<=z<=25 `);this.z=t,this.x=n,this.y=o,this.key=Ic(0,t,t,n,o)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,n,o){const h=(_=this.y,v=this.z,w=zm(256*(g=this.x),256*(_=Math.pow(2,v)-_-1),v),T=zm(256*(g+1),256*(_+1),v),w[0]+","+w[1]+","+T[0]+","+T[1]);var g,_,v,w,T;const E=function(M,z,R){let N,U="";for(let G=M;G>0;G--)N=1<<G-1,U+=(z&N?1:0)+(R&N?2:0);return U}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(o==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,n>1?"@2x":"").replace(/{quadkey}/g,E).replace(/{bbox-epsg-3857}/g,h)}isChildOf(t){const n=this.z-t.z;return n>0&&t.x===this.x>>n&&t.y===this.y>>n}getTilePoint(t){const n=Math.pow(2,this.z);return new q((t.x*n-this.x)*wi,(t.y*n-this.y)*wi)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Dm{constructor(t,n){this.wrap=t,this.canonical=n,this.key=Ic(t,n.z,n.z,n.x,n.y)}}class Gn{constructor(t,n,o,h,g){if(t<o)throw new Error(`overscaledZ should be >= z; overscaledZ = ${t}; z = ${o}`);this.overscaledZ=t,this.wrap=n,this.canonical=new Ed(o,+h,+g),this.key=Ic(n,t,o,h,g)}clone(){return new Gn(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const n=this.canonical.z-t;return t>this.canonical.z?new Gn(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gn(t,this.wrap,t,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(t,n){if(t>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${t}; overscaledZ = ${this.overscaledZ}`);const o=this.canonical.z-t;return t>this.canonical.z?Ic(this.wrap*+n,t,this.canonical.z,this.canonical.x,this.canonical.y):Ic(this.wrap*+n,t,t,this.canonical.x>>o,this.canonical.y>>o)}isChildOf(t){if(t.wrap!==this.wrap)return!1;const n=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>n&&t.canonical.y===this.canonical.y>>n}children(t){if(this.overscaledZ>=t)return[new Gn(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,o=2*this.canonical.x,h=2*this.canonical.y;return[new Gn(n,this.wrap,n,o,h),new Gn(n,this.wrap,n,o+1,h),new Gn(n,this.wrap,n,o,h+1),new Gn(n,this.wrap,n,o+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Gn(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Gn(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Dm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(t){return this.canonical.getTilePoint(new Sc(t.x-this.wrap,t.y))}}function Ic(i,t,n,o,h){(i*=2)<0&&(i=-1*i-1);const g=1<<n;return(g*g*i+g*h+o).toString(36)+n.toString(36)+t.toString(36)}$e("CanonicalTileID",Ed),$e("OverscaledTileID",Gn,{omit:["posMatrix"]});class Lm{constructor(t,n,o,h=1,g=1,_=1,v=0){if(this.uid=t,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(o&&!["mapbox","terrarium","custom"].includes(o))return void St(`"${o}" is not a valid encoding type. Valid types include "mapbox", "terrarium" and "custom".`);this.stride=n.height;const w=this.dim=n.height-2;switch(this.data=new Uint32Array(n.data.buffer),o){case"terrarium":this.redFactor=256,this.greenFactor=1,this.blueFactor=1/256,this.baseShift=32768;break;case"custom":this.redFactor=h,this.greenFactor=g,this.blueFactor=_,this.baseShift=v;break;default:this.redFactor=6553.6,this.greenFactor=25.6,this.blueFactor=.1,this.baseShift=1e4}for(let T=0;T<w;T++)this.data[this._idx(-1,T)]=this.data[this._idx(0,T)],this.data[this._idx(w,T)]=this.data[this._idx(w-1,T)],this.data[this._idx(T,-1)]=this.data[this._idx(T,0)],this.data[this._idx(T,w)]=this.data[this._idx(T,w-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(w,-1)]=this.data[this._idx(w-1,0)],this.data[this._idx(-1,w)]=this.data[this._idx(0,w-1)],this.data[this._idx(w,w)]=this.data[this._idx(w-1,w-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let T=0;T<w;T++)for(let E=0;E<w;E++){const M=this.get(T,E);M>this.max&&(this.max=M),M<this.min&&(this.min=M)}}get(t,n){const o=new Uint8Array(this.data.buffer),h=4*this._idx(t,n);return this.unpack(o[h],o[h+1],o[h+2])}getUnpackVector(){return[this.redFactor,this.greenFactor,this.blueFactor,this.baseShift]}_idx(t,n){if(t<-1||t>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(t+1)}unpack(t,n,o){return t*this.redFactor+n*this.greenFactor+o*this.blueFactor-this.baseShift}getPixels(){return new Zn({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(t,n,o){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,_=o*this.dim,v=o*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(o){case-1:_=v-1;break;case 1:v=_+1}const w=-n*this.dim,T=-o*this.dim;for(let E=_;E<v;E++)for(let M=h;M<g;M++)this.data[this._idx(M,E)]=t.data[this._idx(M+w,E+T)]}}$e("DEMData",Lm);class Rm{constructor(t){this._stringToNumber={},this._numberToString=[];for(let n=0;n<t.length;n++){const o=t[n];this._stringToNumber[o]=n,this._numberToString[n]=o}}encode(t){return this._stringToNumber[t]}decode(t){if(t>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${t} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[t]}}class Bm{constructor(t,n,o,h,g){this.type="Feature",this._vectorTileFeature=t,t._z=n,t._x=o,t._y=h,this.properties=t.properties,this.id=g}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={geometry:this.geometry};for(const n in this)n!=="_geometry"&&n!=="_vectorTileFeature"&&(t[n]=this[n]);return t}}class Fm{constructor(t,n){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Us(wi,16,0),this.grid3D=new Us(wi,16,0),this.featureIndexArray=new Qi,this.promoteId=n}insert(t,n,o,h,g,_){const v=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(o,h,g);const w=_?this.grid3D:this.grid;for(let T=0;T<n.length;T++){const E=n[T],M=[1/0,1/0,-1/0,-1/0];for(let z=0;z<E.length;z++){const R=E[z];M[0]=Math.min(M[0],R.x),M[1]=Math.min(M[1],R.y),M[2]=Math.max(M[2],R.x),M[3]=Math.max(M[3],R.y)}M[0]<wi&&M[1]<wi&&M[2]>=0&&M[3]>=0&&w.insert(v,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Js.VectorTile(new fd(this.rawTileData)).layers,this.sourceLayerCoder=new Rm(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(t,n,o,h){this.loadVTLayers();const g=t.params||{},_=wi/t.tileSize/t.scale,v=ql(g.filter),w=t.queryGeometry,T=t.queryPadding*_,E=Nm(w),M=this.grid.query(E.minX-T,E.minY-T,E.maxX+T,E.maxY+T),z=Nm(t.cameraQueryGeometry),R=this.grid3D.query(z.minX-T,z.minY-T,z.maxX+T,z.maxY+T,(G,J,de,re)=>function(ue,_e,Se,Oe,nt){for(const De of ue)if(_e<=De.x&&Se<=De.y&&Oe>=De.x&&nt>=De.y)return!0;const Re=[new q(_e,Se),new q(_e,nt),new q(Oe,nt),new q(Oe,Se)];if(ue.length>2){for(const De of Re)if(Wa(ue,De))return!0}for(let De=0;De<ue.length-1;De++)if(D_(ue[De],ue[De+1],Re))return!0;return!1}(t.cameraQueryGeometry,G-T,J-T,de+T,re+T));for(const G of R)M.push(G);M.sort(e0);const N={};let U;for(let G=0;G<M.length;G++){const J=M[G];if(J===U)continue;U=J;const de=this.featureIndexArray.get(J);let re=null;this.loadMatchingFeature(N,de.bucketIndex,de.sourceLayerIndex,de.featureIndex,v,g.layers,g.availableImages,n,o,h,(ue,_e,Se)=>(re||(re=Zo(ue)),_e.queryIntersectsFeature(w,ue,Se,re,this.z,t.transform,_,t.pixelPosMatrix)))}return N}loadMatchingFeature(t,n,o,h,g,_,v,w,T,E,M){const z=this.bucketLayerIDs[n];if(_&&!function(G,J){for(let de=0;de<G.length;de++)if(J.indexOf(G[de])>=0)return!0;return!1}(_,z))return;const R=this.sourceLayerCoder.decode(o),N=this.vtLayers[R].feature(h);if(g.needGeometry){const G=Go(N,!0);if(!g.filter(new ei(this.tileID.overscaledZ),G,this.tileID.canonical))return}else if(!g.filter(new ei(this.tileID.overscaledZ),N))return;const U=this.getId(N,R);for(let G=0;G<z.length;G++){const J=z[G];if(_&&_.indexOf(J)<0)continue;const de=w[J];if(!de)continue;let re={};U&&E&&(re=E.getState(de.sourceLayer||"_geojsonTileLayer",U));const ue=We({},T[J]);ue.paint=Om(ue.paint,de.paint,N,re,v),ue.layout=Om(ue.layout,de.layout,N,re,v);const _e=!M||M(N,de,re);if(!_e)continue;const Se=new Bm(N,this.z,this.x,this.y,U);Se.layer=ue;let Oe=t[J];Oe===void 0&&(Oe=t[J]=[]),Oe.push({featureIndex:h,feature:Se,intersectionZ:_e})}}lookupSymbolFeatures(t,n,o,h,g,_,v,w){const T={};this.loadVTLayers();const E=ql(g);for(const M of t)this.loadMatchingFeature(T,o,h,M,E,_,v,w,n);return T}hasLayer(t){for(const n of this.bucketLayerIDs)for(const o of n)if(t===o)return!0;return!1}getId(t,n){let o=t.id;return this.promoteId&&(o=t.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[n]],typeof o=="boolean"&&(o=Number(o))),o}}function Om(i,t,n,o,h){return Ve(i,(g,_)=>{const v=t instanceof jo?t.get(_):null;return v&&v.evaluate?v.evaluate(n,o,h):v})}function Nm(i){let t=1/0,n=1/0,o=-1/0,h=-1/0;for(const g of i)t=Math.min(t,g.x),n=Math.min(n,g.y),o=Math.max(o,g.x),h=Math.max(h,g.y);return{minX:t,minY:n,maxX:o,maxY:h}}function e0(i,t){return t-i}function Vm(i,t,n,o,h){const g=[];for(let _=0;_<i.length;_++){const v=i[_];let w;for(let T=0;T<v.length-1;T++){let E=v[T],M=v[T+1];E.x<t&&M.x<t||(E.x<t?E=new q(t,E.y+(t-E.x)/(M.x-E.x)*(M.y-E.y))._round():M.x<t&&(M=new q(t,E.y+(t-E.x)/(M.x-E.x)*(M.y-E.y))._round()),E.y<n&&M.y<n||(E.y<n?E=new q(E.x+(n-E.y)/(M.y-E.y)*(M.x-E.x),n)._round():M.y<n&&(M=new q(E.x+(n-E.y)/(M.y-E.y)*(M.x-E.x),n)._round()),E.x>=o&&M.x>=o||(E.x>=o?E=new q(o,E.y+(o-E.x)/(M.x-E.x)*(M.y-E.y))._round():M.x>=o&&(M=new q(o,E.y+(o-E.x)/(M.x-E.x)*(M.y-E.y))._round()),E.y>=h&&M.y>=h||(E.y>=h?E=new q(E.x+(h-E.y)/(M.y-E.y)*(M.x-E.x),h)._round():M.y>=h&&(M=new q(E.x+(h-E.y)/(M.y-E.y)*(M.x-E.x),h)._round()),w&&E.equals(w[w.length-1])||(w=[E],g.push(w)),w.push(M)))))}}return g}$e("FeatureIndex",Fm,{omit:["rawTileData","sourceLayerCoder"]});class io extends q{constructor(t,n,o,h){super(t,n),this.angle=o,h!==void 0&&(this.segment=h)}clone(){return new io(this.x,this.y,this.angle,this.segment)}}function Um(i,t,n,o,h){if(t.segment===void 0||n===0)return!0;let g=t,_=t.segment+1,v=0;for(;v>-n/2;){if(_--,_<0)return!1;v-=i[_].dist(g),g=i[_]}v+=i[_].dist(i[_+1]),_++;const w=[];let T=0;for(;v<n/2;){const E=i[_],M=i[_+1];if(!M)return!1;let z=i[_-1].angleTo(E)-E.angleTo(M);for(z=Math.abs((z+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:v,angleDelta:z}),T+=z;v-w[0].distance>o;)T-=w.shift().angleDelta;if(T>h)return!1;_++,v+=E.dist(M)}return!0}function $m(i){let t=0;for(let n=0;n<i.length-1;n++)t+=i[n].dist(i[n+1]);return t}function jm(i,t,n){return i?.6*t*n:0}function qm(i,t){return Math.max(i?i.right-i.left:0,t?t.right-t.left:0)}function t0(i,t,n,o,h,g){const _=jm(n,h,g),v=qm(n,o)*g;let w=0;const T=$m(i)/2;for(let E=0;E<i.length-1;E++){const M=i[E],z=i[E+1],R=M.dist(z);if(w+R>T){const N=(T-w)/R,U=sn.number(M.x,z.x,N),G=sn.number(M.y,z.y,N),J=new io(U,G,z.angleTo(M),E);return J._round(),!_||Um(i,J,v,_,t)?J:void 0}w+=R}}function i0(i,t,n,o,h,g,_,v,w){const T=jm(o,g,_),E=qm(o,h),M=E*_,z=i[0].x===0||i[0].x===w||i[0].y===0||i[0].y===w;return t-M<t/4&&(t=M+t/4),Hm(i,z?t/2*v%t:(E/2+2*g)*_*v%t,t,T,n,M,z,!1,w)}function Hm(i,t,n,o,h,g,_,v,w){const T=g/2,E=$m(i);let M=0,z=t-n,R=[];for(let N=0;N<i.length-1;N++){const U=i[N],G=i[N+1],J=U.dist(G),de=G.angleTo(U);for(;z+n<M+J;){z+=n;const re=(z-M)/J,ue=sn.number(U.x,G.x,re),_e=sn.number(U.y,G.y,re);if(ue>=0&&ue<w&&_e>=0&&_e<w&&z-T>=0&&z+T<=E){const Se=new io(ue,_e,de,N);Se._round(),o&&!Um(i,Se,g,o,h)||R.push(Se)}}M+=J}return v||R.length||_||(R=Hm(i,M/2,n,o,h,g,_,!0,w)),R}$e("Anchor",io);const el=wn;function Wm(i,t,n,o){const h=[],g=i.image,_=g.pixelRatio,v=g.paddedRect.w-2*el,w=g.paddedRect.h-2*el;let T={x1:i.left,y1:i.top,x2:i.right,y2:i.bottom};const E=g.stretchX||[[0,v]],M=g.stretchY||[[0,w]],z=(xe,Je)=>xe+Je[1]-Je[0],R=E.reduce(z,0),N=M.reduce(z,0),U=v-R,G=w-N;let J=0,de=R,re=0,ue=N,_e=0,Se=U,Oe=0,nt=G;if(g.content&&o){const xe=g.content,Je=xe[2]-xe[0],Xe=xe[3]-xe[1];(g.textFitWidth||g.textFitHeight)&&(T=vm(i)),J=Yu(E,0,xe[0]),re=Yu(M,0,xe[1]),de=Yu(E,xe[0],xe[2]),ue=Yu(M,xe[1],xe[3]),_e=xe[0]-J,Oe=xe[1]-re,Se=Je-de,nt=Xe-ue}const Re=T.x1,De=T.y1,Ke=T.x2-Re,He=T.y2-De,Ue=(xe,Je,Xe,lt)=>{const Gt=Ku(xe.stretch-J,de,Ke,Re),$t=Ju(xe.fixed-_e,Se,xe.stretch,R),Ai=Ku(Je.stretch-re,ue,He,De),mr=Ju(Je.fixed-Oe,nt,Je.stretch,N),Wi=Ku(Xe.stretch-J,de,Ke,Re),zi=Ju(Xe.fixed-_e,Se,Xe.stretch,R),cn=Ku(lt.stretch-re,ue,He,De),un=Ju(lt.fixed-Oe,nt,lt.stretch,N),hn=new q(Gt,Ai),gi=new q(Wi,Ai),Di=new q(Wi,cn),tn=new q(Gt,cn),Zi=new q($t/_,mr/_),dn=new q(zi/_,un/_),Gi=t*Math.PI/180;if(Gi){const kt=Math.sin(Gi),Jt=Math.cos(Gi),ri=[Jt,-kt,kt,Jt];hn._matMult(ri),gi._matMult(ri),tn._matMult(ri),Di._matMult(ri)}const Xn=xe.stretch+xe.fixed,Cn=Je.stretch+Je.fixed;return{tl:hn,tr:gi,bl:tn,br:Di,tex:{x:g.paddedRect.x+el+Xn,y:g.paddedRect.y+el+Cn,w:Xe.stretch+Xe.fixed-Xn,h:lt.stretch+lt.fixed-Cn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Zi,pixelOffsetBR:dn,minFontScaleX:Se/_/Ke,minFontScaleY:nt/_/He,isSDF:n}};if(o&&(g.stretchX||g.stretchY)){const xe=Zm(E,U,R),Je=Zm(M,G,N);for(let Xe=0;Xe<xe.length-1;Xe++){const lt=xe[Xe],Gt=xe[Xe+1];for(let $t=0;$t<Je.length-1;$t++)h.push(Ue(lt,Je[$t],Gt,Je[$t+1]))}}else h.push(Ue({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:v+1},{fixed:0,stretch:w+1}));return h}function Yu(i,t,n){let o=0;for(const h of i)o+=Math.max(t,Math.min(n,h[1]))-Math.max(t,Math.min(n,h[0]));return o}function Zm(i,t,n){const o=[{fixed:-el,stretch:0}];for(const[h,g]of i){const _=o[o.length-1];o.push({fixed:h-_.stretch,stretch:_.stretch}),o.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return o.push({fixed:t+el,stretch:n}),o}function Ku(i,t,n,o){return i/t*n+o}function Ju(i,t,n,o){return i-t*n/o}class Qu{constructor(t,n,o,h,g,_,v,w,T,E){var M;if(this.boxStartIndex=t.length,T){let z=_.top,R=_.bottom;const N=_.collisionPadding;N&&(z-=N[1],R+=N[3]);let U=R-z;U>0&&(U=Math.max(10,U),this.circleDiameter=U)}else{const z=!((M=_.image)===null||M===void 0)&&M.content&&(_.image.textFitWidth||_.image.textFitHeight)?vm(_):{x1:_.left,y1:_.top,x2:_.right,y2:_.bottom};z.y1=z.y1*v-w[0],z.y2=z.y2*v+w[2],z.x1=z.x1*v-w[3],z.x2=z.x2*v+w[1];const R=_.collisionPadding;if(R&&(z.x1-=R[0]*v,z.y1-=R[1]*v,z.x2+=R[2]*v,z.y2+=R[3]*v),E){const N=new q(z.x1,z.y1),U=new q(z.x2,z.y1),G=new q(z.x1,z.y2),J=new q(z.x2,z.y2),de=E*Math.PI/180;N._rotate(de),U._rotate(de),G._rotate(de),J._rotate(de),z.x1=Math.min(N.x,U.x,G.x,J.x),z.x2=Math.max(N.x,U.x,G.x,J.x),z.y1=Math.min(N.y,U.y,G.y,J.y),z.y2=Math.max(N.y,U.y,G.y,J.y)}t.emplaceBack(n.x,n.y,z.x1,z.y1,z.x2,z.y2,o,h,g)}this.boxEndIndex=t.length}}class n0{constructor(t=[],n=(o,h)=>o<h?-1:o>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=n,this.length>0)for(let o=(this.length>>1)-1;o>=0;o--)this._down(o)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],n=this.data.pop();return--this.length>0&&(this.data[0]=n,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:n,compare:o}=this,h=n[t];for(;t>0;){const g=t-1>>1,_=n[g];if(o(h,_)>=0)break;n[t]=_,t=g}n[t]=h}_down(t){const{data:n,compare:o}=this,h=this.length>>1,g=n[t];for(;t<h;){let _=1+(t<<1);const v=_+1;if(v<this.length&&o(n[v],n[_])<0&&(_=v),o(n[_],g)>=0)break;n[t]=n[_],t=_}n[t]=g}}function r0(i,t=1,n=!1){let o=1/0,h=1/0,g=-1/0,_=-1/0;const v=i[0];for(let R=0;R<v.length;R++){const N=v[R];(!R||N.x<o)&&(o=N.x),(!R||N.y<h)&&(h=N.y),(!R||N.x>g)&&(g=N.x),(!R||N.y>_)&&(_=N.y)}const w=Math.min(g-o,_-h);let T=w/2;const E=new n0([],s0);if(w===0)return new q(o,h);for(let R=o;R<g;R+=w)for(let N=h;N<_;N+=w)E.push(new tl(R+T,N+T,T,i));let M=function(R){let N=0,U=0,G=0;const J=R[0];for(let de=0,re=J.length,ue=re-1;de<re;ue=de++){const _e=J[de],Se=J[ue],Oe=_e.x*Se.y-Se.x*_e.y;U+=(_e.x+Se.x)*Oe,G+=(_e.y+Se.y)*Oe,N+=3*Oe}return new tl(U/N,G/N,0,R)}(i),z=E.length;for(;E.length;){const R=E.pop();(R.d>M.d||!M.d)&&(M=R,n&&console.log("found best %d after %d probes",Math.round(1e4*R.d)/1e4,z)),R.max-M.d<=t||(T=R.h/2,E.push(new tl(R.p.x-T,R.p.y-T,T,i)),E.push(new tl(R.p.x+T,R.p.y-T,T,i)),E.push(new tl(R.p.x-T,R.p.y+T,T,i)),E.push(new tl(R.p.x+T,R.p.y+T,T,i)),z+=4)}return n&&(console.log(`num probes: ${z}`),console.log(`best distance: ${M.d}`)),M.p}function s0(i,t){return t.max-i.max}function tl(i,t,n,o){this.p=new q(i,t),this.h=n,this.d=function(h,g){let _=!1,v=1/0;for(let w=0;w<g.length;w++){const T=g[w];for(let E=0,M=T.length,z=M-1;E<M;z=E++){const R=T[E],N=T[z];R.y>h.y!=N.y>h.y&&h.x<(N.x-R.x)*(h.y-R.y)/(N.y-R.y)+R.x&&(_=!_),v=Math.min(v,kp(h,R,N))}}return(_?1:-1)*Math.sqrt(v)}(this.p,o),this.max=this.d+this.h*Math.SQRT2}var Hi;x.aq=void 0,(Hi=x.aq||(x.aq={}))[Hi.center=1]="center",Hi[Hi.left=2]="left",Hi[Hi.right=3]="right",Hi[Hi.top=4]="top",Hi[Hi.bottom=5]="bottom",Hi[Hi["top-left"]=6]="top-left",Hi[Hi["top-right"]=7]="top-right",Hi[Hi["bottom-left"]=8]="bottom-left",Hi[Hi["bottom-right"]=9]="bottom-right";const no=7,Pd=Number.POSITIVE_INFINITY;function Gm(i,t){return t[1]!==Pd?function(n,o,h){let g=0,_=0;switch(o=Math.abs(o),h=Math.abs(h),n){case"top-right":case"top-left":case"top":_=h-no;break;case"bottom-right":case"bottom-left":case"bottom":_=-h+no}switch(n){case"top-right":case"bottom-right":case"right":g=-o;break;case"top-left":case"bottom-left":case"left":g=o}return[g,_]}(i,t[0],t[1]):function(n,o){let h=0,g=0;o<0&&(o=0);const _=o/Math.SQRT2;switch(n){case"top-right":case"top-left":g=_-no;break;case"bottom-right":case"bottom-left":g=-_+no;break;case"bottom":g=-o+no;break;case"top":g=o-no}switch(n){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=o;break;case"right":h=-o}return[h,g]}(i,t[0])}function Xm(i,t,n){var o;const h=i.layout,g=(o=h.get("text-variable-anchor-offset"))===null||o===void 0?void 0:o.evaluate(t,{},n);if(g){const v=g.values,w=[];for(let T=0;T<v.length;T+=2){const E=w[T]=v[T],M=v[T+1].map(z=>z*Ii);E.startsWith("top")?M[1]-=no:E.startsWith("bottom")&&(M[1]+=no),w[T+1]=M}return new Tn(w)}const _=h.get("text-variable-anchor");if(_){let v;v=i._unevaluatedLayout.getValue("text-radial-offset")!==void 0?[h.get("text-radial-offset").evaluate(t,{},n)*Ii,Pd]:h.get("text-offset").evaluate(t,{},n).map(T=>T*Ii);const w=[];for(const T of _)w.push(T,Gm(T,v));return new Tn(w)}return null}function Md(i){switch(i){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function o0(i,t,n,o,h,g,_,v,w,T,E){let M=g.textMaxSize.evaluate(t,{});M===void 0&&(M=_);const z=i.layers[0].layout,R=z.get("icon-offset").evaluate(t,{},E),N=Km(n.horizontal),U=_/24,G=i.tilePixelRatio*U,J=i.tilePixelRatio*M/24,de=i.tilePixelRatio*v,re=i.tilePixelRatio*z.get("symbol-spacing"),ue=z.get("text-padding")*i.tilePixelRatio,_e=function(xe,Je,Xe,lt=1){const Gt=xe.get("icon-padding").evaluate(Je,{},Xe),$t=Gt&&Gt.values;return[$t[0]*lt,$t[1]*lt,$t[2]*lt,$t[3]*lt]}(z,t,E,i.tilePixelRatio),Se=z.get("text-max-angle")/180*Math.PI,Oe=z.get("text-rotation-alignment")!=="viewport"&&z.get("symbol-placement")!=="point",nt=z.get("icon-rotation-alignment")==="map"&&z.get("symbol-placement")!=="point",Re=z.get("symbol-placement"),De=re/2,Ke=z.get("icon-text-fit");let He;o&&Ke!=="none"&&(i.allowVerticalPlacement&&n.vertical&&(He=xm(o,n.vertical,Ke,z.get("icon-text-fit-padding"),R,U)),N&&(o=xm(o,N,Ke,z.get("icon-text-fit-padding"),R,U)));const Ue=(xe,Je)=>{Je.x<0||Je.x>=wi||Je.y<0||Je.y>=wi||function(Xe,lt,Gt,$t,Ai,mr,Wi,zi,cn,un,hn,gi,Di,tn,Zi,dn,Gi,Xn,Cn,kt,Jt,ri,Dn,hi,il){const Vr=Xe.addToLineVertexArray(lt,Gt);let Ur,fr,Yn,Oi,us=0,Pc=0,tf=0,nf=0,Fd=-1,Od=-1;const hs={};let rf=$a("");if(Xe.allowVerticalPlacement&&$t.vertical){const nn=zi.layout.get("text-rotate").evaluate(Jt,{},hi)+90;Yn=new Qu(cn,lt,un,hn,gi,$t.vertical,Di,tn,Zi,nn),Wi&&(Oi=new Qu(cn,lt,un,hn,gi,Wi,Gi,Xn,Zi,nn))}if(Ai){const nn=zi.layout.get("icon-rotate").evaluate(Jt,{}),Kn=zi.layout.get("icon-text-fit")!=="none",Yo=Wm(Ai,nn,Dn,Kn),Tr=Wi?Wm(Wi,nn,Dn,Kn):void 0;fr=new Qu(cn,lt,un,hn,gi,Ai,Gi,Xn,!1,nn),us=4*Yo.length;const Ko=Xe.iconSizeData;let $r=null;Ko.kind==="source"?($r=[Nr*zi.layout.get("icon-size").evaluate(Jt,{})],$r[0]>eo&&St(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Cc}. Reduce your "icon-size".`)):Ko.kind==="composite"&&($r=[Nr*ri.compositeIconSizes[0].evaluate(Jt,{},hi),Nr*ri.compositeIconSizes[1].evaluate(Jt,{},hi)],($r[0]>eo||$r[1]>eo)&&St(`${Xe.layerIds[0]}: Value for "icon-size" is >= ${Cc}. Reduce your "icon-size".`)),Xe.addSymbols(Xe.icon,Yo,$r,kt,Cn,Jt,x.ah.none,lt,Vr.lineStartIndex,Vr.lineLength,-1,hi),Fd=Xe.icon.placedSymbolArray.length-1,Tr&&(Pc=4*Tr.length,Xe.addSymbols(Xe.icon,Tr,$r,kt,Cn,Jt,x.ah.vertical,lt,Vr.lineStartIndex,Vr.lineLength,-1,hi),Od=Xe.icon.placedSymbolArray.length-1)}const sf=Object.keys($t.horizontal);for(const nn of sf){const Kn=$t.horizontal[nn];if(!Ur){rf=$a(Kn.text);const Tr=zi.layout.get("text-rotate").evaluate(Jt,{},hi);Ur=new Qu(cn,lt,un,hn,gi,Kn,Di,tn,Zi,Tr)}const Yo=Kn.positionedLines.length===1;if(tf+=Ym(Xe,lt,Kn,mr,zi,Zi,Jt,dn,Vr,$t.vertical?x.ah.horizontal:x.ah.horizontalOnly,Yo?sf:[nn],hs,Fd,ri,hi),Yo)break}$t.vertical&&(nf+=Ym(Xe,lt,$t.vertical,mr,zi,Zi,Jt,dn,Vr,x.ah.vertical,["vertical"],hs,Od,ri,hi));const c0=Ur?Ur.boxStartIndex:Xe.collisionBoxArray.length,u0=Ur?Ur.boxEndIndex:Xe.collisionBoxArray.length,h0=Yn?Yn.boxStartIndex:Xe.collisionBoxArray.length,d0=Yn?Yn.boxEndIndex:Xe.collisionBoxArray.length,p0=fr?fr.boxStartIndex:Xe.collisionBoxArray.length,m0=fr?fr.boxEndIndex:Xe.collisionBoxArray.length,f0=Oi?Oi.boxStartIndex:Xe.collisionBoxArray.length,g0=Oi?Oi.boxEndIndex:Xe.collisionBoxArray.length;let Ir=-1;const th=(nn,Kn)=>nn&&nn.circleDiameter?Math.max(nn.circleDiameter,Kn):Kn;Ir=th(Ur,Ir),Ir=th(Yn,Ir),Ir=th(fr,Ir),Ir=th(Oi,Ir);const of=Ir>-1?1:0;of&&(Ir*=il/Ii),Xe.glyphOffsetArray.length>=Qa.MAX_GLYPHS&&St("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Jt.sortKey!==void 0&&Xe.addToSortKeyRanges(Xe.symbolInstances.length,Jt.sortKey);const _0=Xm(zi,Jt,hi),[y0,v0]=function(nn,Kn){const Yo=nn.length,Tr=Kn?.values;if(Tr?.length>0)for(let Ko=0;Ko<Tr.length;Ko+=2){const $r=Tr[Ko+1];nn.emplaceBack(x.aq[Tr[Ko]],$r[0],$r[1])}return[Yo,nn.length]}(Xe.textAnchorOffsets,_0);Xe.symbolInstances.emplaceBack(lt.x,lt.y,hs.right>=0?hs.right:-1,hs.center>=0?hs.center:-1,hs.left>=0?hs.left:-1,hs.vertical||-1,Fd,Od,rf,c0,u0,h0,d0,p0,m0,f0,g0,un,tf,nf,us,Pc,of,0,Di,Ir,y0,v0)}(i,Je,xe,n,o,h,He,i.layers[0],i.collisionBoxArray,t.index,t.sourceLayerIndex,i.index,G,[ue,ue,ue,ue],Oe,w,de,_e,nt,R,t,g,T,E,_)};if(Re==="line")for(const xe of Vm(t.geometry,0,0,wi,wi)){const Je=i0(xe,re,Se,n.vertical||N,o,24,J,i.overscaling,wi);for(const Xe of Je)N&&a0(i,N.text,De,Xe)||Ue(xe,Xe)}else if(Re==="line-center"){for(const xe of t.geometry)if(xe.length>1){const Je=t0(xe,Se,n.vertical||N,o,24,J);Je&&Ue(xe,Je)}}else if(t.type==="Polygon")for(const xe of ya(t.geometry,0)){const Je=r0(xe,16);Ue(xe[0],new io(Je.x,Je.y,0))}else if(t.type==="LineString")for(const xe of t.geometry)Ue(xe,new io(xe[0].x,xe[0].y,0));else if(t.type==="Point")for(const xe of t.geometry)for(const Je of xe)Ue([Je],new io(Je.x,Je.y,0))}function Ym(i,t,n,o,h,g,_,v,w,T,E,M,z,R,N){const U=function(de,re,ue,_e,Se,Oe,nt,Re){const De=_e.layout.get("text-rotate").evaluate(Oe,{})*Math.PI/180,Ke=[];for(const He of re.positionedLines)for(const Ue of He.positionedGlyphs){if(!Ue.rect)continue;const xe=Ue.rect||{};let Je=dm+1,Xe=!0,lt=1,Gt=0;const $t=(Se||Re)&&Ue.vertical,Ai=Ue.metrics.advance*Ue.scale/2;if(Re&&re.verticalizable&&(Gt=He.lineOffset/2-(Ue.imageName?-(Ii-Ue.metrics.width*Ue.scale)/2:(Ue.scale-1)*Ii)),Ue.imageName){const kt=nt[Ue.imageName];Xe=kt.sdf,lt=kt.pixelRatio,Je=wn/lt}const mr=Se?[Ue.x+Ai,Ue.y]:[0,0];let Wi=Se?[0,0]:[Ue.x+Ai+ue[0],Ue.y+ue[1]-Gt],zi=[0,0];$t&&(zi=Wi,Wi=[0,0]);const cn=Ue.metrics.isDoubleResolution?2:1,un=(Ue.metrics.left-Je)*Ue.scale-Ai+Wi[0],hn=(-Ue.metrics.top-Je)*Ue.scale+Wi[1],gi=un+xe.w/cn*Ue.scale/lt,Di=hn+xe.h/cn*Ue.scale/lt,tn=new q(un,hn),Zi=new q(gi,hn),dn=new q(un,Di),Gi=new q(gi,Di);if($t){const kt=new q(-Ai,Ai-bc),Jt=-Math.PI/2,ri=Ii/2-Ai,Dn=new q(5-bc-ri,-(Ue.imageName?ri:0)),hi=new q(...zi);tn._rotateAround(Jt,kt)._add(Dn)._add(hi),Zi._rotateAround(Jt,kt)._add(Dn)._add(hi),dn._rotateAround(Jt,kt)._add(Dn)._add(hi),Gi._rotateAround(Jt,kt)._add(Dn)._add(hi)}if(De){const kt=Math.sin(De),Jt=Math.cos(De),ri=[Jt,-kt,kt,Jt];tn._matMult(ri),Zi._matMult(ri),dn._matMult(ri),Gi._matMult(ri)}const Xn=new q(0,0),Cn=new q(0,0);Ke.push({tl:tn,tr:Zi,bl:dn,br:Gi,tex:xe,writingMode:re.writingMode,glyphOffset:mr,sectionIndex:Ue.sectionIndex,isSDF:Xe,pixelOffsetTL:Xn,pixelOffsetBR:Cn,minFontScaleX:0,minFontScaleY:0})}return Ke}(0,n,v,h,g,_,o,i.allowVerticalPlacement),G=i.textSizeData;let J=null;G.kind==="source"?(J=[Nr*h.layout.get("text-size").evaluate(_,{})],J[0]>eo&&St(`${i.layerIds[0]}: Value for "text-size" is >= ${Cc}. Reduce your "text-size".`)):G.kind==="composite"&&(J=[Nr*R.compositeTextSizes[0].evaluate(_,{},N),Nr*R.compositeTextSizes[1].evaluate(_,{},N)],(J[0]>eo||J[1]>eo)&&St(`${i.layerIds[0]}: Value for "text-size" is >= ${Cc}. Reduce your "text-size".`)),i.addSymbols(i.text,U,J,v,g,_,T,t,w.lineStartIndex,w.lineLength,z,N);for(const de of E)M[de]=i.text.placedSymbolArray.length-1;return 4*U.length}function Km(i){for(const t in i)return i[t];return null}function a0(i,t,n,o){const h=i.compareText;if(t in h){const g=h[t];for(let _=g.length-1;_>=0;_--)if(o.dist(g[_])<n)return!0}else h[t]=[];return h[t].push(o),!1}const Jm=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class kd{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,o]=new Uint8Array(t,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=o>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=Jm[15&o];if(!g)throw new Error("Unrecognized array type.");const[_]=new Uint16Array(t,2,1),[v]=new Uint32Array(t,4,1);return new kd(v,_,g,t)}constructor(t,n=64,o=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=o,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Jm.indexOf(this.ArrayType),_=2*t*this.ArrayType.BYTES_PER_ELEMENT,v=t*this.IndexArrayType.BYTES_PER_ELEMENT,w=(8-v%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${o}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+_+v+w),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+v+w,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=t)}add(t,n){const o=this._pos>>1;return this.ids[o]=o,this.coords[this._pos++]=t,this.coords[this._pos++]=n,o}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Ad(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,n,o,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:_,nodeSize:v}=this,w=[0,g.length-1,0],T=[];for(;w.length;){const E=w.pop()||0,M=w.pop()||0,z=w.pop()||0;if(M-z<=v){for(let G=z;G<=M;G++){const J=_[2*G],de=_[2*G+1];J>=t&&J<=o&&de>=n&&de<=h&&T.push(g[G])}continue}const R=z+M>>1,N=_[2*R],U=_[2*R+1];N>=t&&N<=o&&U>=n&&U<=h&&T.push(g[R]),(E===0?t<=N:n<=U)&&(w.push(z),w.push(R-1),w.push(1-E)),(E===0?o>=N:h>=U)&&(w.push(R+1),w.push(M),w.push(1-E))}return T}within(t,n,o){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:_}=this,v=[0,h.length-1,0],w=[],T=o*o;for(;v.length;){const E=v.pop()||0,M=v.pop()||0,z=v.pop()||0;if(M-z<=_){for(let G=z;G<=M;G++)ef(g[2*G],g[2*G+1],t,n)<=T&&w.push(h[G]);continue}const R=z+M>>1,N=g[2*R],U=g[2*R+1];ef(N,U,t,n)<=T&&w.push(h[R]),(E===0?t-o<=N:n-o<=U)&&(v.push(z),v.push(R-1),v.push(1-E)),(E===0?t+o>=N:n+o>=U)&&(v.push(R+1),v.push(M),v.push(1-E))}return w}}function Ad(i,t,n,o,h,g){if(h-o<=n)return;const _=o+h>>1;Qm(i,t,_,o,h,g),Ad(i,t,n,o,_-1,1-g),Ad(i,t,n,_+1,h,1-g)}function Qm(i,t,n,o,h,g){for(;h>o;){if(h-o>600){const T=h-o+1,E=n-o+1,M=Math.log(T),z=.5*Math.exp(2*M/3),R=.5*Math.sqrt(M*z*(T-z)/T)*(E-T/2<0?-1:1);Qm(i,t,n,Math.max(o,Math.floor(n-E*z/T+R)),Math.min(h,Math.floor(n+(T-E)*z/T+R)),g)}const _=t[2*n+g];let v=o,w=h;for(Tc(i,t,o,n),t[2*h+g]>_&&Tc(i,t,o,h);v<w;){for(Tc(i,t,v,w),v++,w--;t[2*v+g]<_;)v++;for(;t[2*w+g]>_;)w--}t[2*o+g]===_?Tc(i,t,o,w):(w++,Tc(i,t,w,h)),w<=n&&(o=w+1),n<=w&&(h=w-1)}}function Tc(i,t,n,o){zd(i,n,o),zd(t,2*n,2*o),zd(t,2*n+1,2*o+1)}function zd(i,t,n){const o=i[t];i[t]=i[n],i[n]=o}function ef(i,t,n,o){const h=i-n,g=t-o;return h*h+g*g}var Dd;x.bg=void 0,(Dd=x.bg||(x.bg={})).create="create",Dd.load="load",Dd.fullLoad="fullLoad";let eh=null,Ec=[];const Ld=1e3/60,Rd="loadTime",Bd="fullLoadTime",l0={mark(i){performance.mark(i)},frame(i){const t=i;eh!=null&&Ec.push(t-eh),eh=t},clearMetrics(){eh=null,Ec=[],performance.clearMeasures(Rd),performance.clearMeasures(Bd);for(const i in x.bg)performance.clearMarks(x.bg[i])},getPerformanceMetrics(){performance.measure(Rd,x.bg.create,x.bg.load),performance.measure(Bd,x.bg.create,x.bg.fullLoad);const i=performance.getEntriesByName(Rd)[0].duration,t=performance.getEntriesByName(Bd)[0].duration,n=Ec.length,o=1/(Ec.reduce((g,_)=>g+_,0)/n/1e3),h=Ec.filter(g=>g>Ld).reduce((g,_)=>g+(_-Ld)/Ld,0);return{loadTime:i,fullLoadTime:t,fps:o,percentDroppedFrames:h/(n+h)*100,totalFrames:n}}};x.$=class extends k{},x.A=Za,x.B=qh,x.C=function(i){if(rr==null){const t=i.navigator?i.navigator.userAgent:null;rr=!!i.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return rr},x.D=Ze,x.E=ws,x.F=class{constructor(i,t){this.target=i,this.mapId=t,this.resolveRejects={},this.tasks={},this.taskQueue=[],this.abortControllers={},this.messageHandlers={},this.invoker=new Qy(()=>this.process()),this.subscription=function(n,o,h,g){return n.addEventListener(o,h,!1),{unsubscribe:()=>{n.removeEventListener(o,h,!1)}}}(this.target,"message",n=>this.receive(n)),this.globalScope=Ri(self)?i:window}registerMessageHandler(i,t){this.messageHandlers[i]=t}sendAsync(i,t){return new Promise((n,o)=>{const h=Math.round(1e18*Math.random()).toString(36).substring(0,10);this.resolveRejects[h]={resolve:n,reject:o},t&&t.signal.addEventListener("abort",()=>{delete this.resolveRejects[h];const v={id:h,type:"<cancel>",origin:location.origin,targetMapId:i.targetMapId,sourceMapId:this.mapId};this.target.postMessage(v)},{once:!0});const g=[],_=Object.assign(Object.assign({},i),{id:h,sourceMapId:this.mapId,origin:location.origin,data:$s(i.data,g)});this.target.postMessage(_,{transfer:g})})}receive(i){const t=i.data,n=t.id;if(!(t.origin!=="file://"&&location.origin!=="file://"&&t.origin!=="resource://android"&&location.origin!=="resource://android"&&t.origin!==location.origin||t.targetMapId&&this.mapId!==t.targetMapId)){if(t.type==="<cancel>"){delete this.tasks[n];const o=this.abortControllers[n];return delete this.abortControllers[n],void(o&&o.abort())}if(Ri(self)||t.mustQueue)return this.tasks[n]=t,this.taskQueue.push(n),void this.invoker.trigger();this.processTask(n,t)}}process(){if(this.taskQueue.length===0)return;const i=this.taskQueue.shift(),t=this.tasks[i];delete this.tasks[i],this.taskQueue.length>0&&this.invoker.trigger(),t&&this.processTask(i,t)}processTask(i,t){return u(this,void 0,void 0,function*(){if(t.type==="<response>"){const h=this.resolveRejects[i];return delete this.resolveRejects[i],h?void(t.error?h.reject(js(t.error)):h.resolve(js(t.data))):void 0}if(!this.messageHandlers[t.type])return void this.completeTask(i,new Error(`Could not find a registered handler for ${t.type}, map ID: ${this.mapId}, available handlers: ${Object.keys(this.messageHandlers).join(", ")}`));const n=js(t.data),o=new AbortController;this.abortControllers[i]=o;try{const h=yield this.messageHandlers[t.type](t.sourceMapId,n,o);this.completeTask(i,null,h)}catch(h){this.completeTask(i,h)}})}completeTask(i,t,n){const o=[];delete this.abortControllers[i];const h={id:i,type:"<response>",sourceMapId:this.mapId,origin:location.origin,error:t?$s(t):null,data:$s(n,o)};this.target.postMessage(h,{transfer:o})}remove(){this.invoker.remove(),this.subscription.unsubscribe()}},x.G=bs,x.H=function(){var i=new Za(16);return Za!=Float32Array&&(i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=0,i[12]=0,i[13]=0,i[14]=0),i[0]=1,i[5]=1,i[10]=1,i[15]=1,i},x.I=_d,x.J=function(i,t,n){var o,h,g,_,v,w,T,E,M,z,R,N,U=n[0],G=n[1],J=n[2];return t===i?(i[12]=t[0]*U+t[4]*G+t[8]*J+t[12],i[13]=t[1]*U+t[5]*G+t[9]*J+t[13],i[14]=t[2]*U+t[6]*G+t[10]*J+t[14],i[15]=t[3]*U+t[7]*G+t[11]*J+t[15]):(h=t[1],g=t[2],_=t[3],v=t[4],w=t[5],T=t[6],E=t[7],M=t[8],z=t[9],R=t[10],N=t[11],i[0]=o=t[0],i[1]=h,i[2]=g,i[3]=_,i[4]=v,i[5]=w,i[6]=T,i[7]=E,i[8]=M,i[9]=z,i[10]=R,i[11]=N,i[12]=o*U+v*G+M*J+t[12],i[13]=h*U+w*G+z*J+t[13],i[14]=g*U+T*G+R*J+t[14],i[15]=_*U+E*G+N*J+t[15]),i},x.K=function(i,t,n){var o=n[0],h=n[1],g=n[2];return i[0]=t[0]*o,i[1]=t[1]*o,i[2]=t[2]*o,i[3]=t[3]*o,i[4]=t[4]*h,i[5]=t[5]*h,i[6]=t[6]*h,i[7]=t[7]*h,i[8]=t[8]*g,i[9]=t[9]*g,i[10]=t[10]*g,i[11]=t[11]*g,i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},x.L=Lp,x.M=function(i,t){const n={};for(let o=0;o<t.length;o++){const h=t[o];h in i&&(n[h]=i[h])}return n},x.N=to,x.O=Mm,x.P=q,x.Q=km,x.R=Zn,x.S=Gn,x.T=Fa,x.U=Ce,x.V=je,x.W=Fn,x.X=wi,x.Y=b,x.Z=Sc,x._=u,x.a=Mr,x.a$=function(i,t){var n=i[0],o=i[1],h=i[2],g=i[3],_=i[4],v=i[5],w=i[6],T=i[7],E=i[8],M=i[9],z=i[10],R=i[11],N=i[12],U=i[13],G=i[14],J=i[15],de=t[0],re=t[1],ue=t[2],_e=t[3],Se=t[4],Oe=t[5],nt=t[6],Re=t[7],De=t[8],Ke=t[9],He=t[10],Ue=t[11],xe=t[12],Je=t[13],Xe=t[14],lt=t[15];return Math.abs(n-de)<=ln*Math.max(1,Math.abs(n),Math.abs(de))&&Math.abs(o-re)<=ln*Math.max(1,Math.abs(o),Math.abs(re))&&Math.abs(h-ue)<=ln*Math.max(1,Math.abs(h),Math.abs(ue))&&Math.abs(g-_e)<=ln*Math.max(1,Math.abs(g),Math.abs(_e))&&Math.abs(_-Se)<=ln*Math.max(1,Math.abs(_),Math.abs(Se))&&Math.abs(v-Oe)<=ln*Math.max(1,Math.abs(v),Math.abs(Oe))&&Math.abs(w-nt)<=ln*Math.max(1,Math.abs(w),Math.abs(nt))&&Math.abs(T-Re)<=ln*Math.max(1,Math.abs(T),Math.abs(Re))&&Math.abs(E-De)<=ln*Math.max(1,Math.abs(E),Math.abs(De))&&Math.abs(M-Ke)<=ln*Math.max(1,Math.abs(M),Math.abs(Ke))&&Math.abs(z-He)<=ln*Math.max(1,Math.abs(z),Math.abs(He))&&Math.abs(R-Ue)<=ln*Math.max(1,Math.abs(R),Math.abs(Ue))&&Math.abs(N-xe)<=ln*Math.max(1,Math.abs(N),Math.abs(xe))&&Math.abs(U-Je)<=ln*Math.max(1,Math.abs(U),Math.abs(Je))&&Math.abs(G-Xe)<=ln*Math.max(1,Math.abs(G),Math.abs(Xe))&&Math.abs(J-lt)<=ln*Math.max(1,Math.abs(J),Math.abs(lt))},x.a0=Ct,x.a1=Ed,x.a2=Ee,x.a3=i=>{const t=window.document.createElement("video");return t.muted=!0,new Promise(n=>{t.onloadstart=()=>{n(t)};for(const o of i){const h=window.document.createElement("source");Zr(o)||(t.crossOrigin="Anonymous"),h.src=o,t.appendChild(h)}})},x.a4=function(){return It++},x.a5=Fe,x.a6=Qa,x.a7=ql,x.a8=Go,x.a9=Bm,x.aA=function(i){if(i.type==="custom")return new Jy(i);switch(i.type){case"background":return new Xy(i);case"circle":return new B_(i);case"fill":return new Q_(i);case"fill-extrusion":return new my(i);case"heatmap":return new O_(i);case"hillshade":return new V_(i);case"line":return new wy(i);case"raster":return new Ky(i);case"symbol":return new Xu(i)}},x.aB=tt,x.aC=function(i,t){if(!i)return[{command:"setStyle",args:[t]}];let n=[];try{if(!At(i.version,t.version))return[{command:"setStyle",args:[t]}];At(i.center,t.center)||n.push({command:"setCenter",args:[t.center]}),At(i.zoom,t.zoom)||n.push({command:"setZoom",args:[t.zoom]}),At(i.bearing,t.bearing)||n.push({command:"setBearing",args:[t.bearing]}),At(i.pitch,t.pitch)||n.push({command:"setPitch",args:[t.pitch]}),At(i.sprite,t.sprite)||n.push({command:"setSprite",args:[t.sprite]}),At(i.glyphs,t.glyphs)||n.push({command:"setGlyphs",args:[t.glyphs]}),At(i.transition,t.transition)||n.push({command:"setTransition",args:[t.transition]}),At(i.light,t.light)||n.push({command:"setLight",args:[t.light]}),At(i.terrain,t.terrain)||n.push({command:"setTerrain",args:[t.terrain]}),At(i.sky,t.sky)||n.push({command:"setSky",args:[t.sky]}),At(i.projection,t.projection)||n.push({command:"setProjection",args:[t.projection]});const o={},h=[];(function(_,v,w,T){let E;for(E in v=v||{},_=_||{})Object.prototype.hasOwnProperty.call(_,E)&&(Object.prototype.hasOwnProperty.call(v,E)||zr(E,w,T));for(E in v)Object.prototype.hasOwnProperty.call(v,E)&&(Object.prototype.hasOwnProperty.call(_,E)?At(_[E],v[E])||(_[E].type==="geojson"&&v[E].type==="geojson"&&Cs(_,v,E)?ci(w,{command:"setGeoJSONSourceData",args:[E,v[E].data]}):xr(E,v,w,T)):Co(E,v,w))})(i.sources,t.sources,h,o);const g=[];i.layers&&i.layers.forEach(_=>{"source"in _&&o[_.source]?n.push({command:"removeLayer",args:[_.id]}):g.push(_)}),n=n.concat(h),function(_,v,w){v=v||[];const T=(_=_||[]).map(So),E=v.map(So),M=_.reduce(Io,{}),z=v.reduce(Io,{}),R=T.slice(),N=Object.create(null);let U,G,J,de,re;for(let ue=0,_e=0;ue<T.length;ue++)U=T[ue],Object.prototype.hasOwnProperty.call(z,U)?_e++:(ci(w,{command:"removeLayer",args:[U]}),R.splice(R.indexOf(U,_e),1));for(let ue=0,_e=0;ue<E.length;ue++)U=E[E.length-1-ue],R[R.length-1-ue]!==U&&(Object.prototype.hasOwnProperty.call(M,U)?(ci(w,{command:"removeLayer",args:[U]}),R.splice(R.lastIndexOf(U,R.length-_e),1)):_e++,de=R[R.length-ue],ci(w,{command:"addLayer",args:[z[U],de]}),R.splice(R.length-ue,0,U),N[U]=!0);for(let ue=0;ue<E.length;ue++)if(U=E[ue],G=M[U],J=z[U],!N[U]&&!At(G,J))if(At(G.source,J.source)&&At(G["source-layer"],J["source-layer"])&&At(G.type,J.type)){for(re in In(G.layout,J.layout,w,U,null,"setLayoutProperty"),In(G.paint,J.paint,w,U,null,"setPaintProperty"),At(G.filter,J.filter)||ci(w,{command:"setFilter",args:[U,J.filter]}),At(G.minzoom,J.minzoom)&&At(G.maxzoom,J.maxzoom)||ci(w,{command:"setLayerZoomRange",args:[U,J.minzoom,J.maxzoom]}),G)Object.prototype.hasOwnProperty.call(G,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?In(G[re],J[re],w,U,re.slice(6),"setPaintProperty"):At(G[re],J[re])||ci(w,{command:"setLayerProperty",args:[U,re,J[re]]}));for(re in J)Object.prototype.hasOwnProperty.call(J,re)&&!Object.prototype.hasOwnProperty.call(G,re)&&re!=="layout"&&re!=="paint"&&re!=="filter"&&re!=="metadata"&&re!=="minzoom"&&re!=="maxzoom"&&(re.indexOf("paint.")===0?In(G[re],J[re],w,U,re.slice(6),"setPaintProperty"):At(G[re],J[re])||ci(w,{command:"setLayerProperty",args:[U,re,J[re]]}))}else ci(w,{command:"removeLayer",args:[U]}),de=R[R.lastIndexOf(U)+1],ci(w,{command:"addLayer",args:[J,de]})}(g,t.layers,n)}catch(o){console.warn("Unable to compute style diff:",o),n=[{command:"setStyle",args:[t]}]}return n},x.aD=function(i){const t=[],n=i.id;return n===void 0&&t.push({message:`layers.${n}: missing required property "id"`}),i.render===void 0&&t.push({message:`layers.${n}: missing required method "render"`}),i.renderingMode&&i.renderingMode!=="2d"&&i.renderingMode!=="3d"&&t.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),t},x.aE=function i(t,n){if(Array.isArray(t)){if(!Array.isArray(n)||t.length!==n.length)return!1;for(let o=0;o<t.length;o++)if(!i(t[o],n[o]))return!1;return!0}if(typeof t=="object"&&t!==null&&n!==null){if(typeof n!="object"||Object.keys(t).length!==Object.keys(n).length)return!1;for(const o in t)if(!i(t[o],n[o]))return!1;return!0}return t===n},x.aF=Ve,x.aG=pi,x.aH=class extends Ho{constructor(i,t){super(i,t),this.current=0}set(i){this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}},x.aI=Bu,x.aJ=class extends Ho{constructor(i,t){super(i,t),this.current=P_}set(i){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let t=1;t<16;t++)if(i[t]!==this.current[t]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}},x.aK=Cp,x.aL=Sp,x.aM=Ft,x.aN=class extends Ho{constructor(i,t){super(i,t),this.current=[0,0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2]))}},x.aO=class extends Ho{constructor(i,t){super(i,t),this.current=[0,0]}set(i){i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1]))}},x.aP=function(i,t,n,o,h,g,_){var v=1/(t-n),w=1/(o-h),T=1/(g-_);return i[0]=-2*v,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=-2*w,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=2*T,i[11]=0,i[12]=(t+n)*v,i[13]=(h+o)*w,i[14]=(_+g)*T,i[15]=1,i},x.aQ=R_,x.aR=class extends ae{},x.aS=Ty,x.aT=class extends me{},x.aU=sd,x.aV=function(i){return i<=1?1:Math.pow(2,Math.ceil(Math.log(i)/Math.LN2))},x.aW=Np,x.aX=ji,x.aY=Wn,x.aZ=class extends Ge{},x.a_=function(i,t){return i[0]===t[0]&&i[1]===t[1]&&i[2]===t[2]&&i[3]===t[3]&&i[4]===t[4]&&i[5]===t[5]&&i[6]===t[6]&&i[7]===t[7]&&i[8]===t[8]&&i[9]===t[9]&&i[10]===t[10]&&i[11]===t[11]&&i[12]===t[12]&&i[13]===t[13]&&i[14]===t[14]&&i[15]===t[15]},x.aa=function(i){const t={};if(i.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,o,h,g)=>{const _=h||g;return t[o]=!_||_.toLowerCase(),""}),t["max-age"]){const n=parseInt(t["max-age"],10);isNaN(n)?delete t["max-age"]:t["max-age"]=n}return t},x.ab=function(i,t){const n=[];for(const o in i)o in t||n.push(o);return n},x.ac=qe,x.ad=function(i,t,n){var o=Math.sin(n),h=Math.cos(n),g=t[0],_=t[1],v=t[2],w=t[3],T=t[4],E=t[5],M=t[6],z=t[7];return t!==i&&(i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[0]=g*h+T*o,i[1]=_*h+E*o,i[2]=v*h+M*o,i[3]=w*h+z*o,i[4]=T*h-g*o,i[5]=E*h-_*o,i[6]=M*h-v*o,i[7]=z*h-w*o,i},x.ae=function(i){var t=new Za(16);return t[0]=i[0],t[1]=i[1],t[2]=i[2],t[3]=i[3],t[4]=i[4],t[5]=i[5],t[6]=i[6],t[7]=i[7],t[8]=i[8],t[9]=i[9],t[10]=i[10],t[11]=i[11],t[12]=i[12],t[13]=i[13],t[14]=i[14],t[15]=i[15],t},x.af=Vu,x.ag=function(i,t){let n=0,o=0;if(i.kind==="constant")o=i.layoutSize;else if(i.kind!=="source"){const{interpolationType:h,minZoom:g,maxZoom:_}=i,v=h?qe(on.interpolationFactor(h,t,g,_),0,1):0;i.kind==="camera"?o=sn.number(i.minSize,i.maxSize,v):n=v}return{uSizeT:n,uSize:o}},x.ai=function(i,{uSize:t,uSizeT:n},{lowerSize:o,upperSize:h}){return i.kind==="source"?o/Nr:i.kind==="composite"?sn.number(o/Nr,h/Nr,n):t},x.aj=bd,x.ak=function(i,t,n,o){const h=t.y-i.y,g=t.x-i.x,_=o.y-n.y,v=o.x-n.x,w=_*g-v*h;if(w===0)return null;const T=(v*(i.y-n.y)-_*(i.x-n.x))/w;return new q(i.x+T*g,i.y+T*h)},x.al=Vm,x.am=Pp,x.an=id,x.ao=function(i){let t=1/0,n=1/0,o=-1/0,h=-1/0;for(const g of i)t=Math.min(t,g.x),n=Math.min(n,g.y),o=Math.max(o,g.x),h=Math.max(h,g.y);return[t,n,o,h]},x.ap=Ii,x.ar=xd,x.as=function(i,t){var n=t[0],o=t[1],h=t[2],g=t[3],_=t[4],v=t[5],w=t[6],T=t[7],E=t[8],M=t[9],z=t[10],R=t[11],N=t[12],U=t[13],G=t[14],J=t[15],de=n*v-o*_,re=n*w-h*_,ue=n*T-g*_,_e=o*w-h*v,Se=o*T-g*v,Oe=h*T-g*w,nt=E*U-M*N,Re=E*G-z*N,De=E*J-R*N,Ke=M*G-z*U,He=M*J-R*U,Ue=z*J-R*G,xe=de*Ue-re*He+ue*Ke+_e*De-Se*Re+Oe*nt;return xe?(i[0]=(v*Ue-w*He+T*Ke)*(xe=1/xe),i[1]=(h*He-o*Ue-g*Ke)*xe,i[2]=(U*Oe-G*Se+J*_e)*xe,i[3]=(z*Se-M*Oe-R*_e)*xe,i[4]=(w*De-_*Ue-T*Re)*xe,i[5]=(n*Ue-h*De+g*Re)*xe,i[6]=(G*ue-N*Oe-J*re)*xe,i[7]=(E*Oe-z*ue+R*re)*xe,i[8]=(_*He-v*De+T*nt)*xe,i[9]=(o*De-n*He-g*nt)*xe,i[10]=(N*Se-U*ue+J*de)*xe,i[11]=(M*ue-E*Se-R*de)*xe,i[12]=(v*Re-_*Ke-w*nt)*xe,i[13]=(n*Ke-o*Re+h*nt)*xe,i[14]=(U*re-N*_e-G*de)*xe,i[15]=(E*_e-M*re+z*de)*xe,i):null},x.at=Md,x.au=vd,x.av=kd,x.aw=function(){const i={},t=ge.$version;for(const n in ge.$root){const o=ge.$root[n];if(o.required){let h=null;h=n==="version"?t:o.type==="array"?[]:{},h!=null&&(i[n]=h)}}return i},x.ax=rc,x.ay=On,x.az=function(i){i=i.slice();const t=Object.create(null);for(let n=0;n<i.length;n++)t[i[n].id]=i[n];for(let n=0;n<i.length;n++)"ref"in i[n]&&(i[n]=wo(i[n],t[i[n].ref]));return i},x.b=li,x.b0=function(i,t){return i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[4]=t[4],i[5]=t[5],i[6]=t[6],i[7]=t[7],i[8]=t[8],i[9]=t[9],i[10]=t[10],i[11]=t[11],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15],i},x.b1=function(i,t,n){return i[0]=t[0]*n[0],i[1]=t[1]*n[1],i[2]=t[2]*n[2],i[3]=t[3]*n[3],i},x.b2=function(i,t){return i[0]*t[0]+i[1]*t[1]+i[2]*t[2]+i[3]*t[3]},x.b3=ct,x.b4=Dm,x.b5=Am,x.b6=function(i,t,n,o,h){var g,_=1/Math.tan(t/2);return i[0]=_/n,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=_,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[11]=-1,i[12]=0,i[13]=0,i[15]=0,h!=null&&h!==1/0?(i[10]=(h+o)*(g=1/(o-h)),i[14]=2*h*o*g):(i[10]=-1,i[14]=-2*o),i},x.b7=function(i,t,n){var o=Math.sin(n),h=Math.cos(n),g=t[4],_=t[5],v=t[6],w=t[7],T=t[8],E=t[9],M=t[10],z=t[11];return t!==i&&(i[0]=t[0],i[1]=t[1],i[2]=t[2],i[3]=t[3],i[12]=t[12],i[13]=t[13],i[14]=t[14],i[15]=t[15]),i[4]=g*h+T*o,i[5]=_*h+E*o,i[6]=v*h+M*o,i[7]=w*h+z*o,i[8]=T*h-g*o,i[9]=E*h-_*o,i[10]=M*h-v*o,i[11]=z*h-w*o,i},x.b8=st,x.b9=Qe,x.bA=sm,x.bB=function(i){return i.message===Yi},x.bC=Rs,x.bD=xn,x.ba=function(i){return i*Math.PI/180},x.bb=function(i,t){const{x:n,y:o}=Sc.fromLngLat(t);return!(i<0||i>25||o<0||o>=1||n<0||n>=1)},x.bc=function(i,t){return i[0]=t[0],i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=t[1],i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=t[2],i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},x.bd=class extends P{},x.be=Id,x.bf=l0,x.bh=fn,x.bi=function(i,t){Mr.REGISTERED_PROTOCOLS[i]=t},x.bj=function(i){delete Mr.REGISTERED_PROTOCOLS[i]},x.bk=function(i,t){const n={};for(let h=0;h<i.length;h++){const g=t&&t[i[h].id]||Su(i[h]);t&&(t[i[h].id]=g);let _=n[g];_||(_=n[g]=[]),_.push(i[h])}const o=[];for(const h in n)o.push(n[h]);return o},x.bl=$e,x.bm=Rm,x.bn=Fm,x.bo=mm,x.bp=function(i){i.bucket.createArrays(),i.bucket.tilePixelRatio=wi/(512*i.bucket.overscaling),i.bucket.compareText={},i.bucket.iconsNeedLinear=!1;const t=i.bucket.layers[0],n=t.layout,o=t._unevaluatedLayout._values,h={layoutIconSize:o["icon-size"].possiblyEvaluate(new ei(i.bucket.zoom+1),i.canonical),layoutTextSize:o["text-size"].possiblyEvaluate(new ei(i.bucket.zoom+1),i.canonical),textMaxSize:o["text-size"].possiblyEvaluate(new ei(18))};if(i.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=i.bucket.textSizeData;h.compositeTextSizes=[o["text-size"].possiblyEvaluate(new ei(T),i.canonical),o["text-size"].possiblyEvaluate(new ei(E),i.canonical)]}if(i.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:E}=i.bucket.iconSizeData;h.compositeIconSizes=[o["icon-size"].possiblyEvaluate(new ei(T),i.canonical),o["icon-size"].possiblyEvaluate(new ei(E),i.canonical)]}const g=n.get("text-line-height")*Ii,_=n.get("text-rotation-alignment")!=="viewport"&&n.get("symbol-placement")!=="point",v=n.get("text-keep-upright"),w=n.get("text-size");for(const T of i.bucket.features){const E=n.get("text-font").evaluate(T,{},i.canonical).join(","),M=w.evaluate(T,{},i.canonical),z=h.layoutTextSize.evaluate(T,{},i.canonical),R=h.layoutIconSize.evaluate(T,{},i.canonical),N={horizontal:{},vertical:void 0},U=T.text;let G,J=[0,0];if(U){const ue=U.toString(),_e=n.get("text-letter-spacing").evaluate(T,{},i.canonical)*Ii,Se=Hh(ue)?_e:0,Oe=n.get("text-anchor").evaluate(T,{},i.canonical),nt=Xm(t,T,i.canonical);if(!nt){const He=n.get("text-radial-offset").evaluate(T,{},i.canonical);J=He?Gm(Oe,[He*Ii,Pd]):n.get("text-offset").evaluate(T,{},i.canonical).map(Ue=>Ue*Ii)}let Re=_?"center":n.get("text-justify").evaluate(T,{},i.canonical);const De=n.get("symbol-placement")==="point"?n.get("text-max-width").evaluate(T,{},i.canonical)*Ii:1/0,Ke=()=>{i.bucket.allowVerticalPlacement&&sc(ue)&&(N.vertical=Wu(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,De,g,Oe,"left",Se,J,x.ah.vertical,!0,z,M))};if(!_&&nt){const He=new Set;if(Re==="auto")for(let xe=0;xe<nt.values.length;xe+=2)He.add(Md(nt.values[xe]));else He.add(Re);let Ue=!1;for(const xe of He)if(!N.horizontal[xe])if(Ue)N.horizontal[xe]=N.horizontal[0];else{const Je=Wu(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,De,g,"center",xe,Se,J,x.ah.horizontal,!1,z,M);Je&&(N.horizontal[xe]=Je,Ue=Je.positionedLines.length===1)}Ke()}else{Re==="auto"&&(Re=Md(Oe));const He=Wu(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,De,g,Oe,Re,Se,J,x.ah.horizontal,!1,z,M);He&&(N.horizontal[Re]=He),Ke(),sc(ue)&&_&&v&&(N.vertical=Wu(U,i.glyphMap,i.glyphPositions,i.imagePositions,E,De,g,Oe,Re,Se,J,x.ah.vertical,!1,z,M))}}let de=!1;if(T.icon&&T.icon.name){const ue=i.imageMap[T.icon.name];ue&&(G=qy(i.imagePositions[T.icon.name],n.get("icon-offset").evaluate(T,{},i.canonical),n.get("icon-anchor").evaluate(T,{},i.canonical)),de=!!ue.sdf,i.bucket.sdfIcons===void 0?i.bucket.sdfIcons=de:i.bucket.sdfIcons!==de&&St("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ue.pixelRatio!==i.bucket.pixelRatio||n.get("icon-rotate").constantOr(1)!==0)&&(i.bucket.iconsNeedLinear=!0))}const re=Km(N.horizontal)||N.vertical;i.bucket.iconsInText=!!re&&re.iconsInText,(re||G)&&o0(i.bucket,T,N,G,i.imageMap,h,z,R,J,de,i.canonical)}i.showCollisionBoxes&&i.bucket.generateCollisionDebugBuffers()},x.bq=pd,x.br=ud,x.bs=dd,x.bt=Js,x.bu=fd,x.bv=class{constructor(i){this._marks={start:[i.url,"start"].join("#"),end:[i.url,"end"].join("#"),measure:i.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let i=performance.getEntriesByName(this._marks.measure);return i.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),i=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),i}},x.bw=function(i,t,n,o,h){return u(this,void 0,void 0,function*(){if(je())try{return yield Fn(i,t,n,o,h)}catch{}return function(g,_,v,w,T){const E=g.width,M=g.height;mn&&Vi||(mn=new OffscreenCanvas(E,M),Vi=mn.getContext("2d",{willReadFrequently:!0})),mn.width=E,mn.height=M,Vi.drawImage(g,0,0,E,M);const z=Vi.getImageData(_,v,w,T);return Vi.clearRect(0,0,E,M),z.data}(i,t,n,o,h)})},x.bx=Lm,x.by=O,x.bz=V,x.c=xs,x.d=i=>u(void 0,void 0,void 0,function*(){if(i.byteLength===0)return createImageBitmap(new ImageData(1,1));const t=new Blob([new Uint8Array(i)],{type:"image/png"});try{return createImageBitmap(t)}catch(n){throw new Error(`Could not load image because of ${n.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`)}}),x.e=We,x.f=i=>new Promise((t,n)=>{const o=new Image;o.onload=()=>{t(o),URL.revokeObjectURL(o.src),o.onload=null,window.requestAnimationFrame(()=>{o.src=yr})},o.onerror=()=>n(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const h=new Blob([new Uint8Array(i)],{type:"image/png"});o.src=i.byteLength?URL.createObjectURL(h):yr}),x.g=sr,x.h=(i,t)=>Wr(We(i,{type:"json"}),t),x.i=Ri,x.j=Ar,x.k=kr,x.l=(i,t)=>Wr(We(i,{type:"arrayBuffer"}),t),x.m=Wr,x.n=function(i){return new fd(i).readFields(Fy,[])},x.o=mc,x.p=pm,x.q=f,x.r=jh,x.s=Zr,x.t=ic,x.u=os,x.v=ge,x.w=St,x.x=function([i,t,n]){return t+=90,t*=Math.PI/180,n*=Math.PI/180,{x:i*Math.cos(t)*Math.sin(n),y:i*Math.sin(t)*Math.sin(n),z:i*Math.cos(n)}},x.y=sn,x.z=ei}),y("worker",["./shared"],function(x){class u{constructor(L){this.keyCache={},L&&this.replace(L)}replace(L){this._layerConfigs={},this._layers={},this.update(L,[])}update(L,D){for(const X of L){this._layerConfigs[X.id]=X;const se=this._layers[X.id]=x.aA(X);se._featureFilter=x.a7(se.filter),this.keyCache[X.id]&&delete this.keyCache[X.id]}for(const X of D)delete this.keyCache[X],delete this._layerConfigs[X],delete this._layers[X];this.familiesBySource={};const j=x.bk(Object.values(this._layerConfigs),this.keyCache);for(const X of j){const se=X.map(fe=>this._layers[fe.id]),le=se[0];if(le.visibility==="none")continue;const he=le.source||"";let te=this.familiesBySource[he];te||(te=this.familiesBySource[he]={});const ye=le.sourceLayer||"_geojsonTileLayer";let we=te[ye];we||(we=te[ye]=[]),we.push(se)}}}class O{constructor(L){const D={},j=[];for(const he in L){const te=L[he],ye=D[he]={};for(const we in te){const fe=te[+we];if(!fe||fe.bitmap.width===0||fe.bitmap.height===0)continue;const Pe={x:0,y:0,w:fe.bitmap.width+2,h:fe.bitmap.height+2};j.push(Pe),ye[we]={rect:Pe,metrics:fe.metrics}}}const{w:X,h:se}=x.p(j),le=new x.o({width:X||1,height:se||1});for(const he in L){const te=L[he];for(const ye in te){const we=te[+ye];if(!we||we.bitmap.width===0||we.bitmap.height===0)continue;const fe=D[he][ye].rect;x.o.copy(we.bitmap,le,{x:0,y:0},{x:fe.x+1,y:fe.y+1},we.bitmap)}}this.image=le,this.positions=D}}x.bl("GlyphAtlas",O);class V{constructor(L){this.tileID=new x.S(L.tileID.overscaledZ,L.tileID.wrap,L.tileID.canonical.z,L.tileID.canonical.x,L.tileID.canonical.y),this.uid=L.uid,this.zoom=L.zoom,this.pixelRatio=L.pixelRatio,this.tileSize=L.tileSize,this.source=L.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=L.showCollisionBoxes,this.collectResourceTiming=!!L.collectResourceTiming,this.returnDependencies=!!L.returnDependencies,this.promoteId=L.promoteId,this.inFlightDependencies=[]}parse(L,D,j,X){return x._(this,void 0,void 0,function*(){this.status="parsing",this.data=L,this.collisionBoxArray=new x.a5;const se=new x.bm(Object.keys(L.layers).sort()),le=new x.bn(this.tileID,this.promoteId);le.bucketLayerIDs=[];const he={},te={featureIndex:le,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:j},ye=D.familiesBySource[this.source];for(const gt in ye){const Bt=L.layers[gt];if(!Bt)continue;Bt.version===1&&x.w(`Vector tile source "${this.source}" layer "${gt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const ai=se.encode(gt),ki=[];for(let Bi=0;Bi<Bt.length;Bi++){const Ji=Bt.feature(Bi),Ss=le.getId(Ji,gt);ki.push({feature:Ji,id:Ss,index:Bi,sourceLayerIndex:ai})}for(const Bi of ye[gt]){const Ji=Bi[0];Ji.source!==this.source&&x.w(`layer.source = ${Ji.source} does not equal this.source = ${this.source}`),Ji.minzoom&&this.zoom<Math.floor(Ji.minzoom)||Ji.maxzoom&&this.zoom>=Ji.maxzoom||Ji.visibility!=="none"&&(W(Bi,this.zoom,j),(he[Ji.id]=Ji.createBucket({index:le.bucketLayerIDs.length,layers:Bi,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:ai,sourceID:this.source})).populate(ki,te,this.tileID.canonical),le.bucketLayerIDs.push(Bi.map(Ss=>Ss.id)))}}const we=x.aF(te.glyphDependencies,gt=>Object.keys(gt).map(Number));this.inFlightDependencies.forEach(gt=>gt?.abort()),this.inFlightDependencies=[];let fe=Promise.resolve({});if(Object.keys(we).length){const gt=new AbortController;this.inFlightDependencies.push(gt),fe=X.sendAsync({type:"GG",data:{stacks:we,source:this.source,tileID:this.tileID,type:"glyphs"}},gt)}const Pe=Object.keys(te.iconDependencies);let et=Promise.resolve({});if(Pe.length){const gt=new AbortController;this.inFlightDependencies.push(gt),et=X.sendAsync({type:"GI",data:{icons:Pe,source:this.source,tileID:this.tileID,type:"icons"}},gt)}const it=Object.keys(te.patternDependencies);let Et=Promise.resolve({});if(it.length){const gt=new AbortController;this.inFlightDependencies.push(gt),Et=X.sendAsync({type:"GI",data:{icons:it,source:this.source,tileID:this.tileID,type:"patterns"}},gt)}const[dt,Pt,vt]=yield Promise.all([fe,et,Et]),xi=new O(dt),ui=new x.bo(Pt,vt);for(const gt in he){const Bt=he[gt];Bt instanceof x.a6?(W(Bt.layers,this.zoom,j),x.bp({bucket:Bt,glyphMap:dt,glyphPositions:xi.positions,imageMap:Pt,imagePositions:ui.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Bt.hasPattern&&(Bt instanceof x.bq||Bt instanceof x.br||Bt instanceof x.bs)&&(W(Bt.layers,this.zoom,j),Bt.addFeatures(te,this.tileID.canonical,ui.patternPositions))}return this.status="done",{buckets:Object.values(he).filter(gt=>!gt.isEmpty()),featureIndex:le,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:xi.image,imageAtlas:ui,glyphMap:this.returnDependencies?dt:null,iconMap:this.returnDependencies?Pt:null,glyphPositions:this.returnDependencies?xi.positions:null}})}}function W(K,L,D){const j=new x.z(L);for(const X of K)X.recalculate(j,D)}class q{constructor(L,D,j){this.actor=L,this.layerIndex=D,this.availableImages=j,this.fetching={},this.loading={},this.loaded={}}loadVectorTile(L,D){return x._(this,void 0,void 0,function*(){const j=yield x.l(L.request,D);try{return{vectorTile:new x.bt.VectorTile(new x.bu(j.data)),rawData:j.data,cacheControl:j.cacheControl,expires:j.expires}}catch(X){const se=new Uint8Array(j.data);let le=`Unable to parse the tile at ${L.request.url}, `;throw le+=se[0]===31&&se[1]===139?"please make sure the data is not gzipped and that you have configured the relevant header in the server":`got error: ${X.message}`,new Error(le)}})}loadTile(L){return x._(this,void 0,void 0,function*(){const D=L.uid,j=!!(L&&L.request&&L.request.collectResourceTiming)&&new x.bv(L.request),X=new V(L);this.loading[D]=X;const se=new AbortController;X.abort=se;try{const le=yield this.loadVectorTile(L,se);if(delete this.loading[D],!le)return null;const he=le.rawData,te={};le.expires&&(te.expires=le.expires),le.cacheControl&&(te.cacheControl=le.cacheControl);const ye={};if(j){const fe=j.finish();fe&&(ye.resourceTiming=JSON.parse(JSON.stringify(fe)))}X.vectorTile=le.vectorTile;const we=X.parse(le.vectorTile,this.layerIndex,this.availableImages,this.actor);this.loaded[D]=X,this.fetching[D]={rawTileData:he,cacheControl:te,resourceTiming:ye};try{const fe=yield we;return x.e({rawTileData:he.slice(0)},fe,te,ye)}finally{delete this.fetching[D]}}catch(le){throw delete this.loading[D],X.status="done",this.loaded[D]=X,le}})}reloadTile(L){return x._(this,void 0,void 0,function*(){const D=L.uid;if(!this.loaded||!this.loaded[D])throw new Error("Should not be trying to reload a tile that was never loaded or has been removed");const j=this.loaded[D];if(j.showCollisionBoxes=L.showCollisionBoxes,j.status==="parsing"){const X=yield j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor);let se;if(this.fetching[D]){const{rawTileData:le,cacheControl:he,resourceTiming:te}=this.fetching[D];delete this.fetching[D],se=x.e({rawTileData:le.slice(0)},X,he,te)}else se=X;return se}if(j.status==="done"&&j.vectorTile)return j.parse(j.vectorTile,this.layerIndex,this.availableImages,this.actor)})}abortTile(L){return x._(this,void 0,void 0,function*(){const D=this.loading,j=L.uid;D&&D[j]&&D[j].abort&&(D[j].abort.abort(),delete D[j])})}removeTile(L){return x._(this,void 0,void 0,function*(){this.loaded&&this.loaded[L.uid]&&delete this.loaded[L.uid]})}}class F{constructor(){this.loaded={}}loadTile(L){return x._(this,void 0,void 0,function*(){const{uid:D,encoding:j,rawImageData:X,redFactor:se,greenFactor:le,blueFactor:he,baseShift:te}=L,ye=X.width+2,we=X.height+2,fe=x.b(X)?new x.R({width:ye,height:we},yield x.bw(X,-1,-1,ye,we)):X,Pe=new x.bx(D,fe,j,se,le,he,te);return this.loaded=this.loaded||{},this.loaded[D]=Pe,Pe})}removeTile(L){const D=this.loaded,j=L.uid;D&&D[j]&&delete D[j]}}function oe(K,L){if(K.length!==0){ie(K[0],L);for(var D=1;D<K.length;D++)ie(K[D],!L)}}function ie(K,L){for(var D=0,j=0,X=0,se=K.length,le=se-1;X<se;le=X++){var he=(K[X][0]-K[le][0])*(K[le][1]+K[X][1]),te=D+he;j+=Math.abs(D)>=Math.abs(he)?D-te+he:he-te+D,D=te}D+j>=0!=!!L&&K.reverse()}var pe=x.by(function K(L,D){var j,X=L&&L.type;if(X==="FeatureCollection")for(j=0;j<L.features.length;j++)K(L.features[j],D);else if(X==="GeometryCollection")for(j=0;j<L.geometries.length;j++)K(L.geometries[j],D);else if(X==="Feature")K(L.geometry,D);else if(X==="Polygon")oe(L.coordinates,D);else if(X==="MultiPolygon")for(j=0;j<L.coordinates.length;j++)oe(L.coordinates[j],D);return L});const ve=x.bt.VectorTileFeature.prototype.toGeoJSON;var Ce={exports:{}},je=x.bz,st=x.bt.VectorTileFeature,Qe=qe;function qe(K,L){this.options=L||{},this.features=K,this.length=K.length}function ct(K,L){this.id=typeof K.id=="number"?K.id:void 0,this.type=K.type,this.rawGeometry=K.type===1?[K.geometry]:K.geometry,this.properties=K.tags,this.extent=L||4096}qe.prototype.feature=function(K){return new ct(this.features[K],this.options.extent)},ct.prototype.loadGeometry=function(){var K=this.rawGeometry;this.geometry=[];for(var L=0;L<K.length;L++){for(var D=K[L],j=[],X=0;X<D.length;X++)j.push(new je(D[X][0],D[X][1]));this.geometry.push(j)}return this.geometry},ct.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var K=this.geometry,L=1/0,D=-1/0,j=1/0,X=-1/0,se=0;se<K.length;se++)for(var le=K[se],he=0;he<le.length;he++){var te=le[he];L=Math.min(L,te.x),D=Math.max(D,te.x),j=Math.min(j,te.y),X=Math.max(X,te.y)}return[L,j,D,X]},ct.prototype.toGeoJSON=st.prototype.toGeoJSON;var We=x.bA,It=Qe;function Ve(K){var L=new We;return function(D,j){for(var X in D.layers)j.writeMessage(3,pi,D.layers[X])}(K,L),L.finish()}function pi(K,L){var D;L.writeVarintField(15,K.version||1),L.writeStringField(1,K.name||""),L.writeVarintField(5,K.extent||4096);var j={keys:[],values:[],keycache:{},valuecache:{}};for(D=0;D<K.length;D++)j.feature=K.feature(D),L.writeMessage(2,tt,j);var X=j.keys;for(D=0;D<X.length;D++)L.writeStringField(3,X[D]);var se=j.values;for(D=0;D<se.length;D++)L.writeMessage(4,rr,se[D])}function tt(K,L){var D=K.feature;D.id!==void 0&&L.writeVarintField(1,D.id),L.writeMessage(2,oi,K),L.writeVarintField(3,D.type),L.writeMessage(4,Ri,D)}function oi(K,L){var D=K.feature,j=K.keys,X=K.values,se=K.keycache,le=K.valuecache;for(var he in D.properties){var te=D.properties[he],ye=se[he];if(te!==null){ye===void 0&&(j.push(he),se[he]=ye=j.length-1),L.writeVarint(ye);var we=typeof te;we!=="string"&&we!=="boolean"&&we!=="number"&&(te=JSON.stringify(te));var fe=we+":"+te,Pe=le[fe];Pe===void 0&&(X.push(te),le[fe]=Pe=X.length-1),L.writeVarint(Pe)}}}function St(K,L){return(L<<3)+(7&K)}function Zt(K){return K<<1^K>>31}function Ri(K,L){for(var D=K.loadGeometry(),j=K.type,X=0,se=0,le=D.length,he=0;he<le;he++){var te=D[he],ye=1;j===1&&(ye=te.length),L.writeVarint(St(1,ye));for(var we=j===3?te.length-1:te.length,fe=0;fe<we;fe++){fe===1&&j!==1&&L.writeVarint(St(2,we-1));var Pe=te[fe].x-X,et=te[fe].y-se;L.writeVarint(Zt(Pe)),L.writeVarint(Zt(et)),X+=Pe,se+=et}j===3&&L.writeVarint(St(7,1))}}function rr(K,L){var D=typeof K;D==="string"?L.writeStringField(1,K):D==="boolean"?L.writeBooleanField(7,K):D==="number"&&(K%1!=0?L.writeDoubleField(3,K):K<0?L.writeSVarintField(6,K):L.writeVarintField(5,K))}Ce.exports=Ve,Ce.exports.fromVectorTileJs=Ve,Ce.exports.fromGeojsonVt=function(K,L){L=L||{};var D={};for(var j in K)D[j]=new It(K[j].features,L),D[j].name=j,D[j].version=L.version,D[j].extent=L.extent;return Ve({layers:D})},Ce.exports.GeoJSONWrapper=It;var li=x.by(Ce.exports);const yr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:K=>K},Fn=Math.fround||(mn=new Float32Array(1),K=>(mn[0]=+K,mn[0]));var mn;const Vi=3,Yi=5,xs=6;class Mr{constructor(L){this.options=Object.assign(Object.create(yr),L),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(L){const{log:D,minZoom:j,maxZoom:X}=this.options;D&&console.time("total time");const se=`prepare ${L.length} points`;D&&console.time(se),this.points=L;const le=[];for(let te=0;te<L.length;te++){const ye=L[te];if(!ye.geometry)continue;const[we,fe]=ye.geometry.coordinates,Pe=Fn(fn(we)),et=Fn(On(fe));le.push(Pe,et,1/0,te,-1,1),this.options.reduce&&le.push(0)}let he=this.trees[X+1]=this._createTree(le);D&&console.timeEnd(se);for(let te=X;te>=j;te--){const ye=+Date.now();he=this.trees[te]=this._createTree(this._cluster(he,te)),D&&console.log("z%d: %d clusters in %dms",te,he.numItems,+Date.now()-ye)}return D&&console.timeEnd("total time"),this}getClusters(L,D){let j=((L[0]+180)%360+360)%360-180;const X=Math.max(-90,Math.min(90,L[1]));let se=L[2]===180?180:((L[2]+180)%360+360)%360-180;const le=Math.max(-90,Math.min(90,L[3]));if(L[2]-L[0]>=360)j=-180,se=180;else if(j>se){const fe=this.getClusters([j,X,180,le],D),Pe=this.getClusters([-180,X,se,le],D);return fe.concat(Pe)}const he=this.trees[this._limitZoom(D)],te=he.range(fn(j),On(le),fn(se),On(X)),ye=he.data,we=[];for(const fe of te){const Pe=this.stride*fe;we.push(ye[Pe+Yi]>1?sr(ye,Pe,this.clusterProps):this.points[ye[Pe+Vi]])}return we}getChildren(L){const D=this._getOriginId(L),j=this._getOriginZoom(L),X="No cluster with the specified id.",se=this.trees[j];if(!se)throw new Error(X);const le=se.data;if(D*this.stride>=le.length)throw new Error(X);const he=this.options.radius/(this.options.extent*Math.pow(2,j-1)),te=se.within(le[D*this.stride],le[D*this.stride+1],he),ye=[];for(const we of te){const fe=we*this.stride;le[fe+4]===L&&ye.push(le[fe+Yi]>1?sr(le,fe,this.clusterProps):this.points[le[fe+Vi]])}if(ye.length===0)throw new Error(X);return ye}getLeaves(L,D,j){const X=[];return this._appendLeaves(X,L,D=D||10,j=j||0,0),X}getTile(L,D,j){const X=this.trees[this._limitZoom(L)],se=Math.pow(2,L),{extent:le,radius:he}=this.options,te=he/le,ye=(j-te)/se,we=(j+1+te)/se,fe={features:[]};return this._addTileFeatures(X.range((D-te)/se,ye,(D+1+te)/se,we),X.data,D,j,se,fe),D===0&&this._addTileFeatures(X.range(1-te/se,ye,1,we),X.data,se,j,se,fe),D===se-1&&this._addTileFeatures(X.range(0,ye,te/se,we),X.data,-1,j,se,fe),fe.features.length?fe:null}getClusterExpansionZoom(L){let D=this._getOriginZoom(L)-1;for(;D<=this.options.maxZoom;){const j=this.getChildren(L);if(D++,j.length!==1)break;L=j[0].properties.cluster_id}return D}_appendLeaves(L,D,j,X,se){const le=this.getChildren(D);for(const he of le){const te=he.properties;if(te&&te.cluster?se+te.point_count<=X?se+=te.point_count:se=this._appendLeaves(L,te.cluster_id,j,X,se):se<X?se++:L.push(he),L.length===j)break}return se}_createTree(L){const D=new x.av(L.length/this.stride|0,this.options.nodeSize,Float32Array);for(let j=0;j<L.length;j+=this.stride)D.add(L[j],L[j+1]);return D.finish(),D.data=L,D}_addTileFeatures(L,D,j,X,se,le){for(const he of L){const te=he*this.stride,ye=D[te+Yi]>1;let we,fe,Pe;if(ye)we=bs(D,te,this.clusterProps),fe=D[te],Pe=D[te+1];else{const Et=this.points[D[te+Vi]];we=Et.properties;const[dt,Pt]=Et.geometry.coordinates;fe=fn(dt),Pe=On(Pt)}const et={type:1,geometry:[[Math.round(this.options.extent*(fe*se-j)),Math.round(this.options.extent*(Pe*se-X))]],tags:we};let it;it=ye||this.options.generateId?D[te+Vi]:this.points[D[te+Vi]].id,it!==void 0&&(et.id=it),le.features.push(et)}}_limitZoom(L){return Math.max(this.options.minZoom,Math.min(Math.floor(+L),this.options.maxZoom+1))}_cluster(L,D){const{radius:j,extent:X,reduce:se,minPoints:le}=this.options,he=j/(X*Math.pow(2,D)),te=L.data,ye=[],we=this.stride;for(let fe=0;fe<te.length;fe+=we){if(te[fe+2]<=D)continue;te[fe+2]=D;const Pe=te[fe],et=te[fe+1],it=L.within(te[fe],te[fe+1],he),Et=te[fe+Yi];let dt=Et;for(const Pt of it){const vt=Pt*we;te[vt+2]>D&&(dt+=te[vt+Yi])}if(dt>Et&&dt>=le){let Pt,vt=Pe*Et,xi=et*Et,ui=-1;const gt=((fe/we|0)<<5)+(D+1)+this.points.length;for(const Bt of it){const ai=Bt*we;if(te[ai+2]<=D)continue;te[ai+2]=D;const ki=te[ai+Yi];vt+=te[ai]*ki,xi+=te[ai+1]*ki,te[ai+4]=gt,se&&(Pt||(Pt=this._map(te,fe,!0),ui=this.clusterProps.length,this.clusterProps.push(Pt)),se(Pt,this._map(te,ai)))}te[fe+4]=gt,ye.push(vt/dt,xi/dt,1/0,gt,-1,dt),se&&ye.push(ui)}else{for(let Pt=0;Pt<we;Pt++)ye.push(te[fe+Pt]);if(dt>1)for(const Pt of it){const vt=Pt*we;if(!(te[vt+2]<=D)){te[vt+2]=D;for(let xi=0;xi<we;xi++)ye.push(te[vt+xi])}}}}return ye}_getOriginId(L){return L-this.points.length>>5}_getOriginZoom(L){return(L-this.points.length)%32}_map(L,D,j){if(L[D+Yi]>1){const le=this.clusterProps[L[D+xs]];return j?Object.assign({},le):le}const X=this.points[L[D+Vi]].properties,se=this.options.map(X);return j&&se===X?Object.assign({},se):se}}function sr(K,L,D){return{type:"Feature",id:K[L+Vi],properties:bs(K,L,D),geometry:{type:"Point",coordinates:[(j=K[L],360*(j-.5)),Wr(K[L+1])]}};var j}function bs(K,L,D){const j=K[L+Yi],X=j>=1e4?`${Math.round(j/1e3)}k`:j>=1e3?Math.round(j/100)/10+"k":j,se=K[L+xs],le=se===-1?{}:Object.assign({},D[se]);return Object.assign(le,{cluster:!0,cluster_id:K[L+Vi],point_count:j,point_count_abbreviated:X})}function fn(K){return K/360+.5}function On(K){const L=Math.sin(K*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function Wr(K){const L=(180-360*K)*Math.PI/180;return 360*Math.atan(Math.exp(L))/Math.PI-90}function Zr(K,L,D,j){let X=j;const se=L+(D-L>>1);let le,he=D-L;const te=K[L],ye=K[L+1],we=K[D],fe=K[D+1];for(let Pe=L+3;Pe<D;Pe+=3){const et=bo(K[Pe],K[Pe+1],te,ye,we,fe);if(et>X)le=Pe,X=et;else if(et===X){const it=Math.abs(Pe-se);it<he&&(le=Pe,he=it)}}X>j&&(le-L>3&&Zr(K,L,le,j),K[le+2]=X,D-le>3&&Zr(K,le,D,j))}function bo(K,L,D,j,X,se){let le=X-D,he=se-j;if(le!==0||he!==0){const te=((K-D)*le+(L-j)*he)/(le*le+he*he);te>1?(D=X,j=se):te>0&&(D+=le*te,j+=he*te)}return le=K-D,he=L-j,le*le+he*he}function vr(K,L,D,j){const X={id:K??null,type:L,geometry:D,tags:j,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(L==="Point"||L==="MultiPoint"||L==="LineString")kr(X,D);else if(L==="Polygon")kr(X,D[0]);else if(L==="MultiLineString")for(const se of D)kr(X,se);else if(L==="MultiPolygon")for(const se of D)kr(X,se[0]);return X}function kr(K,L){for(let D=0;D<L.length;D+=3)K.minX=Math.min(K.minX,L[D]),K.minY=Math.min(K.minY,L[D+1]),K.maxX=Math.max(K.maxX,L[D]),K.maxY=Math.max(K.maxY,L[D+1])}function Ar(K,L,D,j){if(!L.geometry)return;const X=L.geometry.coordinates;if(X&&X.length===0)return;const se=L.geometry.type,le=Math.pow(D.tolerance/((1<<D.maxZoom)*D.extent),2);let he=[],te=L.id;if(D.promoteId?te=L.properties[D.promoteId]:D.generateId&&(te=j||0),se==="Point")ws(X,he);else if(se==="MultiPoint")for(const ye of X)ws(ye,he);else if(se==="LineString")ge(X,he,le,!1);else if(se==="MultiLineString"){if(D.lineMetrics){for(const ye of X)he=[],ge(ye,he,le,!1),K.push(vr(te,"LineString",he,L.properties));return}Gr(X,he,le,!1)}else if(se==="Polygon")Gr(X,he,le,!0);else{if(se!=="MultiPolygon"){if(se==="GeometryCollection"){for(const ye of L.geometry.geometries)Ar(K,{id:te,geometry:ye,properties:L.properties},D,j);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const ye of X){const we=[];Gr(ye,we,le,!0),he.push(we)}}K.push(vr(te,se,he,L.properties))}function ws(K,L){L.push(wo(K[0]),At(K[1]),0)}function ge(K,L,D,j){let X,se,le=0;for(let te=0;te<K.length;te++){const ye=wo(K[te][0]),we=At(K[te][1]);L.push(ye,we,0),te>0&&(le+=j?(X*we-ye*se)/2:Math.sqrt(Math.pow(ye-X,2)+Math.pow(we-se,2))),X=ye,se=we}const he=L.length-3;L[2]=1,Zr(L,0,he,D),L[he+2]=1,L.size=Math.abs(le),L.start=0,L.end=L.size}function Gr(K,L,D,j){for(let X=0;X<K.length;X++){const se=[];ge(K[X],se,D,j),L.push(se)}}function wo(K){return K/360+.5}function At(K){const L=Math.sin(K*Math.PI/180),D=.5-.25*Math.log((1+L)/(1-L))/Math.PI;return D<0?0:D>1?1:D}function ci(K,L,D,j,X,se,le,he){if(j/=L,se>=(D/=L)&&le<j)return K;if(le<D||se>=j)return null;const te=[];for(const ye of K){const we=ye.geometry;let fe=ye.type;const Pe=X===0?ye.minX:ye.minY,et=X===0?ye.maxX:ye.maxY;if(Pe>=D&&et<j){te.push(ye);continue}if(et<D||Pe>=j)continue;let it=[];if(fe==="Point"||fe==="MultiPoint")Co(we,it,D,j,X);else if(fe==="LineString")zr(we,it,D,j,X,!1,he.lineMetrics);else if(fe==="MultiLineString")Cs(we,it,D,j,X,!1);else if(fe==="Polygon")Cs(we,it,D,j,X,!0);else if(fe==="MultiPolygon")for(const Et of we){const dt=[];Cs(Et,dt,D,j,X,!0),dt.length&&it.push(dt)}if(it.length){if(he.lineMetrics&&fe==="LineString"){for(const Et of it)te.push(vr(ye.id,fe,Et,ye.tags));continue}fe!=="LineString"&&fe!=="MultiLineString"||(it.length===1?(fe="LineString",it=it[0]):fe="MultiLineString"),fe!=="Point"&&fe!=="MultiPoint"||(fe=it.length===3?"Point":"MultiPoint"),te.push(vr(ye.id,fe,it,ye.tags))}}return te.length?te:null}function Co(K,L,D,j,X){for(let se=0;se<K.length;se+=3){const le=K[se+X];le>=D&&le<=j&&In(L,K[se],K[se+1],K[se+2])}}function zr(K,L,D,j,X,se,le){let he=xr(K);const te=X===0?So:Io;let ye,we,fe=K.start;for(let dt=0;dt<K.length-3;dt+=3){const Pt=K[dt],vt=K[dt+1],xi=K[dt+2],ui=K[dt+3],gt=K[dt+4],Bt=X===0?Pt:vt,ai=X===0?ui:gt;let ki=!1;le&&(ye=Math.sqrt(Math.pow(Pt-ui,2)+Math.pow(vt-gt,2))),Bt<D?ai>D&&(we=te(he,Pt,vt,ui,gt,D),le&&(he.start=fe+ye*we)):Bt>j?ai<j&&(we=te(he,Pt,vt,ui,gt,j),le&&(he.start=fe+ye*we)):In(he,Pt,vt,xi),ai<D&&Bt>=D&&(we=te(he,Pt,vt,ui,gt,D),ki=!0),ai>j&&Bt<=j&&(we=te(he,Pt,vt,ui,gt,j),ki=!0),!se&&ki&&(le&&(he.end=fe+ye*we),L.push(he),he=xr(K)),le&&(fe+=ye)}let Pe=K.length-3;const et=K[Pe],it=K[Pe+1],Et=X===0?et:it;Et>=D&&Et<=j&&In(he,et,it,K[Pe+2]),Pe=he.length-3,se&&Pe>=3&&(he[Pe]!==he[0]||he[Pe+1]!==he[1])&&In(he,he[0],he[1],he[2]),he.length&&L.push(he)}function xr(K){const L=[];return L.size=K.size,L.start=K.start,L.end=K.end,L}function Cs(K,L,D,j,X,se){for(const le of K)zr(le,L,D,j,X,se,!1)}function In(K,L,D,j){K.push(L,D,j)}function So(K,L,D,j,X,se){const le=(se-L)/(j-L);return In(K,se,D+(X-D)*le,1),le}function Io(K,L,D,j,X,se){const le=(se-D)/(X-D);return In(K,L+(j-L)*le,se,1),le}function Ee(K,L){const D=[];for(let j=0;j<K.length;j++){const X=K[j],se=X.type;let le;if(se==="Point"||se==="MultiPoint"||se==="LineString")le=or(X.geometry,L);else if(se==="MultiLineString"||se==="Polygon"){le=[];for(const he of X.geometry)le.push(or(he,L))}else if(se==="MultiPolygon"){le=[];for(const he of X.geometry){const te=[];for(const ye of he)te.push(or(ye,L));le.push(te)}}D.push(vr(X.id,se,le,X.tags))}return D}function or(K,L){const D=[];D.size=K.size,K.start!==void 0&&(D.start=K.start,D.end=K.end);for(let j=0;j<K.length;j+=3)D.push(K[j]+L,K[j+1],K[j+2]);return D}function Ki(K,L){if(K.transformed)return K;const D=1<<K.z,j=K.x,X=K.y;for(const se of K.features){const le=se.geometry,he=se.type;if(se.geometry=[],he===1)for(let te=0;te<le.length;te+=2)se.geometry.push(ar(le[te],le[te+1],L,D,j,X));else for(let te=0;te<le.length;te++){const ye=[];for(let we=0;we<le[te].length;we+=2)ye.push(ar(le[te][we],le[te][we+1],L,D,j,X));se.geometry.push(ye)}}return K.transformed=!0,K}function ar(K,L,D,j,X,se){return[Math.round(D*(K*j-X)),Math.round(D*(L*j-se))]}function Dr(K,L,D,j,X){const se=L===X.maxZoom?0:X.tolerance/((1<<L)*X.extent),le={features:[],numPoints:0,numSimplified:0,numFeatures:K.length,source:null,x:D,y:j,z:L,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const he of K)Ae(le,he,se,X);return le}function Ae(K,L,D,j){const X=L.geometry,se=L.type,le=[];if(K.minX=Math.min(K.minX,L.minX),K.minY=Math.min(K.minY,L.minY),K.maxX=Math.max(K.maxX,L.maxX),K.maxY=Math.max(K.maxY,L.maxY),se==="Point"||se==="MultiPoint")for(let he=0;he<X.length;he+=3)le.push(X[he],X[he+1]),K.numPoints++,K.numSimplified++;else if(se==="LineString")ft(le,X,K,D,!1,!1);else if(se==="MultiLineString"||se==="Polygon")for(let he=0;he<X.length;he++)ft(le,X[he],K,D,se==="Polygon",he===0);else if(se==="MultiPolygon")for(let he=0;he<X.length;he++){const te=X[he];for(let ye=0;ye<te.length;ye++)ft(le,te[ye],K,D,!0,ye===0)}if(le.length){let he=L.tags||null;if(se==="LineString"&&j.lineMetrics){he={};for(const ye in L.tags)he[ye]=L.tags[ye];he.mapbox_clip_start=X.start/X.size,he.mapbox_clip_end=X.end/X.size}const te={geometry:le,type:se==="Polygon"||se==="MultiPolygon"?3:se==="LineString"||se==="MultiLineString"?2:1,tags:he};L.id!==null&&(te.id=L.id),K.features.push(te)}}function ft(K,L,D,j,X,se){const le=j*j;if(j>0&&L.size<(X?le:j))return void(D.numPoints+=L.length/3);const he=[];for(let te=0;te<L.length;te+=3)(j===0||L[te+2]>le)&&(D.numSimplified++,he.push(L[te],L[te+1])),D.numPoints++;X&&function(te,ye){let we=0;for(let fe=0,Pe=te.length,et=Pe-2;fe<Pe;et=fe,fe+=2)we+=(te[fe]-te[et])*(te[fe+1]+te[et+1]);if(we>0===ye)for(let fe=0,Pe=te.length;fe<Pe/2;fe+=2){const et=te[fe],it=te[fe+1];te[fe]=te[Pe-2-fe],te[fe+1]=te[Pe-1-fe],te[Pe-2-fe]=et,te[Pe-1-fe]=it}}(he,se),K.push(he)}const ot={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class rn{constructor(L,D){const j=(D=this.options=function(se,le){for(const he in le)se[he]=le[he];return se}(Object.create(ot),D)).debug;if(j&&console.time("preprocess data"),D.maxZoom<0||D.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(D.promoteId&&D.generateId)throw new Error("promoteId and generateId cannot be used together.");let X=function(se,le){const he=[];if(se.type==="FeatureCollection")for(let te=0;te<se.features.length;te++)Ar(he,se.features[te],le,te);else Ar(he,se.type==="Feature"?se:{geometry:se},le);return he}(L,D);this.tiles={},this.tileCoords=[],j&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",D.indexMaxZoom,D.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=function(se,le){const he=le.buffer/le.extent;let te=se;const ye=ci(se,1,-1-he,he,0,-1,2,le),we=ci(se,1,1-he,2+he,0,-1,2,le);return(ye||we)&&(te=ci(se,1,-he,1+he,0,-1,2,le)||[],ye&&(te=Ee(ye,1).concat(te)),we&&(te=te.concat(Ee(we,-1)))),te}(X,D),X.length&&this.splitTile(X,0,0,0),j&&(X.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(L,D,j,X,se,le,he){const te=[L,D,j,X],ye=this.options,we=ye.debug;for(;te.length;){X=te.pop(),j=te.pop(),D=te.pop(),L=te.pop();const fe=1<<D,Pe=Nn(D,j,X);let et=this.tiles[Pe];if(!et&&(we>1&&console.time("creation"),et=this.tiles[Pe]=Dr(L,D,j,X,ye),this.tileCoords.push({z:D,x:j,y:X}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",D,j,X,et.numFeatures,et.numPoints,et.numSimplified),console.timeEnd("creation"));const ki=`z${D}`;this.stats[ki]=(this.stats[ki]||0)+1,this.total++}if(et.source=L,se==null){if(D===ye.indexMaxZoom||et.numPoints<=ye.indexMaxPoints)continue}else{if(D===ye.maxZoom||D===se)continue;if(se!=null){const ki=se-D;if(j!==le>>ki||X!==he>>ki)continue}}if(et.source=null,L.length===0)continue;we>1&&console.time("clipping");const it=.5*ye.buffer/ye.extent,Et=.5-it,dt=.5+it,Pt=1+it;let vt=null,xi=null,ui=null,gt=null,Bt=ci(L,fe,j-it,j+dt,0,et.minX,et.maxX,ye),ai=ci(L,fe,j+Et,j+Pt,0,et.minX,et.maxX,ye);L=null,Bt&&(vt=ci(Bt,fe,X-it,X+dt,1,et.minY,et.maxY,ye),xi=ci(Bt,fe,X+Et,X+Pt,1,et.minY,et.maxY,ye),Bt=null),ai&&(ui=ci(ai,fe,X-it,X+dt,1,et.minY,et.maxY,ye),gt=ci(ai,fe,X+Et,X+Pt,1,et.minY,et.maxY,ye),ai=null),we>1&&console.timeEnd("clipping"),te.push(vt||[],D+1,2*j,2*X),te.push(xi||[],D+1,2*j,2*X+1),te.push(ui||[],D+1,2*j+1,2*X),te.push(gt||[],D+1,2*j+1,2*X+1)}}getTile(L,D,j){L=+L,D=+D,j=+j;const X=this.options,{extent:se,debug:le}=X;if(L<0||L>24)return null;const he=1<<L,te=Nn(L,D=D+he&he-1,j);if(this.tiles[te])return Ki(this.tiles[te],se);le>1&&console.log("drilling down to z%d-%d-%d",L,D,j);let ye,we=L,fe=D,Pe=j;for(;!ye&&we>0;)we--,fe>>=1,Pe>>=1,ye=this.tiles[Nn(we,fe,Pe)];return ye&&ye.source?(le>1&&(console.log("found parent tile z%d-%d-%d",we,fe,Pe),console.time("drilling down")),this.splitTile(ye.source,we,fe,Pe,L,D,j),le>1&&console.timeEnd("drilling down"),this.tiles[te]?Ki(this.tiles[te],se):null):null}}function Nn(K,L,D){return 32*((1<<K)*D+L)+K}function ht(K,L){return L?K.properties[L]:K.id}function lr(K,L){if(K==null)return!0;if(K.type==="Feature")return ht(K,L)!=null;if(K.type==="FeatureCollection"){const D=new Set;for(const j of K.features){const X=ht(j,L);if(X==null||D.has(X))return!1;D.add(X)}return!0}return!1}function br(K,L){const D=new Map;if(K!=null)if(K.type==="Feature")D.set(ht(K,L),K);else for(const j of K.features)D.set(ht(j,L),j);return D}class Lr extends q{constructor(){super(...arguments),this._dataUpdateable=new Map}loadVectorTile(L,D){return x._(this,void 0,void 0,function*(){const j=L.tileID.canonical;if(!this._geoJSONIndex)throw new Error("Unable to parse the data into a cluster or geojson");const X=this._geoJSONIndex.getTile(j.z,j.x,j.y);if(!X)return null;const se=new class{constructor(he){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=x.X,this.length=he.length,this._features=he}feature(he){return new class{constructor(te){this._feature=te,this.extent=x.X,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const ye of this._feature.geometry)te.push([new x.P(ye[0],ye[1])]);return te}{const te=[];for(const ye of this._feature.geometry){const we=[];for(const fe of ye)we.push(new x.P(fe[0],fe[1]));te.push(we)}return te}}toGeoJSON(te,ye,we){return ve.call(this,te,ye,we)}}(this._features[he])}}(X.features);let le=li(se);return le.byteOffset===0&&le.byteLength===le.buffer.byteLength||(le=new Uint8Array(le)),{vectorTile:se,rawData:le.buffer}})}loadData(L){return x._(this,void 0,void 0,function*(){var D;(D=this._pendingRequest)===null||D===void 0||D.abort();const j=!!(L&&L.request&&L.request.collectResourceTiming)&&new x.bv(L.request);this._pendingRequest=new AbortController;try{this._pendingData=this.loadAndProcessGeoJSON(L,this._pendingRequest),this._geoJSONIndex=L.cluster?new Mr(function({superclusterOptions:le,clusterProperties:he}){if(!he||!le)return le;const te={},ye={},we={accumulated:null,zoom:0},fe={properties:null},Pe=Object.keys(he);for(const et of Pe){const[it,Et]=he[et],dt=x.bC(Et),Pt=x.bC(typeof it=="string"?[it,["accumulated"],["get",et]]:it);te[et]=dt.value,ye[et]=Pt.value}return le.map=et=>{fe.properties=et;const it={};for(const Et of Pe)it[Et]=te[Et].evaluate(we,fe);return it},le.reduce=(et,it)=>{fe.properties=it;for(const Et of Pe)we.accumulated=et[Et],et[Et]=ye[Et].evaluate(we,fe)},le}(L)).load((yield this._pendingData).features):(X=yield this._pendingData,new rn(X,L.geojsonVtOptions)),this.loaded={};const se={};if(j){const le=j.finish();le&&(se.resourceTiming={},se.resourceTiming[L.source]=JSON.parse(JSON.stringify(le)))}return se}catch(se){if(delete this._pendingRequest,x.bB(se))return{abandoned:!0};throw se}var X})}getData(){return x._(this,void 0,void 0,function*(){return this._pendingData})}reloadTile(L){const D=this.loaded;return D&&D[L.uid]?super.reloadTile(L):this.loadTile(L)}loadAndProcessGeoJSON(L,D){return x._(this,void 0,void 0,function*(){let j=yield this.loadGeoJSON(L,D);if(delete this._pendingRequest,typeof j!="object")throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(pe(j,!0),L.filter){const X=x.bC(L.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(X.result==="error")throw new Error(X.value.map(le=>`${le.key}: ${le.message}`).join(", "));j={type:"FeatureCollection",features:j.features.filter(le=>X.value.evaluate({zoom:0},le))}}return j})}loadGeoJSON(L,D){return x._(this,void 0,void 0,function*(){const{promoteId:j}=L;if(L.request){const X=yield x.h(L.request,D);return this._dataUpdateable=lr(X.data,j)?br(X.data,j):void 0,X.data}if(typeof L.data=="string")try{const X=JSON.parse(L.data);return this._dataUpdateable=lr(X,j)?br(X,j):void 0,X}catch{throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`)}if(!L.dataDiff)throw new Error(`Input data given to '${L.source}' is not a valid GeoJSON object.`);if(!this._dataUpdateable)throw new Error(`Cannot update existing geojson data in ${L.source}`);return function(X,se,le){var he,te,ye,we;if(se.removeAll&&X.clear(),se.remove)for(const fe of se.remove)X.delete(fe);if(se.add)for(const fe of se.add){const Pe=ht(fe,le);Pe!=null&&X.set(Pe,fe)}if(se.update)for(const fe of se.update){let Pe=X.get(fe.id);if(Pe==null)continue;const et=!fe.removeAllProperties&&(((he=fe.removeProperties)===null||he===void 0?void 0:he.length)>0||((te=fe.addOrUpdateProperties)===null||te===void 0?void 0:te.length)>0);if((fe.newGeometry||fe.removeAllProperties||et)&&(Pe=Object.assign({},Pe),X.set(fe.id,Pe),et&&(Pe.properties=Object.assign({},Pe.properties))),fe.newGeometry&&(Pe.geometry=fe.newGeometry),fe.removeAllProperties)Pe.properties={};else if(((ye=fe.removeProperties)===null||ye===void 0?void 0:ye.length)>0)for(const it of fe.removeProperties)Object.prototype.hasOwnProperty.call(Pe.properties,it)&&delete Pe.properties[it];if(((we=fe.addOrUpdateProperties)===null||we===void 0?void 0:we.length)>0)for(const{key:it,value:Et}of fe.addOrUpdateProperties)Pe.properties[it]=Et}}(this._dataUpdateable,L.dataDiff,j),{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())}})}removeSource(L){return x._(this,void 0,void 0,function*(){this._pendingRequest&&this._pendingRequest.abort()})}getClusterExpansionZoom(L){return this._geoJSONIndex.getClusterExpansionZoom(L.clusterId)}getClusterChildren(L){return this._geoJSONIndex.getChildren(L.clusterId)}getClusterLeaves(L){return this._geoJSONIndex.getLeaves(L.clusterId,L.limit,L.offset)}}class cr{constructor(L){this.self=L,this.actor=new x.F(L),this.layerIndexes={},this.availableImages={},this.workerSources={},this.demWorkerSources={},this.externalWorkerSourceTypes={},this.self.registerWorkerSource=(D,j)=>{if(this.externalWorkerSourceTypes[D])throw new Error(`Worker source with name "${D}" already registered.`);this.externalWorkerSourceTypes[D]=j},this.self.addProtocol=x.bi,this.self.removeProtocol=x.bj,this.self.registerRTLTextPlugin=D=>{if(x.bD.isParsed())throw new Error("RTL text plugin already registered.");x.bD.setMethods(D)},this.actor.registerMessageHandler("LDT",(D,j)=>this._getDEMWorkerSource(D,j.source).loadTile(j)),this.actor.registerMessageHandler("RDT",(D,j)=>x._(this,void 0,void 0,function*(){this._getDEMWorkerSource(D,j.source).removeTile(j)})),this.actor.registerMessageHandler("GCEZ",(D,j)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterExpansionZoom(j)})),this.actor.registerMessageHandler("GCC",(D,j)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterChildren(j)})),this.actor.registerMessageHandler("GCL",(D,j)=>x._(this,void 0,void 0,function*(){return this._getWorkerSource(D,j.type,j.source).getClusterLeaves(j)})),this.actor.registerMessageHandler("LD",(D,j)=>this._getWorkerSource(D,j.type,j.source).loadData(j)),this.actor.registerMessageHandler("GD",(D,j)=>this._getWorkerSource(D,j.type,j.source).getData()),this.actor.registerMessageHandler("LT",(D,j)=>this._getWorkerSource(D,j.type,j.source).loadTile(j)),this.actor.registerMessageHandler("RT",(D,j)=>this._getWorkerSource(D,j.type,j.source).reloadTile(j)),this.actor.registerMessageHandler("AT",(D,j)=>this._getWorkerSource(D,j.type,j.source).abortTile(j)),this.actor.registerMessageHandler("RMT",(D,j)=>this._getWorkerSource(D,j.type,j.source).removeTile(j)),this.actor.registerMessageHandler("RS",(D,j)=>x._(this,void 0,void 0,function*(){if(!this.workerSources[D]||!this.workerSources[D][j.type]||!this.workerSources[D][j.type][j.source])return;const X=this.workerSources[D][j.type][j.source];delete this.workerSources[D][j.type][j.source],X.removeSource!==void 0&&X.removeSource(j)})),this.actor.registerMessageHandler("RM",D=>x._(this,void 0,void 0,function*(){delete this.layerIndexes[D],delete this.availableImages[D],delete this.workerSources[D],delete this.demWorkerSources[D]})),this.actor.registerMessageHandler("SR",(D,j)=>x._(this,void 0,void 0,function*(){this.referrer=j})),this.actor.registerMessageHandler("SRPS",(D,j)=>this._syncRTLPluginState(D,j)),this.actor.registerMessageHandler("IS",(D,j)=>x._(this,void 0,void 0,function*(){this.self.importScripts(j)})),this.actor.registerMessageHandler("SI",(D,j)=>this._setImages(D,j)),this.actor.registerMessageHandler("UL",(D,j)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(D).update(j.layers,j.removedIds)})),this.actor.registerMessageHandler("SL",(D,j)=>x._(this,void 0,void 0,function*(){this._getLayerIndex(D).replace(j)}))}_setImages(L,D){return x._(this,void 0,void 0,function*(){this.availableImages[L]=D;for(const j in this.workerSources[L]){const X=this.workerSources[L][j];for(const se in X)X[se].availableImages=D}})}_syncRTLPluginState(L,D){return x._(this,void 0,void 0,function*(){if(x.bD.isParsed())return x.bD.getState();if(D.pluginStatus!=="loading")return x.bD.setState(D),D;const j=D.pluginURL;if(this.self.importScripts(j),x.bD.isParsed()){const X={pluginStatus:"loaded",pluginURL:j};return x.bD.setState(X),X}throw x.bD.setState({pluginStatus:"error",pluginURL:""}),new Error(`RTL Text Plugin failed to import scripts from ${j}`)})}_getAvailableImages(L){let D=this.availableImages[L];return D||(D=[]),D}_getLayerIndex(L){let D=this.layerIndexes[L];return D||(D=this.layerIndexes[L]=new u),D}_getWorkerSource(L,D,j){if(this.workerSources[L]||(this.workerSources[L]={}),this.workerSources[L][D]||(this.workerSources[L][D]={}),!this.workerSources[L][D][j]){const X={sendAsync:(se,le)=>(se.targetMapId=L,this.actor.sendAsync(se,le))};switch(D){case"vector":this.workerSources[L][D][j]=new q(X,this._getLayerIndex(L),this._getAvailableImages(L));break;case"geojson":this.workerSources[L][D][j]=new Lr(X,this._getLayerIndex(L),this._getAvailableImages(L));break;default:this.workerSources[L][D][j]=new this.externalWorkerSourceTypes[D](X,this._getLayerIndex(L),this._getAvailableImages(L))}}return this.workerSources[L][D][j]}_getDEMWorkerSource(L,D){return this.demWorkerSources[L]||(this.demWorkerSources[L]={}),this.demWorkerSources[L][D]||(this.demWorkerSources[L][D]=new F),this.demWorkerSources[L][D]}}return x.i(self)&&(self.worker=new cr(self)),cr}),y("index",["exports","./shared"],function(x,u){var O="4.7.1";let V,W;const q={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frameAsync:f=>new Promise((e,s)=>{const l=requestAnimationFrame(e);f.signal.addEventListener("abort",()=>{cancelAnimationFrame(l),s(u.c())})}),getImageData(f,e=0){return this.getImageCanvasContext(f).getImageData(-e,-e,f.width+2*e,f.height+2*e)},getImageCanvasContext(f){const e=window.document.createElement("canvas"),s=e.getContext("2d",{willReadFrequently:!0});if(!s)throw new Error("failed to create canvas 2d context");return e.width=f.width,e.height=f.height,s.drawImage(f,0,0,f.width,f.height),s},resolveURL:f=>(V||(V=document.createElement("a")),V.href=f,V.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(W==null&&(W=matchMedia("(prefers-reduced-motion: reduce)")),W.matches)}};class F{static testProp(e){if(!F.docStyle)return e[0];for(let s=0;s<e.length;s++)if(e[s]in F.docStyle)return e[s];return e[0]}static create(e,s,l){const c=window.document.createElement(e);return s!==void 0&&(c.className=s),l&&l.appendChild(c),c}static createNS(e,s){return window.document.createElementNS(e,s)}static disableDrag(){F.docStyle&&F.selectProp&&(F.userSelect=F.docStyle[F.selectProp],F.docStyle[F.selectProp]="none")}static enableDrag(){F.docStyle&&F.selectProp&&(F.docStyle[F.selectProp]=F.userSelect)}static setTransform(e,s){e.style[F.transformProp]=s}static addEventListener(e,s,l,c={}){e.addEventListener(s,l,"passive"in c?c:c.capture)}static removeEventListener(e,s,l,c={}){e.removeEventListener(s,l,"passive"in c?c:c.capture)}static suppressClickInternal(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",F.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",F.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",F.suppressClickInternal,!0)},0)}static getScale(e){const s=e.getBoundingClientRect();return{x:s.width/e.offsetWidth||1,y:s.height/e.offsetHeight||1,boundingClientRect:s}}static getPoint(e,s,l){const c=s.boundingClientRect;return new u.P((l.clientX-c.left)/s.x-e.clientLeft,(l.clientY-c.top)/s.y-e.clientTop)}static mousePos(e,s){const l=F.getScale(e);return F.getPoint(e,l,s)}static touchPos(e,s){const l=[],c=F.getScale(e);for(let m=0;m<s.length;m++)l.push(F.getPoint(e,c,s[m]));return l}static mouseButton(e){return e.button}static remove(e){e.parentNode&&e.parentNode.removeChild(e)}}F.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,F.selectProp=F.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),F.transformProp=F.testProp(["transform","WebkitTransform"]);const oe={supported:!1,testSupport:function(f){!ve&&pe&&(Ce?je(f):ie=f)}};let ie,pe,ve=!1,Ce=!1;function je(f){const e=f.createTexture();f.bindTexture(f.TEXTURE_2D,e);try{if(f.texImage2D(f.TEXTURE_2D,0,f.RGBA,f.RGBA,f.UNSIGNED_BYTE,pe),f.isContextLost())return;oe.supported=!0}catch{}f.deleteTexture(e),ve=!0}var st;typeof document<"u"&&(pe=document.createElement("img"),pe.onload=()=>{ie&&je(ie),ie=null,Ce=!0},pe.onerror=()=>{ve=!0,ie=null},pe.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(f){let e,s,l,c;f.resetRequestQueue=()=>{e=[],s=0,l=0,c={}},f.addThrottleControl=I=>{const P=l++;return c[P]=I,P},f.removeThrottleControl=I=>{delete c[I],b()},f.getImage=(I,P,k=!0)=>new Promise((A,B)=>{oe.supported&&(I.headers||(I.headers={}),I.headers.accept="image/webp,*/*"),u.e(I,{type:"image"}),e.push({abortController:P,requestParameters:I,supportImageRefresh:k,state:"queued",onError:$=>{B($)},onSuccess:$=>{A($)}}),b()});const m=I=>u._(this,void 0,void 0,function*(){I.state="running";const{requestParameters:P,supportImageRefresh:k,onError:A,onSuccess:B,abortController:$}=I,H=k===!1&&!u.i(self)&&!u.g(P.url)&&(!P.headers||Object.keys(P.headers).reduce((ee,ne)=>ee&&ne==="accept",!0));s++;const Y=H?C(P,$):u.m(P,$);try{const ee=yield Y;delete I.abortController,I.state="completed",ee.data instanceof HTMLImageElement||u.b(ee.data)?B(ee):ee.data&&B({data:yield(Q=ee.data,typeof createImageBitmap=="function"?u.d(Q):u.f(Q)),cacheControl:ee.cacheControl,expires:ee.expires})}catch(ee){delete I.abortController,A(ee)}finally{s--,b()}var Q}),b=()=>{const I=(()=>{for(const P of Object.keys(c))if(c[P]())return!0;return!1})()?u.a.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.a.MAX_PARALLEL_IMAGE_REQUESTS;for(let P=s;P<I&&e.length>0;P++){const k=e.shift();k.abortController.signal.aborted?P--:m(k)}},C=(I,P)=>new Promise((k,A)=>{const B=new Image,$=I.url,H=I.credentials;H&&H==="include"?B.crossOrigin="use-credentials":(H&&H==="same-origin"||!u.s($))&&(B.crossOrigin="anonymous"),P.signal.addEventListener("abort",()=>{B.src="",A(u.c())}),B.fetchPriority="high",B.onload=()=>{B.onerror=B.onload=null,k({data:B})},B.onerror=()=>{B.onerror=B.onload=null,P.signal.aborted||A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))},B.src=$})}(st||(st={})),st.resetRequestQueue();class Qe{constructor(e){this._transformRequestFn=e}transformRequest(e,s){return this._transformRequestFn&&this._transformRequestFn(e,s)||{url:e}}setTransformRequest(e){this._transformRequestFn=e}}function qe(f){var e=new u.A(3);return e[0]=f[0],e[1]=f[1],e[2]=f[2],e}var ct,We=function(f,e,s){return f[0]=e[0]-s[0],f[1]=e[1]-s[1],f[2]=e[2]-s[2],f};ct=new u.A(3),u.A!=Float32Array&&(ct[0]=0,ct[1]=0,ct[2]=0);var It=function(f){var e=f[0],s=f[1];return e*e+s*s};function Ve(f){const e=[];if(typeof f=="string")e.push({id:"default",url:f});else if(f&&f.length>0){const s=[];for(const{id:l,url:c}of f){const m=`${l}${c}`;s.indexOf(m)===-1&&(s.push(m),e.push({id:l,url:c}))}}return e}function pi(f,e,s){const l=f.split("?");return l[0]+=`${e}${s}`,l.join("?")}(function(){var f=new u.A(2);u.A!=Float32Array&&(f[0]=0,f[1]=0)})();class tt{constructor(e,s,l,c){this.context=e,this.format=l,this.texture=e.gl.createTexture(),this.update(s,c)}update(e,s,l){const{width:c,height:m}=e,b=!(this.size&&this.size[0]===c&&this.size[1]===m||l),{context:C}=this,{gl:I}=C;if(this.useMipmap=!!(s&&s.useMipmap),I.bindTexture(I.TEXTURE_2D,this.texture),C.pixelStoreUnpackFlipY.set(!1),C.pixelStoreUnpack.set(1),C.pixelStoreUnpackPremultiplyAlpha.set(this.format===I.RGBA&&(!s||s.premultiply!==!1)),b)this.size=[c,m],e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?I.texImage2D(I.TEXTURE_2D,0,this.format,this.format,I.UNSIGNED_BYTE,e):I.texImage2D(I.TEXTURE_2D,0,this.format,c,m,0,this.format,I.UNSIGNED_BYTE,e.data);else{const{x:P,y:k}=l||{x:0,y:0};e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||u.b(e)?I.texSubImage2D(I.TEXTURE_2D,0,P,k,I.RGBA,I.UNSIGNED_BYTE,e):I.texSubImage2D(I.TEXTURE_2D,0,P,k,c,m,I.RGBA,I.UNSIGNED_BYTE,e.data)}this.useMipmap&&this.isSizePowerOfTwo()&&I.generateMipmap(I.TEXTURE_2D)}bind(e,s,l){const{context:c}=this,{gl:m}=c;m.bindTexture(m.TEXTURE_2D,this.texture),l!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(l=m.LINEAR),e!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,e),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,l||e),this.filter=e),s!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,s),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}function oi(f){const{userImage:e}=f;return!!(e&&e.render&&e.render())&&(f.data.replace(new Uint8Array(e.data.buffer)),!0)}class St extends u.E{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.R({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(e){if(this.loaded!==e&&(this.loaded=e,e)){for(const{ids:s,promiseResolve:l}of this.requestors)l(this._getImagesForIds(s));this.requestors=[]}}getImage(e){const s=this.images[e];if(s&&!s.data&&s.spriteData){const l=s.spriteData;s.data=new u.R({width:l.width,height:l.height},l.context.getImageData(l.x,l.y,l.width,l.height).data),s.spriteData=null}return s}addImage(e,s){if(this.images[e])throw new Error(`Image id ${e} already exist, use updateImage instead`);this._validate(e,s)&&(this.images[e]=s)}_validate(e,s){let l=!0;const c=s.data||s.spriteData;return this._validateStretch(s.stretchX,c&&c.width)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchX" value`))),l=!1),this._validateStretch(s.stretchY,c&&c.height)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "stretchY" value`))),l=!1),this._validateContent(s.content,s)||(this.fire(new u.j(new Error(`Image "${e}" has invalid "content" value`))),l=!1),l}_validateStretch(e,s){if(!e)return!0;let l=0;for(const c of e){if(c[0]<l||c[1]<c[0]||s<c[1])return!1;l=c[1]}return!0}_validateContent(e,s){if(!e)return!0;if(e.length!==4)return!1;const l=s.spriteData,c=l&&l.width||s.data.width,m=l&&l.height||s.data.height;return!(e[0]<0||c<e[0]||e[1]<0||m<e[1]||e[2]<0||c<e[2]||e[3]<0||m<e[3]||e[2]<e[0]||e[3]<e[1])}updateImage(e,s,l=!0){const c=this.getImage(e);if(l&&(c.data.width!==s.data.width||c.data.height!==s.data.height))throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[e]=s,this.updatedImages[e]=!0}removeImage(e){const s=this.images[e];delete this.images[e],delete this.patterns[e],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(e){return new Promise((s,l)=>{let c=!0;if(!this.isLoaded())for(const m of e)this.images[m]||(c=!1);this.isLoaded()||c?s(this._getImagesForIds(e)):this.requestors.push({ids:e,promiseResolve:s})})}_getImagesForIds(e){const s={};for(const l of e){let c=this.getImage(l);c||(this.fire(new u.k("styleimagemissing",{id:l})),c=this.getImage(l)),c?s[l]={data:c.data.clone(),pixelRatio:c.pixelRatio,sdf:c.sdf,version:c.version,stretchX:c.stretchX,stretchY:c.stretchY,content:c.content,textFitWidth:c.textFitWidth,textFitHeight:c.textFitHeight,hasRenderCallback:!!(c.userImage&&c.userImage.render)}:u.w(`Image "${l}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}return s}getPixelSize(){const{width:e,height:s}=this.atlasImage;return{width:e,height:s}}getPattern(e){const s=this.patterns[e],l=this.getImage(e);if(!l)return null;if(s&&s.position.version===l.version)return s.position;if(s)s.position.version=l.version;else{const c={w:l.data.width+2,h:l.data.height+2,x:0,y:0},m=new u.I(c,l);this.patterns[e]={bin:c,position:m}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const s=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new tt(e,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const m in this.patterns)e.push(this.patterns[m].bin);const{w:s,h:l}=u.p(e),c=this.atlasImage;c.resize({width:s||1,height:l||1});for(const m in this.patterns){const{bin:b}=this.patterns[m],C=b.x+1,I=b.y+1,P=this.getImage(m).data,k=P.width,A=P.height;u.R.copy(P,c,{x:0,y:0},{x:C,y:I},{width:k,height:A}),u.R.copy(P,c,{x:0,y:A-1},{x:C,y:I-1},{width:k,height:1}),u.R.copy(P,c,{x:0,y:0},{x:C,y:I+A},{width:k,height:1}),u.R.copy(P,c,{x:k-1,y:0},{x:C-1,y:I},{width:1,height:A}),u.R.copy(P,c,{x:0,y:0},{x:C+k,y:I},{width:1,height:A})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(e){for(const s of e){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const l=this.getImage(s);l||u.w(`Image with ID: "${s}" was not found`),oi(l)&&this.updateImage(s,l)}}}const Zt=1e20;function Ri(f,e,s,l,c,m,b,C,I){for(let P=e;P<e+l;P++)rr(f,s*m+P,m,c,b,C,I);for(let P=s;P<s+c;P++)rr(f,P*m+e,1,l,b,C,I)}function rr(f,e,s,l,c,m,b){m[0]=0,b[0]=-Zt,b[1]=Zt,c[0]=f[e];for(let C=1,I=0,P=0;C<l;C++){c[C]=f[e+C*s];const k=C*C;do{const A=m[I];P=(c[C]-c[A]+k-A*A)/(C-A)/2}while(P<=b[I]&&--I>-1);I++,m[I]=C,b[I]=P,b[I+1]=Zt}for(let C=0,I=0;C<l;C++){for(;b[I+1]<C;)I++;const P=m[I],k=C-P;f[e+C*s]=c[P]+k*k}}class li{constructor(e,s){this.requestManager=e,this.localIdeographFontFamily=s,this.entries={}}setURL(e){this.url=e}getGlyphs(e){return u._(this,void 0,void 0,function*(){const s=[];for(const m in e)for(const b of e[m])s.push(this._getAndCacheGlyphsPromise(m,b));const l=yield Promise.all(s),c={};for(const{stack:m,id:b,glyph:C}of l)c[m]||(c[m]={}),c[m][b]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics};return c})}_getAndCacheGlyphsPromise(e,s){return u._(this,void 0,void 0,function*(){let l=this.entries[e];l||(l=this.entries[e]={glyphs:{},requests:{},ranges:{}});let c=l.glyphs[s];if(c!==void 0)return{stack:e,id:s,glyph:c};if(c=this._tinySDF(l,e,s),c)return l.glyphs[s]=c,{stack:e,id:s,glyph:c};const m=Math.floor(s/256);if(256*m>65535)throw new Error("glyphs > 65535 not supported");if(l.ranges[m])return{stack:e,id:s,glyph:c};if(!this.url)throw new Error("glyphsUrl is not set");if(!l.requests[m]){const C=li.loadGlyphRange(e,m,this.url,this.requestManager);l.requests[m]=C}const b=yield l.requests[m];for(const C in b)this._doesCharSupportLocalGlyph(+C)||(l.glyphs[+C]=b[+C]);return l.ranges[m]=!0,{stack:e,id:s,glyph:b[s]||null}})}_doesCharSupportLocalGlyph(e){return!!this.localIdeographFontFamily&&/\p{Ideo}|\p{sc=Hang}|\p{sc=Hira}|\p{sc=Kana}/u.test(String.fromCodePoint(e))}_tinySDF(e,s,l){const c=this.localIdeographFontFamily;if(!c||!this._doesCharSupportLocalGlyph(l))return;let m=e.tinySDF;if(!m){let C="400";/bold/i.test(s)?C="900":/medium/i.test(s)?C="500":/light/i.test(s)&&(C="200"),m=e.tinySDF=new li.TinySDF({fontSize:48,buffer:6,radius:16,cutoff:.25,fontFamily:c,fontWeight:C})}const b=m.draw(String.fromCharCode(l));return{id:l,bitmap:new u.o({width:b.width||60,height:b.height||60},b.data),metrics:{width:b.glyphWidth/2||24,height:b.glyphHeight/2||24,left:b.glyphLeft/2+.5||0,top:b.glyphTop/2-27.5||-8,advance:b.glyphAdvance/2||24,isDoubleResolution:!0}}}}li.loadGlyphRange=function(f,e,s,l){return u._(this,void 0,void 0,function*(){const c=256*e,m=c+255,b=l.transformRequest(s.replace("{fontstack}",f).replace("{range}",`${c}-${m}`),"Glyphs"),C=yield u.l(b,new AbortController);if(!C||!C.data)throw new Error(`Could not load glyph range. range: ${e}, ${c}-${m}`);const I={};for(const P of u.n(C.data))I[P.id]=P;return I})},li.TinySDF=class{constructor({fontSize:f=24,buffer:e=3,radius:s=8,cutoff:l=.25,fontFamily:c="sans-serif",fontWeight:m="normal",fontStyle:b="normal"}={}){this.buffer=e,this.cutoff=l,this.radius=s;const C=this.size=f+4*e,I=this._createCanvas(C),P=this.ctx=I.getContext("2d",{willReadFrequently:!0});P.font=`${b} ${m} ${f}px ${c}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Uint16Array(C)}_createCanvas(f){const e=document.createElement("canvas");return e.width=e.height=f,e}draw(f){const{width:e,actualBoundingBoxAscent:s,actualBoundingBoxDescent:l,actualBoundingBoxLeft:c,actualBoundingBoxRight:m}=this.ctx.measureText(f),b=Math.ceil(s),C=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(m-c))),I=Math.min(this.size-this.buffer,b+Math.ceil(l)),P=C+2*this.buffer,k=I+2*this.buffer,A=Math.max(P*k,0),B=new Uint8ClampedArray(A),$={data:B,width:P,height:k,glyphWidth:C,glyphHeight:I,glyphTop:b,glyphLeft:0,glyphAdvance:e};if(C===0||I===0)return $;const{ctx:H,buffer:Y,gridInner:Q,gridOuter:ee}=this;H.clearRect(Y,Y,C,I),H.fillText(f,Y,Y+b);const ne=H.getImageData(Y,Y,C,I);ee.fill(Zt,0,A),Q.fill(0,0,A);for(let Z=0;Z<I;Z++)for(let ae=0;ae<C;ae++){const ce=ne.data[4*(Z*C+ae)+3]/255;if(ce===0)continue;const me=(Z+Y)*P+ae+Y;if(ce===1)ee[me]=0,Q[me]=Zt;else{const be=.5-ce;ee[me]=be>0?be*be:0,Q[me]=be<0?be*be:0}}Ri(ee,0,0,P,k,P,this.f,this.v,this.z),Ri(Q,Y,Y,C,I,P,this.f,this.v,this.z);for(let Z=0;Z<A;Z++){const ae=Math.sqrt(ee[Z])-Math.sqrt(Q[Z]);B[Z]=Math.round(255-255*(ae/this.radius+this.cutoff))}return $}};class yr{constructor(){this.specification=u.v.light.position}possiblyEvaluate(e,s){return u.x(e.expression.evaluate(s))}interpolate(e,s,l){return{x:u.y.number(e.x,s.x,l),y:u.y.number(e.y,s.y,l),z:u.y.number(e.z,s.z,l)}}}let Fn;class mn extends u.E{constructor(e){super(),Fn=Fn||new u.q({anchor:new u.D(u.v.light.anchor),position:new yr,color:new u.D(u.v.light.color),intensity:new u.D(u.v.light.intensity)}),this._transitionable=new u.T(Fn),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,s={}){if(!this._validate(u.r,e,s))for(const l in e){const c=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l){return(!l||l.validate!==!1)&&u.t(this,e.call(u.u,{value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.v}))}}const Vi=new u.q({"sky-color":new u.D(u.v.sky["sky-color"]),"horizon-color":new u.D(u.v.sky["horizon-color"]),"fog-color":new u.D(u.v.sky["fog-color"]),"fog-ground-blend":new u.D(u.v.sky["fog-ground-blend"]),"horizon-fog-blend":new u.D(u.v.sky["horizon-fog-blend"]),"sky-horizon-blend":new u.D(u.v.sky["sky-horizon-blend"]),"atmosphere-blend":new u.D(u.v.sky["atmosphere-blend"])});class Yi extends u.E{constructor(e){super(),this._transitionable=new u.T(Vi),this.setSky(e),this._transitioning=this._transitionable.untransitioned(),this.recalculate(new u.z(0))}setSky(e,s={}){if(!this._validate(u.B,e,s)){e||(e={"sky-color":"transparent","horizon-color":"transparent","fog-color":"transparent","fog-ground-blend":1,"atmosphere-blend":0});for(const l in e){const c=e[l];l.endsWith("-transition")?this._transitionable.setTransition(l.slice(0,-11),c):this._transitionable.setValue(l,c)}}}getSky(){return this._transitionable.serialize()}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,s,l={}){return l?.validate!==!1&&u.t(this,e.call(u.u,u.e({value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.v})))}calculateFogBlendOpacity(e){return e<60?0:e<70?(e-60)/10:1}}class xs{constructor(e,s){this.width=e,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(e,s){const l=e.join(",")+String(s);return this.dashEntry[l]||(this.dashEntry[l]=this.addDash(e,s)),this.dashEntry[l]}getDashRanges(e,s,l){const c=[];let m=e.length%2==1?-e[e.length-1]*l:0,b=e[0]*l,C=!0;c.push({left:m,right:b,isDash:C,zeroLength:e[0]===0});let I=e[0];for(let P=1;P<e.length;P++){C=!C;const k=e[P];m=I*l,I+=k,b=I*l,c.push({left:m,right:b,isDash:C,zeroLength:k===0})}return c}addRoundDash(e,s,l){const c=s/2;for(let m=-l;m<=l;m++){const b=this.width*(this.nextRow+l+m);let C=0,I=e[C];for(let P=0;P<this.width;P++){P/I.right>1&&(I=e[++C]);const k=Math.abs(P-I.left),A=Math.abs(P-I.right),B=Math.min(k,A);let $;const H=m/l*(c+1);if(I.isDash){const Y=c-Math.abs(H);$=Math.sqrt(B*B+Y*Y)}else $=c-Math.sqrt(B*B+H*H);this.data[b+P]=Math.max(0,Math.min(255,$+128))}}}addRegularDash(e){for(let C=e.length-1;C>=0;--C){const I=e[C],P=e[C+1];I.zeroLength?e.splice(C,1):P&&P.isDash===I.isDash&&(P.left=I.left,e.splice(C,1))}const s=e[0],l=e[e.length-1];s.isDash===l.isDash&&(s.left=l.left-this.width,l.right=s.right+this.width);const c=this.width*this.nextRow;let m=0,b=e[m];for(let C=0;C<this.width;C++){C/b.right>1&&(b=e[++m]);const I=Math.abs(C-b.left),P=Math.abs(C-b.right),k=Math.min(I,P);this.data[c+C]=Math.max(0,Math.min(255,(b.isDash?k:-k)+128))}}addDash(e,s){const l=s?7:0,c=2*l+1;if(this.nextRow+c>this.height)return u.w("LineAtlas out of space"),null;let m=0;for(let C=0;C<e.length;C++)m+=e[C];if(m!==0){const C=this.width/m,I=this.getDashRanges(e,this.width,C);s?this.addRoundDash(I,C,l):this.addRegularDash(I)}const b={y:(this.nextRow+l+.5)/this.height,height:2*l/this.height,width:m};return this.nextRow+=c,this.dirty=!0,b}bind(e){const s=e.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}const Mr="maplibre_preloaded_worker_pool";class sr{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<sr.workerCount;)this.workers.push(new Worker(u.a.WORKER_URL));return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Mr]}numActive(){return Object.keys(this.active).length}}const bs=Math.floor(q.hardwareConcurrency/2);let fn,On;function Wr(){return fn||(fn=new sr),fn}sr.workerCount=u.C(globalThis)?Math.max(Math.min(bs,3),1):1;class Zr{constructor(e,s){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=s;const l=this.workerPool.acquire(s);for(let c=0;c<l.length;c++){const m=new u.F(l[c],s);m.name=`Worker ${c}`,this.actors.push(m)}if(!this.actors.length)throw new Error("No actors found")}broadcast(e,s){const l=[];for(const c of this.actors)l.push(c.sendAsync({type:e,data:s}));return Promise.all(l)}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(e=!0){this.actors.forEach(s=>{s.remove()}),this.actors=[],e&&this.workerPool.release(this.id)}registerMessageHandler(e,s){for(const l of this.actors)l.registerMessageHandler(e,s)}}function bo(){return On||(On=new Zr(Wr(),u.G),On.registerMessageHandler("GR",(f,e,s)=>u.m(e,s))),On}function vr(f,e){const s=u.H();return u.J(s,s,[1,1,0]),u.K(s,s,[.5*f.width,.5*f.height,1]),u.L(s,s,f.calculatePosMatrix(e.toUnwrapped()))}function kr(f,e,s,l,c,m){const b=function(A,B,$){if(A)for(const H of A){const Y=B[H];if(Y&&Y.source===$&&Y.type==="fill-extrusion")return!0}else for(const H in B){const Y=B[H];if(Y.source===$&&Y.type==="fill-extrusion")return!0}return!1}(c&&c.layers,e,f.id),C=m.maxPitchScaleFactor(),I=f.tilesIn(l,C,b);I.sort(Ar);const P=[];for(const A of I)P.push({wrappedTileID:A.tileID.wrapped().key,queryResults:A.tile.queryRenderedFeatures(e,s,f._state,A.queryGeometry,A.cameraQueryGeometry,A.scale,c,m,C,vr(f.transform,A.tileID))});const k=function(A){const B={},$={};for(const H of A){const Y=H.queryResults,Q=H.wrappedTileID,ee=$[Q]=$[Q]||{};for(const ne in Y){const Z=Y[ne],ae=ee[ne]=ee[ne]||{},ce=B[ne]=B[ne]||[];for(const me of Z)ae[me.featureIndex]||(ae[me.featureIndex]=!0,ce.push(me))}}return B}(P);for(const A in k)k[A].forEach(B=>{const $=B.feature,H=f.getFeatureState($.layer["source-layer"],$.id);$.source=$.layer.source,$.layer["source-layer"]&&($.sourceLayer=$.layer["source-layer"]),$.state=H});return k}function Ar(f,e){const s=f.tileID,l=e.tileID;return s.overscaledZ-l.overscaledZ||s.canonical.y-l.canonical.y||s.wrap-l.wrap||s.canonical.x-l.canonical.x}function ws(f,e,s){return u._(this,void 0,void 0,function*(){let l=f;if(f.url?l=(yield u.h(e.transformRequest(f.url,"Source"),s)).data:yield q.frameAsync(s),!l)return null;const c=u.M(u.e(l,f),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);return"vector_layers"in l&&l.vector_layers&&(c.vectorLayerIds=l.vector_layers.map(m=>m.id)),c})}class ge{constructor(e,s){e&&(s?this.setSouthWest(e).setNorthEast(s):Array.isArray(e)&&(e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1])))}setNorthEast(e){return this._ne=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}setSouthWest(e){return this._sw=e instanceof u.N?new u.N(e.lng,e.lat):u.N.convert(e),this}extend(e){const s=this._sw,l=this._ne;let c,m;if(e instanceof u.N)c=e,m=e;else{if(!(e instanceof ge))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ge.convert(e)):this.extend(u.N.convert(e)):e&&("lng"in e||"lon"in e)&&"lat"in e?this.extend(u.N.convert(e)):this;if(c=e._sw,m=e._ne,!c||!m)return this}return s||l?(s.lng=Math.min(c.lng,s.lng),s.lat=Math.min(c.lat,s.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new u.N(c.lng,c.lat),this._ne=new u.N(m.lng,m.lat)),this}getCenter(){return new u.N((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.N(this.getWest(),this.getNorth())}getSouthEast(){return new u.N(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:s,lat:l}=u.N.convert(e);let c=this._sw.lng<=s&&s<=this._ne.lng;return this._sw.lng>this._ne.lng&&(c=this._sw.lng>=s&&s>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&c}static convert(e){return e instanceof ge?e:e&&new ge(e)}static fromLngLat(e,s=0){const l=360*s/40075017,c=l/Math.cos(Math.PI/180*e.lat);return new ge(new u.N(e.lng-c,e.lat-l),new u.N(e.lng+c,e.lat+l))}adjustAntiMeridian(){const e=new u.N(this._sw.lng,this._sw.lat),s=new u.N(this._ne.lng,this._ne.lat);return new ge(e,e.lng>s.lng?new u.N(s.lng+360,s.lat):s)}}class Gr{constructor(e,s,l){this.bounds=ge.convert(this.validateBounds(e)),this.minzoom=s||0,this.maxzoom=l||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){const s=Math.pow(2,e.z),l=Math.floor(u.O(this.bounds.getWest())*s),c=Math.floor(u.Q(this.bounds.getNorth())*s),m=Math.ceil(u.O(this.bounds.getEast())*s),b=Math.ceil(u.Q(this.bounds.getSouth())*s);return e.x>=l&&e.x<m&&e.y>=c&&e.y<b}}class wo extends u.E{constructor(e,s,l,c){if(super(),this.id=e,this.dispatcher=l,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.e(this,u.M(s,["url","scheme","tileSize","promoteId"])),this._options=u.e({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(c)}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ws(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),e&&(u.e(this,e),e.bounds&&(this.tileBounds=new Gr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}setSourceProperty(e){this._tileJSONRequest&&this._tileJSONRequest.abort(),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}serialize(){return u.e({},this._options)}loadTile(e){return u._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l={request:this.map._requestManager.transformRequest(s,"Tile"),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};l.request.collectResourceTiming=this._collectResourceTiming;let c="RT";if(e.actor&&e.state!=="expired"){if(e.state==="loading")return new Promise((m,b)=>{e.reloadPromise={resolve:m,reject:b}})}else e.actor=this.dispatcher.getActor(),c="LT";e.abortController=new AbortController;try{const m=yield e.actor.sendAsync({type:c,data:l},e.abortController);if(delete e.abortController,e.aborted)return;this._afterTileLoadWorkerResponse(e,m)}catch(m){if(delete e.abortController,e.aborted)return;if(m&&m.status!==404)throw m;this._afterTileLoadWorkerResponse(e,null)}})}_afterTileLoadWorkerResponse(e,s){if(s&&s.resourceTiming&&(e.resourceTiming=s.resourceTiming),s&&this.map._refreshExpiredTiles&&e.setExpiryData(s),e.loadVectorData(s,this.map.painter),e.reloadPromise){const l=e.reloadPromise;e.reloadPromise=null,this.loadTile(e).then(l.resolve).catch(l.reject)}}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.actor&&(yield e.actor.sendAsync({type:"AT",data:{uid:e.uid,type:this.type,source:this.id}}))})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),e.actor&&(yield e.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}}))})}hasTransition(){return!1}}class At extends u.E{constructor(e,s,l,c){super(),this.id=e,this.dispatcher=l,this.setEventedParent(c),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.e({type:"raster"},s),u.e(this,u.M(s,["url","scheme","tileSize"]))}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this._tileJSONRequest=new AbortController;try{const e=yield ws(this._options,this.map._requestManager,this._tileJSONRequest);this._tileJSONRequest=null,this._loaded=!0,e&&(u.e(this,e),e.bounds&&(this.tileBounds=new Gr(e.bounds,this.minzoom,this.maxzoom)),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})))}catch(e){this._tileJSONRequest=null,this.fire(new u.j(e))}})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null)}setSourceProperty(e){this._tileJSONRequest&&(this._tileJSONRequest.abort(),this._tileJSONRequest=null),e(),this.load()}setTiles(e){return this.setSourceProperty(()=>{this._options.tiles=e}),this}setUrl(e){return this.setSourceProperty(()=>{this.url=e,this._options.url=e}),this}serialize(){return u.e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e){return u._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);e.abortController=new AbortController;try{const l=yield st.getImage(this.map._requestManager.transformRequest(s,"Tile"),e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(l&&l.data){this.map._refreshExpiredTiles&&l.cacheControl&&l.expires&&e.setExpiryData({cacheControl:l.cacheControl,expires:l.expires});const c=this.map.painter.context,m=c.gl,b=l.data;e.texture=this.map.painter.getTileTexture(b.width),e.texture?e.texture.update(b,{useMipmap:!0}):(e.texture=new tt(c,b,m.RGBA,{useMipmap:!0}),e.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE,m.LINEAR_MIPMAP_NEAREST)),e.state="loaded"}}catch(l){if(delete e.abortController,e.aborted)e.state="unloaded";else if(l)throw e.state="errored",l}})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController)})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.texture&&this.map.painter.saveTileTexture(e.texture)})}hasTransition(){return!1}}class ci extends At{constructor(e,s,l,c){super(e,s,l,c),this.type="raster-dem",this.maxzoom=22,this._options=u.e({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox",this.redFactor=s.redFactor,this.greenFactor=s.greenFactor,this.blueFactor=s.blueFactor,this.baseShift=s.baseShift}loadTile(e){return u._(this,void 0,void 0,function*(){const s=e.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),l=this.map._requestManager.transformRequest(s,"Tile");e.neighboringTiles=this._getNeighboringTiles(e.tileID),e.abortController=new AbortController;try{const c=yield st.getImage(l,e.abortController,this.map._refreshExpiredTiles);if(delete e.abortController,e.aborted)return void(e.state="unloaded");if(c&&c.data){const m=c.data;this.map._refreshExpiredTiles&&c.cacheControl&&c.expires&&e.setExpiryData({cacheControl:c.cacheControl,expires:c.expires});const b=u.b(m)&&u.U()?m:yield this.readImageNow(m),C={type:this.type,uid:e.uid,source:this.id,rawImageData:b,encoding:this.encoding,redFactor:this.redFactor,greenFactor:this.greenFactor,blueFactor:this.blueFactor,baseShift:this.baseShift};if(!e.actor||e.state==="expired"){e.actor=this.dispatcher.getActor();const I=yield e.actor.sendAsync({type:"LDT",data:C});e.dem=I,e.needsHillshadePrepare=!0,e.needsTerrainPrepare=!0,e.state="loaded"}}}catch(c){if(delete e.abortController,e.aborted)e.state="unloaded";else if(c)throw e.state="errored",c}})}readImageNow(e){return u._(this,void 0,void 0,function*(){if(typeof VideoFrame<"u"&&u.V()){const s=e.width+2,l=e.height+2;try{return new u.R({width:s,height:l},yield u.W(e,-1,-1,s,l))}catch{}}return q.getImageData(e,1)})}_getNeighboringTiles(e){const s=e.canonical,l=Math.pow(2,s.z),c=(s.x-1+l)%l,m=s.x===0?e.wrap-1:e.wrap,b=(s.x+1+l)%l,C=s.x+1===l?e.wrap+1:e.wrap,I={};return I[new u.S(e.overscaledZ,m,s.z,c,s.y).key]={backfilled:!1},I[new u.S(e.overscaledZ,C,s.z,b,s.y).key]={backfilled:!1},s.y>0&&(I[new u.S(e.overscaledZ,m,s.z,c,s.y-1).key]={backfilled:!1},I[new u.S(e.overscaledZ,e.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},I[new u.S(e.overscaledZ,C,s.z,b,s.y-1).key]={backfilled:!1}),s.y+1<l&&(I[new u.S(e.overscaledZ,m,s.z,c,s.y+1).key]={backfilled:!1},I[new u.S(e.overscaledZ,e.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},I[new u.S(e.overscaledZ,C,s.z,b,s.y+1).key]={backfilled:!1}),I}unloadTile(e){return u._(this,void 0,void 0,function*(){e.demTexture&&this.map.painter.saveTileTexture(e.demTexture),e.fbo&&(e.fbo.destroy(),delete e.fbo),e.dem&&delete e.dem,delete e.neighboringTiles,e.state="unloaded",e.actor&&(yield e.actor.sendAsync({type:"RDT",data:{type:this.type,uid:e.uid,source:this.id}}))})}}class Co extends u.E{constructor(e,s,l,c){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=l.getActor(),this.setEventedParent(c),this._data=s.data,this._options=u.e({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const m=u.X/this.tileSize;s.clusterMaxZoom!==void 0&&this.maxzoom<=s.clusterMaxZoom&&u.w(`The maxzoom value "${this.maxzoom}" is expected to be greater than the clusterMaxZoom value "${s.clusterMaxZoom}".`),this.workerOptions=u.e({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*m,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*m,extent:u.X,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:u.X,radius:(s.clusterRadius||50)*m,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){return u._(this,void 0,void 0,function*(){yield this._updateWorkerData()})}onAdd(e){this.map=e,this.load()}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(e){return this._updateWorkerData(e),this}getData(){return u._(this,void 0,void 0,function*(){const e=u.e({type:this.type},this.workerOptions);return this.actor.sendAsync({type:"GD",data:e})})}setClusterOptions(e){return this.workerOptions.cluster=e.cluster,e&&(e.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=e.clusterRadius),e.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=e.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(e){return this.actor.sendAsync({type:"GCEZ",data:{type:this.type,clusterId:e,source:this.id}})}getClusterChildren(e){return this.actor.sendAsync({type:"GCC",data:{type:this.type,clusterId:e,source:this.id}})}getClusterLeaves(e,s,l){return this.actor.sendAsync({type:"GCL",data:{type:this.type,source:this.id,clusterId:e,limit:s,offset:l}})}_updateWorkerData(e){return u._(this,void 0,void 0,function*(){const s=u.e({type:this.type},this.workerOptions);e?s.dataDiff=e:typeof this._data=="string"?(s.request=this.map._requestManager.transformRequest(q.resolveURL(this._data),"Source"),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.k("dataloading",{dataType:"source"}));try{const l=yield this.actor.sendAsync({type:"LD",data:s});if(this._pendingLoads--,this._removed||l.abandoned)return void this.fire(new u.k("dataabort",{dataType:"source"}));let c=null;l.resourceTiming&&l.resourceTiming[this.id]&&(c=l.resourceTiming[this.id].slice(0));const m={dataType:"source"};this._collectResourceTiming&&c&&c.length>0&&u.e(m,{resourceTiming:c}),this.fire(new u.k("data",Object.assign(Object.assign({},m),{sourceDataType:"metadata"}))),this.fire(new u.k("data",Object.assign(Object.assign({},m),{sourceDataType:"content"})))}catch(l){if(this._pendingLoads--,this._removed)return void this.fire(new u.k("dataabort",{dataType:"source"}));this.fire(new u.j(l))}})}loaded(){return this._pendingLoads===0}loadTile(e){return u._(this,void 0,void 0,function*(){const s=e.actor?"RT":"LT";e.actor=this.actor;const l={type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};e.abortController=new AbortController;const c=yield this.actor.sendAsync({type:s,data:l},e.abortController);delete e.abortController,e.unloadVectorData(),e.aborted||e.loadVectorData(c,this.map.painter,s==="RT")})}abortTile(e){return u._(this,void 0,void 0,function*(){e.abortController&&(e.abortController.abort(),delete e.abortController),e.aborted=!0})}unloadTile(e){return u._(this,void 0,void 0,function*(){e.unloadVectorData(),yield this.actor.sendAsync({type:"RMT",data:{uid:e.uid,type:this.type,source:this.id}})})}onRemove(){this._removed=!0,this.actor.sendAsync({type:"RS",data:{type:this.type,source:this.id}})}serialize(){return u.e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var zr=u.Y([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class xr extends u.E{constructor(e,s,l,c){super(),this.id=e,this.dispatcher=l,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(c),this.options=s}load(e){return u._(this,void 0,void 0,function*(){this._loaded=!1,this.fire(new u.k("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=new AbortController;try{const s=yield st.getImage(this.map._requestManager.transformRequest(this.url,"Image"),this._request);this._request=null,this._loaded=!0,s&&s.data&&(this.image=s.data,e&&(this.coordinates=e),this._finishLoading())}catch(s){this._request=null,this._loaded=!0,this.fire(new u.j(s))}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._request&&(this._request.abort(),this._request=null),this.options.url=e.url,this.load(e.coordinates).finally(()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.k("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._request&&(this._request.abort(),this._request=null)}setCoordinates(e){this.coordinates=e;const s=e.map(u.Z.fromLngLat);this.tileID=function(c){let m=1/0,b=1/0,C=-1/0,I=-1/0;for(const B of c)m=Math.min(m,B.x),b=Math.min(b,B.y),C=Math.max(C,B.x),I=Math.max(I,B.y);const P=Math.max(C-m,I-b),k=Math.max(0,Math.floor(-Math.log(P)/Math.LN2)),A=Math.pow(2,k);return new u.a1(k,Math.floor((m+C)/2*A),Math.floor((b+I)/2*A))}(s),this.minzoom=this.maxzoom=this.tileID.z;const l=s.map(c=>this.tileID.getTilePoint(c)._round());return this._boundsArray=new u.$,this._boundsArray.emplaceBack(l[0].x,l[0].y,0,0),this._boundsArray.emplaceBack(l[1].x,l[1].y,u.X,0),this._boundsArray.emplaceBack(l[3].x,l[3].y,0,u.X),this._boundsArray.emplaceBack(l[2].x,l[2].y,u.X,u.X),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.k("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,zr.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture||(this.texture=new tt(e,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(e){return u._(this,void 0,void 0,function*(){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={}):e.state="errored"})}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class Cs extends xr{constructor(e,s,l,c){super(e,s,l,c),this.roundZoom=!0,this.type="video",this.options=s}load(){return u._(this,void 0,void 0,function*(){this._loaded=!1;const e=this.options;this.urls=[];for(const s of e.urls)this.urls.push(this.map._requestManager.transformRequest(s,"Source").url);try{const s=yield u.a3(this.urls);if(this._loaded=!0,!s)return;this.video=s,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading()}catch(s){this.fire(new u.j(s))}})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const s=this.video.seekable;e<s.start(0)||e>s.end(0)?this.fire(new u.j(new u.a2(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const e=this.map.painter.context,s=e.gl;this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,zr.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new tt(e,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));let l=!1;for(const c in this.tiles){const m=this.tiles[c];m.state!=="loaded"&&(m.state="loaded",m.texture=this.texture,l=!0)}l&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class In extends xr{constructor(e,s,l,c){super(e,s,l,c),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(m=>!Array.isArray(m)||m.length!==2||m.some(b=>typeof b!="number"))||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new u.j(new u.a2(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new u.j(new u.a2(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.j(new u.a2(`sources.${e}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){return u._(this,void 0,void 0,function*(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.j(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())})}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,l=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,zr.members)),this.boundsSegments||(this.boundsSegments=u.a0.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new tt(s,this.canvas,l.RGBA,{premultiply:!0});let c=!1;for(const m in this.tiles){const b=this.tiles[m];b.state!=="loaded"&&(b.state="loaded",b.texture=this.texture,c=!0)}c&&this.fire(new u.k("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}}const So={},Io=f=>{switch(f){case"geojson":return Co;case"image":return xr;case"raster":return At;case"raster-dem":return ci;case"vector":return wo;case"video":return Cs;case"canvas":return In}return So[f]},Ee="RTLPluginLoaded";class or extends u.E{constructor(){super(...arguments),this.status="unavailable",this.url=null,this.dispatcher=bo()}_syncState(e){return this.status=e,this.dispatcher.broadcast("SRPS",{pluginStatus:e,pluginURL:this.url}).catch(s=>{throw this.status="error",s})}getRTLTextPluginStatus(){return this.status}clearRTLTextPlugin(){this.status="unavailable",this.url=null}setRTLTextPlugin(e){return u._(this,arguments,void 0,function*(s,l=!1){if(this.url)throw new Error("setRTLTextPlugin cannot be called multiple times.");if(this.url=q.resolveURL(s),!this.url)throw new Error(`requested url ${s} is invalid`);if(this.status==="unavailable"){if(!l)return this._requestImport();this.status="deferred",this._syncState(this.status)}else if(this.status==="requested")return this._requestImport()})}_requestImport(){return u._(this,void 0,void 0,function*(){yield this._syncState("loading"),this.status="loaded",this.fire(new u.k(Ee))})}lazyLoad(){this.status==="unavailable"?this.status="requested":this.status==="deferred"&&this._requestImport()}}let Ki=null;function ar(){return Ki||(Ki=new or),Ki}class Dr{constructor(e,s){this.timeAdded=0,this.fadeEndTime=0,this.tileID=e,this.uid=u.a4(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(e){const s=e+this.timeAdded;s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(e){this.demTexture&&e.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(e,s,l){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(c,m){const b={};if(!m)return b;for(const C of c){const I=C.layerIds.map(P=>m.getLayer(P)).filter(Boolean);if(I.length!==0){C.layers=I,C.stateDependentLayerIds&&(C.stateDependentLayers=C.stateDependentLayerIds.map(P=>I.filter(k=>k.id===P)[0]));for(const P of I)b[P.id]=C}}return b}(e.buckets,s.style),this.hasSymbolBuckets=!1;for(const c in this.buckets){const m=this.buckets[c];if(m instanceof u.a6){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const c in this.buckets){const m=this.buckets[c];if(m instanceof u.a6&&m.hasRTLText){this.hasRTLText=!0,ar().lazyLoad();break}}this.queryPadding=0;for(const c in this.buckets){const m=this.buckets[c];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(c).queryRadius(m))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage)}else this.collisionBoxArray=new u.a5}unloadVectorData(){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(e){return this.buckets[e.id]}upload(e){for(const l in this.buckets){const c=this.buckets[l];c.uploadPending()&&c.upload(e)}const s=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new tt(e,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new tt(e,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,s,l,c,m,b,C,I,P,k){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:c,cameraQueryGeometry:m,scale:b,tileSize:this.tileSize,pixelPosMatrix:k,transform:I,params:C,queryPadding:this.queryPadding*P},e,s,l):{}}querySourceFeatures(e,s){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const c=l.loadVTLayers(),m=s&&s.sourceLayer?s.sourceLayer:"",b=c._geojsonTileLayer||c[m];if(!b)return;const C=u.a7(s&&s.filter),{z:I,x:P,y:k}=this.tileID.canonical,A={z:I,x:P,y:k};for(let B=0;B<b.length;B++){const $=b.feature(B);if(C.needGeometry){const Q=u.a8($,!0);if(!C.filter(new u.z(this.tileID.overscaledZ),Q,this.tileID.canonical))continue}else if(!C.filter(new u.z(this.tileID.overscaledZ),$))continue;const H=l.getId($,m),Y=new u.a9($,I,P,k,H);Y.tile=A,e.push(Y)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const s=this.expirationTime;if(e.cacheControl){const l=u.aa(e.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const l=Date.now();let c=!1;if(this.expirationTime>l)c=!1;else if(s)if(this.expirationTime<s)c=!0;else{const m=this.expirationTime-s;m?this.expirationTime=l+Math.max(m,3e4):c=!0}else c=!0;c?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(e).length===0)return;const l=this.latestFeatureIndex.loadVTLayers();for(const c in this.buckets){if(!s.style.hasLayer(c))continue;const m=this.buckets[c],b=m.layers[0].sourceLayer||"_geojsonTileLayer",C=l[b],I=e[b];if(!C||!I||Object.keys(I).length===0)continue;m.update(I,C,this.imageAtlas&&this.imageAtlas.patternPositions||{});const P=s&&s.style&&s.style.getLayer(c);P&&(this.queryPadding=Math.max(this.queryPadding,P.queryRadius(m)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=q.now()+e}setDependencies(e,s){const l={};for(const c of s)l[c]=!0;this.dependencies[e]=l}hasDependency(e,s){for(const l of e){const c=this.dependencies[l];if(c){for(const m of s)if(c[m])return!0}}return!1}}class Ae{constructor(e,s){this.max=e,this.onRemove=s,this.reset()}reset(){for(const e in this.data)for(const s of this.data[e])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(e,s,l){const c=e.wrapped().key;this.data[c]===void 0&&(this.data[c]=[]);const m={value:s,timeout:void 0};if(l!==void 0&&(m.timeout=setTimeout(()=>{this.remove(e,m)},l)),this.data[c].push(m),this.order.push(c),this.order.length>this.max){const b=this._getAndRemoveByKey(this.order[0]);b&&this.onRemove(b)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const s=this.data[e].shift();return s.timeout&&clearTimeout(s.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),s.value}getByKey(e){const s=this.data[e];return s?s[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,s){if(!this.has(e))return this;const l=e.wrapped().key,c=s===void 0?0:this.data[l].indexOf(s),m=this.data[l][c];return this.data[l].splice(c,1),m.timeout&&clearTimeout(m.timeout),this.data[l].length===0&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(e){const s=[];for(const l in this.data)for(const c of this.data[l])e(c.value)||s.push(c);for(const l of s)this.remove(l.value.tileID,l)}}class ft{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,s,l){const c=String(s);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][c]=this.stateChanges[e][c]||{},u.e(this.stateChanges[e][c],l),this.deletedStates[e]===null){this.deletedStates[e]={};for(const m in this.state[e])m!==c&&(this.deletedStates[e][m]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][c]===null){this.deletedStates[e][c]={};for(const m in this.state[e][c])l[m]||(this.deletedStates[e][c][m]=null)}else for(const m in l)this.deletedStates[e]&&this.deletedStates[e][c]&&this.deletedStates[e][c][m]===null&&delete this.deletedStates[e][c][m]}removeFeatureState(e,s,l){if(this.deletedStates[e]===null)return;const c=String(s);if(this.deletedStates[e]=this.deletedStates[e]||{},l&&s!==void 0)this.deletedStates[e][c]!==null&&(this.deletedStates[e][c]=this.deletedStates[e][c]||{},this.deletedStates[e][c][l]=null);else if(s!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][c])for(l in this.deletedStates[e][c]={},this.stateChanges[e][c])this.deletedStates[e][c][l]=null;else this.deletedStates[e][c]=null;else this.deletedStates[e]=null}getState(e,s){const l=String(s),c=u.e({},(this.state[e]||{})[l],(this.stateChanges[e]||{})[l]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){const m=this.deletedStates[e][s];if(m===null)return{};for(const b in m)delete c[b]}return c}initializeTileState(e,s){e.setFeatureState(this.state,s)}coalesceChanges(e,s){const l={};for(const c in this.stateChanges){this.state[c]=this.state[c]||{};const m={};for(const b in this.stateChanges[c])this.state[c][b]||(this.state[c][b]={}),u.e(this.state[c][b],this.stateChanges[c][b]),m[b]=this.state[c][b];l[c]=m}for(const c in this.deletedStates){this.state[c]=this.state[c]||{};const m={};if(this.deletedStates[c]===null)for(const b in this.state[c])m[b]={},this.state[c][b]={};else for(const b in this.deletedStates[c]){if(this.deletedStates[c][b]===null)this.state[c][b]={};else for(const C of Object.keys(this.deletedStates[c][b]))delete this.state[c][b][C];m[b]=this.state[c][b]}l[c]=l[c]||{},u.e(l[c],m)}if(this.stateChanges={},this.deletedStates={},Object.keys(l).length!==0)for(const c in e)e[c].setFeatureState(l,s)}}class ot extends u.E{constructor(e,s,l){super(),this.id=e,this.dispatcher=l,this.on("data",c=>this._dataHandler(c)),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=((c,m,b,C)=>{const I=new(Io(m.type))(c,m,b,C);if(I.id!==c)throw new Error(`Expected Source id to be ${c} instead of ${I.id}`);return I})(e,s,l,this),this._tiles={},this._cache=new Ae(0,c=>this._unloadTile(c)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new ft,this._didEmitContent=!1,this._updated=!1}onAdd(e){this.map=e,this._maxTileCacheSize=e?e._maxTileCacheSize:null,this._maxTileCacheZoomLevels=e?e._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(e)}onRemove(e){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(e)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const e in this._tiles){const s=this._tiles[e];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(e,s,l){return u._(this,void 0,void 0,function*(){try{yield this._source.loadTile(e),this._tileLoaded(e,s,l)}catch(c){e.state="errored",c.status!==404?this._source.fire(new u.j(c,{tile:e})):this.update(this.transform,this.terrain)}})}_unloadTile(e){this._source.unloadTile&&this._source.unloadTile(e)}_abortTile(e){this._source.abortTile&&this._source.abortTile(e),this._source.fire(new u.k("dataabort",{tile:e,coord:e.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const l=this._tiles[s];l.upload(e),l.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(rn).map(e=>e.key)}getRenderableIds(e){const s=[];for(const l in this._tiles)this._isIdRenderable(l,e)&&s.push(this._tiles[l]);return e?s.sort((l,c)=>{const m=l.tileID,b=c.tileID,C=new u.P(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),I=new u.P(b.canonical.x,b.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-b.overscaledZ||I.y-C.y||I.x-C.x}).map(l=>l.tileID.key):s.map(l=>l.tileID).sort(rn).map(l=>l.key)}hasRenderableParent(e){const s=this.findLoadedParent(e,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(e,s){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(s||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(e,"reloading")}}_reloadTile(e,s){return u._(this,void 0,void 0,function*(){const l=this._tiles[e];l&&(l.state!=="loading"&&(l.state=s),yield this._loadTile(l,e,s))})}_tileLoaded(e,s,l){e.timeAdded=q.now(),l==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(s,e),this.getSource().type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),e.aborted||this._source.fire(new u.k("data",{dataType:"source",tile:e,coord:e.tileID}))}_backfillDEM(e){const s=this.getRenderableIds();for(let c=0;c<s.length;c++){const m=s[c];if(e.neighboringTiles&&e.neighboringTiles[m]){const b=this.getTileByID(m);l(e,b),l(b,e)}}function l(c,m){c.needsHillshadePrepare=!0,c.needsTerrainPrepare=!0;let b=m.tileID.canonical.x-c.tileID.canonical.x;const C=m.tileID.canonical.y-c.tileID.canonical.y,I=Math.pow(2,c.tileID.canonical.z),P=m.tileID.key;b===0&&C===0||Math.abs(C)>1||(Math.abs(b)>1&&(Math.abs(b+I)===1?b+=I:Math.abs(b-I)===1&&(b-=I)),m.dem&&c.dem&&(c.dem.backfillBorder(m.dem,b,C),c.neighboringTiles&&c.neighboringTiles[P]&&(c.neighboringTiles[P].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,s,l,c){for(const m in this._tiles){let b=this._tiles[m];if(c[m]||!b.hasData()||b.tileID.overscaledZ<=s||b.tileID.overscaledZ>l)continue;let C=b.tileID;for(;b&&b.tileID.overscaledZ>s+1;){const P=b.tileID.scaledTo(b.tileID.overscaledZ-1);b=this._tiles[P.key],b&&b.hasData()&&(C=P)}let I=C;for(;I.overscaledZ>s;)if(I=I.scaledTo(I.overscaledZ-1),e[I.key]){c[C.key]=C;break}}}findLoadedParent(e,s){if(e.key in this._loadedParentTiles){const l=this._loadedParentTiles[e.key];return l&&l.tileID.overscaledZ>=s?l:null}for(let l=e.overscaledZ-1;l>=s;l--){const c=e.scaledTo(l),m=this._getLoadedTile(c);if(m)return m}}findLoadedSibling(e){return this._getLoadedTile(e)}_getLoadedTile(e){const s=this._tiles[e.key];return s&&s.hasData()?s:this._cache.getByKey(e.wrapped().key)}updateCacheSize(e){const s=Math.ceil(e.width/this._source.tileSize)+1,l=Math.ceil(e.height/this._source.tileSize)+1,c=Math.floor(s*l*(this._maxTileCacheZoomLevels===null?u.a.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),m=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,c):c;this._cache.setMaxSize(m)}handleWrapJump(e){const s=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,s){const l={};for(const c in this._tiles){const m=this._tiles[c];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+s),l[m.tileID.key]=m}this._tiles=l;for(const c in this._timers)clearTimeout(this._timers[c]),delete this._timers[c];for(const c in this._tiles)this._setTileReloadTimer(c,this._tiles[c])}}_updateCoveredAndRetainedTiles(e,s,l,c,m,b){const C={},I={},P=Object.keys(e),k=q.now();for(const A of P){const B=e[A],$=this._tiles[A];if(!$||$.fadeEndTime!==0&&$.fadeEndTime<=k)continue;const H=this.findLoadedParent(B,s),Y=this.findLoadedSibling(B),Q=H||Y||null;Q&&(this._addTile(Q.tileID),C[Q.tileID.key]=Q.tileID),I[A]=B}this._retainLoadedChildren(I,c,l,e);for(const A in C)e[A]||(this._coveredTiles[A]=!0,e[A]=C[A]);if(b){const A={},B={};for(const $ of m)this._tiles[$.key].hasData()?A[$.key]=$:B[$.key]=$;for(const $ in B){const H=B[$].children(this._source.maxzoom);this._tiles[H[0].key]&&this._tiles[H[1].key]&&this._tiles[H[2].key]&&this._tiles[H[3].key]&&(A[H[0].key]=e[H[0].key]=H[0],A[H[1].key]=e[H[1].key]=H[1],A[H[2].key]=e[H[2].key]=H[2],A[H[3].key]=e[H[3].key]=H[3],delete B[$])}for(const $ in B){const H=B[$],Y=this.findLoadedParent(H,this._source.minzoom),Q=this.findLoadedSibling(H),ee=Y||Q||null;if(ee){A[ee.tileID.key]=e[ee.tileID.key]=ee.tileID;for(const ne in A)A[ne].isChildOf(ee.tileID)&&delete A[ne]}}for(const $ in this._tiles)A[$]||(this._coveredTiles[$]=!0)}}update(e,s){if(!this._sourceLoaded||this._paused)return;let l;this.transform=e,this.terrain=s,this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?l=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new u.S(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(l=e.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(l=l.filter(k=>this._source.hasTile(k)))):l=[];const c=e.coveringZoomLevel(this._source),m=Math.max(c-ot.maxOverzooming,this._source.minzoom),b=Math.max(c+ot.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const A of l)if(A.canonical.z>this._source.minzoom){const B=A.scaledTo(A.canonical.z-1);k[B.key]=B;const $=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));k[$.key]=$}l=l.concat(Object.values(k))}const C=l.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,C&&this.fire(new u.k("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const I=this._updateRetainedTiles(l,c);Nn(this._source.type)&&this._updateCoveredAndRetainedTiles(I,m,b,c,l,s);for(const k in I)this._tiles[k].clearFadeHold();const P=u.ab(this._tiles,I);for(const k of P){const A=this._tiles[k];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache(),this._updateLoadedSiblingTileCache()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(e)}_updateRetainedTiles(e,s){var l;const c={},m={},b=Math.max(s-ot.maxOverzooming,this._source.minzoom),C=Math.max(s+ot.maxUnderzooming,this._source.minzoom),I={};for(const P of e){const k=this._addTile(P);c[P.key]=P,k.hasData()||s<this._source.maxzoom&&(I[P.key]=P)}this._retainLoadedChildren(I,s,C,c);for(const P of e){let k=this._tiles[P.key];if(k.hasData())continue;if(s+1>this._source.maxzoom){const B=P.children(this._source.maxzoom)[0],$=this.getTile(B);if($&&$.hasData()){c[B.key]=B;continue}}else{const B=P.children(this._source.maxzoom);if(c[B[0].key]&&c[B[1].key]&&c[B[2].key]&&c[B[3].key])continue}let A=k.wasRequested();for(let B=P.overscaledZ-1;B>=b;--B){const $=P.scaledTo(B);if(m[$.key])break;if(m[$.key]=!0,k=this.getTile($),!k&&A&&(k=this._addTile($)),k){const H=k.hasData();if((H||!(!((l=this.map)===null||l===void 0)&&l.cancelPendingTileRequestsWhileZooming)||A)&&(c[$.key]=$),A=k.wasRequested(),H)break}}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const s=[];let l,c=this._tiles[e].tileID;for(;c.overscaledZ>0;){if(c.key in this._loadedParentTiles){l=this._loadedParentTiles[c.key];break}s.push(c.key);const m=c.scaledTo(c.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;c=m}for(const m of s)this._loadedParentTiles[m]=l}}_updateLoadedSiblingTileCache(){this._loadedSiblingTiles={};for(const e in this._tiles){const s=this._tiles[e].tileID,l=this._getLoadedTile(s);this._loadedSiblingTiles[s.key]=l}}_addTile(e){let s=this._tiles[e.key];if(s)return s;s=this._cache.getAndRemove(e),s&&(this._setTileReloadTimer(e.key,s),s.tileID=e,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,s)));const l=s;return s||(s=new Dr(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(s,e.key,s.state)),s.uses++,this._tiles[e.key]=s,l||this._source.fire(new u.k("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(e,s){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const l=s.getExpiryTimeout();l&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},l))}_removeTile(e){const s=this._tiles[e];s&&(s.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}_dataHandler(e){const s=e.sourceDataType;e.dataType==="source"&&s==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&e.dataType==="source"&&s==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(e);this._cache.reset()}tilesIn(e,s,l){const c=[],m=this.transform;if(!m)return c;const b=l?m.getCameraQueryGeometry(e):e,C=e.map(H=>m.pointCoordinate(H,this.terrain)),I=b.map(H=>m.pointCoordinate(H,this.terrain)),P=this.getIds();let k=1/0,A=1/0,B=-1/0,$=-1/0;for(const H of I)k=Math.min(k,H.x),A=Math.min(A,H.y),B=Math.max(B,H.x),$=Math.max($,H.y);for(let H=0;H<P.length;H++){const Y=this._tiles[P[H]];if(Y.holdingForFade())continue;const Q=Y.tileID,ee=Math.pow(2,m.zoom-Y.tileID.overscaledZ),ne=s*Y.queryPadding*u.X/Y.tileSize/ee,Z=[Q.getTilePoint(new u.Z(k,A)),Q.getTilePoint(new u.Z(B,$))];if(Z[0].x-ne<u.X&&Z[0].y-ne<u.X&&Z[1].x+ne>=0&&Z[1].y+ne>=0){const ae=C.map(me=>Q.getTilePoint(me)),ce=I.map(me=>Q.getTilePoint(me));c.push({tile:Y,tileID:Q,queryGeometry:ae,cameraQueryGeometry:ce,scale:ee})}}return c}getVisibleCoordinates(e){const s=this.getRenderableIds(e).map(l=>this._tiles[l].tileID);for(const l of s)l.posMatrix=this.transform.calculatePosMatrix(l.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(Nn(this._source.type)){const e=q.now();for(const s in this._tiles)if(this._tiles[s].fadeEndTime>=e)return!0}return!1}setFeatureState(e,s,l){this._state.updateState(e=e||"_geojsonTileLayer",s,l)}removeFeatureState(e,s,l){this._state.removeFeatureState(e=e||"_geojsonTileLayer",s,l)}getFeatureState(e,s){return this._state.getState(e=e||"_geojsonTileLayer",s)}setDependencies(e,s,l){const c=this._tiles[e];c&&c.setDependencies(s,l)}reloadTilesForDependencies(e,s){for(const l in this._tiles)this._tiles[l].hasDependency(e,s)&&this._reloadTile(l,"reloading");this._cache.filter(l=>!l.hasDependency(e,s))}}function rn(f,e){const s=Math.abs(2*f.wrap)-+(f.wrap<0),l=Math.abs(2*e.wrap)-+(e.wrap<0);return f.overscaledZ-e.overscaledZ||l-s||e.canonical.y-f.canonical.y||e.canonical.x-f.canonical.x}function Nn(f){return f==="raster"||f==="image"||f==="video"}ot.maxOverzooming=10,ot.maxUnderzooming=3;class ht{constructor(e,s){this.reset(e,s)}reset(e,s){this.points=e||[],this._distances=[0];for(let l=1;l<this.points.length;l++)this._distances[l]=this._distances[l-1]+this.points[l].dist(this.points[l-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=u.ac(e,0,1);let s=1,l=this._distances[s];const c=e*this.paddedLength+this.padding;for(;l<c&&s<this._distances.length;)l=this._distances[++s];const m=s-1,b=this._distances[m],C=l-b,I=C>0?(c-b)/C:0;return this.points[m].mult(1-I).add(this.points[s].mult(I))}}function lr(f,e){let s=!0;return f==="always"||f!=="never"&&e!=="never"||(s=!1),s}class br{constructor(e,s,l){const c=this.boxCells=[],m=this.circleCells=[];this.xCellCount=Math.ceil(e/l),this.yCellCount=Math.ceil(s/l);for(let b=0;b<this.xCellCount*this.yCellCount;b++)c.push([]),m.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=s,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,s,l,c,m){this._forEachCell(s,l,c,m,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(s),this.bboxes.push(l),this.bboxes.push(c),this.bboxes.push(m)}insertCircle(e,s,l,c){this._forEachCell(s-c,l-c,s+c,l+c,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(s),this.circles.push(l),this.circles.push(c)}_insertBoxCell(e,s,l,c,m,b){this.boxCells[m].push(b)}_insertCircleCell(e,s,l,c,m,b){this.circleCells[m].push(b)}_query(e,s,l,c,m,b,C){if(l<0||e>this.width||c<0||s>this.height)return[];const I=[];if(e<=0&&s<=0&&this.width<=l&&this.height<=c){if(m)return[{key:null,x1:e,y1:s,x2:l,y2:c}];for(let P=0;P<this.boxKeys.length;P++)I.push({key:this.boxKeys[P],x1:this.bboxes[4*P],y1:this.bboxes[4*P+1],x2:this.bboxes[4*P+2],y2:this.bboxes[4*P+3]});for(let P=0;P<this.circleKeys.length;P++){const k=this.circles[3*P],A=this.circles[3*P+1],B=this.circles[3*P+2];I.push({key:this.circleKeys[P],x1:k-B,y1:A-B,x2:k+B,y2:A+B})}}else this._forEachCell(e,s,l,c,this._queryCell,I,{hitTest:m,overlapMode:b,seenUids:{box:{},circle:{}}},C);return I}query(e,s,l,c){return this._query(e,s,l,c,!1,null)}hitTest(e,s,l,c,m,b){return this._query(e,s,l,c,!0,m,b).length>0}hitTestCircle(e,s,l,c,m){const b=e-l,C=e+l,I=s-l,P=s+l;if(C<0||b>this.width||P<0||I>this.height)return!1;const k=[];return this._forEachCell(b,I,C,P,this._queryCellCircle,k,{hitTest:!0,overlapMode:c,circle:{x:e,y:s,radius:l},seenUids:{box:{},circle:{}}},m),k.length>0}_queryCell(e,s,l,c,m,b,C,I){const{seenUids:P,hitTest:k,overlapMode:A}=C,B=this.boxCells[m];if(B!==null){const H=this.bboxes;for(const Y of B)if(!P.box[Y]){P.box[Y]=!0;const Q=4*Y,ee=this.boxKeys[Y];if(e<=H[Q+2]&&s<=H[Q+3]&&l>=H[Q+0]&&c>=H[Q+1]&&(!I||I(ee))&&(!k||!lr(A,ee.overlapMode))&&(b.push({key:ee,x1:H[Q],y1:H[Q+1],x2:H[Q+2],y2:H[Q+3]}),k))return!0}}const $=this.circleCells[m];if($!==null){const H=this.circles;for(const Y of $)if(!P.circle[Y]){P.circle[Y]=!0;const Q=3*Y,ee=this.circleKeys[Y];if(this._circleAndRectCollide(H[Q],H[Q+1],H[Q+2],e,s,l,c)&&(!I||I(ee))&&(!k||!lr(A,ee.overlapMode))){const ne=H[Q],Z=H[Q+1],ae=H[Q+2];if(b.push({key:ee,x1:ne-ae,y1:Z-ae,x2:ne+ae,y2:Z+ae}),k)return!0}}}return!1}_queryCellCircle(e,s,l,c,m,b,C,I){const{circle:P,seenUids:k,overlapMode:A}=C,B=this.boxCells[m];if(B!==null){const H=this.bboxes;for(const Y of B)if(!k.box[Y]){k.box[Y]=!0;const Q=4*Y,ee=this.boxKeys[Y];if(this._circleAndRectCollide(P.x,P.y,P.radius,H[Q+0],H[Q+1],H[Q+2],H[Q+3])&&(!I||I(ee))&&!lr(A,ee.overlapMode))return b.push(!0),!0}}const $=this.circleCells[m];if($!==null){const H=this.circles;for(const Y of $)if(!k.circle[Y]){k.circle[Y]=!0;const Q=3*Y,ee=this.circleKeys[Y];if(this._circlesCollide(H[Q],H[Q+1],H[Q+2],P.x,P.y,P.radius)&&(!I||I(ee))&&!lr(A,ee.overlapMode))return b.push(!0),!0}}}_forEachCell(e,s,l,c,m,b,C,I){const P=this._convertToXCellCoord(e),k=this._convertToYCellCoord(s),A=this._convertToXCellCoord(l),B=this._convertToYCellCoord(c);for(let $=P;$<=A;$++)for(let H=k;H<=B;H++)if(m.call(this,e,s,l,c,this.xCellCount*H+$,b,C,I))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,s,l,c,m,b){const C=c-e,I=m-s,P=l+b;return P*P>C*C+I*I}_circleAndRectCollide(e,s,l,c,m,b,C){const I=(b-c)/2,P=Math.abs(e-(c+I));if(P>I+l)return!1;const k=(C-m)/2,A=Math.abs(s-(m+k));if(A>k+l)return!1;if(P<=I||A<=k)return!0;const B=P-I,$=A-k;return B*B+$*$<=l*l}}function Lr(f,e,s,l,c){const m=u.H();return e?(u.K(m,m,[1/c,1/c,1]),s||u.ad(m,m,l.angle)):u.L(m,l.labelPlaneMatrix,f),m}function cr(f,e,s,l,c){if(e){const m=u.ae(f);return u.K(m,m,[c,c,1]),s||u.ad(m,m,-l.angle),m}return l.glCoordMatrix}function K(f,e,s,l){let c;l?(c=[f,e,l(f,e),1],u.af(c,c,s)):(c=[f,e,0,1],Et(c,c,s));const m=c[3];return{point:new u.P(c[0]/m,c[1]/m),signedDistanceFromCamera:m,isOccluded:!1}}function L(f,e){return .5+f/e*.5}function D(f,e){return f.x>=-e[0]&&f.x<=e[0]&&f.y>=-e[1]&&f.y<=e[1]}function j(f,e,s,l,c,m,b,C,I,P,k,A,B,$,H){const Y=l?f.textSizeData:f.iconSizeData,Q=u.ag(Y,s.transform.zoom),ee=[256/s.width*2+1,256/s.height*2+1],ne=l?f.text.dynamicLayoutVertexArray:f.icon.dynamicLayoutVertexArray;ne.clear();const Z=f.lineVertexArray,ae=l?f.text.placedSymbolArray:f.icon.placedSymbolArray,ce=s.transform.width/s.transform.height;let me=!1;for(let be=0;be<ae.length;be++){const Ie=ae.get(be);if(Ie.hidden||Ie.writingMode===u.ah.vertical&&!me){it(Ie.numGlyphs,ne);continue}me=!1;const Le=K(Ie.anchorX,Ie.anchorY,e,H);if(!D(Le.point,ee)){it(Ie.numGlyphs,ne);continue}const Ne=L(s.transform.cameraToCenterDistance,Le.signedDistanceFromCamera),ke=u.ai(Y,Q,Ie),Me=b?ke/Ne:ke*Ne,Ge={getElevation:H,labelPlaneMatrix:c,lineVertexArray:Z,pitchWithMap:b,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:P,tileAnchorPoint:new u.P(Ie.anchorX,Ie.anchorY),unwrappedTileID:k,width:A,height:B,translation:$},ut=le(Ge,Ie,Me,!1,C,e,m,f.glyphOffsetArray,ne,ce,I);me=ut.useVertical,(ut.notEnoughRoom||me||ut.needsFlipping&&le(Ge,Ie,Me,!0,C,e,m,f.glyphOffsetArray,ne,ce,I).notEnoughRoom)&&it(Ie.numGlyphs,ne)}l?f.text.dynamicLayoutVertexBuffer.updateData(ne):f.icon.dynamicLayoutVertexBuffer.updateData(ne)}function X(f,e,s,l,c,m,b,C){const I=m.glyphStartIndex+m.numGlyphs,P=m.lineStartIndex,k=m.lineStartIndex+m.lineLength,A=e.getoffsetX(m.glyphStartIndex),B=e.getoffsetX(I-1),$=Pe(f*A,s,l,c,m.segment,P,k,C,b);if(!$)return null;const H=Pe(f*B,s,l,c,m.segment,P,k,C,b);return H?C.projectionCache.anyProjectionOccluded?null:{first:$,last:H}:null}function se(f,e,s,l){return f===u.ah.horizontal&&Math.abs(s.y-e.y)>Math.abs(s.x-e.x)*l?{useVertical:!0}:(f===u.ah.vertical?e.y<s.y:e.x>s.x)?{needsFlipping:!0}:null}function le(f,e,s,l,c,m,b,C,I,P,k){const A=s/24,B=e.lineOffsetX*A,$=e.lineOffsetY*A;let H;if(e.numGlyphs>1){const Y=e.glyphStartIndex+e.numGlyphs,Q=e.lineStartIndex,ee=e.lineStartIndex+e.lineLength,ne=X(A,C,B,$,l,e,k,f);if(!ne)return{notEnoughRoom:!0};const Z=K(ne.first.point.x,ne.first.point.y,b,f.getElevation).point,ae=K(ne.last.point.x,ne.last.point.y,b,f.getElevation).point;if(c&&!l){const ce=se(e.writingMode,Z,ae,P);if(ce)return ce}H=[ne.first];for(let ce=e.glyphStartIndex+1;ce<Y-1;ce++)H.push(Pe(A*C.getoffsetX(ce),B,$,l,e.segment,Q,ee,f,k));H.push(ne.last)}else{if(c&&!l){const Q=K(f.tileAnchorPoint.x,f.tileAnchorPoint.y,m,f.getElevation).point,ee=e.lineStartIndex+e.segment+1,ne=new u.P(f.lineVertexArray.getx(ee),f.lineVertexArray.gety(ee)),Z=K(ne.x,ne.y,m,f.getElevation),ae=Z.signedDistanceFromCamera>0?Z.point:function(me,be,Ie,Le,Ne,ke){return he(me,be,Ie,1,Ne,ke)}(f.tileAnchorPoint,ne,Q,0,m,f),ce=se(e.writingMode,Q,ae,P);if(ce)return ce}const Y=Pe(A*C.getoffsetX(e.glyphStartIndex),B,$,l,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,f,k);if(!Y||f.projectionCache.anyProjectionOccluded)return{notEnoughRoom:!0};H=[Y]}for(const Y of H)u.aj(I,Y.point,Y.angle);return{}}function he(f,e,s,l,c,m){const b=f.add(f.sub(e)._unit()),C=c!==void 0?K(b.x,b.y,c,m.getElevation).point:ye(b.x,b.y,m).point,I=s.sub(C);return s.add(I._mult(l/I.mag()))}function te(f,e,s){const l=e.projectionCache;if(l.projections[f])return l.projections[f];const c=new u.P(e.lineVertexArray.getx(f),e.lineVertexArray.gety(f)),m=ye(c.x,c.y,e);if(m.signedDistanceFromCamera>0)return l.projections[f]=m.point,l.anyProjectionOccluded=l.anyProjectionOccluded||m.isOccluded,m.point;const b=f-s.direction;return function(C,I,P,k,A){return he(C,I,P,k,void 0,A)}(s.distanceFromAnchor===0?e.tileAnchorPoint:new u.P(e.lineVertexArray.getx(b),e.lineVertexArray.gety(b)),c,s.previousVertex,s.absOffsetX-s.distanceFromAnchor+1,e)}function ye(f,e,s){const l=f+s.translation[0],c=e+s.translation[1];let m;return!s.pitchWithMap&&s.projection.useSpecialProjectionForSymbols?(m=s.projection.projectTileCoordinates(l,c,s.unwrappedTileID,s.getElevation),m.point.x=(.5*m.point.x+.5)*s.width,m.point.y=(.5*-m.point.y+.5)*s.height):(m=K(l,c,s.labelPlaneMatrix,s.getElevation),m.isOccluded=!1),m}function we(f,e,s){return f._unit()._perp()._mult(e*s)}function fe(f,e,s,l,c,m,b,C,I){if(C.projectionCache.offsets[f])return C.projectionCache.offsets[f];const P=s.add(e);if(f+I.direction<l||f+I.direction>=c)return C.projectionCache.offsets[f]=P,P;const k=te(f+I.direction,C,I),A=we(k.sub(s),b,I.direction),B=s.add(A),$=k.add(A);return C.projectionCache.offsets[f]=u.ak(m,P,B,$)||P,C.projectionCache.offsets[f]}function Pe(f,e,s,l,c,m,b,C,I){const P=l?f-e:f+e;let k=P>0?1:-1,A=0;l&&(k*=-1,A=Math.PI),k<0&&(A+=Math.PI);let B,$=k>0?m+c:m+c+1;C.projectionCache.cachedAnchorPoint?B=C.projectionCache.cachedAnchorPoint:(B=ye(C.tileAnchorPoint.x,C.tileAnchorPoint.y,C).point,C.projectionCache.cachedAnchorPoint=B);let H,Y,Q=B,ee=B,ne=0,Z=0;const ae=Math.abs(P),ce=[];let me;for(;ne+Z<=ae;){if($+=k,$<m||$>=b)return null;ne+=Z,ee=Q,Y=H;const Le={absOffsetX:ae,direction:k,distanceFromAnchor:ne,previousVertex:ee};if(Q=te($,C,Le),s===0)ce.push(ee),me=Q.sub(ee);else{let Ne;const ke=Q.sub(ee);Ne=ke.mag()===0?we(te($+k,C,Le).sub(Q),s,k):we(ke,s,k),Y||(Y=ee.add(Ne)),H=fe($,Ne,Q,m,b,Y,s,C,Le),ce.push(Y),me=H.sub(Y)}Z=me.mag()}const be=me._mult((ae-ne)/Z)._add(Y||ee),Ie=A+Math.atan2(Q.y-ee.y,Q.x-ee.x);return ce.push(be),{point:be,angle:I?Ie:0,path:ce}}const et=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function it(f,e){for(let s=0;s<f;s++){const l=e.length;e.resize(l+4),e.float32.set(et,3*l)}}function Et(f,e,s){const l=e[0],c=e[1];return f[0]=s[0]*l+s[4]*c+s[12],f[1]=s[1]*l+s[5]*c+s[13],f[3]=s[3]*l+s[7]*c+s[15],f}const dt=100;class Pt{constructor(e,s,l=new br(e.width+200,e.height+200,25),c=new br(e.width+200,e.height+200,25)){this.transform=e,this.mapProjection=s,this.grid=l,this.ignoredGrid=c,this.pitchFactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+dt,this.screenBottomBoundary=e.height+dt,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(e,s,l,c,m,b,C,I,P,k,A){const B=e.anchorPointX+I[0],$=e.anchorPointY+I[1],H=this.projectAndGetPerspectiveRatio(c,B,$,m,k),Y=l*H.perspectiveRatio;let Q;if(b||C)Q=this._projectCollisionBox(e,Y,c,m,b,C,I,H,k,A);else{const ce=H.point.x+(A?A.x*Y:0),me=H.point.y+(A?A.y*Y:0);Q={allPointsOccluded:!1,box:[ce+e.x1*Y,me+e.y1*Y,ce+e.x2*Y,me+e.y2*Y]}}const[ee,ne,Z,ae]=Q.box;return this.mapProjection.useSpecialProjectionForSymbols&&(b?Q.allPointsOccluded:this.mapProjection.isOccluded(B,$,m))||H.perspectiveRatio<this.perspectiveRatioCutoff||!this.isInsideGrid(ee,ne,Z,ae)||s!=="always"&&this.grid.hitTest(ee,ne,Z,ae,s,P)?{box:[ee,ne,Z,ae],placeable:!1,offscreen:!1}:{box:[ee,ne,Z,ae],placeable:!0,offscreen:this.isOffscreen(ee,ne,Z,ae)}}placeCollisionCircles(e,s,l,c,m,b,C,I,P,k,A,B,$,H,Y,Q){const ee=[],ne=new u.P(s.anchorX,s.anchorY),Z=this.getPerspectiveRatio(b,ne.x,ne.y,C,Q),ae=(A?m/Z:m*Z)/u.ap,ce={getElevation:Q,labelPlaneMatrix:I,lineVertexArray:l,pitchWithMap:A,projectionCache:{projections:{},offsets:{},cachedAnchorPoint:void 0,anyProjectionOccluded:!1},projection:this.mapProjection,tileAnchorPoint:ne,unwrappedTileID:C,width:this.transform.width,height:this.transform.height,translation:Y},me=X(ae,c,s.lineOffsetX*ae,s.lineOffsetY*ae,!1,s,!1,ce);let be=!1,Ie=!1,Le=!0;if(me){const Ne=.5*$*Z+H,ke=new u.P(-100,-100),Me=new u.P(this.screenRightBoundary,this.screenBottomBoundary),Ge=new ht,ut=me.first,ze=me.last;let Fe=[];for(let pt=ut.path.length-1;pt>=1;pt--)Fe.push(ut.path[pt]);for(let pt=1;pt<ze.path.length;pt++)Fe.push(ze.path[pt]);const at=2.5*Ne;if(P){const pt=this.projectPathToScreenSpace(Fe,ce,P);Fe=pt.some(xt=>xt.signedDistanceFromCamera<=0)?[]:pt.map(xt=>xt.point)}let ti=[];if(Fe.length>0){const pt=Fe[0].clone(),xt=Fe[0].clone();for(let ii=1;ii<Fe.length;ii++)pt.x=Math.min(pt.x,Fe[ii].x),pt.y=Math.min(pt.y,Fe[ii].y),xt.x=Math.max(xt.x,Fe[ii].x),xt.y=Math.max(xt.y,Fe[ii].y);ti=pt.x>=ke.x&&xt.x<=Me.x&&pt.y>=ke.y&&xt.y<=Me.y?[Fe]:xt.x<ke.x||pt.x>Me.x||xt.y<ke.y||pt.y>Me.y?[]:u.al([Fe],ke.x,ke.y,Me.x,Me.y)}for(const pt of ti){Ge.reset(pt,.25*Ne);let xt=0;xt=Ge.length<=.5*Ne?1:Math.ceil(Ge.paddedLength/at)+1;for(let ii=0;ii<xt;ii++){const $i=ii/Math.max(xt-1,1),Hn=Ge.lerp($i),ni=Hn.x+dt,an=Hn.y+dt;ee.push(ni,an,Ne,0);const Qi=ni-Ne,ji=an-Ne,en=ni+Ne,pr=an+Ne;if(Le=Le&&this.isOffscreen(Qi,ji,en,pr),Ie=Ie||this.isInsideGrid(Qi,ji,en,pr),e!=="always"&&this.grid.hitTestCircle(ni,an,Ne,e,B)&&(be=!0,!k))return{circles:[],offscreen:!1,collisionDetected:be}}}}return{circles:!k&&be||!Ie||Z<this.perspectiveRatioCutoff?[]:ee,offscreen:Le,collisionDetected:be}}projectPathToScreenSpace(e,s,l){return e.map(c=>K(c.x,c.y,l,s.getElevation))}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let l=1/0,c=1/0,m=-1/0,b=-1/0;for(const k of e){const A=new u.P(k.x+dt,k.y+dt);l=Math.min(l,A.x),c=Math.min(c,A.y),m=Math.max(m,A.x),b=Math.max(b,A.y),s.push(A)}const C=this.grid.query(l,c,m,b).concat(this.ignoredGrid.query(l,c,m,b)),I={},P={};for(const k of C){const A=k.key;if(I[A.bucketInstanceId]===void 0&&(I[A.bucketInstanceId]={}),I[A.bucketInstanceId][A.featureIndex])continue;const B=[new u.P(k.x1,k.y1),new u.P(k.x2,k.y1),new u.P(k.x2,k.y2),new u.P(k.x1,k.y2)];u.am(s,B)&&(I[A.bucketInstanceId][A.featureIndex]=!0,P[A.bucketInstanceId]===void 0&&(P[A.bucketInstanceId]=[]),P[A.bucketInstanceId].push(A.featureIndex))}return P}insertCollisionBox(e,s,l,c,m,b){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:c,featureIndex:m,collisionGroupID:b,overlapMode:s},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,s,l,c,m,b){const C=l?this.ignoredGrid:this.grid,I={bucketInstanceId:c,featureIndex:m,collisionGroupID:b,overlapMode:s};for(let P=0;P<e.length;P+=4)C.insertCircle(I,e[P],e[P+1],e[P+2])}projectAndGetPerspectiveRatio(e,s,l,c,m){let b;m?(b=[s,l,m(s,l),1],u.af(b,b,e)):(b=[s,l,0,1],Et(b,b,e));const C=b[3];return{point:new u.P((b[0]/C+1)/2*this.transform.width+dt,(-b[1]/C+1)/2*this.transform.height+dt),perspectiveRatio:.5+this.transform.cameraToCenterDistance/C*.5,isOccluded:!1,signedDistanceFromCamera:C}}getPerspectiveRatio(e,s,l,c,m){const b=this.mapProjection.useSpecialProjectionForSymbols?this.mapProjection.projectTileCoordinates(s,l,c,m):K(s,l,e,m);return .5+this.transform.cameraToCenterDistance/b.signedDistanceFromCamera*.5}isOffscreen(e,s,l,c){return l<dt||e>=this.screenRightBoundary||c<dt||s>this.screenBottomBoundary}isInsideGrid(e,s,l,c){return l>=0&&e<this.gridRightBoundary&&c>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const e=u.an([]);return u.J(e,e,[-100,-100,0]),e}_projectCollisionBox(e,s,l,c,m,b,C,I,P,k){let A=new u.P(1,0),B=new u.P(0,1);const $=new u.P(e.anchorPointX+C[0],e.anchorPointY+C[1]);if(b&&!m){const Le=this.projectAndGetPerspectiveRatio(l,$.x+1,$.y,c,P).point.sub(I.point).unit(),Ne=Math.atan(Le.y/Le.x)+(Le.x<0?Math.PI:0),ke=Math.sin(Ne),Me=Math.cos(Ne);A=new u.P(Me,ke),B=new u.P(-ke,Me)}else if(!b&&m){const Le=-this.transform.angle,Ne=Math.sin(Le),ke=Math.cos(Le);A=new u.P(ke,Ne),B=new u.P(-Ne,ke)}let H=I.point,Y=s;if(m){H=$;const Le=this.transform.zoom-Math.floor(this.transform.zoom);Y=Math.pow(2,-Le),Y*=this.mapProjection.getPitchedTextCorrection(this.transform,$,c),k||(Y*=u.ac(.5+I.signedDistanceFromCamera/this.transform.cameraToCenterDistance*.5,0,4))}k&&(H=H.add(A.mult(k.x*Y)).add(B.mult(k.y*Y)));const Q=e.x1*Y,ee=e.x2*Y,ne=(Q+ee)/2,Z=e.y1*Y,ae=e.y2*Y,ce=(Z+ae)/2,me=[{offsetX:Q,offsetY:Z},{offsetX:ne,offsetY:Z},{offsetX:ee,offsetY:Z},{offsetX:ee,offsetY:ce},{offsetX:ee,offsetY:ae},{offsetX:ne,offsetY:ae},{offsetX:Q,offsetY:ae},{offsetX:Q,offsetY:ce}];let be=[];for(const{offsetX:Le,offsetY:Ne}of me)be.push(new u.P(H.x+A.x*Le+B.x*Ne,H.y+A.y*Le+B.y*Ne));let Ie=!1;if(m){const Le=be.map(Ne=>this.projectAndGetPerspectiveRatio(l,Ne.x,Ne.y,c,P));Ie=Le.some(Ne=>!Ne.isOccluded),be=Le.map(Ne=>Ne.point)}else Ie=!0;return{box:u.ao(be),allPointsOccluded:!Ie}}}function vt(f,e,s){return e*(u.X/(f.tileSize*Math.pow(2,s-f.tileID.overscaledZ)))}class xi{constructor(e,s,l,c){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?s:-s))):c&&l?1:0,this.placed=l}isHidden(){return this.opacity===0&&!this.placed}}class ui{constructor(e,s,l,c,m){this.text=new xi(e?e.text:null,s,l,m),this.icon=new xi(e?e.icon:null,s,c,m)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class gt{constructor(e,s,l){this.text=e,this.icon=s,this.skipFade=l}}class Bt{constructor(){this.invProjMatrix=u.H(),this.viewportMatrix=u.H(),this.circles=[]}}class ai{constructor(e,s,l,c,m){this.bucketInstanceId=e,this.featureIndex=s,this.sourceLayerIndex=l,this.bucketIndex=c,this.tileID=m}}class ki{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const s=++this.maxGroupID;this.collisionGroups[e]={ID:s,predicate:l=>l.collisionGroupID===s}}return this.collisionGroups[e]}}function Bi(f,e,s,l,c){const{horizontalAlign:m,verticalAlign:b}=u.au(f);return new u.P(-(m-.5)*e+l[0]*c,-(b-.5)*s+l[1]*c)}class Ji{constructor(e,s,l,c,m,b){this.transform=e.clone(),this.terrain=l,this.collisionIndex=new Pt(this.transform,s),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ki(m),this.collisionCircleArrays={},this.collisionBoxArrays=new Map,this.prevPlacement=b,b&&(b.prevPlacement=void 0),this.placedOrientations={}}_getTerrainElevationFunc(e){const s=this.terrain;return s?(l,c)=>s.getElevation(e,l,c):null}getBucketParts(e,s,l,c){const m=l.getBucket(s),b=l.latestFeatureIndex;if(!m||!b||s.id!==m.layerIds[0])return;const C=l.collisionBoxArray,I=m.layers[0].layout,P=m.layers[0].paint,k=Math.pow(2,this.transform.zoom-l.tileID.overscaledZ),A=l.tileSize/u.X,B=l.tileID.toUnwrapped(),$=this.transform.calculatePosMatrix(B),H=I.get("text-pitch-alignment")==="map",Y=I.get("text-rotation-alignment")==="map",Q=vt(l,1,this.transform.zoom),ee=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("text-translate"),P.get("text-translate-anchor")),ne=this.collisionIndex.mapProjection.translatePosition(this.transform,l,P.get("icon-translate"),P.get("icon-translate-anchor")),Z=Lr($,H,Y,this.transform,Q);let ae=null;if(H){const me=cr($,H,Y,this.transform,Q);ae=u.L([],this.transform.labelPlaneMatrix,me)}this.retainedQueryData[m.bucketInstanceId]=new ai(m.bucketInstanceId,b,m.sourceLayerIndex,m.index,l.tileID);const ce={bucket:m,layout:I,translationText:ee,translationIcon:ne,posMatrix:$,unwrappedTileID:B,textLabelPlaneMatrix:Z,labelToScreenMatrix:ae,scale:k,textPixelRatio:A,holdingForFade:l.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:u.ag(m.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(m.sourceID)};if(c)for(const me of m.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Ie,symbolInstanceEnd:Le}=me;e.push({sortKey:be,symbolInstanceStart:Ie,symbolInstanceEnd:Le,parameters:ce})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:m.symbolInstances.length,parameters:ce})}attemptAnchorPlacement(e,s,l,c,m,b,C,I,P,k,A,B,$,H,Y,Q,ee,ne,Z){const ae=u.aq[e.textAnchor],ce=[e.textOffset0,e.textOffset1],me=Bi(ae,l,c,ce,m),be=this.collisionIndex.placeCollisionBox(s,B,I,P,k,C,b,Q,A.predicate,Z,me);if((!ne||this.collisionIndex.placeCollisionBox(ne,B,I,P,k,C,b,ee,A.predicate,Z,me).placeable)&&be.placeable){let Ie;if(this.prevPlacement&&this.prevPlacement.variableOffsets[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID]&&this.prevPlacement.placements[$.crossTileID].text&&(Ie=this.prevPlacement.variableOffsets[$.crossTileID].anchor),$.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[$.crossTileID]={textOffset:ce,width:l,height:c,anchor:ae,textBoxScale:m,prevAnchor:Ie},this.markUsedJustification(H,ae,$,Y),H.allowVerticalPlacement&&(this.markUsedOrientation(H,Y,$),this.placedOrientations[$.crossTileID]=Y),{shift:me,placedGlyphBoxes:be}}}placeLayerBucketPart(e,s,l){const{bucket:c,layout:m,translationText:b,translationIcon:C,posMatrix:I,unwrappedTileID:P,textLabelPlaneMatrix:k,labelToScreenMatrix:A,textPixelRatio:B,holdingForFade:$,collisionBoxArray:H,partiallyEvaluatedTextSize:Y,collisionGroup:Q}=e.parameters,ee=m.get("text-optional"),ne=m.get("icon-optional"),Z=u.ar(m,"text-overlap","text-allow-overlap"),ae=Z==="always",ce=u.ar(m,"icon-overlap","icon-allow-overlap"),me=ce==="always",be=m.get("text-rotation-alignment")==="map",Ie=m.get("text-pitch-alignment")==="map",Le=m.get("icon-text-fit")!=="none",Ne=m.get("symbol-z-order")==="viewport-y",ke=ae&&(me||!c.hasIconData()||ne),Me=me&&(ae||!c.hasTextData()||ee);!c.collisionArrays&&H&&c.deserializeCollisionBoxes(H);const Ge=this._getTerrainElevationFunc(this.retainedQueryData[c.bucketInstanceId].tileID),ut=(ze,Fe,at)=>{var ti,pt;if(s[ze.crossTileID])return;if($)return void(this.placements[ze.crossTileID]=new gt(!1,!1,!1));let xt=!1,ii=!1,$i=!0,Hn=null,ni={box:null,placeable:!1,offscreen:null},an={box:null,placeable:!1,offscreen:null},Qi=null,ji=null,en=null,pr=0,Ws=0,Va=0;Fe.textFeatureIndex?pr=Fe.textFeatureIndex:ze.useRuntimeCollisionCircles&&(pr=ze.featureIndex),Fe.verticalTextFeatureIndex&&(Ws=Fe.verticalTextFeatureIndex);const Zs=Fe.textBox;if(Zs){const An=Fi=>{let qi=u.ah.horizontal;if(c.allowVerticalPlacement&&!Fi&&this.prevPlacement){const bn=this.prevPlacement.placedOrientations[ze.crossTileID];bn&&(this.placedOrientations[ze.crossTileID]=bn,qi=bn,this.markUsedOrientation(c,qi,ze))}return qi},zn=(Fi,qi)=>{if(c.allowVerticalPlacement&&ze.numVerticalGlyphVertices>0&&Fe.verticalTextBox){for(const bn of c.writingModes)if(bn===u.ah.vertical?(ni=qi(),an=ni):ni=Fi(),ni&&ni.placeable)break}else ni=Fi()},Fr=ze.textAnchorOffsetStartIndex,Wn=ze.textAnchorOffsetEndIndex;if(Wn===Fr){const Fi=(qi,bn)=>{const Ct=this.collisionIndex.placeCollisionBox(qi,Z,B,I,P,Ie,be,b,Q.predicate,Ge);return Ct&&Ct.placeable&&(this.markUsedOrientation(c,bn,ze),this.placedOrientations[ze.crossTileID]=bn),Ct};zn(()=>Fi(Zs,u.ah.horizontal),()=>{const qi=Fe.verticalTextBox;return c.allowVerticalPlacement&&ze.numVerticalGlyphVertices>0&&qi?Fi(qi,u.ah.vertical):{box:null,offscreen:null}}),An(ni&&ni.placeable)}else{let Fi=u.aq[(pt=(ti=this.prevPlacement)===null||ti===void 0?void 0:ti.variableOffsets[ze.crossTileID])===null||pt===void 0?void 0:pt.anchor];const qi=(Ct,as,Gs)=>{const Xs=Ct.x2-Ct.x1,Du=Ct.y2-Ct.y1,Yh=ze.textBoxScale,Lu=Le&&ce==="never"?as:null;let Or=null,Ru=Z==="never"?1:2,$a="never";Fi&&Ru++;for(let qo=0;qo<Ru;qo++){for(let ja=Fr;ja<Wn;ja++){const qa=c.textAnchorOffsets.get(ja);if(Fi&&qa.textAnchor!==Fi)continue;const Ys=this.attemptAnchorPlacement(qa,Ct,Xs,Du,Yh,be,Ie,B,I,P,Q,$a,ze,c,Gs,b,C,Lu,Ge);if(Ys&&(Or=Ys.placedGlyphBoxes,Or&&Or.placeable))return xt=!0,Hn=Ys.shift,Or}Fi?Fi=null:$a=Z}return l&&!Or&&(Or={box:this.collisionIndex.placeCollisionBox(Zs,"always",B,I,P,Ie,be,b,Q.predicate,Ge,new u.P(0,0)).box,offscreen:!1,placeable:!1}),Or};zn(()=>qi(Zs,Fe.iconBox,u.ah.horizontal),()=>{const Ct=Fe.verticalTextBox;return c.allowVerticalPlacement&&(!ni||!ni.placeable)&&ze.numVerticalGlyphVertices>0&&Ct?qi(Ct,Fe.verticalIconBox,u.ah.vertical):{box:null,occluded:!0,offscreen:null}}),ni&&(xt=ni.placeable,$i=ni.offscreen);const bn=An(ni&&ni.placeable);if(!xt&&this.prevPlacement){const Ct=this.prevPlacement.variableOffsets[ze.crossTileID];Ct&&(this.variableOffsets[ze.crossTileID]=Ct,this.markUsedJustification(c,Ct.anchor,ze,bn))}}}if(Qi=ni,xt=Qi&&Qi.placeable,$i=Qi&&Qi.offscreen,ze.useRuntimeCollisionCircles){const An=c.text.placedSymbolArray.get(ze.centerJustifiedTextSymbolIndex),zn=u.ai(c.textSizeData,Y,An),Fr=m.get("text-padding");ji=this.collisionIndex.placeCollisionCircles(Z,An,c.lineVertexArray,c.glyphOffsetArray,zn,I,P,k,A,l,Ie,Q.predicate,ze.collisionCircleDiameter,Fr,b,Ge),ji.circles.length&&ji.collisionDetected&&!l&&u.w("Collisions detected, but collision boxes are not shown"),xt=ae||ji.circles.length>0&&!ji.collisionDetected,$i=$i&&ji.offscreen}if(Fe.iconFeatureIndex&&(Va=Fe.iconFeatureIndex),Fe.iconBox){const An=zn=>this.collisionIndex.placeCollisionBox(zn,ce,B,I,P,Ie,be,C,Q.predicate,Ge,Le&&Hn?Hn:void 0);an&&an.placeable&&Fe.verticalIconBox?(en=An(Fe.verticalIconBox),ii=en.placeable):(en=An(Fe.iconBox),ii=en.placeable),$i=$i&&en.offscreen}const kn=ee||ze.numHorizontalGlyphVertices===0&&ze.numVerticalGlyphVertices===0,Ua=ne||ze.numIconVertices===0;kn||Ua?Ua?kn||(ii=ii&&xt):xt=ii&&xt:ii=xt=ii&&xt;const uc=ii&&en.placeable;if(xt&&Qi.placeable&&this.collisionIndex.insertCollisionBox(Qi.box,Z,m.get("text-ignore-placement"),c.bucketInstanceId,an&&an.placeable&&Ws?Ws:pr,Q.ID),uc&&this.collisionIndex.insertCollisionBox(en.box,ce,m.get("icon-ignore-placement"),c.bucketInstanceId,Va,Q.ID),ji&&xt&&this.collisionIndex.insertCollisionCircles(ji.circles,Z,m.get("text-ignore-placement"),c.bucketInstanceId,pr,Q.ID),l&&this.storeCollisionData(c.bucketInstanceId,at,Fe,Qi,en,ji),ze.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(c.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ze.crossTileID]=new gt(xt||ke,ii||Me,$i||c.justReloaded),s[ze.crossTileID]=!0};if(Ne){if(e.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ze=c.getSortedSymbolIndexes(this.transform.angle);for(let Fe=ze.length-1;Fe>=0;--Fe){const at=ze[Fe];ut(c.symbolInstances.get(at),c.collisionArrays[at],at)}}else for(let ze=e.symbolInstanceStart;ze<e.symbolInstanceEnd;ze++)ut(c.symbolInstances.get(ze),c.collisionArrays[ze],ze);if(l&&c.bucketInstanceId in this.collisionCircleArrays){const ze=this.collisionCircleArrays[c.bucketInstanceId];u.as(ze.invProjMatrix,I),ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}c.justReloaded=!1}storeCollisionData(e,s,l,c,m,b){if(l.textBox||l.iconBox){let C,I;this.collisionBoxArrays.has(e)?C=this.collisionBoxArrays.get(e):(C=new Map,this.collisionBoxArrays.set(e,C)),C.has(s)?I=C.get(s):(I={text:null,icon:null},C.set(s,I)),l.textBox&&(I.text=c.box),l.iconBox&&(I.icon=m.box)}if(b){let C=this.collisionCircleArrays[e];C===void 0&&(C=this.collisionCircleArrays[e]=new Bt);for(let I=0;I<b.circles.length;I+=4)C.circles.push(b.circles[I+0]),C.circles.push(b.circles[I+1]),C.circles.push(b.circles[I+2]),C.circles.push(b.collisionDetected?1:0)}}markUsedJustification(e,s,l,c){let m;m=c===u.ah.vertical?l.verticalPlacedTextSymbolIndex:{left:l.leftJustifiedTextSymbolIndex,center:l.centerJustifiedTextSymbolIndex,right:l.rightJustifiedTextSymbolIndex}[u.at(s)];const b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex,l.verticalPlacedTextSymbolIndex];for(const C of b)C>=0&&(e.text.placedSymbolArray.get(C).crossTileID=m>=0&&C!==m?0:l.crossTileID)}markUsedOrientation(e,s,l){const c=s===u.ah.horizontal||s===u.ah.horizontalOnly?s:0,m=s===u.ah.vertical?s:0,b=[l.leftJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.rightJustifiedTextSymbolIndex];for(const C of b)e.text.placedSymbolArray.get(C).placedOrientation=c;l.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(l.verticalPlacedTextSymbolIndex).placedOrientation=m)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let l=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const c=s?s.symbolFadeChange(e):1,m=s?s.opacities:{},b=s?s.variableOffsets:{},C=s?s.placedOrientations:{};for(const I in this.placements){const P=this.placements[I],k=m[I];k?(this.opacities[I]=new ui(k,c,P.text,P.icon),l=l||P.text!==k.text.placed||P.icon!==k.icon.placed):(this.opacities[I]=new ui(null,c,P.text,P.icon,P.skipFade),l=l||P.text||P.icon)}for(const I in m){const P=m[I];if(!this.opacities[I]){const k=new ui(P,c,!1,!1);k.isHidden()||(this.opacities[I]=k,l=l||P.text.placed||P.icon.placed)}}for(const I in b)this.variableOffsets[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.variableOffsets[I]=b[I]);for(const I in C)this.placedOrientations[I]||!this.opacities[I]||this.opacities[I].isHidden()||(this.placedOrientations[I]=C[I]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");l?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:e)}updateLayerOpacities(e,s){const l={};for(const c of s){const m=c.getBucket(e);m&&c.latestFeatureIndex&&e.id===m.layerIds[0]&&this.updateBucketOpacities(m,c.tileID,l,c.collisionBoxArray)}}updateBucketOpacities(e,s,l,c){e.hasTextData()&&(e.text.opacityVertexArray.clear(),e.text.hasVisibleVertices=!1),e.hasIconData()&&(e.icon.opacityVertexArray.clear(),e.icon.hasVisibleVertices=!1),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const m=e.layers[0],b=m.layout,C=new ui(null,0,!1,!1,!0),I=b.get("text-allow-overlap"),P=b.get("icon-allow-overlap"),k=m._unevaluatedLayout.hasValue("text-variable-anchor")||m._unevaluatedLayout.hasValue("text-variable-anchor-offset"),A=b.get("text-rotation-alignment")==="map",B=b.get("text-pitch-alignment")==="map",$=b.get("icon-text-fit")!=="none",H=new ui(null,0,I&&(P||!e.hasIconData()||b.get("icon-optional")),P&&(I||!e.hasTextData()||b.get("text-optional")),!0);!e.collisionArrays&&c&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(c);const Y=(ee,ne,Z)=>{for(let ae=0;ae<ne/4;ae++)ee.opacityVertexArray.emplaceBack(Z);ee.hasVisibleVertices=ee.hasVisibleVertices||Z!==Is},Q=this.collisionBoxArrays.get(e.bucketInstanceId);for(let ee=0;ee<e.symbolInstances.length;ee++){const ne=e.symbolInstances.get(ee),{numHorizontalGlyphVertices:Z,numVerticalGlyphVertices:ae,crossTileID:ce}=ne;let me=this.opacities[ce];l[ce]?me=C:me||(me=H,this.opacities[ce]=me),l[ce]=!0;const be=ne.numIconVertices>0,Ie=this.placedOrientations[ne.crossTileID],Le=Ie===u.ah.vertical,Ne=Ie===u.ah.horizontal||Ie===u.ah.horizontalOnly;if(Z>0||ae>0){const Me=yn(me.text);Y(e.text,Z,Le?Is:Me),Y(e.text,ae,Ne?Is:Me);const Ge=me.text.isHidden();[ne.rightJustifiedTextSymbolIndex,ne.centerJustifiedTextSymbolIndex,ne.leftJustifiedTextSymbolIndex].forEach(Fe=>{Fe>=0&&(e.text.placedSymbolArray.get(Fe).hidden=Ge||Le?1:0)}),ne.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(ne.verticalPlacedTextSymbolIndex).hidden=Ge||Ne?1:0);const ut=this.variableOffsets[ne.crossTileID];ut&&this.markUsedJustification(e,ut.anchor,ne,Ie);const ze=this.placedOrientations[ne.crossTileID];ze&&(this.markUsedJustification(e,"left",ne,ze),this.markUsedOrientation(e,ze,ne))}if(be){const Me=yn(me.icon),Ge=!($&&ne.verticalPlacedIconSymbolIndex&&Le);ne.placedIconSymbolIndex>=0&&(Y(e.icon,ne.numIconVertices,Ge?Me:Is),e.icon.placedSymbolArray.get(ne.placedIconSymbolIndex).hidden=me.icon.isHidden()),ne.verticalPlacedIconSymbolIndex>=0&&(Y(e.icon,ne.numVerticalIconVertices,Ge?Is:Me),e.icon.placedSymbolArray.get(ne.verticalPlacedIconSymbolIndex).hidden=me.icon.isHidden())}const ke=Q&&Q.has(ee)?Q.get(ee):{text:null,icon:null};if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const Me=e.collisionArrays[ee];if(Me){let Ge=new u.P(0,0);if(Me.textBox||Me.verticalTextBox){let ut=!0;if(k){const ze=this.variableOffsets[ce];ze?(Ge=Bi(ze.anchor,ze.width,ze.height,ze.textOffset,ze.textBoxScale),A&&Ge._rotate(B?this.transform.angle:-this.transform.angle)):ut=!1}if(Me.textBox||Me.verticalTextBox){let ze;Me.textBox&&(ze=Le),Me.verticalTextBox&&(ze=Ne),Ss(e.textCollisionBox.collisionVertexArray,me.text.placed,!ut||ze,ke.text,Ge.x,Ge.y)}}if(Me.iconBox||Me.verticalIconBox){const ut=!!(!Ne&&Me.verticalIconBox);let ze;Me.iconBox&&(ze=ut),Me.verticalIconBox&&(ze=!ut),Ss(e.iconCollisionBox.collisionVertexArray,me.icon.placed,ze,ke.icon,$?Ge.x:0,$?Ge.y:0)}}}}if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.text.opacityVertexArray.length!==e.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${e.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${e.text.layoutVertexArray.length}) / 4`);if(e.icon.opacityVertexArray.length!==e.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${e.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${e.icon.layoutVertexArray.length}) / 4`);if(e.bucketInstanceId in this.collisionCircleArrays){const ee=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=ee.invProjMatrix,e.placementViewportMatrix=ee.viewportMatrix,e.collisionCircleArray=ee.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,s){const l=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*l>e}setStale(){this.stale=!0}}function Ss(f,e,s,l,c,m){l&&l.length!==0||(l=[0,0,0,0]);const b=l[0]-dt,C=l[1]-dt,I=l[2]-dt,P=l[3]-dt;f.emplaceBack(e?1:0,s?1:0,c||0,m||0,b,C),f.emplaceBack(e?1:0,s?1:0,c||0,m||0,I,C),f.emplaceBack(e?1:0,s?1:0,c||0,m||0,I,P),f.emplaceBack(e?1:0,s?1:0,c||0,m||0,b,P)}const Ft=Math.pow(2,25),bl=Math.pow(2,24),wl=Math.pow(2,17),gn=Math.pow(2,16),_n=Math.pow(2,9),Sh=Math.pow(2,8),Tn=Math.pow(2,1);function yn(f){if(f.opacity===0&&!f.placed)return 0;if(f.opacity===1&&f.placed)return 4294967295;const e=f.placed?1:0,s=Math.floor(127*f.opacity);return s*Ft+e*bl+s*wl+e*gn+s*_n+e*Sh+s*Tn+e}const Is=0;function Xr(){return{isOccluded:(f,e,s)=>!1,getPitchedTextCorrection:(f,e,s)=>1,get useSpecialProjectionForSymbols(){return!1},projectTileCoordinates(f,e,s,l){throw new Error("Not implemented.")},translatePosition:(f,e,s,l)=>function(c,m,b,C,I=!1){if(!b[0]&&!b[1])return[0,0];const P=I?C==="map"?c.angle:0:C==="viewport"?-c.angle:0;if(P){const k=Math.sin(P),A=Math.cos(P);b=[b[0]*A-b[1]*k,b[0]*k+b[1]*A]}return[I?b[0]:vt(m,b[0],c.zoom),I?b[1]:vt(m,b[1],c.zoom)]}(f,e,s,l),getCircleRadiusCorrection:f=>1}}class bi{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&!e.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(e,s,l,c,m){const b=this._bucketParts;for(;this._currentTileIndex<e.length;)if(s.getBucketParts(b,c,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,m())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,b.sort((C,I)=>C.sortKey-I.sortKey));this._currentPartIndex<b.length;)if(s.placeLayerBucketPart(b[this._currentPartIndex],this._seenCrossTileIDs,l),this._currentPartIndex++,m())return!0;return!1}}class To{constructor(e,s,l,c,m,b,C,I){this.placement=new Ji(e,Xr(),s,b,C,I),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=c,this._showCollisionBoxes=m,this._done=!1}isDone(){return this._done}continuePlacement(e,s,l){const c=q.now(),m=()=>!this._forceFullPlacement&&q.now()-c>2;for(;this._currentPlacementIndex>=0;){const b=s[e[this._currentPlacementIndex]],C=this.placement.collisionIndex.transform.zoom;if(b.type==="symbol"&&(!b.minzoom||b.minzoom<=C)&&(!b.maxzoom||b.maxzoom>C)){if(this._inProgressLayer||(this._inProgressLayer=new bi(b)),this._inProgressLayer.continuePlacement(l[b.source],this.placement,this._showCollisionBoxes,b,m))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Vn=512/u.X/2;class _i{constructor(e,s,l){this.tileID=e,this.bucketInstanceId=l,this._symbolsByKey={};const c=new Map;for(let m=0;m<s.length;m++){const b=s.get(m),C=b.key,I=c.get(C);I?I.push(b):c.set(C,[b])}for(const[m,b]of c){const C={positions:b.map(I=>({x:Math.floor(I.anchorX*Vn),y:Math.floor(I.anchorY*Vn)})),crossTileIDs:b.map(I=>I.crossTileID)};if(C.positions.length>128){const I=new u.av(C.positions.length,16,Uint16Array);for(const{x:P,y:k}of C.positions)I.add(P,k);I.finish(),delete C.positions,C.index=I}this._symbolsByKey[m]=C}}getScaledCoordinates(e,s){const{x:l,y:c,z:m}=this.tileID.canonical,{x:b,y:C,z:I}=s.canonical,P=Vn/Math.pow(2,I-m),k=(C*u.X+e.anchorY)*P,A=c*u.X*Vn;return{x:Math.floor((b*u.X+e.anchorX)*P-l*u.X*Vn),y:Math.floor(k-A)}}findMatches(e,s,l){const c=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let m=0;m<e.length;m++){const b=e.get(m);if(b.crossTileID)continue;const C=this._symbolsByKey[b.key];if(!C)continue;const I=this.getScaledCoordinates(b,s);if(C.index){const P=C.index.range(I.x-c,I.y-c,I.x+c,I.y+c).sort();for(const k of P){const A=C.crossTileIDs[k];if(!l[A]){l[A]=!0,b.crossTileID=A;break}}}else if(C.positions)for(let P=0;P<C.positions.length;P++){const k=C.positions[P],A=C.crossTileIDs[P];if(Math.abs(k.x-I.x)<=c&&Math.abs(k.y-I.y)<=c&&!l[A]){l[A]=!0,b.crossTileID=A;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:e})=>e)}}class ca{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Un{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const s=Math.round((e-this.lng)/360);if(s!==0)for(const l in this.indexes){const c=this.indexes[l],m={};for(const b in c){const C=c[b];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+s),m[C.tileID.key]=C}this.indexes[l]=m}this.lng=e}addBucket(e,s,l){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let m=0;m<s.symbolInstances.length;m++)s.symbolInstances.get(m).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]={});const c=this.usedCrossTileIDs[e.overscaledZ];for(const m in this.indexes){const b=this.indexes[m];if(Number(m)>e.overscaledZ)for(const C in b){const I=b[C];I.tileID.isChildOf(e)&&I.findMatches(s.symbolInstances,e,c)}else{const C=b[e.scaledTo(Number(m)).key];C&&C.findMatches(s.symbolInstances,e,c)}}for(let m=0;m<s.symbolInstances.length;m++){const b=s.symbolInstances.get(m);b.crossTileID||(b.crossTileID=l.generate(),c[b.crossTileID]=!0)}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new _i(e,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(e,s){for(const l of s.getCrossTileIDsLists())for(const c of l)delete this.usedCrossTileIDs[e][c]}removeStaleBuckets(e){let s=!1;for(const l in this.indexes){const c=this.indexes[l];for(const m in c)e[c[m].bucketInstanceId]||(this.removeBucketCrossTileIDs(l,c[m]),delete c[m],s=!0)}return s}}class Cl{constructor(){this.layerIndexes={},this.crossTileIDs=new ca,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,s,l){let c=this.layerIndexes[e.id];c===void 0&&(c=this.layerIndexes[e.id]=new Un);let m=!1;const b={};c.handleWrapJump(l);for(const C of s){const I=C.getBucket(e);I&&e.id===I.layerIds[0]&&(I.bucketInstanceId||(I.bucketInstanceId=++this.maxBucketInstanceId),c.addBucket(C.tileID,I,this.crossTileIDs)&&(m=!0),b[I.bucketInstanceId]=!0)}return c.removeStaleBuckets(b)&&(m=!0),m}pruneUnusedLayers(e){const s={};e.forEach(l=>{s[l]=!0});for(const l in this.layerIndexes)s[l]||delete this.layerIndexes[l]}}const $n=(f,e)=>u.t(f,e&&e.filter(s=>s.identifier!=="source.canvas")),Ih=u.aw();class ua extends u.E{constructor(e,s={}){super(),this._rtlPluginLoaded=()=>{for(const l in this.sourceCaches){const c=this.sourceCaches[l].getSource().type;c!=="vector"&&c!=="geojson"||this.sourceCaches[l].reload()}},this.map=e,this.dispatcher=new Zr(Wr(),e._getMapId()),this.dispatcher.registerMessageHandler("GG",(l,c)=>this.getGlyphs(l,c)),this.dispatcher.registerMessageHandler("GI",(l,c)=>this.getImages(l,c)),this.imageManager=new St,this.imageManager.setEventedParent(this),this.glyphManager=new li(e._requestManager,s.localIdeographFontFamily),this.lineAtlas=new xs(256,512),this.crossTileSymbolIndex=new Cl,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ax,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("SR",u.ay()),ar().on(Ee,this._rtlPluginLoaded),this.on("data",l=>{if(l.dataType!=="source"||l.sourceDataType!=="metadata")return;const c=this.sourceCaches[l.sourceId];if(!c)return;const m=c.getSource();if(m&&m.vectorLayerIds)for(const b in this._layers){const C=this._layers[b];C.source===m.id&&this._validateLayer(C)}})}loadURL(e,s={},l){this.fire(new u.k("dataloading",{dataType:"style"})),s.validate=typeof s.validate!="boolean"||s.validate;const c=this.map._requestManager.transformRequest(e,"Style");this._loadStyleRequest=new AbortController;const m=this._loadStyleRequest;u.h(c,this._loadStyleRequest).then(b=>{this._loadStyleRequest=null,this._load(b.data,s,l)}).catch(b=>{this._loadStyleRequest=null,b&&!m.signal.aborted&&this.fire(new u.j(b))})}loadJSON(e,s={},l){this.fire(new u.k("dataloading",{dataType:"style"})),this._frameRequest=new AbortController,q.frameAsync(this._frameRequest).then(()=>{this._frameRequest=null,s.validate=s.validate!==!1,this._load(e,s,l)}).catch(()=>{})}loadEmpty(){this.fire(new u.k("dataloading",{dataType:"style"})),this._load(Ih,{validate:!1})}_load(e,s,l){var c;const m=s.transformStyle?s.transformStyle(l,e):e;if(!s.validate||!$n(this,u.u(m))){this._loaded=!0,this.stylesheet=m;for(const b in m.sources)this.addSource(b,m.sources[b],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new mn(this.stylesheet.light),this.sky=new Yi(this.stylesheet.sky),this.map.setTerrain((c=this.stylesheet.terrain)!==null&&c!==void 0?c:null),this.fire(new u.k("data",{dataType:"style"})),this.fire(new u.k("style.load"))}}_createLayers(){const e=u.az(this.stylesheet.layers);this.dispatcher.broadcast("SL",e),this._order=e.map(s=>s.id),this._layers={},this._serializedLayers=null;for(const s of e){const l=u.aA(s);l.setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=l}}_loadSprite(e,s=!1,l=void 0){let c;this.imageManager.setLoaded(!1),this._spriteRequest=new AbortController,function(m,b,C,I){return u._(this,void 0,void 0,function*(){const P=Ve(m),k=C>1?"@2x":"",A={},B={};for(const{id:$,url:H}of P){const Y=b.transformRequest(pi(H,k,".json"),"SpriteJSON");A[$]=u.h(Y,I);const Q=b.transformRequest(pi(H,k,".png"),"SpriteImage");B[$]=st.getImage(Q,I)}return yield Promise.all([...Object.values(A),...Object.values(B)]),function($,H){return u._(this,void 0,void 0,function*(){const Y={};for(const Q in $){Y[Q]={};const ee=q.getImageCanvasContext((yield H[Q]).data),ne=(yield $[Q]).data;for(const Z in ne){const{width:ae,height:ce,x:me,y:be,sdf:Ie,pixelRatio:Le,stretchX:Ne,stretchY:ke,content:Me,textFitWidth:Ge,textFitHeight:ut}=ne[Z];Y[Q][Z]={data:null,pixelRatio:Le,sdf:Ie,stretchX:Ne,stretchY:ke,content:Me,textFitWidth:Ge,textFitHeight:ut,spriteData:{width:ae,height:ce,x:me,y:be,context:ee}}}}return Y})}(A,B)})}(e,this.map._requestManager,this.map.getPixelRatio(),this._spriteRequest).then(m=>{if(this._spriteRequest=null,m)for(const b in m){this._spritesImagesIds[b]=[];const C=this._spritesImagesIds[b]?this._spritesImagesIds[b].filter(I=>!(I in m)):[];for(const I of C)this.imageManager.removeImage(I),this._changedImages[I]=!0;for(const I in m[b]){const P=b==="default"?I:`${b}:${I}`;this._spritesImagesIds[b].push(P),P in this.imageManager.images?this.imageManager.updateImage(P,m[b][I],!1):this.imageManager.addImage(P,m[b][I]),s&&(this._changedImages[P]=!0)}}}).catch(m=>{this._spriteRequest=null,c=m,this.fire(new u.j(c))}).finally(()=>{this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),s&&(this._changed=!0),this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"})),l&&l(c)})}_unloadSprite(){for(const e of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(e),this._changedImages[e]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}_validateLayer(e){const s=this.sourceCaches[e.source];if(!s)return;const l=e.sourceLayer;if(!l)return;const c=s.getSource();(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(l)===-1)&&this.fire(new u.j(new Error(`Source layer "${l}" does not exist on source "${c.id}" as specified by style layer "${e.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const e in this.sourceCaches)if(!this.sourceCaches[e].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(e,s=!1){const l=this._serializedAllLayers();if(!e||e.length===0)return Object.values(s?u.aB(l):l);const c=[];for(const m of e)if(l[m]){const b=s?u.aB(l[m]):l[m];c.push(b)}return c}_serializedAllLayers(){let e=this._serializedLayers;if(e)return e;e=this._serializedLayers={};const s=Object.keys(this._layers);for(const l of s){const c=this._layers[l];c.type!=="custom"&&(e[l]=c.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition()||this.sky&&this.sky.hasTransition())return!0;for(const e in this.sourceCaches)if(this.sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(e){if(!this._loaded)return;const s=this._changed;if(s){const c=Object.keys(this._updatedLayers),m=Object.keys(this._removedLayers);(c.length||m.length)&&this._updateWorkerLayers(c,m);for(const b in this._updatedSources){const C=this._updatedSources[b];if(C==="reload")this._reloadSource(b);else{if(C!=="clear")throw new Error(`Invalid action ${C}`);this._clearSource(b)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const b in this._updatedPaintProps)this._layers[b].updateTransitions(e);this.light.updateTransitions(e),this.sky.updateTransitions(e),this._resetUpdates()}const l={};for(const c in this.sourceCaches){const m=this.sourceCaches[c];l[c]=m.used,m.used=!1}for(const c of this._order){const m=this._layers[c];m.recalculate(e,this._availableImages),!m.isHidden(e.zoom)&&m.source&&(this.sourceCaches[m.source].used=!0)}for(const c in l){const m=this.sourceCaches[c];!!l[c]!=!!m.used&&m.fire(new u.k("data",{sourceDataType:"visibility",dataType:"source",sourceId:c}))}this.light.recalculate(e),this.sky.recalculate(e),this.z=e.zoom,s&&this.fire(new u.k("data",{dataType:"style"}))}_updateTilesForChangedImages(){const e=Object.keys(this._changedImages);if(e.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],e);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(e,s){this.dispatcher.broadcast("UL",{layers:this._serializeByIds(e,!1),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(e,s={}){var l;this._checkLoaded();const c=this.serialize();if(e=s.transformStyle?s.transformStyle(c,e):e,((l=s.validate)===null||l===void 0||l)&&$n(this,u.u(e)))return!1;(e=u.aB(e)).layers=u.az(e.layers);const m=u.aC(c,e),b=this._getOperationsToPerform(m);if(b.unimplemented.length>0)throw new Error(`Unimplemented: ${b.unimplemented.join(", ")}.`);if(b.operations.length===0)return!1;for(const C of b.operations)C();return this.stylesheet=e,this._serializedLayers=null,!0}_getOperationsToPerform(e){const s=[],l=[];for(const c of e)switch(c.command){case"setCenter":case"setZoom":case"setBearing":case"setPitch":continue;case"addLayer":s.push(()=>this.addLayer.apply(this,c.args));break;case"removeLayer":s.push(()=>this.removeLayer.apply(this,c.args));break;case"setPaintProperty":s.push(()=>this.setPaintProperty.apply(this,c.args));break;case"setLayoutProperty":s.push(()=>this.setLayoutProperty.apply(this,c.args));break;case"setFilter":s.push(()=>this.setFilter.apply(this,c.args));break;case"addSource":s.push(()=>this.addSource.apply(this,c.args));break;case"removeSource":s.push(()=>this.removeSource.apply(this,c.args));break;case"setLayerZoomRange":s.push(()=>this.setLayerZoomRange.apply(this,c.args));break;case"setLight":s.push(()=>this.setLight.apply(this,c.args));break;case"setGeoJSONSourceData":s.push(()=>this.setGeoJSONSourceData.apply(this,c.args));break;case"setGlyphs":s.push(()=>this.setGlyphs.apply(this,c.args));break;case"setSprite":s.push(()=>this.setSprite.apply(this,c.args));break;case"setSky":s.push(()=>this.setSky.apply(this,c.args));break;case"setTerrain":s.push(()=>this.map.setTerrain.apply(this,c.args));break;case"setTransition":s.push(()=>{});break;default:l.push(c.command)}return{operations:s,unimplemented:l}}addImage(e,s){if(this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" already exists.`)));this.imageManager.addImage(e,s),this._afterImageUpdated(e)}updateImage(e,s){this.imageManager.updateImage(e,s)}getImage(e){return this.imageManager.getImage(e)}removeImage(e){if(!this.getImage(e))return this.fire(new u.j(new Error(`An image named "${e}" does not exist.`)));this.imageManager.removeImage(e),this._afterImageUpdated(e)}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(e,s,l={}){if(this._checkLoaded(),this.sourceCaches[e]!==void 0)throw new Error(`Source "${e}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(u.u.source,`sources.${e}`,s,null,l))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const c=this.sourceCaches[e]=new ot(e,s,this.dispatcher);c.style=this,c.setEventedParent(this,()=>({isSourceLoaded:c.loaded(),source:c.serialize(),sourceId:e})),c.onAdd(this.map),this._changed=!0}removeSource(e){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error("There is no source with this ID");for(const l in this._layers)if(this._layers[l].source===e)return this.fire(new u.j(new Error(`Source "${e}" cannot be removed while layer "${l}" is using it.`)));const s=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],s.fire(new u.k("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(e,s){if(this._checkLoaded(),this.sourceCaches[e]===void 0)throw new Error(`There is no source with this ID=${e}`);const l=this.sourceCaches[e].getSource();if(l.type!=="geojson")throw new Error(`geojsonSource.type is ${l.type}, which is !== 'geojson`);l.setData(s),this._changed=!0}getSource(e){return this.sourceCaches[e]&&this.sourceCaches[e].getSource()}addLayer(e,s,l={}){this._checkLoaded();const c=e.id;if(this.getLayer(c))return void this.fire(new u.j(new Error(`Layer "${c}" already exists on this map.`)));let m;if(e.type==="custom"){if($n(this,u.aD(e)))return;m=u.aA(e)}else{if("source"in e&&typeof e.source=="object"&&(this.addSource(c,e.source),e=u.aB(e),e=u.e(e,{source:c})),this._validate(u.u.layer,`layers.${c}`,e,{arrayIndex:-1},l))return;m=u.aA(e),this._validateLayer(m),m.setEventedParent(this,{layer:{id:c}})}const b=s?this._order.indexOf(s):this._order.length;if(s&&b===-1)this.fire(new u.j(new Error(`Cannot add layer "${c}" before non-existing layer "${s}".`)));else{if(this._order.splice(b,0,c),this._layerOrderChanged=!0,this._layers[c]=m,this._removedLayers[c]&&m.source&&m.type!=="custom"){const C=this._removedLayers[c];delete this._removedLayers[c],C.type!==m.type?this._updatedSources[m.source]="clear":(this._updatedSources[m.source]="reload",this.sourceCaches[m.source].pause())}this._updateLayer(m),m.onAdd&&m.onAdd(this.map)}}moveLayer(e,s){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new u.j(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===s)return;const l=this._order.indexOf(e);this._order.splice(l,1);const c=s?this._order.indexOf(s):this._order.length;s&&c===-1?this.fire(new u.j(new Error(`Cannot move layer "${e}" before non-existing layer "${s}".`))):(this._order.splice(c,0,e),this._layerOrderChanged=!0)}removeLayer(e){this._checkLoaded();const s=this._layers[e];if(!s)return void this.fire(new u.j(new Error(`Cannot remove non-existing layer "${e}".`)));s.setEventedParent(null);const l=this._order.indexOf(e);this._order.splice(l,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=s,delete this._layers[e],this._serializedLayers&&delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],s.onRemove&&s.onRemove(this.map)}getLayer(e){return this._layers[e]}getLayersOrder(){return[...this._order]}hasLayer(e){return e in this._layers}setLayerZoomRange(e,s,l){this._checkLoaded();const c=this.getLayer(e);c?c.minzoom===s&&c.maxzoom===l||(s!=null&&(c.minzoom=s),l!=null&&(c.maxzoom=l),this._updateLayer(c)):this.fire(new u.j(new Error(`Cannot set the zoom range of non-existing layer "${e}".`)))}setFilter(e,s,l={}){this._checkLoaded();const c=this.getLayer(e);if(c){if(!u.aE(c.filter,s))return s==null?(c.filter=void 0,void this._updateLayer(c)):void(this._validate(u.u.filter,`layers.${c.id}.filter`,s,null,l)||(c.filter=u.aB(s),this._updateLayer(c)))}else this.fire(new u.j(new Error(`Cannot filter non-existing layer "${e}".`)))}getFilter(e){return u.aB(this.getLayer(e).filter)}setLayoutProperty(e,s,l,c={}){this._checkLoaded();const m=this.getLayer(e);m?u.aE(m.getLayoutProperty(s),l)||(m.setLayoutProperty(s,l,c),this._updateLayer(m)):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getLayoutProperty(e,s){const l=this.getLayer(e);if(l)return l.getLayoutProperty(s);this.fire(new u.j(new Error(`Cannot get style of non-existing layer "${e}".`)))}setPaintProperty(e,s,l,c={}){this._checkLoaded();const m=this.getLayer(e);m?u.aE(m.getPaintProperty(s),l)||(m.setPaintProperty(s,l,c)&&this._updateLayer(m),this._changed=!0,this._updatedPaintProps[e]=!0,this._serializedLayers=null):this.fire(new u.j(new Error(`Cannot style non-existing layer "${e}".`)))}getPaintProperty(e,s){return this.getLayer(e).getPaintProperty(s)}setFeatureState(e,s){this._checkLoaded();const l=e.source,c=e.sourceLayer,m=this.sourceCaches[l];if(m===void 0)return void this.fire(new u.j(new Error(`The source '${l}' does not exist in the map's style.`)));const b=m.getSource().type;b==="geojson"&&c?this.fire(new u.j(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):b!=="vector"||c?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),m.setFeatureState(c,e.id,s)):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(e,s){this._checkLoaded();const l=e.source,c=this.sourceCaches[l];if(c===void 0)return void this.fire(new u.j(new Error(`The source '${l}' does not exist in the map's style.`)));const m=c.getSource().type,b=m==="vector"?e.sourceLayer:void 0;m!=="vector"||b?s&&typeof e.id!="string"&&typeof e.id!="number"?this.fire(new u.j(new Error("A feature id is required to remove its specific state property."))):c.removeFeatureState(b,e.id,s):this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(e){this._checkLoaded();const s=e.source,l=e.sourceLayer,c=this.sourceCaches[s];if(c!==void 0)return c.getSource().type!=="vector"||l?(e.id===void 0&&this.fire(new u.j(new Error("The feature id parameter must be provided."))),c.getFeatureState(l,e.id)):void this.fire(new u.j(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.j(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return u.e({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){if(!this._loaded)return;const e=u.aF(this.sourceCaches,m=>m.serialize()),s=this._serializeByIds(this._order,!0),l=this.map.getTerrain()||void 0,c=this.stylesheet;return u.aG({version:c.version,name:c.name,metadata:c.metadata,light:c.light,sky:c.sky,center:c.center,zoom:c.zoom,bearing:c.bearing,pitch:c.pitch,sprite:c.sprite,glyphs:c.glyphs,transition:c.transition,sources:e,layers:s,terrain:l},m=>m!==void 0)}_updateLayer(e){this._updatedLayers[e.id]=!0,e.source&&!this._updatedSources[e.source]&&this.sourceCaches[e.source].getSource().type!=="raster"&&(this._updatedSources[e.source]="reload",this.sourceCaches[e.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(e){const s=b=>this._layers[b].type==="fill-extrusion",l={},c=[];for(let b=this._order.length-1;b>=0;b--){const C=this._order[b];if(s(C)){l[C]=b;for(const I of e){const P=I[C];if(P)for(const k of P)c.push(k)}}}c.sort((b,C)=>C.intersectionZ-b.intersectionZ);const m=[];for(let b=this._order.length-1;b>=0;b--){const C=this._order[b];if(s(C))for(let I=c.length-1;I>=0;I--){const P=c[I].feature;if(l[P.layer.id]<b)break;m.push(P),c.pop()}else for(const I of e){const P=I[C];if(P)for(const k of P)m.push(k.feature)}}return m}queryRenderedFeatures(e,s,l){s&&s.filter&&this._validate(u.u.filter,"queryRenderedFeatures.filter",s.filter,null,s);const c={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new u.j(new Error("parameters.layers must be an Array."))),[];for(const C of s.layers){const I=this._layers[C];if(!I)return this.fire(new u.j(new Error(`The layer '${C}' does not exist in the map's style and cannot be queried for features.`))),[];c[I.source]=!0}}const m=[];s.availableImages=this._availableImages;const b=this._serializedAllLayers();for(const C in this.sourceCaches)s.layers&&!c[C]||m.push(kr(this.sourceCaches[C],this._layers,b,e,s,l));return this.placement&&m.push(function(C,I,P,k,A,B,$){const H={},Y=B.queryRenderedSymbols(k),Q=[];for(const ee of Object.keys(Y).map(Number))Q.push($[ee]);Q.sort(Ar);for(const ee of Q){const ne=ee.featureIndex.lookupSymbolFeatures(Y[ee.bucketInstanceId],I,ee.bucketIndex,ee.sourceLayerIndex,A.filter,A.layers,A.availableImages,C);for(const Z in ne){const ae=H[Z]=H[Z]||[],ce=ne[Z];ce.sort((me,be)=>{const Ie=ee.featureSortOrder;if(Ie){const Le=Ie.indexOf(me.featureIndex);return Ie.indexOf(be.featureIndex)-Le}return be.featureIndex-me.featureIndex});for(const me of ce)ae.push(me)}}for(const ee in H)H[ee].forEach(ne=>{const Z=ne.feature,ae=P[C[ee].source].getFeatureState(Z.layer["source-layer"],Z.id);Z.source=Z.layer.source,Z.layer["source-layer"]&&(Z.sourceLayer=Z.layer["source-layer"]),Z.state=ae});return H}(this._layers,b,this.sourceCaches,e,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(m)}querySourceFeatures(e,s){s&&s.filter&&this._validate(u.u.filter,"querySourceFeatures.filter",s.filter,null,s);const l=this.sourceCaches[e];return l?function(c,m){const b=c.getRenderableIds().map(P=>c.getTileByID(P)),C=[],I={};for(let P=0;P<b.length;P++){const k=b[P],A=k.tileID.canonical.key;I[A]||(I[A]=!0,k.querySourceFeatures(C,m))}return C}(l,s):[]}getLight(){return this.light.getLight()}setLight(e,s={}){this._checkLoaded();const l=this.light.getLight();let c=!1;for(const b in e)if(!u.aE(e[b],l[b])){c=!0;break}if(!c)return;const m={now:q.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,s),this.light.updateTransitions(m)}getSky(){var e;return(e=this.stylesheet)===null||e===void 0?void 0:e.sky}setSky(e,s={}){const l=this.getSky();let c=!1;if(!e&&!l)return;if(e&&!l)c=!0;else if(!e&&l)c=!0;else for(const b in e)if(!u.aE(e[b],l[b])){c=!0;break}if(!c)return;const m={now:q.now(),transition:u.e({duration:300,delay:0},this.stylesheet.transition)};this.stylesheet.sky=e,this.sky.setSky(e,s),this.sky.updateTransitions(m)}_validate(e,s,l,c,m={}){return(!m||m.validate!==!1)&&$n(this,e.call(u.u,u.e({key:s,style:this.serialize(),value:l,styleSpec:u.v},c)))}_remove(e=!0){this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._loadStyleRequest&&(this._loadStyleRequest.abort(),this._loadStyleRequest=null),this._spriteRequest&&(this._spriteRequest.abort(),this._spriteRequest=null),ar().off(Ee,this._rtlPluginLoaded);for(const s in this._layers)this._layers[s].setEventedParent(null);for(const s in this.sourceCaches){const l=this.sourceCaches[s];l.setEventedParent(null),l.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),e&&this.dispatcher.broadcast("RM",void 0),this.dispatcher.remove(e)}_clearSource(e){this.sourceCaches[e].clearTiles()}_reloadSource(e){this.sourceCaches[e].resume(),this.sourceCaches[e].reload()}_updateSources(e){for(const s in this.sourceCaches)this.sourceCaches[s].update(e,this.map.terrain)}_generateCollisionBoxes(){for(const e in this.sourceCaches)this._reloadSource(e)}_updatePlacement(e,s,l,c,m=!1){let b=!1,C=!1;const I={};for(const P of this._order){const k=this._layers[P];if(k.type!=="symbol")continue;if(!I[k.source]){const B=this.sourceCaches[k.source];I[k.source]=B.getRenderableIds(!0).map($=>B.getTileByID($)).sort(($,H)=>H.tileID.overscaledZ-$.tileID.overscaledZ||($.tileID.isLessThan(H.tileID)?-1:1))}const A=this.crossTileSymbolIndex.addLayer(k,I[k.source],e.center.lng);b=b||A}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((m=m||this._layerOrderChanged||l===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(q.now(),e.zoom))&&(this.pauseablePlacement=new To(e,this.map.terrain,this._order,m,s,l,c,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,I),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(q.now()),C=!0),b&&this.pauseablePlacement.placement.setStale()),C||b)for(const P of this._order){const k=this._layers[P];k.type==="symbol"&&this.placement.updateLayerOpacities(k,I[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(q.now())}_releaseSymbolFadeTiles(){for(const e in this.sourceCaches)this.sourceCaches[e].releaseSymbolFadeTiles()}getImages(e,s){return u._(this,void 0,void 0,function*(){const l=yield this.imageManager.getImages(s.icons);this._updateTilesForChangedImages();const c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,s.icons),l})}getGlyphs(e,s){return u._(this,void 0,void 0,function*(){const l=yield this.glyphManager.getGlyphs(s.stacks),c=this.sourceCaches[s.source];return c&&c.setDependencies(s.tileID.key,s.type,[""]),l})}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(e,s={}){this._checkLoaded(),e&&this._validate(u.u.glyphs,"glyphs",e,null,s)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=e,this.glyphManager.entries={},this.glyphManager.setURL(e))}addSprite(e,s,l={},c){this._checkLoaded();const m=[{id:e,url:s}],b=[...Ve(this.stylesheet.sprite),...m];this._validate(u.u.sprite,"sprite",b,null,l)||(this.stylesheet.sprite=b,this._loadSprite(m,!0,c))}removeSprite(e){this._checkLoaded();const s=Ve(this.stylesheet.sprite);if(s.find(l=>l.id===e)){if(this._spritesImagesIds[e])for(const l of this._spritesImagesIds[e])this.imageManager.removeImage(l),this._changedImages[l]=!0;s.splice(s.findIndex(l=>l.id===e),1),this.stylesheet.sprite=s.length>0?s:void 0,delete this._spritesImagesIds[e],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("SI",this._availableImages),this.fire(new u.k("data",{dataType:"style"}))}else this.fire(new u.j(new Error(`Sprite "${e}" doesn't exists on this map.`)))}getSprite(){return Ve(this.stylesheet.sprite)}setSprite(e,s={},l){this._checkLoaded(),e&&this._validate(u.u.sprite,"sprite",e,null,s)||(this.stylesheet.sprite=e,e?this._loadSprite(e,!0,l):(this._unloadSprite(),l&&l(null)))}}var Yr=u.Y([{name:"a_pos",type:"Int16",components:2}]);const Rr={prelude:zt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:zt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:zt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:zt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);float antialiased_blur=v_data.z;float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}float antialiasblur=-max(1.0/u_device_pixel_ratio/(radius+stroke_width),blur);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:zt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:zt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,get_elevation(floor(a_pos*0.5)),1);gl_Position=u_matrix*pos;}`),heatmapTexture:zt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:zt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_anchor_pos;attribute vec2 a_placed;attribute vec2 a_box_real;uniform mat4 u_matrix;uniform vec2 u_pixel_extrude_scale;varying float v_placed;varying float v_notUsed;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}void main() {gl_Position=projectTileWithElevation(a_anchor_pos,get_elevation(a_anchor_pos));gl_Position.xy=((a_box_real+0.5)*u_pixel_extrude_scale*2.0-1.0)*vec2(1.0,-1.0)*gl_Position.w;if (gl_Position.z/gl_Position.w < 1.1) {gl_Position.z=0.5;}v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:zt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:zt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:zt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:zt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:zt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:zt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:zt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:zt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:zt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:zt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:zt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:zt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:zt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:zt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:zt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_tex;varying float v_fade_opacity;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}gl_Position=finalPos;v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:zt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float inner_edge=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);inner_edge=inner_edge+gamma*gamma_scale;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(inner_edge-gamma_scaled,inner_edge+gamma_scaled,dist);if (u_is_halo) {lowp float halo_edge=(6.0-halo_width/fontScale)/SDF_PX;alpha=min(smoothstep(halo_edge-gamma_scaled,halo_edge+gamma_scaled,dist),1.0-alpha);}gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec2 v_data0;varying vec3 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:zt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;uniform bool u_is_along_line;uniform bool u_is_variable_anchor;uniform vec2 u_translation;uniform float u_pitched_scale;varying vec4 v_data0;varying vec4 v_data1;vec4 projectTileWithElevation(vec2 posInTile,float elevation) {return u_matrix*vec4(posInTile,elevation,1.0);}
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 translated_a_pos=a_pos+u_translation;vec4 projectedPoint=projectTileWithElevation(translated_a_pos,ele);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=projectTileWithElevation(translated_a_pos+vec2(1,0),ele);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos;if (u_is_along_line || u_is_variable_anchor) {projected_pos=vec4(a_projected_pos.xy,ele,1.0);} else if (u_pitch_with_map) {projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy+u_translation,ele,1.0);} else {projected_pos=u_label_plane_matrix*projectTileWithElevation(a_projected_pos.xy+u_translation,ele);}float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;float projectionScaling=1.0;vec4 finalPos=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale)*projectionScaling,z,1.0);if(u_pitch_with_map) {finalPos=projectTileWithElevation(finalPos.xy,finalPos.z);}float gamma_scale=finalPos.w;gl_Position=finalPos;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:zt("uniform sampler2D u_texture;uniform vec4 u_fog_color;uniform vec4 u_horizon_color;uniform float u_fog_ground_blend;uniform float u_fog_ground_blend_opacity;uniform float u_horizon_fog_blend;varying vec2 v_texture_pos;varying float v_fog_depth;const float gamma=2.2;vec4 gammaToLinear(vec4 color) {return pow(color,vec4(gamma));}vec4 linearToGamma(vec4 color) {return pow(color,vec4(1.0/gamma));}void main() {vec4 surface_color=texture2D(u_texture,v_texture_pos);if (v_fog_depth > u_fog_ground_blend) {vec4 surface_color_linear=gammaToLinear(surface_color);float blend_color=smoothstep(0.0,1.0,max((v_fog_depth-u_horizon_fog_blend)/(1.0-u_horizon_fog_blend),0.0));vec4 fog_horizon_color_linear=mix(gammaToLinear(u_fog_color),gammaToLinear(u_horizon_color),blend_color);float factor_fog=max(v_fog_depth-u_fog_ground_blend,0.0)/(1.0-u_fog_ground_blend);gl_FragColor=linearToGamma(mix(surface_color_linear,fog_horizon_color_linear,pow(factor_fog,2.0)*u_fog_ground_blend_opacity));} else {gl_FragColor=surface_color;}}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform mat4 u_fog_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_fog_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);vec4 pos=u_fog_matrix*vec4(a_pos3d.xy,ele,1.0);v_fog_depth=pos.z/pos.w*0.5+0.5;}"),terrainDepth:zt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying float v_depth;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}"),terrainCoords:zt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}","attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;void main() {float ele=get_elevation(a_pos3d.xy);float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/8192.0;gl_Position=u_matrix*vec4(a_pos3d.xy,ele-ele_delta,1.0);}"),sky:zt("uniform vec4 u_sky_color;uniform vec4 u_horizon_color;uniform float u_horizon;uniform float u_sky_horizon_blend;void main() {float y=gl_FragCoord.y;if (y > u_horizon) {float blend=y-u_horizon;if (blend < u_sky_horizon_blend) {gl_FragColor=mix(u_sky_color,u_horizon_color,pow(1.0-blend/u_sky_horizon_blend,2.0));} else {gl_FragColor=u_sky_color;}}}","attribute vec2 a_pos;void main() {gl_Position=vec4(a_pos,1.0,1.0);}")};function zt(f,e){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,l=e.match(/attribute ([\w]+) ([\w]+)/g),c=f.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),m=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),b=m?m.concat(c):c,C={};return{fragmentSource:f=f.replace(s,(I,P,k,A,B)=>(C[B]=!0,P==="define"?`
#ifndef HAS_UNIFORM_u_${B}
varying ${k} ${A} ${B};
#else
uniform ${k} ${A} u_${B};
#endif
`:`
#ifdef HAS_UNIFORM_u_${B}
    ${k} ${A} ${B} = u_${B};
#endif
`)),vertexSource:e=e.replace(s,(I,P,k,A,B)=>{const $=A==="float"?"vec2":"vec4",H=B.match(/color/)?"color":$;return C[B]?P==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${k} ${$} a_${B};
varying ${k} ${A} ${B};
#else
uniform ${k} ${A} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = a_${B};
#else
    ${k} ${A} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${k} ${A} ${B} = u_${B};
#endif
`:P==="define"?`
#ifndef HAS_UNIFORM_u_${B}
uniform lowp float u_${B}_t;
attribute ${k} ${$} a_${B};
#else
uniform ${k} ${A} u_${B};
#endif
`:H==="vec4"?`
#ifndef HAS_UNIFORM_u_${B}
    ${k} ${A} ${B} = a_${B};
#else
    ${k} ${A} ${B} = u_${B};
#endif
`:`
#ifndef HAS_UNIFORM_u_${B}
    ${k} ${A} ${B} = unpack_mix_${H}(a_${B}, u_${B}_t);
#else
    ${k} ${A} ${B} = u_${B};
#endif
`}),staticAttributes:l,staticUniforms:b}}class Sl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(e,s,l,c,m,b,C,I,P){this.context=e;let k=this.boundPaintVertexBuffers.length!==c.length;for(let A=0;!k&&A<c.length;A++)this.boundPaintVertexBuffers[A]!==c[A]&&(k=!0);!this.vao||this.boundProgram!==s||this.boundLayoutVertexBuffer!==l||k||this.boundIndexBuffer!==m||this.boundVertexOffset!==b||this.boundDynamicVertexBuffer!==C||this.boundDynamicVertexBuffer2!==I||this.boundDynamicVertexBuffer3!==P?this.freshBind(s,l,c,m,b,C,I,P):(e.bindVertexArray.set(this.vao),C&&C.bind(),m&&m.dynamicDraw&&m.bind(),I&&I.bind(),P&&P.bind())}freshBind(e,s,l,c,m,b,C,I){const P=e.numAttributes,k=this.context,A=k.gl;this.vao&&this.destroy(),this.vao=k.createVertexArray(),k.bindVertexArray.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=l,this.boundIndexBuffer=c,this.boundVertexOffset=m,this.boundDynamicVertexBuffer=b,this.boundDynamicVertexBuffer2=C,this.boundDynamicVertexBuffer3=I,s.enableAttributes(A,e);for(const B of l)B.enableAttributes(A,e);b&&b.enableAttributes(A,e),C&&C.enableAttributes(A,e),I&&I.enableAttributes(A,e),s.bind(),s.setVertexAttribPointers(A,e,m);for(const B of l)B.bind(),B.setVertexAttribPointers(A,e,m);b&&(b.bind(),b.setVertexAttribPointers(A,e,m)),c&&c.bind(),C&&(C.bind(),C.setVertexAttribPointers(A,e,m)),I&&(I.bind(),I.setVertexAttribPointers(A,e,m)),k.currentNumAttributes=P}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}const Il=(f,e,s,l,c)=>({u_matrix:f,u_texture:0,u_ele_delta:e,u_fog_matrix:s,u_fog_color:l?l.properties.get("fog-color"):u.aM.white,u_fog_ground_blend:l?l.properties.get("fog-ground-blend"):1,u_fog_ground_blend_opacity:l?l.calculateFogBlendOpacity(c):0,u_horizon_color:l?l.properties.get("horizon-color"):u.aM.white,u_horizon_fog_blend:l?l.properties.get("horizon-fog-blend"):1});function Ts(f){const e=[];for(let s=0;s<f.length;s++){if(f[s]===null)continue;const l=f[s].split(" ");e.push(l.pop())}return e}class Tl{constructor(e,s,l,c,m,b){const C=e.gl;this.program=C.createProgram();const I=Ts(s.staticAttributes),P=l?l.getBinderAttributes():[],k=I.concat(P),A=Rr.prelude.staticUniforms?Ts(Rr.prelude.staticUniforms):[],B=s.staticUniforms?Ts(s.staticUniforms):[],$=l?l.getBinderUniforms():[],H=A.concat(B).concat($),Y=[];for(const me of H)Y.indexOf(me)<0&&Y.push(me);const Q=l?l.defines():[];m&&Q.push("#define OVERDRAW_INSPECTOR;"),b&&Q.push("#define TERRAIN3D;");const ee=Q.concat(Rr.prelude.fragmentSource,s.fragmentSource).join(`
`),ne=Q.concat(Rr.prelude.vertexSource,s.vertexSource).join(`
`),Z=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(Z,ee),C.compileShader(Z),!C.getShaderParameter(Z,C.COMPILE_STATUS))throw new Error(`Could not compile fragment shader: ${C.getShaderInfoLog(Z)}`);C.attachShader(this.program,Z);const ae=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);if(C.shaderSource(ae,ne),C.compileShader(ae),!C.getShaderParameter(ae,C.COMPILE_STATUS))throw new Error(`Could not compile vertex shader: ${C.getShaderInfoLog(ae)}`);C.attachShader(this.program,ae),this.attributes={};const ce={};this.numAttributes=k.length;for(let me=0;me<this.numAttributes;me++)k[me]&&(C.bindAttribLocation(this.program,me,k[me]),this.attributes[k[me]]=me);if(C.linkProgram(this.program),!C.getProgramParameter(this.program,C.LINK_STATUS))throw new Error(`Program failed to link: ${C.getProgramInfoLog(this.program)}`);C.deleteShader(ae),C.deleteShader(Z);for(let me=0;me<Y.length;me++){const be=Y[me];if(be&&!ce[be]){const Ie=C.getUniformLocation(this.program,be);Ie&&(ce[be]=Ie)}}this.fixedUniforms=c(e,ce),this.terrainUniforms=((me,be)=>({u_depth:new u.aH(me,be.u_depth),u_terrain:new u.aH(me,be.u_terrain),u_terrain_dim:new u.aI(me,be.u_terrain_dim),u_terrain_matrix:new u.aJ(me,be.u_terrain_matrix),u_terrain_unpack:new u.aK(me,be.u_terrain_unpack),u_terrain_exaggeration:new u.aI(me,be.u_terrain_exaggeration)}))(e,ce),this.binderUniforms=l?l.getUniforms(e,ce):[]}draw(e,s,l,c,m,b,C,I,P,k,A,B,$,H,Y,Q,ee,ne){const Z=e.gl;if(this.failedToCreate)return;if(e.program.set(this.program),e.setDepthMode(l),e.setStencilMode(c),e.setColorMode(m),e.setCullFace(b),I){e.activeTexture.set(Z.TEXTURE2),Z.bindTexture(Z.TEXTURE_2D,I.depthTexture),e.activeTexture.set(Z.TEXTURE3),Z.bindTexture(Z.TEXTURE_2D,I.texture);for(const ce in this.terrainUniforms)this.terrainUniforms[ce].set(I[ce])}for(const ce in this.fixedUniforms)this.fixedUniforms[ce].set(C[ce]);Y&&Y.setUniforms(e,this.binderUniforms,$,{zoom:H});let ae=0;switch(s){case Z.LINES:ae=2;break;case Z.TRIANGLES:ae=3;break;case Z.LINE_STRIP:ae=1}for(const ce of B.get()){const me=ce.vaos||(ce.vaos={});(me[P]||(me[P]=new Sl)).bind(e,this,k,Y?Y.getPaintVertexBuffers():[],A,ce.vertexOffset,Q,ee,ne),Z.drawElements(s,ce.primitiveLength*ae,Z.UNSIGNED_SHORT,ce.primitiveOffset*ae*2)}}}function ha(f,e,s){const l=1/vt(s,1,e.transform.tileZoom),c=Math.pow(2,s.tileID.overscaledZ),m=s.tileSize*Math.pow(2,e.transform.tileZoom)/c,b=m*(s.tileID.canonical.x+s.tileID.wrap*c),C=m*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[l,f.fromScale,f.toScale],u_fade:f.t,u_pixel_coord_upper:[b>>16,C>>16],u_pixel_coord_lower:[65535&b,65535&C]}}const Eo=(f,e,s,l)=>{const c=e.style.light,m=c.properties.get("position"),b=[m.x,m.y,m.z],C=function(){var P=new u.A(9);return u.A!=Float32Array&&(P[1]=0,P[2]=0,P[3]=0,P[5]=0,P[6]=0,P[7]=0),P[0]=1,P[4]=1,P[8]=1,P}();c.properties.get("anchor")==="viewport"&&function(P,k){var A=Math.sin(k),B=Math.cos(k);P[0]=B,P[1]=A,P[2]=0,P[3]=-A,P[4]=B,P[5]=0,P[6]=0,P[7]=0,P[8]=1}(C,-e.transform.angle),function(P,k,A){var B=k[0],$=k[1],H=k[2];P[0]=B*A[0]+$*A[3]+H*A[6],P[1]=B*A[1]+$*A[4]+H*A[7],P[2]=B*A[2]+$*A[5]+H*A[8]}(b,b,C);const I=c.properties.get("color");return{u_matrix:f,u_lightpos:b,u_lightintensity:c.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_vertical_gradient:+s,u_opacity:l}},da=(f,e,s,l,c,m,b)=>u.e(Eo(f,e,s,l),ha(m,e,b),{u_height_factor:-Math.pow(2,c.overscaledZ)/b.tileSize/8}),Es=f=>({u_matrix:f}),eu=(f,e,s,l)=>u.e(Es(f),ha(s,e,l)),Th=(f,e)=>({u_matrix:f,u_world:e}),tu=(f,e,s,l,c)=>u.e(eu(f,e,s,l),{u_world:c}),Eh=(f,e,s,l)=>{const c=f.transform;let m,b;if(l.paint.get("circle-pitch-alignment")==="map"){const C=vt(s,1,c.zoom);m=!0,b=[C,C]}else m=!1,b=c.pixelsToGLUnits;return{u_camera_to_center_distance:c.cameraToCenterDistance,u_scale_with_map:+(l.paint.get("circle-pitch-scale")==="map"),u_matrix:f.translatePosMatrix(e.posMatrix,s,l.paint.get("circle-translate"),l.paint.get("circle-translate-anchor")),u_pitch_with_map:+m,u_device_pixel_ratio:f.pixelRatio,u_extrude_scale:b}},Kr=(f,e,s)=>({u_matrix:f,u_inv_matrix:e,u_camera_to_center_distance:s.cameraToCenterDistance,u_viewport_size:[s.width,s.height]}),Po=(f,e,s=1)=>({u_matrix:f,u_color:e,u_overlay:0,u_overlay_scale:s}),sn=f=>({u_matrix:f}),on=(f,e,s,l)=>({u_matrix:f,u_extrude_scale:vt(e,1,s),u_intensity:l}),pa=(f,e,s,l)=>{const c=u.H();u.aP(c,0,f.width,f.height,0,0,1);const m=f.context.gl;return{u_matrix:c,u_world:[m.drawingBufferWidth,m.drawingBufferHeight],u_image:s,u_color_ramp:l,u_opacity:e.paint.get("heatmap-opacity")}};function ma(f,e){const s=Math.pow(2,e.canonical.z),l=e.canonical.y;return[new u.Z(0,l/s).toLngLat().lat,new u.Z(0,(l+1)/s).toLngLat().lat]}const fa=(f,e,s,l)=>{const c=f.transform;return{u_matrix:ru(f,e,s,l),u_ratio:1/vt(e,1,c.zoom),u_device_pixel_ratio:f.pixelRatio,u_units_to_pixels:[1/c.pixelsToGLUnits[0],1/c.pixelsToGLUnits[1]]}},iu=(f,e,s,l,c)=>u.e(fa(f,e,s,c),{u_image:0,u_image_height:l}),Ps=(f,e,s,l,c)=>{const m=f.transform,b=nu(e,m);return{u_matrix:ru(f,e,s,c),u_texsize:e.imageAtlasTexture.size,u_ratio:1/vt(e,1,m.zoom),u_device_pixel_ratio:f.pixelRatio,u_image:0,u_scale:[b,l.fromScale,l.toScale],u_fade:l.t,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Ph=(f,e,s,l,c,m)=>{const b=f.lineAtlas,C=nu(e,f.transform),I=s.layout.get("line-cap")==="round",P=b.getDash(l.from,I),k=b.getDash(l.to,I),A=P.width*c.fromScale,B=k.width*c.toScale;return u.e(fa(f,e,s,m),{u_patternscale_a:[C/A,-P.height/2],u_patternscale_b:[C/B,-k.height/2],u_sdfgamma:b.width/(256*Math.min(A,B)*f.pixelRatio)/2,u_image:0,u_tex_y_a:P.y,u_tex_y_b:k.y,u_mix:c.t})};function nu(f,e){return 1/vt(f,1,e.tileZoom)}function ru(f,e,s,l){return f.translatePosMatrix(l?l.posMatrix:e.tileID.posMatrix,e,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Mh=(f,e,s,l,c)=>{return{u_matrix:f,u_tl_parent:e,u_scale_parent:s,u_buffer_scale:1,u_fade_t:l.mix,u_opacity:l.opacity*c.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:c.paint.get("raster-brightness-min"),u_brightness_high:c.paint.get("raster-brightness-max"),u_saturation_factor:(b=c.paint.get("raster-saturation"),b>0?1-1/(1.001-b):-b),u_contrast_factor:(m=c.paint.get("raster-contrast"),m>0?1/(1-m):1+m),u_spin_weights:kh(c.paint.get("raster-hue-rotate"))};var m,b};function kh(f){f*=Math.PI/180;const e=Math.sin(f),s=Math.cos(f);return[(2*s+1)/3,(-Math.sqrt(3)*e-s+1)/3,(Math.sqrt(3)*e-s+1)/3]}const su=(f,e,s,l,c,m,b,C,I,P,k,A,B,$)=>{const H=b.transform;return{u_is_size_zoom_constant:+(f==="constant"||f==="source"),u_is_size_feature_constant:+(f==="constant"||f==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:H.cameraToCenterDistance,u_pitch:H.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:H.width/H.height,u_fade_change:b.options.fadeDuration?b.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:I,u_coord_matrix:P,u_is_text:+A,u_pitch_with_map:+l,u_is_along_line:c,u_is_variable_anchor:m,u_texsize:B,u_texture:0,u_translation:k,u_pitched_scale:$}},Mo=(f,e,s,l,c,m,b,C,I,P,k,A,B,$,H)=>{const Y=b.transform;return u.e(su(f,e,s,l,c,m,b,C,I,P,k,A,B,H),{u_gamma_scale:l?Math.cos(Y._pitch)*Y.cameraToCenterDistance:1,u_device_pixel_ratio:b.pixelRatio,u_is_halo:+$})},El=(f,e,s,l,c,m,b,C,I,P,k,A,B,$)=>u.e(Mo(f,e,s,l,c,m,b,C,I,P,k,!0,A,!0,$),{u_texsize_icon:B,u_texture_icon:1}),ga=(f,e,s)=>({u_matrix:f,u_opacity:e,u_color:s}),Pl=(f,e,s,l,c,m)=>u.e(function(b,C,I,P){const k=I.imageManager.getPattern(b.from.toString()),A=I.imageManager.getPattern(b.to.toString()),{width:B,height:$}=I.imageManager.getPixelSize(),H=Math.pow(2,P.tileID.overscaledZ),Y=P.tileSize*Math.pow(2,I.transform.tileZoom)/H,Q=Y*(P.tileID.canonical.x+P.tileID.wrap*H),ee=Y*P.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:k.tl,u_pattern_br_a:k.br,u_pattern_tl_b:A.tl,u_pattern_br_b:A.br,u_texsize:[B,$],u_mix:C.t,u_pattern_size_a:k.displaySize,u_pattern_size_b:A.displaySize,u_scale_a:C.fromScale,u_scale_b:C.toScale,u_tile_units_to_pixels:1/vt(P,1,I.transform.tileZoom),u_pixel_coord_upper:[Q>>16,ee>>16],u_pixel_coord_lower:[65535&Q,65535&ee]}}(l,m,s,c),{u_matrix:f,u_opacity:e}),Ml={fillExtrusion:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_lightpos:new u.aN(f,e.u_lightpos),u_lightintensity:new u.aI(f,e.u_lightintensity),u_lightcolor:new u.aN(f,e.u_lightcolor),u_vertical_gradient:new u.aI(f,e.u_vertical_gradient),u_opacity:new u.aI(f,e.u_opacity)}),fillExtrusionPattern:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_lightpos:new u.aN(f,e.u_lightpos),u_lightintensity:new u.aI(f,e.u_lightintensity),u_lightcolor:new u.aN(f,e.u_lightcolor),u_vertical_gradient:new u.aI(f,e.u_vertical_gradient),u_height_factor:new u.aI(f,e.u_height_factor),u_image:new u.aH(f,e.u_image),u_texsize:new u.aO(f,e.u_texsize),u_pixel_coord_upper:new u.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(f,e.u_pixel_coord_lower),u_scale:new u.aN(f,e.u_scale),u_fade:new u.aI(f,e.u_fade),u_opacity:new u.aI(f,e.u_opacity)}),fill:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix)}),fillPattern:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_image:new u.aH(f,e.u_image),u_texsize:new u.aO(f,e.u_texsize),u_pixel_coord_upper:new u.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(f,e.u_pixel_coord_lower),u_scale:new u.aN(f,e.u_scale),u_fade:new u.aI(f,e.u_fade)}),fillOutline:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_world:new u.aO(f,e.u_world)}),fillOutlinePattern:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_world:new u.aO(f,e.u_world),u_image:new u.aH(f,e.u_image),u_texsize:new u.aO(f,e.u_texsize),u_pixel_coord_upper:new u.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(f,e.u_pixel_coord_lower),u_scale:new u.aN(f,e.u_scale),u_fade:new u.aI(f,e.u_fade)}),circle:(f,e)=>({u_camera_to_center_distance:new u.aI(f,e.u_camera_to_center_distance),u_scale_with_map:new u.aH(f,e.u_scale_with_map),u_pitch_with_map:new u.aH(f,e.u_pitch_with_map),u_extrude_scale:new u.aO(f,e.u_extrude_scale),u_device_pixel_ratio:new u.aI(f,e.u_device_pixel_ratio),u_matrix:new u.aJ(f,e.u_matrix)}),collisionBox:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_pixel_extrude_scale:new u.aO(f,e.u_pixel_extrude_scale)}),collisionCircle:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_inv_matrix:new u.aJ(f,e.u_inv_matrix),u_camera_to_center_distance:new u.aI(f,e.u_camera_to_center_distance),u_viewport_size:new u.aO(f,e.u_viewport_size)}),debug:(f,e)=>({u_color:new u.aL(f,e.u_color),u_matrix:new u.aJ(f,e.u_matrix),u_overlay:new u.aH(f,e.u_overlay),u_overlay_scale:new u.aI(f,e.u_overlay_scale)}),clippingMask:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix)}),heatmap:(f,e)=>({u_extrude_scale:new u.aI(f,e.u_extrude_scale),u_intensity:new u.aI(f,e.u_intensity),u_matrix:new u.aJ(f,e.u_matrix)}),heatmapTexture:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_world:new u.aO(f,e.u_world),u_image:new u.aH(f,e.u_image),u_color_ramp:new u.aH(f,e.u_color_ramp),u_opacity:new u.aI(f,e.u_opacity)}),hillshade:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_image:new u.aH(f,e.u_image),u_latrange:new u.aO(f,e.u_latrange),u_light:new u.aO(f,e.u_light),u_shadow:new u.aL(f,e.u_shadow),u_highlight:new u.aL(f,e.u_highlight),u_accent:new u.aL(f,e.u_accent)}),hillshadePrepare:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_image:new u.aH(f,e.u_image),u_dimension:new u.aO(f,e.u_dimension),u_zoom:new u.aI(f,e.u_zoom),u_unpack:new u.aK(f,e.u_unpack)}),line:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_ratio:new u.aI(f,e.u_ratio),u_device_pixel_ratio:new u.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(f,e.u_units_to_pixels)}),lineGradient:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_ratio:new u.aI(f,e.u_ratio),u_device_pixel_ratio:new u.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(f,e.u_units_to_pixels),u_image:new u.aH(f,e.u_image),u_image_height:new u.aI(f,e.u_image_height)}),linePattern:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_texsize:new u.aO(f,e.u_texsize),u_ratio:new u.aI(f,e.u_ratio),u_device_pixel_ratio:new u.aI(f,e.u_device_pixel_ratio),u_image:new u.aH(f,e.u_image),u_units_to_pixels:new u.aO(f,e.u_units_to_pixels),u_scale:new u.aN(f,e.u_scale),u_fade:new u.aI(f,e.u_fade)}),lineSDF:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_ratio:new u.aI(f,e.u_ratio),u_device_pixel_ratio:new u.aI(f,e.u_device_pixel_ratio),u_units_to_pixels:new u.aO(f,e.u_units_to_pixels),u_patternscale_a:new u.aO(f,e.u_patternscale_a),u_patternscale_b:new u.aO(f,e.u_patternscale_b),u_sdfgamma:new u.aI(f,e.u_sdfgamma),u_image:new u.aH(f,e.u_image),u_tex_y_a:new u.aI(f,e.u_tex_y_a),u_tex_y_b:new u.aI(f,e.u_tex_y_b),u_mix:new u.aI(f,e.u_mix)}),raster:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_tl_parent:new u.aO(f,e.u_tl_parent),u_scale_parent:new u.aI(f,e.u_scale_parent),u_buffer_scale:new u.aI(f,e.u_buffer_scale),u_fade_t:new u.aI(f,e.u_fade_t),u_opacity:new u.aI(f,e.u_opacity),u_image0:new u.aH(f,e.u_image0),u_image1:new u.aH(f,e.u_image1),u_brightness_low:new u.aI(f,e.u_brightness_low),u_brightness_high:new u.aI(f,e.u_brightness_high),u_saturation_factor:new u.aI(f,e.u_saturation_factor),u_contrast_factor:new u.aI(f,e.u_contrast_factor),u_spin_weights:new u.aN(f,e.u_spin_weights)}),symbolIcon:(f,e)=>({u_is_size_zoom_constant:new u.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(f,e.u_is_size_feature_constant),u_size_t:new u.aI(f,e.u_size_t),u_size:new u.aI(f,e.u_size),u_camera_to_center_distance:new u.aI(f,e.u_camera_to_center_distance),u_pitch:new u.aI(f,e.u_pitch),u_rotate_symbol:new u.aH(f,e.u_rotate_symbol),u_aspect_ratio:new u.aI(f,e.u_aspect_ratio),u_fade_change:new u.aI(f,e.u_fade_change),u_matrix:new u.aJ(f,e.u_matrix),u_label_plane_matrix:new u.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(f,e.u_coord_matrix),u_is_text:new u.aH(f,e.u_is_text),u_pitch_with_map:new u.aH(f,e.u_pitch_with_map),u_is_along_line:new u.aH(f,e.u_is_along_line),u_is_variable_anchor:new u.aH(f,e.u_is_variable_anchor),u_texsize:new u.aO(f,e.u_texsize),u_texture:new u.aH(f,e.u_texture),u_translation:new u.aO(f,e.u_translation),u_pitched_scale:new u.aI(f,e.u_pitched_scale)}),symbolSDF:(f,e)=>({u_is_size_zoom_constant:new u.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(f,e.u_is_size_feature_constant),u_size_t:new u.aI(f,e.u_size_t),u_size:new u.aI(f,e.u_size),u_camera_to_center_distance:new u.aI(f,e.u_camera_to_center_distance),u_pitch:new u.aI(f,e.u_pitch),u_rotate_symbol:new u.aH(f,e.u_rotate_symbol),u_aspect_ratio:new u.aI(f,e.u_aspect_ratio),u_fade_change:new u.aI(f,e.u_fade_change),u_matrix:new u.aJ(f,e.u_matrix),u_label_plane_matrix:new u.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(f,e.u_coord_matrix),u_is_text:new u.aH(f,e.u_is_text),u_pitch_with_map:new u.aH(f,e.u_pitch_with_map),u_is_along_line:new u.aH(f,e.u_is_along_line),u_is_variable_anchor:new u.aH(f,e.u_is_variable_anchor),u_texsize:new u.aO(f,e.u_texsize),u_texture:new u.aH(f,e.u_texture),u_gamma_scale:new u.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(f,e.u_device_pixel_ratio),u_is_halo:new u.aH(f,e.u_is_halo),u_translation:new u.aO(f,e.u_translation),u_pitched_scale:new u.aI(f,e.u_pitched_scale)}),symbolTextAndIcon:(f,e)=>({u_is_size_zoom_constant:new u.aH(f,e.u_is_size_zoom_constant),u_is_size_feature_constant:new u.aH(f,e.u_is_size_feature_constant),u_size_t:new u.aI(f,e.u_size_t),u_size:new u.aI(f,e.u_size),u_camera_to_center_distance:new u.aI(f,e.u_camera_to_center_distance),u_pitch:new u.aI(f,e.u_pitch),u_rotate_symbol:new u.aH(f,e.u_rotate_symbol),u_aspect_ratio:new u.aI(f,e.u_aspect_ratio),u_fade_change:new u.aI(f,e.u_fade_change),u_matrix:new u.aJ(f,e.u_matrix),u_label_plane_matrix:new u.aJ(f,e.u_label_plane_matrix),u_coord_matrix:new u.aJ(f,e.u_coord_matrix),u_is_text:new u.aH(f,e.u_is_text),u_pitch_with_map:new u.aH(f,e.u_pitch_with_map),u_is_along_line:new u.aH(f,e.u_is_along_line),u_is_variable_anchor:new u.aH(f,e.u_is_variable_anchor),u_texsize:new u.aO(f,e.u_texsize),u_texsize_icon:new u.aO(f,e.u_texsize_icon),u_texture:new u.aH(f,e.u_texture),u_texture_icon:new u.aH(f,e.u_texture_icon),u_gamma_scale:new u.aI(f,e.u_gamma_scale),u_device_pixel_ratio:new u.aI(f,e.u_device_pixel_ratio),u_is_halo:new u.aH(f,e.u_is_halo),u_translation:new u.aO(f,e.u_translation),u_pitched_scale:new u.aI(f,e.u_pitched_scale)}),background:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_opacity:new u.aI(f,e.u_opacity),u_color:new u.aL(f,e.u_color)}),backgroundPattern:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_opacity:new u.aI(f,e.u_opacity),u_image:new u.aH(f,e.u_image),u_pattern_tl_a:new u.aO(f,e.u_pattern_tl_a),u_pattern_br_a:new u.aO(f,e.u_pattern_br_a),u_pattern_tl_b:new u.aO(f,e.u_pattern_tl_b),u_pattern_br_b:new u.aO(f,e.u_pattern_br_b),u_texsize:new u.aO(f,e.u_texsize),u_mix:new u.aI(f,e.u_mix),u_pattern_size_a:new u.aO(f,e.u_pattern_size_a),u_pattern_size_b:new u.aO(f,e.u_pattern_size_b),u_scale_a:new u.aI(f,e.u_scale_a),u_scale_b:new u.aI(f,e.u_scale_b),u_pixel_coord_upper:new u.aO(f,e.u_pixel_coord_upper),u_pixel_coord_lower:new u.aO(f,e.u_pixel_coord_lower),u_tile_units_to_pixels:new u.aI(f,e.u_tile_units_to_pixels)}),terrain:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_texture:new u.aH(f,e.u_texture),u_ele_delta:new u.aI(f,e.u_ele_delta),u_fog_matrix:new u.aJ(f,e.u_fog_matrix),u_fog_color:new u.aL(f,e.u_fog_color),u_fog_ground_blend:new u.aI(f,e.u_fog_ground_blend),u_fog_ground_blend_opacity:new u.aI(f,e.u_fog_ground_blend_opacity),u_horizon_color:new u.aL(f,e.u_horizon_color),u_horizon_fog_blend:new u.aI(f,e.u_horizon_fog_blend)}),terrainDepth:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_ele_delta:new u.aI(f,e.u_ele_delta)}),terrainCoords:(f,e)=>({u_matrix:new u.aJ(f,e.u_matrix),u_texture:new u.aH(f,e.u_texture),u_terrain_coords_id:new u.aI(f,e.u_terrain_coords_id),u_ele_delta:new u.aI(f,e.u_ele_delta)}),sky:(f,e)=>({u_sky_color:new u.aL(f,e.u_sky_color),u_horizon_color:new u.aL(f,e.u_horizon_color),u_horizon:new u.aI(f,e.u_horizon),u_sky_horizon_blend:new u.aI(f,e.u_sky_horizon_blend)})};class ur{constructor(e,s,l){this.context=e;const c=e.gl;this.buffer=c.createBuffer(),this.dynamicDraw=!!l,this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),c.bufferData(c.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?c.DYNAMIC_DRAW:c.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Ah={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class kl{constructor(e,s,l,c){this.length=s.length,this.attributes=l,this.itemSize=s.bytesPerElement,this.dynamicDraw=c,this.context=e;const m=e.gl;this.buffer=m.createBuffer(),e.bindVertexBuffer.set(this.buffer),m.bufferData(m.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){if(e.length!==this.length)throw new Error(`Length of new data is ${e.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,s){for(let l=0;l<this.attributes.length;l++){const c=s.attributes[this.attributes[l].name];c!==void 0&&e.enableVertexAttribArray(c)}}setVertexAttribPointers(e,s,l){for(let c=0;c<this.attributes.length;c++){const m=this.attributes[c],b=s.attributes[m.name];b!==void 0&&e.vertexAttribPointer(b,m.components,e[Ah[m.type]],!1,this.itemSize,m.offset+this.itemSize*(l||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Jr=new WeakMap;function Br(f){var e;if(Jr.has(f))return Jr.get(f);{const s=(e=f.getParameter(f.VERSION))===null||e===void 0?void 0:e.startsWith("WebGL 2.0");return Jr.set(f,s),s}}class Dt{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class _a extends Dt{getDefault(){return u.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class zh extends Dt{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class Ms extends Dt{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class Dh extends Dt{getDefault(){return[!0,!0,!0,!0]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class ou extends Dt{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class Lh extends Dt{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class au extends Dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const s=this.current;(e.func!==s.func||e.ref!==s.ref||e.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class Al extends Dt{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class lu extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=e,this.dirty=!1}}class cu extends Dt{getDefault(){return[0,1]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class uu extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=e,this.dirty=!1}}class hu extends Dt{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class Qr extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.BLEND):s.disable(s.BLEND),this.current=e,this.dirty=!1}}class du extends Dt{getDefault(){const e=this.gl;return[e.ONE,e.ZERO]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(e[0],e[1]),this.current=e,this.dirty=!1)}}class Rh extends Dt{getDefault(){return u.aM.transparent}set(e){const s=this.current;(e.r!==s.r||e.g!==s.g||e.b!==s.b||e.a!==s.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class pu extends Dt{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquation(e),this.current=e,this.dirty=!1)}}class ko extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;e?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=e,this.dirty=!1}}class Bh extends Dt{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class ya extends Dt{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}class Fh extends Dt{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}}class Oh extends Dt{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class mu extends Dt{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const s=this.current;(e[0]!==s[0]||e[1]!==s[1]||e[2]!==s[2]||e[3]!==s[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class fu extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class gu extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class zl extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class _u extends Dt{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class va extends Dt{getDefault(){return null}set(e){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class wr extends Dt{getDefault(){return null}set(e){var s;if(e===this.current&&!this.dirty)return;const l=this.gl;Br(l)?l.bindVertexArray(e):(s=l.getExtension("OES_vertex_array_object"))===null||s===void 0||s.bindVertexArrayOES(e),this.current=e,this.dirty=!1}}class Dl extends Dt{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class Ll extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Rl extends Dt{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class xa extends Dt{constructor(e,s){super(e),this.context=e,this.parent=s}getDefault(){return null}}class Bl extends xa{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class es extends xa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Fl extends xa{set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Nh{constructor(e,s,l,c,m){this.context=e,this.width=s,this.height=l;const b=e.gl,C=this.framebuffer=b.createFramebuffer();if(this.colorAttachment=new Bl(e,C),c)this.depthAttachment=m?new Fl(e,C):new es(e,C);else if(m)throw new Error("Stencil cannot be set without depth");if(b.checkFramebufferStatus(b.FRAMEBUFFER)!==b.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const e=this.context.gl,s=this.colorAttachment.get();if(s&&e.deleteTexture(s),this.depthAttachment){const l=this.depthAttachment.get();l&&e.deleteRenderbuffer(l)}e.deleteFramebuffer(this.framebuffer)}}class mi{constructor(e,s,l){this.blendFunction=e,this.blendColor=s,this.mask=l}}mi.Replace=[1,0],mi.disabled=new mi(mi.Replace,u.aM.transparent,[!1,!1,!1,!1]),mi.unblended=new mi(mi.Replace,u.aM.transparent,[!0,!0,!0,!0]),mi.alphaBlended=new mi([1,771],u.aM.transparent,[!0,!0,!0,!0]);class Vh{constructor(e){var s,l;if(this.gl=e,this.clearColor=new _a(this),this.clearDepth=new zh(this),this.clearStencil=new Ms(this),this.colorMask=new Dh(this),this.depthMask=new ou(this),this.stencilMask=new Lh(this),this.stencilFunc=new au(this),this.stencilOp=new Al(this),this.stencilTest=new lu(this),this.depthRange=new cu(this),this.depthTest=new uu(this),this.depthFunc=new hu(this),this.blend=new Qr(this),this.blendFunc=new du(this),this.blendColor=new Rh(this),this.blendEquation=new pu(this),this.cullFace=new ko(this),this.cullFaceSide=new Bh(this),this.frontFace=new ya(this),this.program=new Fh(this),this.activeTexture=new Oh(this),this.viewport=new mu(this),this.bindFramebuffer=new fu(this),this.bindRenderbuffer=new gu(this),this.bindTexture=new zl(this),this.bindVertexBuffer=new _u(this),this.bindElementBuffer=new va(this),this.bindVertexArray=new wr(this),this.pixelStoreUnpack=new Dl(this),this.pixelStoreUnpackPremultiplyAlpha=new Ll(this),this.pixelStoreUnpackFlipY=new Rl(this),this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),Br(e)){this.HALF_FLOAT=e.HALF_FLOAT;const c=e.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(s=e.RGBA16F)!==null&&s!==void 0?s:c?.RGBA16F_EXT,this.RGB16F=(l=e.RGB16F)!==null&&l!==void 0?l:c?.RGB16F_EXT,e.getExtension("EXT_color_buffer_float")}else{e.getExtension("EXT_color_buffer_half_float"),e.getExtension("OES_texture_half_float_linear");const c=e.getExtension("OES_texture_half_float");this.HALF_FLOAT=c?.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,s){return new ur(this,e,s)}createVertexBuffer(e,s,l){return new kl(this,e,s,l)}createRenderbuffer(e,s,l){const c=this.gl,m=c.createRenderbuffer();return this.bindRenderbuffer.set(m),c.renderbufferStorage(c.RENDERBUFFER,e,s,l),this.bindRenderbuffer.set(null),m}createFramebuffer(e,s,l,c){return new Nh(this,e,s,l,c)}clear({color:e,depth:s,stencil:l}){const c=this.gl;let m=0;e&&(m|=c.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(m|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),l!==void 0&&(m|=c.STENCIL_BUFFER_BIT,this.clearStencil.set(l),this.stencilMask.set(255)),c.clear(m)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){u.aE(e.blendFunction,mi.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}createVertexArray(){var e;return Br(this.gl)?this.gl.createVertexArray():(e=this.gl.getExtension("OES_vertex_array_object"))===null||e===void 0?void 0:e.createVertexArrayOES()}deleteVertexArray(e){var s;return Br(this.gl)?this.gl.deleteVertexArray(e):(s=this.gl.getExtension("OES_vertex_array_object"))===null||s===void 0?void 0:s.deleteVertexArrayOES(e)}unbindVAO(){this.bindVertexArray.set(null)}}class yt{constructor(e,s,l){this.func=e,this.mask=s,this.range=l}}yt.ReadOnly=!1,yt.ReadWrite=!0,yt.disabled=new yt(519,yt.ReadOnly,[0,1]);const ba=7680;class Kt{constructor(e,s,l,c,m,b){this.test=e,this.ref=s,this.mask=l,this.fail=c,this.depthFail=m,this.pass=b}}Kt.disabled=new Kt({func:519,mask:0},0,0,ba,ba,ba);class Vt{constructor(e,s,l){this.enable=e,this.mode=s,this.frontFace=l}}let ts;function Ao(f,e,s,l,c){const m=f.context,b=m.gl,C=f.useProgram("collisionBox"),I=[];let P=0,k=0;for(let ee=0;ee<l.length;ee++){const ne=l[ee],Z=e.getTile(ne).getBucket(s);if(!Z)continue;const ae=c?Z.textCollisionBox:Z.iconCollisionBox,ce=Z.collisionCircleArray;if(ce.length>0){const me=u.H();u.aQ(me,Z.placementInvProjMatrix,f.transform.glCoordMatrix),u.aQ(me,me,Z.placementViewportMatrix),I.push({circleArray:ce,circleOffset:k,transform:ne.posMatrix,invTransform:me,coord:ne}),P+=ce.length/4,k=P}ae&&C.draw(m,b.LINES,yt.disabled,Kt.disabled,f.colorModeForRenderPass(),Vt.disabled,{u_matrix:ne.posMatrix,u_pixel_extrude_scale:[1/(A=f.transform).width,1/A.height]},f.style.map.terrain&&f.style.map.terrain.getTerrainData(ne),s.id,ae.layoutVertexBuffer,ae.indexBuffer,ae.segments,null,f.transform.zoom,null,null,ae.collisionVertexBuffer)}var A;if(!c||!I.length)return;const B=f.useProgram("collisionCircle"),$=new u.aR;$.resize(4*P),$._trim();let H=0;for(const ee of I)for(let ne=0;ne<ee.circleArray.length/4;ne++){const Z=4*ne,ae=ee.circleArray[Z+0],ce=ee.circleArray[Z+1],me=ee.circleArray[Z+2],be=ee.circleArray[Z+3];$.emplace(H++,ae,ce,me,be,0),$.emplace(H++,ae,ce,me,be,1),$.emplace(H++,ae,ce,me,be,2),$.emplace(H++,ae,ce,me,be,3)}(!ts||ts.length<2*P)&&(ts=function(ee){const ne=2*ee,Z=new u.aT;Z.resize(ne),Z._trim();for(let ae=0;ae<ne;ae++){const ce=6*ae;Z.uint16[ce+0]=4*ae+0,Z.uint16[ce+1]=4*ae+1,Z.uint16[ce+2]=4*ae+2,Z.uint16[ce+3]=4*ae+2,Z.uint16[ce+4]=4*ae+3,Z.uint16[ce+5]=4*ae+0}return Z}(P));const Y=m.createIndexBuffer(ts,!0),Q=m.createVertexBuffer($,u.aS.members,!0);for(const ee of I){const ne=Kr(ee.transform,ee.invTransform,f.transform);B.draw(m,b.TRIANGLES,yt.disabled,Kt.disabled,f.colorModeForRenderPass(),Vt.disabled,ne,f.style.map.terrain&&f.style.map.terrain.getTerrainData(ee.coord),s.id,Q,Y,u.a0.simpleSegment(0,2*ee.circleOffset,ee.circleArray.length,ee.circleArray.length/2),null,f.transform.zoom,null,null,null)}Q.destroy(),Y.destroy()}Vt.disabled=new Vt(!1,1029,2305),Vt.backCCW=new Vt(!0,1029,2305);const zo=u.an(new Float32Array(16));function Ol(f,e,s,l,c,m){const{horizontalAlign:b,verticalAlign:C}=u.au(f);return new u.P((-(b-.5)*e/c+l[0])*m,(-(C-.5)*s/c+l[1])*m)}function is(f,e,s,l,c,m){const b=e.tileAnchorPoint.add(new u.P(e.translation[0],e.translation[1]));if(e.pitchWithMap){let C=l.mult(m);s||(C=C.rotate(-c));const I=b.add(C);return K(I.x,I.y,e.labelPlaneMatrix,e.getElevation).point}if(s){const C=ye(e.tileAnchorPoint.x+1,e.tileAnchorPoint.y,e).point.sub(f),I=Math.atan(C.y/C.x)+(C.x<0?Math.PI:0);return f.add(l.rotate(I))}return f.add(l)}function ks(f,e,s,l,c,m,b,C,I,P,k,A,B,$){const H=f.text.placedSymbolArray,Y=f.text.dynamicLayoutVertexArray,Q=f.icon.dynamicLayoutVertexArray,ee={};Y.clear();for(let ne=0;ne<H.length;ne++){const Z=H.get(ne),ae=Z.hidden||!Z.crossTileID||f.allowVerticalPlacement&&!Z.placedOrientation?null:l[Z.crossTileID];if(ae){const ce=new u.P(Z.anchorX,Z.anchorY),me={getElevation:$,width:c.width,height:c.height,labelPlaneMatrix:m,lineVertexArray:null,pitchWithMap:s,projection:k,projectionCache:null,tileAnchorPoint:ce,translation:A,unwrappedTileID:B},be=s?K(ce.x,ce.y,b,$):ye(ce.x,ce.y,me),Ie=L(c.cameraToCenterDistance,be.signedDistanceFromCamera);let Le=u.ai(f.textSizeData,I,Z)*Ie/u.ap;s&&(Le*=f.tilePixelRatio/C);const{width:Ne,height:ke,anchor:Me,textOffset:Ge,textBoxScale:ut}=ae,ze=Ol(Me,Ne,ke,Ge,ut,Le),Fe=k.getPitchedTextCorrection(c,ce.add(new u.P(A[0],A[1])),B),at=is(be.point,me,e,ze,c.angle,Fe),ti=f.allowVerticalPlacement&&Z.placedOrientation===u.ah.vertical?Math.PI/2:0;for(let pt=0;pt<Z.numGlyphs;pt++)u.aj(Y,at,ti);P&&Z.associatedIconIndex>=0&&(ee[Z.associatedIconIndex]={shiftedAnchor:at,angle:ti})}else it(Z.numGlyphs,Y)}if(P){Q.clear();const ne=f.icon.placedSymbolArray;for(let Z=0;Z<ne.length;Z++){const ae=ne.get(Z);if(ae.hidden)it(ae.numGlyphs,Q);else{const ce=ee[Z];if(ce)for(let me=0;me<ae.numGlyphs;me++)u.aj(Q,ce.shiftedAnchor,ce.angle);else it(ae.numGlyphs,Q)}}f.icon.dynamicLayoutVertexBuffer.updateData(Q)}f.text.dynamicLayoutVertexBuffer.updateData(Y)}function En(f,e,s){return s.iconsInText&&e?"symbolTextAndIcon":f?"symbolSDF":"symbolIcon"}function Nl(f,e,s,l,c,m,b,C,I,P,k,A){const B=f.context,$=B.gl,H=f.transform,Y=Xr(),Q=C==="map",ee=I==="map",ne=C!=="viewport"&&s.layout.get("symbol-placement")!=="point",Z=Q&&!ee&&!ne,ae=!ee&&ne,ce=!s.layout.get("symbol-sort-key").isConstant();let me=!1;const be=f.depthModeForSublayer(0,yt.ReadOnly),Ie=s._unevaluatedLayout.hasValue("text-variable-anchor")||s._unevaluatedLayout.hasValue("text-variable-anchor-offset"),Le=[],Ne=Y.getCircleRadiusCorrection(H);for(const ke of l){const Me=e.getTile(ke),Ge=Me.getBucket(s);if(!Ge)continue;const ut=c?Ge.text:Ge.icon;if(!ut||!ut.segments.get().length||!ut.hasVisibleVertices)continue;const ze=ut.programConfigurations.get(s.id),Fe=c||Ge.sdfIcons,at=c?Ge.textSizeData:Ge.iconSizeData,ti=ee||H.pitch!==0,pt=f.useProgram(En(Fe,c,Ge),ze),xt=u.ag(at,H.zoom),ii=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ke);let $i,Hn,ni,an,Qi=[0,0],ji=null;if(c)Hn=Me.glyphAtlasTexture,ni=$.LINEAR,$i=Me.glyphAtlasTexture.size,Ge.iconsInText&&(Qi=Me.imageAtlasTexture.size,ji=Me.imageAtlasTexture,an=ti||f.options.rotating||f.options.zooming||at.kind==="composite"||at.kind==="camera"?$.LINEAR:$.NEAREST);else{const Ct=s.layout.get("icon-size").constantOr(0)!==1||Ge.iconsNeedLinear;Hn=Me.imageAtlasTexture,ni=Fe||f.options.rotating||f.options.zooming||Ct||ti?$.LINEAR:$.NEAREST,$i=Me.imageAtlasTexture.size}const en=vt(Me,1,f.transform.zoom),pr=ae?ke.posMatrix:zo,Ws=Lr(pr,ee,Q,f.transform,en),Va=cr(pr,ee,Q,f.transform,en),Zs=cr(ke.posMatrix,ee,Q,f.transform,en),kn=Y.translatePosition(f.transform,Me,m,b),Ua=Ie&&Ge.hasTextData(),uc=s.layout.get("icon-text-fit")!=="none"&&Ua&&Ge.hasIconData();if(ne){const Ct=f.style.map.terrain?(Gs,Xs)=>f.style.map.terrain.getElevation(ke,Gs,Xs):null,as=s.layout.get("text-rotation-alignment")==="map";j(Ge,ke.posMatrix,f,c,Ws,Zs,ee,P,as,Y,ke.toUnwrapped(),H.width,H.height,kn,Ct)}const An=ke.posMatrix,zn=c&&Ie||uc,Fr=ne||zn?zo:Ws,Wn=Va,Fi=Fe&&s.paint.get(c?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let qi;qi=Fe?Ge.iconsInText?El(at.kind,xt,Z,ee,ne,zn,f,An,Fr,Wn,kn,$i,Qi,Ne):Mo(at.kind,xt,Z,ee,ne,zn,f,An,Fr,Wn,kn,c,$i,!0,Ne):su(at.kind,xt,Z,ee,ne,zn,f,An,Fr,Wn,kn,c,$i,Ne);const bn={program:pt,buffers:ut,uniformValues:qi,atlasTexture:Hn,atlasTextureIcon:ji,atlasInterpolation:ni,atlasInterpolationIcon:an,isSDF:Fe,hasHalo:Fi};if(ce&&Ge.canOverlap){me=!0;const Ct=ut.segments.get();for(const as of Ct)Le.push({segments:new u.a0([as]),sortKey:as.sortKey,state:bn,terrainData:ii})}else Le.push({segments:ut.segments,sortKey:0,state:bn,terrainData:ii})}me&&Le.sort((ke,Me)=>ke.sortKey-Me.sortKey);for(const ke of Le){const Me=ke.state;if(B.activeTexture.set($.TEXTURE0),Me.atlasTexture.bind(Me.atlasInterpolation,$.CLAMP_TO_EDGE),Me.atlasTextureIcon&&(B.activeTexture.set($.TEXTURE1),Me.atlasTextureIcon&&Me.atlasTextureIcon.bind(Me.atlasInterpolationIcon,$.CLAMP_TO_EDGE)),Me.isSDF){const Ge=Me.uniformValues;Me.hasHalo&&(Ge.u_is_halo=1,Vl(Me.buffers,ke.segments,s,f,Me.program,be,k,A,Ge,ke.terrainData)),Ge.u_is_halo=0}Vl(Me.buffers,ke.segments,s,f,Me.program,be,k,A,Me.uniformValues,ke.terrainData)}}function Vl(f,e,s,l,c,m,b,C,I,P){const k=l.context;c.draw(k,k.gl.TRIANGLES,m,b,C,Vt.disabled,I,P,s.id,f.layoutVertexBuffer,f.indexBuffer,e,s.paint,l.transform.zoom,f.programConfigurations.get(s.id),f.dynamicLayoutVertexBuffer,f.opacityVertexBuffer)}function Ul(f,e,s,l){const c=f.context,m=c.gl,b=Kt.disabled,C=new mi([m.ONE,m.ONE],u.aM.transparent,[!0,!0,!0,!0]),I=e.getBucket(s);if(!I)return;const P=l.key;let k=s.heatmapFbos.get(P);k||(k=Do(c,e.tileSize,e.tileSize),s.heatmapFbos.set(P,k)),c.bindFramebuffer.set(k.framebuffer),c.viewport.set([0,0,e.tileSize,e.tileSize]),c.clear({color:u.aM.transparent});const A=I.programConfigurations.get(s.id),B=f.useProgram("heatmap",A),$=f.style.map.terrain.getTerrainData(l);B.draw(c,m.TRIANGLES,yt.disabled,b,C,Vt.disabled,on(l.posMatrix,e,f.transform.zoom,s.paint.get("heatmap-intensity")),$,s.id,I.layoutVertexBuffer,I.indexBuffer,I.segments,s.paint,f.transform.zoom,A)}function ns(f,e,s){const l=f.context,c=l.gl;l.setColorMode(f.colorModeForRenderPass());const m=Lo(l,e),b=s.key,C=e.heatmapFbos.get(b);C&&(l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,C.colorAttachment.get()),l.activeTexture.set(c.TEXTURE1),m.bind(c.LINEAR,c.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(l,c.TRIANGLES,yt.disabled,Kt.disabled,f.colorModeForRenderPass(),Vt.disabled,pa(f,e,0,1),null,e.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments,e.paint,f.transform.zoom),C.destroy(),e.heatmapFbos.delete(b))}function Do(f,e,s){var l,c;const m=f.gl,b=m.createTexture();m.bindTexture(m.TEXTURE_2D,b),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,m.CLAMP_TO_EDGE),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,m.LINEAR),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,m.LINEAR);const C=(l=f.HALF_FLOAT)!==null&&l!==void 0?l:m.UNSIGNED_BYTE,I=(c=f.RGBA16F)!==null&&c!==void 0?c:m.RGBA;m.texImage2D(m.TEXTURE_2D,0,I,e,s,0,m.RGBA,C,null);const P=f.createFramebuffer(e,s,!1,!1);return P.colorAttachment.set(b),P}function Lo(f,e){return e.colorRampTexture||(e.colorRampTexture=new tt(f,e.colorRamp,f.gl.RGBA)),e.colorRampTexture}function As(f,e,s,l,c){if(!s||!l||!l.imageAtlas)return;const m=l.imageAtlas.patternPositions;let b=m[s.to.toString()],C=m[s.from.toString()];if(!b&&C&&(b=C),!C&&b&&(C=b),!b||!C){const I=c.getPaintProperty(e);b=m[I],C=m[I]}b&&C&&f.setConstantPatternPositions(b,C)}function Ro(f,e,s,l,c,m,b){const C=f.context.gl,I="fill-pattern",P=s.paint.get(I),k=P&&P.constantOr(1),A=s.getCrossfadeParameters();let B,$,H,Y,Q;b?($=k&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=C.LINES):($=k?"fillPattern":"fill",B=C.TRIANGLES);const ee=P.constantOr(null);for(const ne of l){const Z=e.getTile(ne);if(k&&!Z.patternsLoaded())continue;const ae=Z.getBucket(s);if(!ae)continue;const ce=ae.programConfigurations.get(s.id),me=f.useProgram($,ce),be=f.style.map.terrain&&f.style.map.terrain.getTerrainData(ne);k&&(f.context.activeTexture.set(C.TEXTURE0),Z.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),ce.updatePaintBuffers(A)),As(ce,I,ee,Z,s);const Ie=be?ne:null,Le=f.translatePosMatrix(Ie?Ie.posMatrix:ne.posMatrix,Z,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(b){Y=ae.indexBuffer2,Q=ae.segments2;const Ne=[C.drawingBufferWidth,C.drawingBufferHeight];H=$==="fillOutlinePattern"&&k?tu(Le,f,A,Z,Ne):Th(Le,Ne)}else Y=ae.indexBuffer,Q=ae.segments,H=k?eu(Le,f,A,Z):Es(Le);me.draw(f.context,B,c,f.stencilModeForClipping(ne),m,Vt.disabled,H,be,s.id,ae.layoutVertexBuffer,Y,Q,s.paint,f.transform.zoom,ce)}}function wa(f,e,s,l,c,m,b){const C=f.context,I=C.gl,P="fill-extrusion-pattern",k=s.paint.get(P),A=k.constantOr(1),B=s.getCrossfadeParameters(),$=s.paint.get("fill-extrusion-opacity"),H=k.constantOr(null);for(const Y of l){const Q=e.getTile(Y),ee=Q.getBucket(s);if(!ee)continue;const ne=f.style.map.terrain&&f.style.map.terrain.getTerrainData(Y),Z=ee.programConfigurations.get(s.id),ae=f.useProgram(A?"fillExtrusionPattern":"fillExtrusion",Z);A&&(f.context.activeTexture.set(I.TEXTURE0),Q.imageAtlasTexture.bind(I.LINEAR,I.CLAMP_TO_EDGE),Z.updatePaintBuffers(B)),As(Z,P,H,Q,s);const ce=f.translatePosMatrix(Y.posMatrix,Q,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),me=s.paint.get("fill-extrusion-vertical-gradient"),be=A?da(ce,f,me,$,Y,B,Q):Eo(ce,f,me,$);ae.draw(C,C.gl.TRIANGLES,c,m,b,Vt.backCCW,be,ne,s.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,s.paint,f.transform.zoom,Z,f.style.map.terrain&&ee.centroidVertexBuffer)}}function zs(f,e,s,l,c,m,b){const C=f.context,I=C.gl,P=s.fbo;if(!P)return;const k=f.useProgram("hillshade"),A=f.style.map.terrain&&f.style.map.terrain.getTerrainData(e);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,P.colorAttachment.get()),k.draw(C,I.TRIANGLES,c,m,b,Vt.disabled,((B,$,H,Y)=>{const Q=H.paint.get("hillshade-shadow-color"),ee=H.paint.get("hillshade-highlight-color"),ne=H.paint.get("hillshade-accent-color");let Z=H.paint.get("hillshade-illumination-direction")*(Math.PI/180);H.paint.get("hillshade-illumination-anchor")==="viewport"&&(Z-=B.transform.angle);const ae=!B.options.moving;return{u_matrix:Y?Y.posMatrix:B.transform.calculatePosMatrix($.tileID.toUnwrapped(),ae),u_image:0,u_latrange:ma(0,$.tileID),u_light:[H.paint.get("hillshade-exaggeration"),Z],u_shadow:Q,u_highlight:ee,u_accent:ne}})(f,s,l,A?e:null),A,l.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments)}function Ds(f,e,s,l,c,m){const b=f.context,C=b.gl,I=e.dem;if(I&&I.data){const P=I.dim,k=I.stride,A=I.getPixels();if(b.activeTexture.set(C.TEXTURE1),b.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||f.getTileTexture(k),e.demTexture){const $=e.demTexture;$.update(A,{premultiply:!1}),$.bind(C.NEAREST,C.CLAMP_TO_EDGE)}else e.demTexture=new tt(b,A,C.RGBA,{premultiply:!1}),e.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE);b.activeTexture.set(C.TEXTURE0);let B=e.fbo;if(!B){const $=new tt(b,{width:P,height:P,data:null},C.RGBA);$.bind(C.LINEAR,C.CLAMP_TO_EDGE),B=e.fbo=b.createFramebuffer(P,P,!0,!1),B.colorAttachment.set($.texture)}b.bindFramebuffer.set(B.framebuffer),b.viewport.set([0,0,P,P]),f.useProgram("hillshadePrepare").draw(b,C.TRIANGLES,l,c,m,Vt.disabled,(($,H)=>{const Y=H.stride,Q=u.H();return u.aP(Q,0,u.X,-u.X,0,0,1),u.J(Q,Q,[0,-u.X,0]),{u_matrix:Q,u_image:1,u_dimension:[Y,Y],u_zoom:$.overscaledZ,u_unpack:H.getUnpackVector()}})(e.tileID,I),null,s.id,f.rasterBoundsBuffer,f.quadTriangleIndexBuffer,f.rasterBoundsSegments),e.needsHillshadePrepare=!1}}function yu(f,e,s,l,c,m){const b=l.paint.get("raster-fade-duration");if(!m&&b>0){const C=q.now(),I=(C-f.timeAdded)/b,P=e?(C-e.timeAdded)/b:-1,k=s.getSource(),A=c.coveringZoomLevel({tileSize:k.tileSize,roundZoom:k.roundZoom}),B=!e||Math.abs(e.tileID.overscaledZ-A)>Math.abs(f.tileID.overscaledZ-A),$=B&&f.refreshedUponExpiration?1:u.ac(B?I:1-P,0,1);return f.refreshedUponExpiration&&I>=1&&(f.refreshedUponExpiration=!1),e?{opacity:1,mix:1-$}:{opacity:$,mix:0}}return{opacity:1,mix:0}}const $l=new u.aM(1,0,0,1),Mt=new u.aM(0,1,0,1),Ca=new u.aM(0,0,1,1),Uh=new u.aM(1,0,1,1),vu=new u.aM(0,1,1,1);function Ls(f,e,s,l){Sa(f,0,e+s/2,f.transform.width,s,l)}function xu(f,e,s,l){Sa(f,e-s/2,0,s,f.transform.height,l)}function Sa(f,e,s,l,c,m){const b=f.context,C=b.gl;C.enable(C.SCISSOR_TEST),C.scissor(e*f.pixelRatio,s*f.pixelRatio,l*f.pixelRatio,c*f.pixelRatio),b.clear({color:m}),C.disable(C.SCISSOR_TEST)}function bu(f,e,s){const l=f.context,c=l.gl,m=s.posMatrix,b=f.useProgram("debug"),C=yt.disabled,I=Kt.disabled,P=f.colorModeForRenderPass(),k="$debug",A=f.style.map.terrain&&f.style.map.terrain.getTerrainData(s);l.activeTexture.set(c.TEXTURE0);const B=e.getTileByID(s.key).latestRawTileData,$=Math.floor((B&&B.byteLength||0)/1024),H=e.getTile(s).tileSize,Y=512/Math.min(H,512)*(s.overscaledZ/f.transform.zoom)*.5;let Q=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(Q+=` => ${s.overscaledZ}`),function(ee,ne){ee.initDebugOverlayCanvas();const Z=ee.debugOverlayCanvas,ae=ee.context.gl,ce=ee.debugOverlayCanvas.getContext("2d");ce.clearRect(0,0,Z.width,Z.height),ce.shadowColor="white",ce.shadowBlur=2,ce.lineWidth=1.5,ce.strokeStyle="white",ce.textBaseline="top",ce.font="bold 36px Open Sans, sans-serif",ce.fillText(ne,5,5),ce.strokeText(ne,5,5),ee.debugOverlayTexture.update(Z),ee.debugOverlayTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE)}(f,`${Q} ${$}kB`),b.draw(l,c.TRIANGLES,C,I,mi.alphaBlended,Vt.disabled,Po(m,u.aM.transparent,Y),null,k,f.debugBuffer,f.quadTriangleIndexBuffer,f.debugSegments),b.draw(l,c.LINE_STRIP,C,I,P,Vt.disabled,Po(m,u.aM.red),A,k,f.debugBuffer,f.tileBorderIndexBuffer,f.debugSegments)}function wu(f,e,s){const l=f.context,c=l.gl,m=f.colorModeForRenderPass(),b=new yt(c.LEQUAL,yt.ReadWrite,f.depthRangeFor3D),C=f.useProgram("terrain"),I=e.getTerrainMesh();l.bindFramebuffer.set(null),l.viewport.set([0,0,f.width,f.height]);for(const P of s){const k=f.renderToTexture.getTexture(P),A=e.getTerrainData(P.tileID);l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,k.texture);const B=f.transform.calculatePosMatrix(P.tileID.toUnwrapped()),$=e.getMeshFrameDelta(f.transform.zoom),H=f.transform.calculateFogMatrix(P.tileID.toUnwrapped()),Y=Il(B,$,H,f.style.sky,f.transform.pitch);C.draw(l,c.TRIANGLES,b,Kt.disabled,m,Vt.backCCW,Y,A,"terrain",I.vertexBuffer,I.indexBuffer,I.segments)}}class Ia{constructor(e,s,l){this.vertexBuffer=e,this.indexBuffer=s,this.segments=l}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.vertexBuffer=null,this.indexBuffer=null,this.segments=null}}class Ta{constructor(e,s){this.context=new Vh(e),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.an(new Float64Array(16)),renderTime:0},this.setup(),this.numSublayers=ot.maxUnderzooming+ot.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Cl}resize(e,s,l){if(this.width=Math.floor(e*l),this.height=Math.floor(s*l),this.pixelRatio=l,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const c of this.style._order)this.style._layers[c].resize()}setup(){const e=this.context,s=new u.aX;s.emplaceBack(0,0),s.emplaceBack(u.X,0),s.emplaceBack(0,u.X),s.emplaceBack(u.X,u.X),this.tileExtentBuffer=e.createVertexBuffer(s,Yr.members),this.tileExtentSegments=u.a0.simpleSegment(0,0,4,2);const l=new u.aX;l.emplaceBack(0,0),l.emplaceBack(u.X,0),l.emplaceBack(0,u.X),l.emplaceBack(u.X,u.X),this.debugBuffer=e.createVertexBuffer(l,Yr.members),this.debugSegments=u.a0.simpleSegment(0,0,4,5);const c=new u.$;c.emplaceBack(0,0,0,0),c.emplaceBack(u.X,0,u.X,0),c.emplaceBack(0,u.X,0,u.X),c.emplaceBack(u.X,u.X,u.X,u.X),this.rasterBoundsBuffer=e.createVertexBuffer(c,zr.members),this.rasterBoundsSegments=u.a0.simpleSegment(0,0,4,2);const m=new u.aX;m.emplaceBack(0,0),m.emplaceBack(1,0),m.emplaceBack(0,1),m.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(m,Yr.members),this.viewportSegments=u.a0.simpleSegment(0,0,4,2);const b=new u.aZ;b.emplaceBack(0),b.emplaceBack(1),b.emplaceBack(3),b.emplaceBack(2),b.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(b);const C=new u.aY;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(C);const I=this.context.gl;this.stencilClearMode=new Kt({func:I.ALWAYS,mask:0},0,255,I.ZERO,I.ZERO,I.ZERO)}clearStencil(){const e=this.context,s=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const l=u.H();u.aP(l,0,this.width,this.height,0,0,1),u.K(l,l,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,s.TRIANGLES,yt.disabled,this.stencilClearMode,mi.disabled,Vt.disabled,sn(l),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(e,s){if(this.currentStencilSource===e.source||!e.isTileClipped()||!s||!s.length)return;this.currentStencilSource=e.source;const l=this.context,c=l.gl;this.nextStencilID+s.length>256&&this.clearStencil(),l.setColorMode(mi.disabled),l.setDepthMode(yt.disabled);const m=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const b of s){const C=this._tileClippingMaskIDs[b.key]=this.nextStencilID++,I=this.style.map.terrain&&this.style.map.terrain.getTerrainData(b);m.draw(l,c.TRIANGLES,yt.disabled,new Kt({func:c.ALWAYS,mask:0},C,255,c.KEEP,c.KEEP,c.REPLACE),mi.disabled,Vt.disabled,sn(b.posMatrix),I,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,s=this.context.gl;return new Kt({func:s.NOTEQUAL,mask:255},e,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(e){const s=this.context.gl;return new Kt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(e){const s=this.context.gl,l=e.sort((b,C)=>C.overscaledZ-b.overscaledZ),c=l[l.length-1].overscaledZ,m=l[0].overscaledZ-c+1;if(m>1){this.currentStencilSource=void 0,this.nextStencilID+m>256&&this.clearStencil();const b={};for(let C=0;C<m;C++)b[C+c]=new Kt({func:s.GEQUAL,mask:255},C+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=m,[b,l]}return[{[c]:Kt.disabled},l]}colorModeForRenderPass(){const e=this.context.gl;return this._showOverdrawInspector?new mi([e.CONSTANT_COLOR,e.ONE],new u.aM(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?mi.unblended:mi.alphaBlended}depthModeForSublayer(e,s,l){if(!this.opaquePassEnabledForLayer())return yt.disabled;const c=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new yt(l||this.context.gl.LEQUAL,s,[c,c])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,s){this.style=e,this.options=s,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(q.now()),this.imageManager.beginFrame();const l=this.style._order,c=this.style.sourceCaches,m={},b={},C={};for(const I in c){const P=c[I];P.used&&P.prepare(this.context),m[I]=P.getVisibleCoordinates(),b[I]=m[I].slice().reverse(),C[I]=P.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let I=0;I<l.length;I++)if(this.style._layers[l[I]].is3D()){this.opaquePassCutoff=I;break}this.maybeDrawDepthAndCoords(!1),this.renderToTexture&&(this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0),this.renderPass="offscreen";for(const I of l){const P=this.style._layers[I];if(!P.hasOffscreenPass()||P.isHidden(this.transform.zoom))continue;const k=b[P.source];(P.type==="custom"||k.length)&&this.renderLayer(this,c[P.source],P,k)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?u.aM.black:u.aM.transparent,depth:1}),this.clearStencil(),this.style.sky&&function(I,P){const k=I.context,A=k.gl,B=((ee,ne,Z)=>({u_sky_color:ee.properties.get("sky-color"),u_horizon_color:ee.properties.get("horizon-color"),u_horizon:(ne.height/2+ne.getHorizon())*Z,u_sky_horizon_blend:ee.properties.get("sky-horizon-blend")*ne.height/2*Z}))(P,I.style.map.transform,I.pixelRatio),$=new yt(A.LEQUAL,yt.ReadWrite,[0,1]),H=Kt.disabled,Y=I.colorModeForRenderPass(),Q=I.useProgram("sky");if(!P.mesh){const ee=new u.aX;ee.emplaceBack(-1,-1),ee.emplaceBack(1,-1),ee.emplaceBack(1,1),ee.emplaceBack(-1,1);const ne=new u.aY;ne.emplaceBack(0,1,2),ne.emplaceBack(0,2,3),P.mesh=new Ia(k.createVertexBuffer(ee,Yr.members),k.createIndexBuffer(ne),u.a0.simpleSegment(0,0,ee.length,ne.length))}Q.draw(k,A.TRIANGLES,$,H,Y,Vt.disabled,B,void 0,"sky",P.mesh.vertexBuffer,P.mesh.indexBuffer,P.mesh.segments)}(this,this.style.sky),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=l.length-1;this.currentLayer>=0;this.currentLayer--){const I=this.style._layers[l[this.currentLayer]],P=c[I.source],k=m[I.source];this._renderTileClippingMasks(I,k),this.renderLayer(this,P,I,k)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<l.length;this.currentLayer++){const I=this.style._layers[l[this.currentLayer]],P=c[I.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(I))continue;const k=(I.type==="symbol"?C:b)[I.source];this._renderTileClippingMasks(I,m[I.source]),this.renderLayer(this,P,I,k)}if(this.options.showTileBoundaries){const I=function(P,k){let A=null;const B=Object.values(P._layers).flatMap(Q=>Q.source&&!Q.isHidden(k)?[P.sourceCaches[Q.source]]:[]),$=B.filter(Q=>Q.getSource().type==="vector"),H=B.filter(Q=>Q.getSource().type!=="vector"),Y=Q=>{(!A||A.getSource().maxzoom<Q.getSource().maxzoom)&&(A=Q)};return $.forEach(Q=>Y(Q)),A||H.forEach(Q=>Y(Q)),A}(this.style,this.transform.zoom);I&&function(P,k,A){for(let B=0;B<A.length;B++)bu(P,k,A[B])}(this,I,I.getVisibleCoordinates())}this.options.showPadding&&function(I){const P=I.transform.padding;Ls(I,I.transform.height-(P.top||0),3,$l),Ls(I,P.bottom||0,3,Mt),xu(I,P.left||0,3,Ca),xu(I,I.transform.width-(P.right||0),3,Uh);const k=I.transform.centerPoint;(function(A,B,$,H){Sa(A,B-1,$-10,2,20,H),Sa(A,B-10,$-1,20,2,H)})(I,k.x,I.transform.height-k.y,vu)}(this),this.context.setDefault()}maybeDrawDepthAndCoords(e){if(!this.style||!this.style.map||!this.style.map.terrain)return;const s=this.terrainFacilitator.matrix,l=this.transform.modelViewProjectionMatrix;let c=this.terrainFacilitator.dirty;c||(c=e?!u.a_(s,l):!u.a$(s,l)),c||(c=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime).length>0),c&&(u.b0(s,l),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(m,b){const C=m.context,I=C.gl,P=mi.unblended,k=new yt(I.LEQUAL,yt.ReadWrite,[0,1]),A=b.getTerrainMesh(),B=b.sourceCache.getRenderableTiles(),$=m.useProgram("terrainDepth");C.bindFramebuffer.set(b.getFramebuffer("depth").framebuffer),C.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),C.clear({color:u.aM.transparent,depth:1});for(const H of B){const Y=b.getTerrainData(H.tileID),Q={u_matrix:m.transform.calculatePosMatrix(H.tileID.toUnwrapped()),u_ele_delta:b.getMeshFrameDelta(m.transform.zoom)};$.draw(C,I.TRIANGLES,k,Kt.disabled,P,Vt.backCCW,Q,Y,"terrain",A.vertexBuffer,A.indexBuffer,A.segments)}C.bindFramebuffer.set(null),C.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain),function(m,b){const C=m.context,I=C.gl,P=mi.unblended,k=new yt(I.LEQUAL,yt.ReadWrite,[0,1]),A=b.getTerrainMesh(),B=b.getCoordsTexture(),$=b.sourceCache.getRenderableTiles(),H=m.useProgram("terrainCoords");C.bindFramebuffer.set(b.getFramebuffer("coords").framebuffer),C.viewport.set([0,0,m.width/devicePixelRatio,m.height/devicePixelRatio]),C.clear({color:u.aM.transparent,depth:1}),b.coordsIndex=[];for(const Y of $){const Q=b.getTerrainData(Y.tileID);C.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,B.texture);const ee={u_matrix:m.transform.calculatePosMatrix(Y.tileID.toUnwrapped()),u_terrain_coords_id:(255-b.coordsIndex.length)/255,u_texture:0,u_ele_delta:b.getMeshFrameDelta(m.transform.zoom)};H.draw(C,I.TRIANGLES,k,Kt.disabled,P,Vt.backCCW,ee,Q,"terrain",A.vertexBuffer,A.indexBuffer,A.segments),b.coordsIndex.push(Y.tileID.key)}C.bindFramebuffer.set(null),C.viewport.set([0,0,m.width,m.height])}(this,this.style.map.terrain))}renderLayer(e,s,l,c){if(!l.isHidden(this.transform.zoom)&&(l.type==="background"||l.type==="custom"||(c||[]).length))switch(this.id=l.id,l.type){case"symbol":(function(m,b,C,I,P){if(m.renderPass!=="translucent")return;const k=Kt.disabled,A=m.colorModeForRenderPass();(C._unevaluatedLayout.hasValue("text-variable-anchor")||C._unevaluatedLayout.hasValue("text-variable-anchor-offset"))&&function(B,$,H,Y,Q,ee,ne,Z,ae){const ce=$.transform,me=Xr(),be=Q==="map",Ie=ee==="map";for(const Le of B){const Ne=Y.getTile(Le),ke=Ne.getBucket(H);if(!ke||!ke.text||!ke.text.segments.get().length)continue;const Me=u.ag(ke.textSizeData,ce.zoom),Ge=vt(Ne,1,$.transform.zoom),ut=Lr(Le.posMatrix,Ie,be,$.transform,Ge),ze=H.layout.get("icon-text-fit")!=="none"&&ke.hasIconData();if(Me){const Fe=Math.pow(2,ce.zoom-Ne.tileID.overscaledZ),at=$.style.map.terrain?(pt,xt)=>$.style.map.terrain.getElevation(Le,pt,xt):null,ti=me.translatePosition(ce,Ne,ne,Z);ks(ke,be,Ie,ae,ce,ut,Le.posMatrix,Fe,Me,ze,me,ti,Le.toUnwrapped(),at)}}}(I,m,C,b,C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),P),C.paint.get("icon-opacity").constantOr(1)!==0&&Nl(m,b,C,I,!1,C.paint.get("icon-translate"),C.paint.get("icon-translate-anchor"),C.layout.get("icon-rotation-alignment"),C.layout.get("icon-pitch-alignment"),C.layout.get("icon-keep-upright"),k,A),C.paint.get("text-opacity").constantOr(1)!==0&&Nl(m,b,C,I,!0,C.paint.get("text-translate"),C.paint.get("text-translate-anchor"),C.layout.get("text-rotation-alignment"),C.layout.get("text-pitch-alignment"),C.layout.get("text-keep-upright"),k,A),b.map.showCollisionBoxes&&(Ao(m,b,C,I,!0),Ao(m,b,C,I,!1))})(e,s,l,c,this.style.placement.variableOffsets);break;case"circle":(function(m,b,C,I){if(m.renderPass!=="translucent")return;const P=C.paint.get("circle-opacity"),k=C.paint.get("circle-stroke-width"),A=C.paint.get("circle-stroke-opacity"),B=!C.layout.get("circle-sort-key").isConstant();if(P.constantOr(1)===0&&(k.constantOr(1)===0||A.constantOr(1)===0))return;const $=m.context,H=$.gl,Y=m.depthModeForSublayer(0,yt.ReadOnly),Q=Kt.disabled,ee=m.colorModeForRenderPass(),ne=[];for(let Z=0;Z<I.length;Z++){const ae=I[Z],ce=b.getTile(ae),me=ce.getBucket(C);if(!me)continue;const be=me.programConfigurations.get(C.id),Ie=m.useProgram("circle",be),Le=me.layoutVertexBuffer,Ne=me.indexBuffer,ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ae),Me={programConfiguration:be,program:Ie,layoutVertexBuffer:Le,indexBuffer:Ne,uniformValues:Eh(m,ae,ce,C),terrainData:ke};if(B){const Ge=me.segments.get();for(const ut of Ge)ne.push({segments:new u.a0([ut]),sortKey:ut.sortKey,state:Me})}else ne.push({segments:me.segments,sortKey:0,state:Me})}B&&ne.sort((Z,ae)=>Z.sortKey-ae.sortKey);for(const Z of ne){const{programConfiguration:ae,program:ce,layoutVertexBuffer:me,indexBuffer:be,uniformValues:Ie,terrainData:Le}=Z.state;ce.draw($,H.TRIANGLES,Y,Q,ee,Vt.disabled,Ie,Le,C.id,me,be,Z.segments,C.paint,m.transform.zoom,ae)}})(e,s,l,c);break;case"heatmap":(function(m,b,C,I){if(C.paint.get("heatmap-opacity")===0)return;const P=m.context;if(m.style.map.terrain){for(const k of I){const A=b.getTile(k);b.hasRenderableParent(k)||(m.renderPass==="offscreen"?Ul(m,A,C,k):m.renderPass==="translucent"&&ns(m,C,k))}P.viewport.set([0,0,m.width,m.height])}else m.renderPass==="offscreen"?function(k,A,B,$){const H=k.context,Y=H.gl,Q=Kt.disabled,ee=new mi([Y.ONE,Y.ONE],u.aM.transparent,[!0,!0,!0,!0]);(function(ne,Z,ae){const ce=ne.gl;ne.activeTexture.set(ce.TEXTURE1),ne.viewport.set([0,0,Z.width/4,Z.height/4]);let me=ae.heatmapFbos.get(u.aU);me?(ce.bindTexture(ce.TEXTURE_2D,me.colorAttachment.get()),ne.bindFramebuffer.set(me.framebuffer)):(me=Do(ne,Z.width/4,Z.height/4),ae.heatmapFbos.set(u.aU,me))})(H,k,B),H.clear({color:u.aM.transparent});for(let ne=0;ne<$.length;ne++){const Z=$[ne];if(A.hasRenderableParent(Z))continue;const ae=A.getTile(Z),ce=ae.getBucket(B);if(!ce)continue;const me=ce.programConfigurations.get(B.id),be=k.useProgram("heatmap",me),{zoom:Ie}=k.transform;be.draw(H,Y.TRIANGLES,yt.disabled,Q,ee,Vt.disabled,on(Z.posMatrix,ae,Ie,B.paint.get("heatmap-intensity")),null,B.id,ce.layoutVertexBuffer,ce.indexBuffer,ce.segments,B.paint,k.transform.zoom,me)}H.viewport.set([0,0,k.width,k.height])}(m,b,C,I):m.renderPass==="translucent"&&function(k,A){const B=k.context,$=B.gl;B.setColorMode(k.colorModeForRenderPass());const H=A.heatmapFbos.get(u.aU);H&&(B.activeTexture.set($.TEXTURE0),$.bindTexture($.TEXTURE_2D,H.colorAttachment.get()),B.activeTexture.set($.TEXTURE1),Lo(B,A).bind($.LINEAR,$.CLAMP_TO_EDGE),k.useProgram("heatmapTexture").draw(B,$.TRIANGLES,yt.disabled,Kt.disabled,k.colorModeForRenderPass(),Vt.disabled,pa(k,A,0,1),null,A.id,k.viewportBuffer,k.quadTriangleIndexBuffer,k.viewportSegments,A.paint,k.transform.zoom))}(m,C)})(e,s,l,c);break;case"line":(function(m,b,C,I){if(m.renderPass!=="translucent")return;const P=C.paint.get("line-opacity"),k=C.paint.get("line-width");if(P.constantOr(1)===0||k.constantOr(1)===0)return;const A=m.depthModeForSublayer(0,yt.ReadOnly),B=m.colorModeForRenderPass(),$=C.paint.get("line-dasharray"),H=C.paint.get("line-pattern"),Y=H.constantOr(1),Q=C.paint.get("line-gradient"),ee=C.getCrossfadeParameters(),ne=Y?"linePattern":$?"lineSDF":Q?"lineGradient":"line",Z=m.context,ae=Z.gl;let ce=!0;for(const me of I){const be=b.getTile(me);if(Y&&!be.patternsLoaded())continue;const Ie=be.getBucket(C);if(!Ie)continue;const Le=Ie.programConfigurations.get(C.id),Ne=m.context.program.get(),ke=m.useProgram(ne,Le),Me=ce||ke.program!==Ne,Ge=m.style.map.terrain&&m.style.map.terrain.getTerrainData(me),ut=H.constantOr(null);if(ut&&be.imageAtlas){const at=be.imageAtlas,ti=at.patternPositions[ut.to.toString()],pt=at.patternPositions[ut.from.toString()];ti&&pt&&Le.setConstantPatternPositions(ti,pt)}const ze=Ge?me:null,Fe=Y?Ps(m,be,C,ee,ze):$?Ph(m,be,C,$,ee,ze):Q?iu(m,be,C,Ie.lineClipsArray.length,ze):fa(m,be,C,ze);if(Y)Z.activeTexture.set(ae.TEXTURE0),be.imageAtlasTexture.bind(ae.LINEAR,ae.CLAMP_TO_EDGE),Le.updatePaintBuffers(ee);else if($&&(Me||m.lineAtlas.dirty))Z.activeTexture.set(ae.TEXTURE0),m.lineAtlas.bind(Z);else if(Q){const at=Ie.gradients[C.id];let ti=at.texture;if(C.gradientVersion!==at.version){let pt=256;if(C.stepInterpolant){const xt=b.getSource().maxzoom,ii=me.canonical.z===xt?Math.ceil(1<<m.transform.maxZoom-me.canonical.z):1;pt=u.ac(u.aV(Ie.maxLineLength/u.X*1024*ii),256,Z.maxTextureSize)}at.gradient=u.aW({expression:C.gradientExpression(),evaluationKey:"lineProgress",resolution:pt,image:at.gradient||void 0,clips:Ie.lineClipsArray}),at.texture?at.texture.update(at.gradient):at.texture=new tt(Z,at.gradient,ae.RGBA),at.version=C.gradientVersion,ti=at.texture}Z.activeTexture.set(ae.TEXTURE0),ti.bind(C.stepInterpolant?ae.NEAREST:ae.LINEAR,ae.CLAMP_TO_EDGE)}ke.draw(Z,ae.TRIANGLES,A,m.stencilModeForClipping(me),B,Vt.disabled,Fe,Ge,C.id,Ie.layoutVertexBuffer,Ie.indexBuffer,Ie.segments,C.paint,m.transform.zoom,Le,Ie.layoutVertexBuffer2),ce=!1}})(e,s,l,c);break;case"fill":(function(m,b,C,I){const P=C.paint.get("fill-color"),k=C.paint.get("fill-opacity");if(k.constantOr(1)===0)return;const A=m.colorModeForRenderPass(),B=C.paint.get("fill-pattern"),$=m.opaquePassEnabledForLayer()&&!B.constantOr(1)&&P.constantOr(u.aM.transparent).a===1&&k.constantOr(0)===1?"opaque":"translucent";if(m.renderPass===$){const H=m.depthModeForSublayer(1,m.renderPass==="opaque"?yt.ReadWrite:yt.ReadOnly);Ro(m,b,C,I,H,A,!1)}if(m.renderPass==="translucent"&&C.paint.get("fill-antialias")){const H=m.depthModeForSublayer(C.getPaintProperty("fill-outline-color")?2:0,yt.ReadOnly);Ro(m,b,C,I,H,A,!0)}})(e,s,l,c);break;case"fill-extrusion":(function(m,b,C,I){const P=C.paint.get("fill-extrusion-opacity");if(P!==0&&m.renderPass==="translucent"){const k=new yt(m.context.gl.LEQUAL,yt.ReadWrite,m.depthRangeFor3D);if(P!==1||C.paint.get("fill-extrusion-pattern").constantOr(1))wa(m,b,C,I,k,Kt.disabled,mi.disabled),wa(m,b,C,I,k,m.stencilModeFor3D(),m.colorModeForRenderPass());else{const A=m.colorModeForRenderPass();wa(m,b,C,I,k,Kt.disabled,A)}}})(e,s,l,c);break;case"hillshade":(function(m,b,C,I){if(m.renderPass!=="offscreen"&&m.renderPass!=="translucent")return;const P=m.context,k=m.depthModeForSublayer(0,yt.ReadOnly),A=m.colorModeForRenderPass(),[B,$]=m.renderPass==="translucent"?m.stencilConfigForOverlap(I):[{},I];for(const H of $){const Y=b.getTile(H);Y.needsHillshadePrepare!==void 0&&Y.needsHillshadePrepare&&m.renderPass==="offscreen"?Ds(m,Y,C,k,Kt.disabled,A):m.renderPass==="translucent"&&zs(m,H,Y,C,k,B[H.overscaledZ],A)}P.viewport.set([0,0,m.width,m.height])})(e,s,l,c);break;case"raster":(function(m,b,C,I){if(m.renderPass!=="translucent"||C.paint.get("raster-opacity")===0||!I.length)return;const P=m.context,k=P.gl,A=b.getSource(),B=m.useProgram("raster"),$=m.colorModeForRenderPass(),[H,Y]=A instanceof xr?[{},I]:m.stencilConfigForOverlap(I),Q=Y[Y.length-1].overscaledZ,ee=!m.options.moving;for(const ne of Y){const Z=m.depthModeForSublayer(ne.overscaledZ-Q,C.paint.get("raster-opacity")===1?yt.ReadWrite:yt.ReadOnly,k.LESS),ae=b.getTile(ne);ae.registerFadeDuration(C.paint.get("raster-fade-duration"));const ce=b.findLoadedParent(ne,0),me=b.findLoadedSibling(ne),be=yu(ae,ce||me||null,b,C,m.transform,m.style.map.terrain);let Ie,Le;const Ne=C.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;P.activeTexture.set(k.TEXTURE0),ae.texture.bind(Ne,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),P.activeTexture.set(k.TEXTURE1),ce?(ce.texture.bind(Ne,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),Ie=Math.pow(2,ce.tileID.overscaledZ-ae.tileID.overscaledZ),Le=[ae.tileID.canonical.x*Ie%1,ae.tileID.canonical.y*Ie%1]):ae.texture.bind(Ne,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST),ae.texture.useMipmap&&P.extTextureFilterAnisotropic&&m.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const ke=m.style.map.terrain&&m.style.map.terrain.getTerrainData(ne),Me=ke?ne:null,Ge=Me?Me.posMatrix:m.transform.calculatePosMatrix(ne.toUnwrapped(),ee),ut=Mh(Ge,Le||[0,0],Ie||1,be,C);A instanceof xr?B.draw(P,k.TRIANGLES,Z,Kt.disabled,$,Vt.disabled,ut,ke,C.id,A.boundsBuffer,m.quadTriangleIndexBuffer,A.boundsSegments):B.draw(P,k.TRIANGLES,Z,H[ne.overscaledZ],$,Vt.disabled,ut,ke,C.id,m.rasterBoundsBuffer,m.quadTriangleIndexBuffer,m.rasterBoundsSegments)}})(e,s,l,c);break;case"background":(function(m,b,C,I){const P=C.paint.get("background-color"),k=C.paint.get("background-opacity");if(k===0)return;const A=m.context,B=A.gl,$=m.transform,H=$.tileSize,Y=C.paint.get("background-pattern");if(m.isPatternMissing(Y))return;const Q=!Y&&P.a===1&&k===1&&m.opaquePassEnabledForLayer()?"opaque":"translucent";if(m.renderPass!==Q)return;const ee=Kt.disabled,ne=m.depthModeForSublayer(0,Q==="opaque"?yt.ReadWrite:yt.ReadOnly),Z=m.colorModeForRenderPass(),ae=m.useProgram(Y?"backgroundPattern":"background"),ce=I||$.coveringTiles({tileSize:H,terrain:m.style.map.terrain});Y&&(A.activeTexture.set(B.TEXTURE0),m.imageManager.bind(m.context));const me=C.getCrossfadeParameters();for(const be of ce){const Ie=I?be.posMatrix:m.transform.calculatePosMatrix(be.toUnwrapped()),Le=Y?Pl(Ie,k,m,Y,{tileID:be,tileSize:H},me):ga(Ie,k,P),Ne=m.style.map.terrain&&m.style.map.terrain.getTerrainData(be);ae.draw(A,B.TRIANGLES,ne,ee,Z,Vt.disabled,Le,Ne,C.id,m.tileExtentBuffer,m.quadTriangleIndexBuffer,m.tileExtentSegments)}})(e,0,l,c);break;case"custom":(function(m,b,C){const I=m.context,P=C.implementation;if(m.renderPass==="offscreen"){const k=P.prerender;k&&(m.setCustomLayerDefaults(),I.setColorMode(m.colorModeForRenderPass()),k.call(P,I.gl,m.transform.customLayerMatrix()),I.setDirty(),m.setBaseState())}else if(m.renderPass==="translucent"){m.setCustomLayerDefaults(),I.setColorMode(m.colorModeForRenderPass()),I.setStencilMode(Kt.disabled);const k=P.renderingMode==="3d"?new yt(m.context.gl.LEQUAL,yt.ReadWrite,m.depthRangeFor3D):m.depthModeForSublayer(0,yt.ReadOnly);I.setDepthMode(k),P.render(I.gl,m.transform.customLayerMatrix(),{farZ:m.transform.farZ,nearZ:m.transform.nearZ,fov:m.transform._fov,modelViewProjectionMatrix:m.transform.modelViewProjectionMatrix,projectionMatrix:m.transform.projectionMatrix}),I.setDirty(),m.setBaseState(),I.bindFramebuffer.set(null)}})(e,0,l)}}translatePosMatrix(e,s,l,c,m){if(!l[0]&&!l[1])return e;const b=m?c==="map"?this.transform.angle:0:c==="viewport"?-this.transform.angle:0;if(b){const P=Math.sin(b),k=Math.cos(b);l=[l[0]*k-l[1]*P,l[0]*P+l[1]*k]}const C=[m?l[0]:vt(s,l[0],this.transform.zoom),m?l[1]:vt(s,l[1],this.transform.zoom),0],I=new Float32Array(16);return u.J(I,e,C),I}saveTileTexture(e){const s=this._tileTextures[e.size[0]];s?s.push(e):this._tileTextures[e.size[0]]=[e]}getTileTexture(e){const s=this._tileTextures[e];return s&&s.length>0?s.pop():null}isPatternMissing(e){if(!e)return!1;if(!e.from||!e.to)return!0;const s=this.imageManager.getPattern(e.from.toString()),l=this.imageManager.getPattern(e.to.toString());return!s||!l}useProgram(e,s){this.cache=this.cache||{};const l=e+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[l]||(this.cache[l]=new Tl(this.context,Rr[e],s,Ml[e],this._showOverdrawInspector,this.style.map.terrain)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new tt(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}overLimit(){const{drawingBufferWidth:e,drawingBufferHeight:s}=this.context.gl;return this.width!==e||this.height!==s}}class Rs{constructor(e,s){this.points=e,this.planes=s}static fromInvProjectionMatrix(e,s,l){const c=Math.pow(2,l),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(C=>{const I=1/(C=u.af([],C,e))[3]/s*c;return u.b1(C,C,[I,I,1/C[3],I])}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(C=>{const I=function(B,$){var H=$[0],Y=$[1],Q=$[2],ee=H*H+Y*Y+Q*Q;return ee>0&&(ee=1/Math.sqrt(ee)),B[0]=$[0]*ee,B[1]=$[1]*ee,B[2]=$[2]*ee,B}([],function(B,$,H){var Y=$[0],Q=$[1],ee=$[2],ne=H[0],Z=H[1],ae=H[2];return B[0]=Q*ae-ee*Z,B[1]=ee*ne-Y*ae,B[2]=Y*Z-Q*ne,B}([],We([],m[C[0]],m[C[1]]),We([],m[C[2]],m[C[1]]))),P=-((k=I)[0]*(A=m[C[1]])[0]+k[1]*A[1]+k[2]*A[2]);var k,A;return I.concat(P)});return new Rs(m,b)}}class Bs{constructor(e,s){this.min=e,this.max=s,this.center=function(l,c,m){return l[0]=.5*c[0],l[1]=.5*c[1],l[2]=.5*c[2],l}([],function(l,c,m){return l[0]=c[0]+m[0],l[1]=c[1]+m[1],l[2]=c[2]+m[2],l}([],this.min,this.max))}quadrant(e){const s=[e%2==0,e<2],l=qe(this.min),c=qe(this.max);for(let m=0;m<s.length;m++)l[m]=s[m]?this.min[m]:this.center[m],c[m]=s[m]?this.center[m]:this.max[m];return c[2]=this.max[2],new Bs(l,c)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}intersects(e){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let l=!0;for(let c=0;c<e.planes.length;c++){const m=e.planes[c];let b=0;for(let C=0;C<s.length;C++)u.b2(m,s[C])>=0&&b++;if(b===0)return 0;b!==s.length&&(l=!1)}if(l)return 2;for(let c=0;c<3;c++){let m=Number.MAX_VALUE,b=-Number.MAX_VALUE;for(let C=0;C<e.points.length;C++){const I=e.points[C][c]-this.min[c];m=Math.min(m,I),b=Math.max(b,I)}if(b<0||m>this.max[c]-this.min[c])return 0}return 1}}class Fs{constructor(e=0,s=0,l=0,c=0){if(isNaN(e)||e<0||isNaN(s)||s<0||isNaN(l)||l<0||isNaN(c)||c<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=s,this.left=l,this.right=c}interpolate(e,s,l){return s.top!=null&&e.top!=null&&(this.top=u.y.number(e.top,s.top,l)),s.bottom!=null&&e.bottom!=null&&(this.bottom=u.y.number(e.bottom,s.bottom,l)),s.left!=null&&e.left!=null&&(this.left=u.y.number(e.left,s.left,l)),s.right!=null&&e.right!=null&&(this.right=u.y.number(e.right,s.right,l)),this}getCenter(e,s){const l=u.ac((this.left+e-this.right)/2,0,e),c=u.ac((this.top+s-this.bottom)/2,0,s);return new u.P(l,c)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new Fs(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const jl=85.051129;class Os{constructor(e,s,l,c,m){this.tileSize=512,this._renderWorldCopies=m===void 0||!!m,this._minZoom=e||0,this._maxZoom=s||22,this._minPitch=l??0,this._maxPitch=c??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.N(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Fs,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={},this.minElevationForCurrentTile=0}clone(){const e=new Os(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return e.apply(this),e}apply(e){this.tileSize=e.tileSize,this.latRange=e.latRange,this.lngRange=e.lngRange,this.width=e.width,this.height=e.height,this._center=e._center,this._elevation=e._elevation,this.minElevationForCurrentTile=e.minElevationForCurrentTile,this.zoom=e.zoom,this.angle=e.angle,this._fov=e._fov,this._pitch=e._pitch,this._unmodified=e._unmodified,this._edgeInsets=e._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.P(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(e){const s=-u.b3(e,-180,180)*Math.PI/180;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=function(){var l=new u.A(4);return u.A!=Float32Array&&(l[1]=0,l[2]=0),l[0]=1,l[3]=1,l}(),function(l,c,m){var b=c[0],C=c[1],I=c[2],P=c[3],k=Math.sin(m),A=Math.cos(m);l[0]=b*A+I*k,l[1]=C*A+P*k,l[2]=b*-k+I*A,l[3]=C*-k+P*A}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const s=u.ac(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=e/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(e){const s=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.tileZoom=Math.max(0,Math.floor(s)),this.scale=this.zoomScale(s),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(e){e!==this._elevation&&(this._elevation=e,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,s,l){this._unmodified=!1,this._edgeInsets.interpolate(e,s,l),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const s=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(e){const s=[new u.b4(0,e)];if(this._renderWorldCopies){const l=this.pointCoordinate(new u.P(0,0)),c=this.pointCoordinate(new u.P(this.width,0)),m=this.pointCoordinate(new u.P(this.width,this.height)),b=this.pointCoordinate(new u.P(0,this.height)),C=Math.floor(Math.min(l.x,c.x,m.x,b.x)),I=Math.floor(Math.max(l.x,c.x,m.x,b.x)),P=1;for(let k=C-P;k<=I+P;k++)k!==0&&s.push(new u.b4(k,e))}return s}coveringTiles(e){var s,l;let c=this.coveringZoomLevel(e);const m=c;if(e.minzoom!==void 0&&c<e.minzoom)return[];e.maxzoom!==void 0&&c>e.maxzoom&&(c=e.maxzoom);const b=this.pointCoordinate(this.getCameraPoint()),C=u.Z.fromLngLat(this.center),I=Math.pow(2,c),P=[I*b.x,I*b.y,0],k=[I*C.x,I*C.y,0],A=Rs.fromInvProjectionMatrix(this.invModelViewProjectionMatrix,this.worldSize,c);let B=e.minzoom||0;!e.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(B=c);const $=e.terrain?2/Math.min(this.tileSize,e.tileSize)*this.tileSize:3,H=Z=>({aabb:new Bs([Z*I,0,0],[(Z+1)*I,I,0]),zoom:0,x:0,y:0,wrap:Z,fullyVisible:!1}),Y=[],Q=[],ee=c,ne=e.reparseOverscaled?m:c;if(this._renderWorldCopies)for(let Z=1;Z<=3;Z++)Y.push(H(-Z)),Y.push(H(Z));for(Y.push(H(0));Y.length>0;){const Z=Y.pop(),ae=Z.x,ce=Z.y;let me=Z.fullyVisible;if(!me){const ke=Z.aabb.intersects(A);if(ke===0)continue;me=ke===2}const be=e.terrain?P:k,Ie=Z.aabb.distanceX(be),Le=Z.aabb.distanceY(be),Ne=Math.max(Math.abs(Ie),Math.abs(Le));if(Z.zoom===ee||Ne>$+(1<<ee-Z.zoom)-2&&Z.zoom>=B){const ke=ee-Z.zoom,Me=P[0]-.5-(ae<<ke),Ge=P[1]-.5-(ce<<ke);Q.push({tileID:new u.S(Z.zoom===ee?ne:Z.zoom,Z.wrap,Z.zoom,ae,ce),distanceSq:It([k[0]-.5-ae,k[1]-.5-ce]),tileDistanceToCamera:Math.sqrt(Me*Me+Ge*Ge)})}else for(let ke=0;ke<4;ke++){const Me=(ae<<1)+ke%2,Ge=(ce<<1)+(ke>>1),ut=Z.zoom+1;let ze=Z.aabb.quadrant(ke);if(e.terrain){const Fe=new u.S(ut,Z.wrap,ut,Me,Ge),at=e.terrain.getMinMaxElevation(Fe),ti=(s=at.minElevation)!==null&&s!==void 0?s:this.elevation,pt=(l=at.maxElevation)!==null&&l!==void 0?l:this.elevation;ze=new Bs([ze.min[0],ze.min[1],ti],[ze.max[0],ze.max[1],pt])}Y.push({aabb:ze,zoom:ut,x:Me,y:Ge,wrap:Z.wrap,fullyVisible:me})}}return Q.sort((Z,ae)=>Z.distanceSq-ae.distanceSq).map(Z=>Z.tileID)}resize(e,s){this.width=e,this.height=s,this.pixelsToGLUnits=[2/e,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){const s=u.ac(e.lat,-85.051129,jl);return new u.P(u.O(e.lng)*this.worldSize,u.Q(s)*this.worldSize)}unproject(e){return new u.Z(e.x/this.worldSize,e.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(e){const s=this.elevation,l=Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter,c=this.pointLocation(this.centerPoint,e),m=e.getElevationForLngLatZoom(c,this.tileZoom);if(!(this.elevation-m))return;const b=l+s-m,C=Math.cos(this._pitch)*this.cameraToCenterDistance/b/u.b5(1,c.lat),I=this.scaleZoom(C/this.tileSize);this._elevation=m,this._center=c,this.zoom=I}setLocationAtPoint(e,s){const l=this.pointCoordinate(s),c=this.pointCoordinate(this.centerPoint),m=this.locationCoordinate(e),b=new u.Z(m.x-(l.x-c.x),m.y-(l.y-c.y));this.center=this.coordinateLocation(b),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(e,s){return s?this.coordinatePoint(this.locationCoordinate(e),s.getElevationForLngLatZoom(e,this.tileZoom),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(e))}pointLocation(e,s){return this.coordinateLocation(this.pointCoordinate(e,s))}locationCoordinate(e){return u.Z.fromLngLat(e)}coordinateLocation(e){return e&&e.toLngLat()}pointCoordinate(e,s){if(s){const B=s.pointCoordinate(e);if(B!=null)return B}const l=[e.x,e.y,0,1],c=[e.x,e.y,1,1];u.af(l,l,this.pixelMatrixInverse),u.af(c,c,this.pixelMatrixInverse);const m=l[3],b=c[3],C=l[1]/m,I=c[1]/b,P=l[2]/m,k=c[2]/b,A=P===k?0:(0-P)/(k-P);return new u.Z(u.y.number(l[0]/m,c[0]/b,A)/this.worldSize,u.y.number(C,I,A)/this.worldSize)}coordinatePoint(e,s=0,l=this.pixelMatrix){const c=[e.x*this.worldSize,e.y*this.worldSize,s,1];return u.af(c,c,l),new u.P(c[0]/c[3],c[1]/c[3])}getBounds(){const e=Math.max(0,this.height/2-this.getHorizon());return new ge().extend(this.pointLocation(new u.P(0,e))).extend(this.pointLocation(new u.P(this.width,e))).extend(this.pointLocation(new u.P(this.width,this.height))).extend(this.pointLocation(new u.P(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ge([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(e){e?(this.lngRange=[e.getWest(),e.getEast()],this.latRange=[e.getSouth(),e.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-85.051129,jl])}calculateTileMatrix(e){const s=e.canonical,l=this.worldSize/this.zoomScale(s.z),c=s.x+Math.pow(2,s.z)*e.wrap,m=u.an(new Float64Array(16));return u.J(m,m,[c*l,s.y*l,0]),u.K(m,m,[l/u.X,l/u.X,1]),m}calculatePosMatrix(e,s=!1){const l=e.key,c=s?this._alignedPosMatrixCache:this._posMatrixCache;if(c[l])return c[l];const m=this.calculateTileMatrix(e);return u.L(m,s?this.alignedModelViewProjectionMatrix:this.modelViewProjectionMatrix,m),c[l]=new Float32Array(m),c[l]}calculateFogMatrix(e){const s=e.key,l=this._fogMatrixCache;if(l[s])return l[s];const c=this.calculateTileMatrix(e);return u.L(c,this.fogMatrix,c),l[s]=new Float32Array(c),l[s]}customLayerMatrix(){return this.mercatorMatrix.slice()}getConstrained(e,s){s=u.ac(+s,this.minZoom,this.maxZoom);const l={center:new u.N(e.lng,e.lat),zoom:s};let c=this.lngRange;if(!this._renderWorldCopies&&c===null){const Z=179.9999999999;c=[-Z,Z]}const m=this.tileSize*this.zoomScale(l.zoom);let b=0,C=m,I=0,P=m,k=0,A=0;const{x:B,y:$}=this.size;if(this.latRange){const Z=this.latRange;b=u.Q(Z[1])*m,C=u.Q(Z[0])*m,C-b<$&&(k=$/(C-b))}c&&(I=u.b3(u.O(c[0])*m,0,m),P=u.b3(u.O(c[1])*m,0,m),P<I&&(P+=m),P-I<B&&(A=B/(P-I)));const{x:H,y:Y}=this.project.call({worldSize:m},e);let Q,ee;const ne=Math.max(A||0,k||0);if(ne){const Z=new u.P(A?(P+I)/2:H,k?(C+b)/2:Y);return l.center=this.unproject.call({worldSize:m},Z).wrap(),l.zoom+=this.scaleZoom(ne),l}if(this.latRange){const Z=$/2;Y-Z<b&&(ee=b+Z),Y+Z>C&&(ee=C-Z)}if(c){const Z=(I+P)/2;let ae=H;this._renderWorldCopies&&(ae=u.b3(H,Z-m/2,Z+m/2));const ce=B/2;ae-ce<I&&(Q=I+ce),ae+ce>P&&(Q=P-ce)}if(Q!==void 0||ee!==void 0){const Z=new u.P(Q??H,ee??Y);l.center=this.unproject.call({worldSize:m},Z).wrap()}return l}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const e=this._unmodified,{center:s,zoom:l}=this.getConstrained(this.center,this.zoom);this.center=s,this.zoom=l,this._unmodified=e,this._constraining=!1}_calcMatrices(){if(!this.height)return;const e=this.centerOffset,s=this.point.x,l=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.b5(1,this.center.lat)*this.worldSize;let c=u.an(new Float64Array(16));u.K(c,c,[this.width/2,-this.height/2,1]),u.J(c,c,[1,-1,0]),this.labelPlaneMatrix=c,c=u.an(new Float64Array(16)),u.K(c,c,[1,-1,1]),u.J(c,c,[-1,-1,0]),u.K(c,c,[2/this.width,2/this.height,1]),this.glCoordMatrix=c;const m=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch),b=Math.min(this.elevation,this.minElevationForCurrentTile),C=m-b*this._pixelPerMeter/Math.cos(this._pitch),I=b<0?C:m,P=Math.PI/2+this._pitch,k=this._fov*(.5+e.y/this.height),A=Math.sin(k)*I/Math.sin(u.ac(Math.PI-P-k,.01,Math.PI-.01)),B=this.getHorizon(),$=2*Math.atan(B/this.cameraToCenterDistance)*(.5+e.y/(2*B)),H=Math.sin($)*I/Math.sin(u.ac(Math.PI-P-$,.01,Math.PI-.01)),Y=Math.min(A,H);this.farZ=1.01*(Math.cos(Math.PI/2-this._pitch)*Y+I),this.nearZ=this.height/50,c=new Float64Array(16),u.b6(c,this._fov,this.width/this.height,this.nearZ,this.farZ),c[8]=2*-e.x/this.width,c[9]=2*e.y/this.height,this.projectionMatrix=u.ae(c),u.K(c,c,[1,-1,1]),u.J(c,c,[0,0,-this.cameraToCenterDistance]),u.b7(c,c,this._pitch),u.ad(c,c,this.angle),u.J(c,c,[-s,-l,0]),this.mercatorMatrix=u.K([],c,[this.worldSize,this.worldSize,this.worldSize]),u.K(c,c,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.L(new Float64Array(16),this.labelPlaneMatrix,c),u.J(c,c,[0,0,-this.elevation]),this.modelViewProjectionMatrix=c,this.invModelViewProjectionMatrix=u.as([],c),this.fogMatrix=new Float64Array(16),u.b6(this.fogMatrix,this._fov,this.width/this.height,m,this.farZ),this.fogMatrix[8]=2*-e.x/this.width,this.fogMatrix[9]=2*e.y/this.height,u.K(this.fogMatrix,this.fogMatrix,[1,-1,1]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.cameraToCenterDistance]),u.b7(this.fogMatrix,this.fogMatrix,this._pitch),u.ad(this.fogMatrix,this.fogMatrix,this.angle),u.J(this.fogMatrix,this.fogMatrix,[-s,-l,0]),u.K(this.fogMatrix,this.fogMatrix,[1,1,this._pixelPerMeter]),u.J(this.fogMatrix,this.fogMatrix,[0,0,-this.elevation]),this.pixelMatrix3D=u.L(new Float64Array(16),this.labelPlaneMatrix,c);const Q=this.width%2/2,ee=this.height%2/2,ne=Math.cos(this.angle),Z=Math.sin(this.angle),ae=s-Math.round(s)+ne*Q+Z*ee,ce=l-Math.round(l)+ne*ee+Z*Q,me=new Float64Array(c);if(u.J(me,me,[ae>.5?ae-1:ae,ce>.5?ce-1:ce,0]),this.alignedModelViewProjectionMatrix=me,c=u.as(new Float64Array(16),this.pixelMatrix),!c)throw new Error("failed to invert matrix");this.pixelMatrixInverse=c,this._posMatrixCache={},this._alignedPosMatrixCache={},this._fogMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const e=this.pointCoordinate(new u.P(0,0)),s=[e.x*this.worldSize,e.y*this.worldSize,0,1];return u.af(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.P(0,e))}getCameraQueryGeometry(e){const s=this.getCameraPoint();if(e.length===1)return[e[0],s];{let l=s.x,c=s.y,m=s.x,b=s.y;for(const C of e)l=Math.min(l,C.x),c=Math.min(c,C.y),m=Math.max(m,C.x),b=Math.max(b,C.y);return[new u.P(l,c),new u.P(m,c),new u.P(m,b),new u.P(l,b),new u.P(l,c)]}}lngLatToCameraDepth(e,s){const l=this.locationCoordinate(e),c=[l.x*this.worldSize,l.y*this.worldSize,s,1];return u.af(c,c,this.modelViewProjectionMatrix),c[2]/c[3]}}function Bo(f,e){let s,l=!1,c=null,m=null;const b=()=>{c=null,l&&(f.apply(m,s),c=setTimeout(b,e),l=!1)};return(...C)=>(l=!0,m=this,s=C,c||b(),c)}class Ea{constructor(e){this._getCurrentHash=()=>{const s=window.location.hash.replace("#","");if(this._hashName){let l;return s.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(l=c)}),(l&&l[1]||"").split("/")}return s.split("/")},this._onHashChange=()=>{const s=this._getCurrentHash();if(s.length>=3&&!s.some(l=>isNaN(l))){const l=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(s[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+s[2],+s[1]],zoom:+s[0],bearing:l,pitch:+(s[4]||0)}),!0}return!1},this._updateHashUnthrottled=()=>{const s=window.location.href.replace(/(#.*)?$/,this.getHashString());window.history.replaceState(window.history.state,null,s)},this._removeHash=()=>{const s=this._getCurrentHash();if(s.length===0)return;const l=s.join("/");let c=l;c.split("&").length>0&&(c=c.split("&")[0]),this._hashName&&(c=`${this._hashName}=${l}`);let m=window.location.hash.replace(c,"");m.startsWith("#&")?m=m.slice(0,1)+m.slice(2):m==="#"&&(m="");let b=window.location.href.replace(/(#.+)?$/,m);b=b.replace("&&","&"),window.history.replaceState(window.history.state,null,b)},this._updateHash=Bo(this._updateHashUnthrottled,300),this._hashName=e&&encodeURIComponent(e)}addTo(e){return this._map=e,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),this._removeHash(),delete this._map,this}getHashString(e){const s=this._map.getCenter(),l=Math.round(100*this._map.getZoom())/100,c=Math.ceil((l*Math.LN2+Math.log(512/360/.5))/Math.LN10),m=Math.pow(10,c),b=Math.round(s.lng*m)/m,C=Math.round(s.lat*m)/m,I=this._map.getBearing(),P=this._map.getPitch();let k="";if(k+=e?`/${b}/${C}/${l}`:`${l}/${C}/${b}`,(I||P)&&(k+="/"+Math.round(10*I)/10),P&&(k+=`/${Math.round(P)}`),this._hashName){const A=this._hashName;let B=!1;const $=window.location.hash.slice(1).split("&").map(H=>{const Y=H.split("=")[0];return Y===A?(B=!0,`${Y}=${k}`):H}).filter(H=>H);return B||$.push(`${A}=${k}`),`#${$.join("&")}`}return`#${k}`}}const Pa={linearity:.3,easing:u.b8(0,0,.3,1)},ql=u.e({deceleration:2500,maxSpeed:1400},Pa),$h=u.e({deceleration:20,maxSpeed:1400},Pa),Cu=u.e({deceleration:1e3,maxSpeed:360},Pa),Ma=u.e({deceleration:1e3,maxSpeed:90},Pa);class Hl{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:q.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,s=q.now();for(;e.length>0&&s-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new u.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:m}of this._inertiaBuffer)s.zoom+=m.zoomDelta||0,s.bearing+=m.bearingDelta||0,s.pitch+=m.pitchDelta||0,m.panDelta&&s.pan._add(m.panDelta),m.around&&(s.around=m.around),m.pinchAround&&(s.pinchAround=m.pinchAround);const l=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,c={};if(s.pan.mag()){const m=Oo(s.pan.mag(),l,u.e({},ql,e||{}));c.offset=s.pan.mult(m.amount/s.pan.mag()),c.center=this._map.transform.center,Fo(c,m)}if(s.zoom){const m=Oo(s.zoom,l,$h);c.zoom=this._map.transform.zoom+m.amount,Fo(c,m)}if(s.bearing){const m=Oo(s.bearing,l,Cu);c.bearing=this._map.transform.bearing+u.ac(m.amount,-179,179),Fo(c,m)}if(s.pitch){const m=Oo(s.pitch,l,Ma);c.pitch=this._map.transform.pitch+m.amount,Fo(c,m)}if(c.zoom||c.bearing){const m=s.pinchAround===void 0?s.around:s.pinchAround;c.around=m?this._map.unproject(m):this._map.getCenter()}return this.clear(),u.e(c,{noMoveStart:!0})}}function Fo(f,e){(!f.duration||f.duration<e.duration)&&(f.duration=e.duration,f.easing=e.easing)}function Oo(f,e,s){const{maxSpeed:l,linearity:c,deceleration:m}=s,b=u.ac(f*c/(e/1e3),-l,l),C=Math.abs(b)/(m*c);return{easing:s.easing,duration:1e3*C,amount:b*(C/2)}}class Ui extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l,c={}){const m=F.mousePos(s.getCanvas(),l),b=s.unproject(m);super(e,u.e({point:m,lngLat:b,originalEvent:l},c)),this._defaultPrevented=!1,this.target=s}}class rs extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){const c=e==="touchend"?l.changedTouches:l.touches,m=F.touchPos(s.getCanvasContainer(),c),b=m.map(I=>s.unproject(I)),C=m.reduce((I,P,k,A)=>I.add(P.div(A.length)),new u.P(0,0));super(e,{points:m,point:C,lngLats:b,lngLat:s.unproject(C),originalEvent:l}),this._defaultPrevented=!1}}class Su extends u.k{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,s,l){super(e,{originalEvent:l}),this._defaultPrevented=!1}}class Iu{constructor(e,s){this._map=e,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(e){return this._firePreventable(new Su(e.type,this._map,e))}mousedown(e,s){return this._mousedownPos=s,this._firePreventable(new Ui(e.type,this._map,e))}mouseup(e){this._map.fire(new Ui(e.type,this._map,e))}click(e,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Ui(e.type,this._map,e))}dblclick(e){return this._firePreventable(new Ui(e.type,this._map,e))}mouseover(e){this._map.fire(new Ui(e.type,this._map,e))}mouseout(e){this._map.fire(new Ui(e.type,this._map,e))}touchstart(e){return this._firePreventable(new rs(e.type,this._map,e))}touchmove(e){this._map.fire(new rs(e.type,this._map,e))}touchend(e){this._map.fire(new rs(e.type,this._map,e))}touchcancel(e){this._map.fire(new rs(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class fi{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(e){this._map.fire(new Ui(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ui("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._ignoreContextMenu||this._map.fire(new Ui(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class jn{constructor(e){this._map=e}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(e){return this.transform.pointLocation(u.P.convert(e),this._map.terrain)}}class vn{constructor(e,s){this._map=e,this._tr=new jn(e),this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,s){this.isEnabled()&&e.shiftKey&&e.button===0&&(F.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(e,s){if(!this._active)return;const l=s;if(this._lastPos.equals(l)||!this._box&&l.dist(this._startPos)<this._clickTolerance)return;const c=this._startPos;this._lastPos=l,this._box||(this._box=F.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",e));const m=Math.min(c.x,l.x),b=Math.max(c.x,l.x),C=Math.min(c.y,l.y),I=Math.max(c.y,l.y);F.setTransform(this._box,`translate(${m}px,${C}px)`),this._box.style.width=b-m+"px",this._box.style.height=I-C+"px"}mouseupWindow(e,s){if(!this._active||e.button!==0)return;const l=this._startPos,c=s;if(this.reset(),F.suppressClick(),l.x!==c.x||l.y!==c.y)return this._map.fire(new u.k("boxzoomend",{originalEvent:e})),{cameraAnimation:m=>m.fitScreenCoordinates(l,c,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",e)}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(F.remove(this._box),this._box=null),F.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(e,s){return this._map.fire(new u.k(e,{originalEvent:s}))}}function No(f,e){if(f.length!==e.length)throw new Error(`The number of touches and points are not equal - touches ${f.length}, points ${e.length}`);const s={};for(let l=0;l<f.length;l++)s[f[l].identifier]=e[l];return s}class Wl{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(e,s,l){(this.centroid||l.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=e.timeStamp),l.length===this.numTouches&&(this.centroid=function(c){const m=new u.P(0,0);for(const b of c)m._add(b);return m.div(c.length)}(s),this.touches=No(l,s)))}touchmove(e,s,l){if(this.aborted||!this.centroid)return;const c=No(l,s);for(const m in this.touches){const b=c[m];(!b||b.dist(this.touches[m])>30)&&(this.aborted=!0)}}touchend(e,s,l){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),l.length===0){const c=!this.aborted&&this.centroid;if(this.reset(),c)return c}}}class ka{constructor(e){this.singleTap=new Wl(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(e,s,l){this.singleTap.touchstart(e,s,l)}touchmove(e,s,l){this.singleTap.touchmove(e,s,l)}touchend(e,s,l){const c=this.singleTap.touchend(e,s,l);if(c){const m=e.timeStamp-this.lastTime<500,b=!this.lastTap||this.lastTap.dist(c)<30;if(m&&b||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=c,this.count===this.numTaps)return this.reset(),c}}}class Ns{constructor(e){this._tr=new jn(e),this._zoomIn=new ka({numTouches:1,numTaps:2}),this._zoomOut=new ka({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,s,l){this._zoomIn.touchstart(e,s,l),this._zoomOut.touchstart(e,s,l)}touchmove(e,s,l){this._zoomIn.touchmove(e,s,l),this._zoomOut.touchmove(e,s,l)}touchend(e,s,l){const c=this._zoomIn.touchend(e,s,l),m=this._zoomOut.touchend(e,s,l),b=this._tr;return c?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:b.zoom+1,around:b.unproject(c)},{originalEvent:e})}):m?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:C=>C.easeTo({duration:300,zoom:b.zoom-1,around:b.unproject(m)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Cr{constructor(e){this._enabled=!!e.enable,this._moveStateManager=e.moveStateManager,this._clickTolerance=e.clickTolerance||1,this._moveFunction=e.move,this._activateOnStart=!!e.activateOnStart,e.assignEvents(this),this.reset()}reset(e){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(e)}_move(...e){const s=this._moveFunction(...e);if(s.bearingDelta||s.pitchDelta||s.around||s.panDelta)return this._active=!0,s}dragStart(e,s){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(e)&&(this._moveStateManager.startMove(e),this._lastPoint=s.length?s[0]:s,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(e,s){if(!this.isEnabled())return;const l=this._lastPoint;if(!l)return;if(e.preventDefault(),!this._moveStateManager.isValidMoveEvent(e))return void this.reset(e);const c=s.length?s[0]:s;return!this._moved&&c.dist(l)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=c,this._move(l,c))}dragEnd(e){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(e)&&(this._moved&&F.suppressClick(),this.reset(e))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zl={0:1,2:2};class Aa{constructor(e){this._correctEvent=e.checkCorrectEvent}startMove(e){const s=F.mouseButton(e);this._eventButton=s}endMove(e){delete this._eventButton}isValidStartEvent(e){return this._correctEvent(e)}isValidMoveEvent(e){return!function(s,l){const c=Zl[l];return s.buttons===void 0||(s.buttons&c)!==c}(e,this._eventButton)}isValidEndEvent(e){return F.mouseButton(e)===this._eventButton}}class Gl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(e){return e.targetTouches.length===1}_isSameTouchEvent(e){return e.targetTouches[0].identifier===this._firstTouch}startMove(e){this._firstTouch=e.targetTouches[0].identifier}endMove(e){delete this._firstTouch}isValidStartEvent(e){return this._isOneFingerTouch(e)}isValidMoveEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}isValidEndEvent(e){return this._isOneFingerTouch(e)&&this._isSameTouchEvent(e)}}const za=f=>{f.mousedown=f.dragStart,f.mousemoveWindow=f.dragMove,f.mouseup=f.dragEnd,f.contextmenu=e=>{e.preventDefault()}},Xl=({enable:f,clickTolerance:e,bearingDegreesPerPixelMoved:s=.8})=>{const l=new Aa({checkCorrectEvent:c=>F.mouseButton(c)===0&&c.ctrlKey||F.mouseButton(c)===2});return new Cr({clickTolerance:e,move:(c,m)=>({bearingDelta:(m.x-c.x)*s}),moveStateManager:l,enable:f,assignEvents:za})},Yl=({enable:f,clickTolerance:e,pitchDegreesPerPixelMoved:s=-.5})=>{const l=new Aa({checkCorrectEvent:c=>F.mouseButton(c)===0&&c.ctrlKey||F.mouseButton(c)===2});return new Cr({clickTolerance:e,move:(c,m)=>({pitchDelta:(m.y-c.y)*s}),moveStateManager:l,enable:f,assignEvents:za})};class ss{constructor(e,s){this._clickTolerance=e.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.P(0,0)}_shouldBePrevented(e){return e<(this._map.cooperativeGestures.isEnabled()?2:1)}touchstart(e,s,l){return this._calculateTransform(e,s,l)}touchmove(e,s,l){if(this._active){if(!this._shouldBePrevented(l.length))return e.preventDefault(),this._calculateTransform(e,s,l);this._map.cooperativeGestures.notifyGestureBlocked("touch_pan",e)}}touchend(e,s,l){this._calculateTransform(e,s,l),this._active&&this._shouldBePrevented(l.length)&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,s,l){l.length>0&&(this._active=!0);const c=No(l,s),m=new u.P(0,0),b=new u.P(0,0);let C=0;for(const P in c){const k=c[P],A=this._touches[P];A&&(m._add(k),b._add(k.sub(A)),C++,c[P]=k)}if(this._touches=c,this._shouldBePrevented(C)||!b.mag())return;const I=b.div(C);return this._sum._add(I),this._sum.mag()<this._clickTolerance?void 0:{around:m.div(C),panDelta:I}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Da{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}touchstart(e,s,l){this._firstTwoTouches||l.length<2||(this._firstTwoTouches=[l[0].identifier,l[1].identifier],this._start([s[0],s[1]]))}touchmove(e,s,l){if(!this._firstTwoTouches)return;e.preventDefault();const[c,m]=this._firstTwoTouches,b=Vo(l,s,c),C=Vo(l,s,m);if(!b||!C)return;const I=this._aroundCenter?null:b.add(C).div(2);return this._move([b,C],I,e)}touchend(e,s,l){if(!this._firstTwoTouches)return;const[c,m]=this._firstTwoTouches,b=Vo(l,s,c),C=Vo(l,s,m);b&&C||(this._active&&F.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}}function Vo(f,e,s){for(let l=0;l<f.length;l++)if(f[l].identifier===s)return e[l]}function Kl(f,e){return Math.log(f/e)/Math.LN2}class Jl extends Da{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,s){const l=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(Kl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Kl(this._distance,l),pinchAround:s}}}function Ql(f,e){return 180*f.angleWith(e)/Math.PI}class ec extends Da{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,s,l){const c=this._vector;if(this._vector=e[0].sub(e[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Ql(this._vector,c),pinchAround:s}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const s=25/(Math.PI*this._minDiameter)*360,l=Ql(e,this._startVector);return Math.abs(l)<s}}function La(f){return Math.abs(f.y)>Math.abs(f.x)}class Vs extends Da{constructor(e){super(),this._currentTouchCount=0,this._map=e}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(e,s,l){super.touchstart(e,s,l),this._currentTouchCount=l.length}_start(e){this._lastPoints=e,La(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,s,l){if(this._map.cooperativeGestures.isEnabled()&&this._currentTouchCount<3)return;const c=e[0].sub(this._lastPoints[0]),m=e[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(c,m,l.timeStamp),this._valid?(this._lastPoints=e,this._active=!0,{pitchDelta:(c.y+m.y)/2*-.5}):void 0}gestureBeginsVertically(e,s,l){if(this._valid!==void 0)return this._valid;const c=e.mag()>=2,m=s.mag()>=2;if(!c&&!m)return;if(!c||!m)return this._firstMove===void 0&&(this._firstMove=l),l-this._firstMove<100&&void 0;const b=e.y>0==s.y>0;return La(e)&&La(s)&&b}}const Tu={panStep:100,bearingStep:15,pitchStep:10};class Pn{constructor(e){this._tr=new jn(e);const s=Tu;this._panStep=s.panStep,this._bearingStep=s.bearingStep,this._pitchStep=s.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let s=0,l=0,c=0,m=0,b=0;switch(e.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:e.shiftKey?l=-1:(e.preventDefault(),m=-1);break;case 39:e.shiftKey?l=1:(e.preventDefault(),m=1);break;case 38:e.shiftKey?c=1:(e.preventDefault(),b=-1);break;case 40:e.shiftKey?c=-1:(e.preventDefault(),b=1);break;default:return}return this._rotationDisabled&&(l=0,c=0),{cameraAnimation:C=>{const I=this._tr;C.easeTo({duration:300,easeId:"keyboardHandler",easing:hr,zoom:s?Math.round(I.zoom)+s*(e.shiftKey?2:1):I.zoom,bearing:I.bearing+l*this._bearingStep,pitch:I.pitch+c*this._pitchStep,offset:[-m*this._panStep,-b*this._panStep],center:I.center},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function hr(f){return f*(2-f)}const tc=4.000244140625;class qn{constructor(e,s){this._onTimeout=l=>{this._type="wheel",this._delta-=this._lastValue,this._active||this._start(l)},this._map=e,this._tr=new jn(e),this._triggerRenderFrame=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}_shouldBePrevented(e){return!!this._map.cooperativeGestures.isEnabled()&&!(e.ctrlKey||this._map.cooperativeGestures.isBypassed(e))}wheel(e){if(!this.isEnabled())return;if(this._shouldBePrevented(e))return void this._map.cooperativeGestures.notifyGestureBlocked("wheel_zoom",e);let s=e.deltaMode===WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const l=q.now(),c=l-(this._lastWheelEventTime||0);this._lastWheelEventTime=l,s!==0&&s%tc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":c>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(c*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),e.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=e,this._delta-=s,this._active||this._start(e)),e.preventDefault()}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=F.mousePos(this._map.getCanvas(),e),l=this._tr;this._around=s.y>l.transform.height/2-l.transform.getHorizon()?u.N.convert(this._aroundCenter?l.center:l.unproject(s)):u.N.convert(l.center),this._aroundPoint=l.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const e=this._tr.transform;if(this._delta!==0){const I=this._type==="wheel"&&Math.abs(this._delta)>tc?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*I)));this._delta<0&&P!==0&&(P=1/P);const k=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):e.scale;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(k*P))),this._type==="wheel"&&(this._startZoom=e.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:e.zoom,l=this._startZoom,c=this._easing;let m,b=!1;const C=q.now()-this._lastWheelEventTime;if(this._type==="wheel"&&l&&c&&C){const I=Math.min(C/200,1),P=c(I);m=u.y.number(l,s,P),I<1?this._frameId||(this._frameId=!0):b=!0}else m=s,b=!0;return this._active=!0,b&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!b,zoomDelta:m-e.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let s=u.b9;if(this._prevEase){const l=this._prevEase,c=(q.now()-l.start)/l.duration,m=l.easing(c+.01)-l.easing(c),b=.27/Math.sqrt(m*m+1e-4)*.01,C=Math.sqrt(.0729-b*b);s=u.b8(b,C,.25,1)}return this._prevEase={start:q.now(),duration:e,easing:s},s}reset(){this._active=!1,this._zooming=!1,delete this._targetZoom,this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout)}}class os{constructor(e,s){this._clickZoom=e,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class jh{constructor(e){this._tr=new jn(e),this.reset()}reset(){this._active=!1}dblclick(e,s){return e.preventDefault(),{cameraAnimation:l=>{l.easeTo({duration:300,zoom:this._tr.zoom+(e.shiftKey?-1:1),around:this._tr.unproject(s)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class qh{constructor(){this._tap=new ka({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,delete this._tapPoint,this._tap.reset()}touchstart(e,s,l){if(!this._swipePoint)if(this._tapTime){const c=s[0],m=e.timeStamp-this._tapTime<500,b=this._tapPoint.dist(c)<30;m&&b?l.length>0&&(this._swipePoint=c,this._swipeTouch=l[0].identifier):this.reset()}else this._tap.touchstart(e,s,l)}touchmove(e,s,l){if(this._tapTime){if(this._swipePoint){if(l[0].identifier!==this._swipeTouch)return;const c=s[0],m=c.y-this._swipePoint.y;return this._swipePoint=c,e.preventDefault(),this._active=!0,{zoomDelta:m/128}}}else this._tap.touchmove(e,s,l)}touchend(e,s,l){if(this._tapTime)this._swipePoint&&l.length===0&&this.reset();else{const c=this._tap.touchend(e,s,l);c&&(this._tapTime=e.timeStamp,this._tapPoint=c)}}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Eu{constructor(e,s,l){this._el=e,this._mousePan=s,this._touchPan=l}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Pu{constructor(e,s,l){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=s,this._mousePitch=l}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class ic{constructor(e,s,l,c){this._el=e,this._touchZoom=s,this._touchRotate=l,this._tapDragZoom=c,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}class Us{constructor(e,s){this._bypassKey=navigator.userAgent.indexOf("Mac")!==-1?"metaKey":"ctrlKey",this._map=e,this._options=s,this._enabled=!1}isActive(){return!1}reset(){}_setupUI(){if(this._container)return;const e=this._map.getCanvasContainer();e.classList.add("maplibregl-cooperative-gestures"),this._container=F.create("div","maplibregl-cooperative-gesture-screen",e);let s=this._map._getUIString("CooperativeGesturesHandler.WindowsHelpText");this._bypassKey==="metaKey"&&(s=this._map._getUIString("CooperativeGesturesHandler.MacHelpText"));const l=this._map._getUIString("CooperativeGesturesHandler.MobileHelpText"),c=document.createElement("div");c.className="maplibregl-desktop-message",c.textContent=s,this._container.appendChild(c);const m=document.createElement("div");m.className="maplibregl-mobile-message",m.textContent=l,this._container.appendChild(m),this._container.setAttribute("aria-hidden","true")}_destroyUI(){this._container&&(F.remove(this._container),this._map.getCanvasContainer().classList.remove("maplibregl-cooperative-gestures")),delete this._container}enable(){this._setupUI(),this._enabled=!0}disable(){this._enabled=!1,this._destroyUI()}isEnabled(){return this._enabled}isBypassed(e){return e[this._bypassKey]}notifyGestureBlocked(e,s){this._enabled&&(this._map.fire(new u.k("cooperativegestureprevented",{gestureType:e,originalEvent:s})),this._container.classList.add("maplibregl-show"),setTimeout(()=>{this._container.classList.remove("maplibregl-show")},100))}}const Mn=f=>f.zoom||f.drag||f.pitch||f.rotate;class $e extends u.k{}function Ra(f){return f.panDelta&&f.panDelta.mag()||f.zoomDelta||f.bearingDelta||f.pitchDelta}class nc{constructor(e,s){this.handleWindowEvent=c=>{this.handleEvent(c,`${c.type}Window`)},this.handleEvent=(c,m)=>{if(c.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const b=c.type==="renderFrame"?void 0:c,C={needsRenderFrame:!1},I={},P={},k=c.touches,A=k?this._getMapTouches(k):void 0,B=A?F.touchPos(this._map.getCanvas(),A):F.mousePos(this._map.getCanvas(),c);for(const{handlerName:Y,handler:Q,allowed:ee}of this._handlers){if(!Q.isEnabled())continue;let ne;this._blockedByActive(P,ee,Y)?Q.reset():Q[m||c.type]&&(ne=Q[m||c.type](c,B,A),this.mergeHandlerResult(C,I,ne,Y,b),ne&&ne.needsRenderFrame&&this._triggerRenderFrame()),(ne||Q.isActive())&&(P[Y]=Q)}const $={};for(const Y in this._previousActiveHandlers)P[Y]||($[Y]=b);this._previousActiveHandlers=P,(Object.keys($).length||Ra(C))&&(this._changes.push([C,I,$]),this._triggerRenderFrame()),(Object.keys(P).length||Ra(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=C;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))},this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Hl(e),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s);const l=this._el;this._listeners=[[l,"touchstart",{passive:!0}],[l,"touchmove",{passive:!1}],[l,"touchend",void 0],[l,"touchcancel",void 0],[l,"mousedown",void 0],[l,"mousemove",void 0],[l,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[l,"mouseover",void 0],[l,"mouseout",void 0],[l,"dblclick",void 0],[l,"click",void 0],[l,"keydown",{capture:!1}],[l,"keyup",void 0],[l,"wheel",{passive:!1}],[l,"contextmenu",void 0],[window,"blur",void 0]];for(const[c,m,b]of this._listeners)F.addEventListener(c,m,c===document?this.handleWindowEvent:this.handleEvent,b)}destroy(){for(const[e,s,l]of this._listeners)F.removeEventListener(e,s,e===document?this.handleWindowEvent:this.handleEvent,l)}_addDefaultHandlers(e){const s=this._map,l=s.getCanvasContainer();this._add("mapEvent",new Iu(s,e));const c=s.boxZoom=new vn(s,e);this._add("boxZoom",c),e.interactive&&e.boxZoom&&c.enable();const m=s.cooperativeGestures=new Us(s,e.cooperativeGestures);this._add("cooperativeGestures",m),e.cooperativeGestures&&m.enable();const b=new Ns(s),C=new jh(s);s.doubleClickZoom=new os(C,b),this._add("tapZoom",b),this._add("clickZoom",C),e.interactive&&e.doubleClickZoom&&s.doubleClickZoom.enable();const I=new qh;this._add("tapDragZoom",I);const P=s.touchPitch=new Vs(s);this._add("touchPitch",P),e.interactive&&e.touchPitch&&s.touchPitch.enable(e.touchPitch);const k=Xl(e),A=Yl(e);s.dragRotate=new Pu(e,k,A),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]),e.interactive&&e.dragRotate&&s.dragRotate.enable();const B=(({enable:ne,clickTolerance:Z})=>{const ae=new Aa({checkCorrectEvent:ce=>F.mouseButton(ce)===0&&!ce.ctrlKey});return new Cr({clickTolerance:Z,move:(ce,me)=>({around:me,panDelta:me.sub(ce)}),activateOnStart:!0,moveStateManager:ae,enable:ne,assignEvents:za})})(e),$=new ss(e,s);s.dragPan=new Eu(l,B,$),this._add("mousePan",B),this._add("touchPan",$,["touchZoom","touchRotate"]),e.interactive&&e.dragPan&&s.dragPan.enable(e.dragPan);const H=new ec,Y=new Jl;s.touchZoomRotate=new ic(l,Y,H,I),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),e.interactive&&e.touchZoomRotate&&s.touchZoomRotate.enable(e.touchZoomRotate);const Q=s.scrollZoom=new qn(s,()=>this._triggerRenderFrame());this._add("scrollZoom",Q,["mousePan"]),e.interactive&&e.scrollZoom&&s.scrollZoom.enable(e.scrollZoom);const ee=s.keyboard=new Pn(s);this._add("keyboard",ee),e.interactive&&e.keyboard&&s.keyboard.enable(),this._add("blockableMapEvent",new fi(s))}_add(e,s,l){this._handlers.push({handlerName:e,handler:s,allowed:l}),this._handlersById[e]=s}stop(e){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[]}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Mn(this._eventsInProgress)||this.isZooming()}_blockedByActive(e,s,l){for(const c in e)if(c!==l&&(!s||s.indexOf(c)<0))return!0;return!1}_getMapTouches(e){const s=[];for(const l of e)this._el.contains(l.target)&&s.push(l);return s}mergeHandlerResult(e,s,l,c,m){if(!l)return;u.e(e,l);const b={handlerName:c,originalEvent:l.originalEvent||m};l.zoomDelta!==void 0&&(s.zoom=b),l.panDelta!==void 0&&(s.drag=b),l.pitchDelta!==void 0&&(s.pitch=b),l.bearingDelta!==void 0&&(s.rotate=b)}_applyChanges(){const e={},s={},l={};for(const[c,m,b]of this._changes)c.panDelta&&(e.panDelta=(e.panDelta||new u.P(0,0))._add(c.panDelta)),c.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+c.zoomDelta),c.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+c.bearingDelta),c.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+c.pitchDelta),c.around!==void 0&&(e.around=c.around),c.pinchAround!==void 0&&(e.pinchAround=c.pinchAround),c.noInertia&&(e.noInertia=c.noInertia),u.e(s,m),u.e(l,b);this._updateMapTransform(e,s,l),this._changes=[]}_updateMapTransform(e,s,l){const c=this._map,m=c._getTransformForUpdate(),b=c.terrain;if(!(Ra(e)||b&&this._terrainMovement))return this._fireEvents(s,l,!0);let{panDelta:C,zoomDelta:I,bearingDelta:P,pitchDelta:k,around:A,pinchAround:B}=e;B!==void 0&&(A=B),c._stop(!0),A=A||c.transform.centerPoint;const $=m.pointLocation(C?A.sub(C):A);P&&(m.bearing+=P),k&&(m.pitch+=k),I&&(m.zoom+=I),b?this._terrainMovement||!s.drag&&!s.zoom?s.drag&&this._terrainMovement?m.center=m.pointLocation(m.centerPoint.sub(C)):m.setLocationAtPoint($,A):(this._terrainMovement=!0,this._map._elevationFreeze=!0,m.setLocationAtPoint($,A)):m.setLocationAtPoint($,A),c._applyUpdatedTransform(m),this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(s,l,!0)}_fireEvents(e,s,l){const c=Mn(this._eventsInProgress),m=Mn(e),b={};for(const A in e){const{originalEvent:B}=e[A];this._eventsInProgress[A]||(b[`${A}start`]=B),this._eventsInProgress[A]=e[A]}!c&&m&&this._fireEvent("movestart",m.originalEvent);for(const A in b)this._fireEvent(A,b[A]);m&&this._fireEvent("move",m.originalEvent);for(const A in e){const{originalEvent:B}=e[A];this._fireEvent(A,B)}const C={};let I;for(const A in this._eventsInProgress){const{handlerName:B,originalEvent:$}=this._eventsInProgress[A];this._handlersById[B].isActive()||(delete this._eventsInProgress[A],I=s[B]||$,C[`${A}end`]=I)}for(const A in C)this._fireEvent(A,C[A]);const P=Mn(this._eventsInProgress),k=(c||m)&&!P;if(k&&this._terrainMovement){this._map._elevationFreeze=!1,this._terrainMovement=!1;const A=this._map._getTransformForUpdate();A.recalculateZoom(this._map.terrain),this._map._applyUpdatedTransform(A)}if(l&&k){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=$=>$!==0&&-this._bearingSnap<$&&$<this._bearingSnap;!A||!A.essential&&q.prefersReducedMotion?(this._map.fire(new u.k("moveend",{originalEvent:I})),B(this._map.getBearing())&&this._map.resetNorth()):(B(A.bearing||this._map.getBearing())&&(A.bearing=0),A.freezeElevation=!0,this._map.easeTo(A,{originalEvent:I})),this._updatingCamera=!1}}_fireEvent(e,s){this._map.fire(new u.k(e,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{delete this._frameId,this.handleEvent(new $e("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}class Mu extends u.E{constructor(e,s){super(),this._renderFrameCallback=()=>{const l=Math.min((q.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(l)),l<1&&this._easeFrameId?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=s.bearingSnap,this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.N(this.transform.center.lng,this.transform.center.lat)}setCenter(e,s){return this.jumpTo({center:e},s)}panBy(e,s,l){return e=u.P.convert(e).mult(-1),this.panTo(this.transform.center,u.e({offset:e},s),l)}panTo(e,s,l){return this.easeTo(u.e({center:e},s),l)}getZoom(){return this.transform.zoom}setZoom(e,s){return this.jumpTo({zoom:e},s),this}zoomTo(e,s,l){return this.easeTo(u.e({zoom:e},s),l)}zoomIn(e,s){return this.zoomTo(this.getZoom()+1,e,s),this}zoomOut(e,s){return this.zoomTo(this.getZoom()-1,e,s),this}getBearing(){return this.transform.bearing}setBearing(e,s){return this.jumpTo({bearing:e},s),this}getPadding(){return this.transform.padding}setPadding(e,s){return this.jumpTo({padding:e},s),this}rotateTo(e,s,l){return this.easeTo(u.e({bearing:e},s),l)}resetNorth(e,s){return this.rotateTo(0,u.e({duration:1e3},e),s),this}resetNorthPitch(e,s){return this.easeTo(u.e({bearing:0,pitch:0,duration:1e3},e),s),this}snapToNorth(e,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,s):this}getPitch(){return this.transform.pitch}setPitch(e,s){return this.jumpTo({pitch:e},s),this}cameraForBounds(e,s){e=ge.convert(e).adjustAntiMeridian();const l=s&&s.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),l,s)}_cameraForBoxAndBearing(e,s,l,c){const m={top:0,bottom:0,right:0,left:0};if(typeof(c=u.e({padding:m,offset:[0,0],maxZoom:this.transform.maxZoom},c)).padding=="number"){const ke=c.padding;c.padding={top:ke,bottom:ke,right:ke,left:ke}}c.padding=u.e(m,c.padding);const b=this.transform,C=b.padding,I=new ge(e,s),P=b.project(I.getNorthWest()),k=b.project(I.getNorthEast()),A=b.project(I.getSouthEast()),B=b.project(I.getSouthWest()),$=u.ba(-l),H=P.rotate($),Y=k.rotate($),Q=A.rotate($),ee=B.rotate($),ne=new u.P(Math.max(H.x,Y.x,ee.x,Q.x),Math.max(H.y,Y.y,ee.y,Q.y)),Z=new u.P(Math.min(H.x,Y.x,ee.x,Q.x),Math.min(H.y,Y.y,ee.y,Q.y)),ae=ne.sub(Z),ce=(b.width-(C.left+C.right+c.padding.left+c.padding.right))/ae.x,me=(b.height-(C.top+C.bottom+c.padding.top+c.padding.bottom))/ae.y;if(me<0||ce<0)return void u.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const be=Math.min(b.scaleZoom(b.scale*Math.min(ce,me)),c.maxZoom),Ie=u.P.convert(c.offset),Le=new u.P((c.padding.left-c.padding.right)/2,(c.padding.top-c.padding.bottom)/2).rotate(u.ba(l)),Ne=Ie.add(Le).mult(b.scale/b.zoomScale(be));return{center:b.unproject(P.add(A).div(2).sub(Ne)),zoom:be,bearing:l}}fitBounds(e,s,l){return this._fitInternal(this.cameraForBounds(e,s),s,l)}fitScreenCoordinates(e,s,l,c,m){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.P.convert(e)),this.transform.pointLocation(u.P.convert(s)),l,c),c,m)}_fitInternal(e,s,l){return e?(delete(s=u.e(e,s)).padding,s.linear?this.easeTo(s,l):this.flyTo(s,l)):this}jumpTo(e,s){this.stop();const l=this._getTransformForUpdate();let c=!1,m=!1,b=!1;return"zoom"in e&&l.zoom!==+e.zoom&&(c=!0,l.zoom=+e.zoom),e.center!==void 0&&(l.center=u.N.convert(e.center)),"bearing"in e&&l.bearing!==+e.bearing&&(m=!0,l.bearing=+e.bearing),"pitch"in e&&l.pitch!==+e.pitch&&(b=!0,l.pitch=+e.pitch),e.padding==null||l.isPaddingEqual(e.padding)||(l.padding=e.padding),this._applyUpdatedTransform(l),this.fire(new u.k("movestart",s)).fire(new u.k("move",s)),c&&this.fire(new u.k("zoomstart",s)).fire(new u.k("zoom",s)).fire(new u.k("zoomend",s)),m&&this.fire(new u.k("rotatestart",s)).fire(new u.k("rotate",s)).fire(new u.k("rotateend",s)),b&&this.fire(new u.k("pitchstart",s)).fire(new u.k("pitch",s)).fire(new u.k("pitchend",s)),this.fire(new u.k("moveend",s))}calculateCameraOptionsFromTo(e,s,l,c=0){const m=u.Z.fromLngLat(e,s),b=u.Z.fromLngLat(l,c),C=b.x-m.x,I=b.y-m.y,P=b.z-m.z,k=Math.hypot(C,I,P);if(k===0)throw new Error("Can't calculate camera options with same From and To");const A=Math.hypot(C,I),B=this.transform.scaleZoom(this.transform.cameraToCenterDistance/k/this.transform.tileSize),$=180*Math.atan2(C,-I)/Math.PI;let H=180*Math.acos(A/k)/Math.PI;return H=P<0?90-H:90+H,{center:b.toLngLat(),zoom:B,pitch:H,bearing:$}}easeTo(e,s){var l;this._stop(!1,e.easeId),((e=u.e({offset:[0,0],duration:500,easing:u.b9},e)).animate===!1||!e.essential&&q.prefersReducedMotion)&&(e.duration=0);const c=this._getTransformForUpdate(),m=c.zoom,b=c.bearing,C=c.pitch,I=c.padding,P="bearing"in e?this._normalizeBearing(e.bearing,b):b,k="pitch"in e?+e.pitch:C,A="padding"in e?e.padding:c.padding,B=u.P.convert(e.offset);let $=c.centerPoint.add(B);const H=c.pointLocation($),{center:Y,zoom:Q}=c.getConstrained(u.N.convert(e.center||H),(l=e.zoom)!==null&&l!==void 0?l:m);this._normalizeCenter(Y,c);const ee=c.project(H),ne=c.project(Y).sub(ee),Z=c.zoomScale(Q-m);let ae,ce;e.around&&(ae=u.N.convert(e.around),ce=c.locationPoint(ae));const me={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||Q!==m,this._rotating=this._rotating||b!==P,this._pitching=this._pitching||k!==C,this._padding=!c.isPaddingEqual(A),this._easeId=e.easeId,this._prepareEase(s,e.noMoveStart,me),this.terrain&&this._prepareElevation(Y),this._ease(be=>{if(this._zooming&&(c.zoom=u.y.number(m,Q,be)),this._rotating&&(c.bearing=u.y.number(b,P,be)),this._pitching&&(c.pitch=u.y.number(C,k,be)),this._padding&&(c.interpolatePadding(I,A,be),$=c.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(be),ae)c.setLocationAtPoint(ae,ce);else{const Ie=c.zoomScale(c.zoom-m),Le=Q>m?Math.min(2,Z):Math.max(.5,Z),Ne=Math.pow(Le,1-be),ke=c.unproject(ee.add(ne.mult(be*Ne)).mult(Ie));c.setLocationAtPoint(c.renderWorldCopies?ke.wrap():ke,$)}this._applyUpdatedTransform(c),this._fireMoveEvents(s)},be=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s,be)},e),this}_prepareEase(e,s,l={}){this._moving=!0,s||l.moving||this.fire(new u.k("movestart",e)),this._zooming&&!l.zooming&&this.fire(new u.k("zoomstart",e)),this._rotating&&!l.rotating&&this.fire(new u.k("rotatestart",e)),this._pitching&&!l.pitching&&this.fire(new u.k("pitchstart",e))}_prepareElevation(e){this._elevationCenter=e,this._elevationStart=this.transform.elevation,this._elevationTarget=this.terrain.getElevationForLngLatZoom(e,this.transform.tileZoom),this._elevationFreeze=!0}_updateElevation(e){this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);const s=this.terrain.getElevationForLngLatZoom(this._elevationCenter,this.transform.tileZoom);if(e<1&&s!==this._elevationTarget){const l=this._elevationTarget-this._elevationStart;this._elevationStart+=e*(l-(s-(l*e+this._elevationStart))/(1-e)),this._elevationTarget=s}this.transform.elevation=u.y.number(this._elevationStart,this._elevationTarget,e)}_finalizeElevation(){this._elevationFreeze=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate||this.terrain?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_elevateCameraIfInsideTerrain(e){const s=e.getCameraPosition(),l=this.terrain.getElevationForLngLatZoom(s.lngLat,e.zoom);if(s.altitude<l){const c=this.calculateCameraOptionsFromTo(s.lngLat,l,e.center,e.elevation);return{pitch:c.pitch,zoom:c.zoom}}return{}}_applyUpdatedTransform(e){const s=[];if(this.terrain&&s.push(c=>this._elevateCameraIfInsideTerrain(c)),this.transformCameraUpdate&&s.push(c=>this.transformCameraUpdate(c)),!s.length)return;const l=e.clone();for(const c of s){const m=l.clone(),{center:b,zoom:C,pitch:I,bearing:P,elevation:k}=c(m);b&&(m.center=b),C!==void 0&&(m.zoom=C),I!==void 0&&(m.pitch=I),P!==void 0&&(m.bearing=P),k!==void 0&&(m.elevation=k),l.apply(m)}this.transform.apply(l)}_fireMoveEvents(e){this.fire(new u.k("move",e)),this._zooming&&this.fire(new u.k("zoom",e)),this._rotating&&this.fire(new u.k("rotate",e)),this._pitching&&this.fire(new u.k("pitch",e))}_afterEase(e,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId;const l=this._zooming,c=this._rotating,m=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,l&&this.fire(new u.k("zoomend",e)),c&&this.fire(new u.k("rotateend",e)),m&&this.fire(new u.k("pitchend",e)),this.fire(new u.k("moveend",e))}flyTo(e,s){var l;if(!e.essential&&q.prefersReducedMotion){const Fe=u.M(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Fe,s)}this.stop(),e=u.e({offset:[0,0],speed:1.2,curve:1.42,easing:u.b9},e);const c=this._getTransformForUpdate(),m=c.zoom,b=c.bearing,C=c.pitch,I=c.padding,P="bearing"in e?this._normalizeBearing(e.bearing,b):b,k="pitch"in e?+e.pitch:C,A="padding"in e?e.padding:c.padding,B=u.P.convert(e.offset);let $=c.centerPoint.add(B);const H=c.pointLocation($),{center:Y,zoom:Q}=c.getConstrained(u.N.convert(e.center||H),(l=e.zoom)!==null&&l!==void 0?l:m);this._normalizeCenter(Y,c);const ee=c.zoomScale(Q-m),ne=c.project(H),Z=c.project(Y).sub(ne);let ae=e.curve;const ce=Math.max(c.width,c.height),me=ce/ee,be=Z.mag();if("minZoom"in e){const Fe=u.ac(Math.min(e.minZoom,m,Q),c.minZoom,c.maxZoom),at=ce/c.zoomScale(Fe-m);ae=Math.sqrt(at/be*2)}const Ie=ae*ae;function Le(Fe){const at=(me*me-ce*ce+(Fe?-1:1)*Ie*Ie*be*be)/(2*(Fe?me:ce)*Ie*be);return Math.log(Math.sqrt(at*at+1)-at)}function Ne(Fe){return(Math.exp(Fe)-Math.exp(-Fe))/2}function ke(Fe){return(Math.exp(Fe)+Math.exp(-Fe))/2}const Me=Le(!1);let Ge=function(Fe){return ke(Me)/ke(Me+ae*Fe)},ut=function(Fe){return ce*((ke(Me)*(Ne(at=Me+ae*Fe)/ke(at))-Ne(Me))/Ie)/be;var at},ze=(Le(!0)-Me)/ae;if(Math.abs(be)<1e-6||!isFinite(ze)){if(Math.abs(ce-me)<1e-6)return this.easeTo(e,s);const Fe=me<ce?-1:1;ze=Math.abs(Math.log(me/ce))/ae,ut=()=>0,Ge=at=>Math.exp(Fe*ae*at)}return e.duration="duration"in e?+e.duration:1e3*ze/("screenSpeed"in e?+e.screenSpeed/ae:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=b!==P,this._pitching=k!==C,this._padding=!c.isPaddingEqual(A),this._prepareEase(s,!1),this.terrain&&this._prepareElevation(Y),this._ease(Fe=>{const at=Fe*ze,ti=1/Ge(at);c.zoom=Fe===1?Q:m+c.scaleZoom(ti),this._rotating&&(c.bearing=u.y.number(b,P,Fe)),this._pitching&&(c.pitch=u.y.number(C,k,Fe)),this._padding&&(c.interpolatePadding(I,A,Fe),$=c.centerPoint.add(B)),this.terrain&&!e.freezeElevation&&this._updateElevation(Fe);const pt=Fe===1?Y:c.unproject(ne.add(Z.mult(ut(at))).mult(ti));c.setLocationAtPoint(c.renderWorldCopies?pt.wrap():pt,$),this._applyUpdatedTransform(c),this._fireMoveEvents(s)},()=>{this.terrain&&e.freezeElevation&&this._finalizeElevation(),this._afterEase(s)},e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,s){var l;if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,s)}return e||(l=this.handlers)===null||l===void 0||l.stop(!1),this}_ease(e,s,l){l.animate===!1||l.duration===0?(e(1),s()):(this._easeStart=q.now(),this._easeOptions=l,this._onEaseFrame=e,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_normalizeBearing(e,s){e=u.b3(e,-180,180);const l=Math.abs(e-s);return Math.abs(e-360-s)<l&&(e-=360),Math.abs(e+360-s)<l&&(e+=360),e}_normalizeCenter(e,s){if(!s.renderWorldCopies||s.lngRange)return;const l=e.lng-s.center.lng;e.lng+=l>180?-360:l<-180?360:0}queryTerrainElevation(e){return this.terrain?this.terrain.getElevationForLngLatZoom(u.N.convert(e),this.transform.tileZoom)-this.transform.elevation:null}}const $s={compact:!0,customAttribution:'<a href="https://maplibre.org/" target="_blank">MapLibre</a>'};class js{constructor(e=$s){this._toggleAttribution=()=>{this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))},this._updateData=s=>{!s||s.sourceDataType!=="metadata"&&s.sourceDataType!=="visibility"&&s.dataType!=="style"&&s.type!=="terrain"||this._updateAttributions()},this._updateCompact=()=>{this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))},this._updateCompactMinimize=()=>{this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")},this.options=e}getDefaultPosition(){return"bottom-right"}onAdd(e){return this._map=e,this._compact=this.options.compact,this._container=F.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=F.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=F.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){F.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(e,s){const l=this._map._getUIString(`AttributionControl.${s}`);e.title=l,e.setAttribute("aria-label",l)}_updateAttributions(){if(!this._map.style)return;let e=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=e.concat(this.options.customAttribution.map(c=>typeof c!="string"?"":c)):typeof this.options.customAttribution=="string"&&e.push(this.options.customAttribution)),this._map.style.stylesheet){const c=this._map.style.stylesheet;this.styleOwner=c.owner,this.styleId=c.id}const s=this._map.style.sourceCaches;for(const c in s){const m=s[c];if(m.used||m.usedForTerrain){const b=m.getSource();b.attribution&&e.indexOf(b.attribution)<0&&e.push(b.attribution)}}e=e.filter(c=>String(c).trim()),e.sort((c,m)=>c.length-m.length),e=e.filter((c,m)=>{for(let b=m+1;b<e.length;b++)if(e[b].indexOf(c)>=0)return!1;return!0});const l=e.join(" | ");l!==this._attribHTML&&(this._attribHTML=l,e.length?(this._innerContainer.innerHTML=l,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}}class rc{constructor(e={}){this._updateCompact=()=>{const s=this._container.children;if(s.length){const l=s[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&l.classList.add("maplibregl-compact"):l.classList.remove("maplibregl-compact")}},this.options=e}getDefaultPosition(){return"bottom-left"}onAdd(e){this._map=e,this._compact=this.options&&this.options.compact,this._container=F.create("div","maplibregl-ctrl");const s=F.create("a","maplibregl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){F.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}}class wt{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const s=++this._id;return this._queue.push({callback:e,id:s,cancelled:!1}),s}remove(e){const s=this._currentlyRunning,l=s?this._queue.concat(s):this._queue;for(const c of l)if(c.id===e)return void(c.cancelled=!0)}run(e=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const l of s)if(!l.cancelled&&(l.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}var sc=u.Y([{name:"a_pos3d",type:"Int16",components:3}]);class Hh extends u.E{constructor(e){super(),this.sourceCache=e,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,e.usedForTerrain=!0,e.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(e,s){this.sourceCache.update(e,s),this._renderableTilesKeys=[];const l={};for(const c of e.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))l[c.key]=!0,this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),u.aP(c.posMatrix,0,u.X,0,u.X,0,1),this._tiles[c.key]=new Dr(c,this.tileSize));for(const c in this._tiles)l[c]||delete this._tiles[c]}freeRtt(e){for(const s in this._tiles){const l=this._tiles[s];(!e||l.tileID.equals(e)||l.tileID.isChildOf(e)||e.isChildOf(l.tileID))&&(l.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(e=>this.getTileByID(e))}getTileByID(e){return this._tiles[e]}getTerrainCoords(e){const s={};for(const l of this._renderableTilesKeys){const c=this._tiles[l].tileID;if(c.canonical.equals(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16),u.aP(m.posMatrix,0,u.X,0,u.X,0,1),s[l]=m}else if(c.canonical.isChildOf(e.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const b=c.canonical.z-e.canonical.z,C=c.canonical.x-(c.canonical.x>>b<<b),I=c.canonical.y-(c.canonical.y>>b<<b),P=u.X>>b;u.aP(m.posMatrix,0,P,0,P,0,1),u.J(m.posMatrix,m.posMatrix,[-C*P,-I*P,0]),s[l]=m}else if(e.canonical.isChildOf(c.canonical)){const m=e.clone();m.posMatrix=new Float64Array(16);const b=e.canonical.z-c.canonical.z,C=e.canonical.x-(e.canonical.x>>b<<b),I=e.canonical.y-(e.canonical.y>>b<<b),P=u.X>>b;u.aP(m.posMatrix,0,u.X,0,u.X,0,1),u.J(m.posMatrix,m.posMatrix,[C*P,I*P,0]),u.K(m.posMatrix,m.posMatrix,[1/2**b,1/2**b,0]),s[l]=m}}return s}getSourceTile(e,s){const l=this.sourceCache._source;let c=e.overscaledZ-this.deltaZoom;if(c>l.maxzoom&&(c=l.maxzoom),c<l.minzoom)return null;this._sourceTileCache[e.key]||(this._sourceTileCache[e.key]=e.scaledTo(c).key);let m=this.sourceCache.getTileByID(this._sourceTileCache[e.key]);if((!m||!m.dem)&&s)for(;c>=l.minzoom&&(!m||!m.dem);)m=this.sourceCache.getTileByID(e.scaledTo(c--).key);return m}tilesAfterTime(e=Date.now()){return Object.values(this._tiles).filter(s=>s.timeAdded>=e)}}class oc{constructor(e,s,l){this.painter=e,this.sourceCache=new Hh(s),this.options=l,this.exaggeration=typeof l.exaggeration=="number"?l.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(e,s,l,c=u.X){var m;if(!(s>=0&&s<c&&l>=0&&l<c))return 0;const b=this.getTerrainData(e),C=(m=b.tile)===null||m===void 0?void 0:m.dem;if(!C)return 0;const I=function(H,Y,Q){var ee=Y[0],ne=Y[1];return H[0]=Q[0]*ee+Q[4]*ne+Q[12],H[1]=Q[1]*ee+Q[5]*ne+Q[13],H}([],[s/c*u.X,l/c*u.X],b.u_terrain_matrix),P=[I[0]*C.dim,I[1]*C.dim],k=Math.floor(P[0]),A=Math.floor(P[1]),B=P[0]-k,$=P[1]-A;return C.get(k,A)*(1-B)*(1-$)+C.get(k+1,A)*B*(1-$)+C.get(k,A+1)*(1-B)*$+C.get(k+1,A+1)*B*$}getElevationForLngLatZoom(e,s){if(!u.bb(s,e.wrap()))return 0;const{tileID:l,mercatorX:c,mercatorY:m}=this._getOverscaledTileIDFromLngLatZoom(e,s);return this.getElevation(l,c%u.X,m%u.X,u.X)}getElevation(e,s,l,c=u.X){return this.getDEMElevation(e,s,l,c)*this.exaggeration}getTerrainData(e){if(!this._emptyDemTexture){const c=this.painter.context,m=new u.R({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new tt(c,m,c.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new tt(c,new u.R({width:1,height:1}),c.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.an([])}const s=this.sourceCache.getSourceTile(e,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const c=this.painter.context;s.demTexture=this.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new tt(c,s.dem.getPixels(),c.gl.RGBA,{premultiply:!1}),s.demTexture.bind(c.gl.NEAREST,c.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const l=s&&s+s.tileID.key+e.key;if(l&&!this._demMatrixCache[l]){const c=this.sourceCache.sourceCache._source.maxzoom;let m=e.canonical.z-s.tileID.canonical.z;e.overscaledZ>e.canonical.z&&(e.canonical.z>=c?m=e.canonical.z-c:u.w("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const b=e.canonical.x-(e.canonical.x>>m<<m),C=e.canonical.y-(e.canonical.y>>m<<m),I=u.bc(new Float64Array(16),[1/(u.X<<m),1/(u.X<<m),0]);u.J(I,I,[b*u.X,C*u.X,0]),this._demMatrixCache[e.key]={matrix:I,coord:e}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:l?this._demMatrixCache[e.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getFramebuffer(e){const s=this.painter,l=s.width/devicePixelRatio,c=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===l&&this._fbo.height===c||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new tt(s.context,{width:l,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new tt(s.context,{width:l,height:c,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(l,c,!0,!1),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,l,c))),this._fbo.colorAttachment.set(e==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const e=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let m=0,b=0;m<this._coordsTextureSize;m++)for(let C=0;C<this._coordsTextureSize;C++,b+=4)s[b+0]=255&C,s[b+1]=255&m,s[b+2]=C>>8<<4|m>>8,s[b+3]=0;const l=new u.R({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),c=new tt(e,l,e.gl.RGBA,{premultiply:!1});return c.bind(e.gl.NEAREST,e.gl.CLAMP_TO_EDGE),this._coordsTexture=c,c}pointCoordinate(e){this.painter.maybeDrawDepthAndCoords(!0);const s=new Uint8Array(4),l=this.painter.context,c=l.gl,m=Math.round(e.x*this.painter.pixelRatio/devicePixelRatio),b=Math.round(e.y*this.painter.pixelRatio/devicePixelRatio),C=Math.round(this.painter.height/devicePixelRatio);l.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),c.readPixels(m,C-b-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null);const I=s[0]+(s[2]>>4<<8),P=s[1]+((15&s[2])<<8),k=this.coordsIndex[255-s[3]],A=k&&this.sourceCache.getTileByID(k);if(!A)return null;const B=this._coordsTextureSize,$=(1<<A.tileID.canonical.z)*B;return new u.Z((A.tileID.canonical.x*B+I)/$+A.tileID.wrap,(A.tileID.canonical.y*B+P)/$,this.getElevation(A.tileID,I,P,B))}depthAtPoint(e){const s=new Uint8Array(4),l=this.painter.context,c=l.gl;return l.bindFramebuffer.set(this.getFramebuffer("depth").framebuffer),c.readPixels(e.x,this.painter.height/devicePixelRatio-e.y-1,1,1,c.RGBA,c.UNSIGNED_BYTE,s),l.bindFramebuffer.set(null),(s[0]/16777216+s[1]/65536+s[2]/256+s[3])/256}getTerrainMesh(){if(this._mesh)return this._mesh;const e=this.painter.context,s=new u.bd,l=new u.aY,c=this.meshSize,m=u.X/c,b=c*c;for(let A=0;A<=c;A++)for(let B=0;B<=c;B++)s.emplaceBack(B*m,A*m,0);for(let A=0;A<b;A+=c+1)for(let B=0;B<c;B++)l.emplaceBack(B+A,c+B+A+1,c+B+A+2),l.emplaceBack(B+A,c+B+A+2,B+A+1);const C=s.length,I=C+2*(c+1);for(const A of[0,1])for(let B=0;B<=c;B++)for(const $ of[0,1])s.emplaceBack(B*m,A*u.X,$);for(let A=0;A<2*c;A+=2)l.emplaceBack(I+A,I+A+1,I+A+3),l.emplaceBack(I+A,I+A+3,I+A+2),l.emplaceBack(C+A,C+A+3,C+A+1),l.emplaceBack(C+A,C+A+2,C+A+3);const P=s.length,k=P+2*(c+1);for(const A of[0,1])for(let B=0;B<=c;B++)for(const $ of[0,1])s.emplaceBack(A*u.X,B*m,$);for(let A=0;A<2*c;A+=2)l.emplaceBack(P+A,P+A+1,P+A+3),l.emplaceBack(P+A,P+A+3,P+A+2),l.emplaceBack(k+A,k+A+3,k+A+1),l.emplaceBack(k+A,k+A+2,k+A+3);return this._mesh=new Ia(e.createVertexBuffer(s,sc.members),e.createIndexBuffer(l),u.a0.simpleSegment(0,0,s.length,l.length)),this._mesh}getMeshFrameDelta(e){return 2*Math.PI*u.be/Math.pow(2,e)/5}getMinTileElevationForLngLatZoom(e,s){var l;const{tileID:c}=this._getOverscaledTileIDFromLngLatZoom(e,s);return(l=this.getMinMaxElevation(c).minElevation)!==null&&l!==void 0?l:0}getMinMaxElevation(e){const s=this.getTerrainData(e).tile,l={minElevation:null,maxElevation:null};return s&&s.dem&&(l.minElevation=s.dem.min*this.exaggeration,l.maxElevation=s.dem.max*this.exaggeration),l}_getOverscaledTileIDFromLngLatZoom(e,s){const l=u.Z.fromLngLat(e.wrap()),c=(1<<s)*u.X,m=l.x*c,b=l.y*c,C=Math.floor(m/u.X),I=Math.floor(b/u.X);return{tileID:new u.S(s,0,s,C,I),mercatorX:m,mercatorY:b}}}class Wh{constructor(e,s,l){this._context=e,this._size=s,this._tileSize=l,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const e of this._objects)e.texture.destroy(),e.fbo.destroy()}_createObject(e){const s=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),l=new tt(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return l.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),s.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),s.colorAttachment.set(l.texture),{id:e,fbo:s,texture:l,stamp:-1,inUse:!1}}getObjectForId(e){return this._objects[e]}useObject(e){e.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(s=>e.id!==s),this._recentlyUsed.push(e.id)}stampObject(e){e.stamp=++this._stamp}getOrCreateFreeObject(){for(const s of this._recentlyUsed)if(!this._objects[s].inUse)return this._objects[s];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const e=this._createObject(this._objects.length);return this._objects.push(e),e}freeObject(e){e.inUse=!1}freeAllObjects(){for(const e of this._objects)this.freeObject(e)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(e=>!e.inUse)===!1}}const qs={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ku{constructor(e,s){this.painter=e,this.terrain=s,this.pool=new Wh(e.context,30,s.sourceCache.tileSize*s.qualityFactor)}destruct(){this.pool.destruct()}getTexture(e){return this.pool.getObjectForId(e.rtt[this._stacks.length-1].id).texture}prepareForRender(e,s){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=e._order.filter(l=>!e._layers[l].isHidden(s)),this._coordsDescendingInv={};for(const l in e.sourceCaches){this._coordsDescendingInv[l]={};const c=e.sourceCaches[l].getVisibleCoordinates();for(const m of c){const b=this.terrain.sourceCache.getTerrainCoords(m);for(const C in b)this._coordsDescendingInv[l][C]||(this._coordsDescendingInv[l][C]=[]),this._coordsDescendingInv[l][C].push(b[C])}}this._coordsDescendingInvStr={};for(const l of e._order){const c=e._layers[l],m=c.source;if(qs[c.type]&&!this._coordsDescendingInvStr[m]){this._coordsDescendingInvStr[m]={};for(const b in this._coordsDescendingInv[m])this._coordsDescendingInvStr[m][b]=this._coordsDescendingInv[m][b].map(C=>C.key).sort().join()}}for(const l of this._renderableTiles)for(const c in this._coordsDescendingInvStr){const m=this._coordsDescendingInvStr[c][l.tileID.key];m&&m!==l.rttCoords[c]&&(l.rtt=[])}}renderLayer(e){if(e.isHidden(this.painter.transform.zoom))return!1;const s=e.type,l=this.painter,c=this._renderableLayerIds[this._renderableLayerIds.length-1]===e.id;if(qs[s]&&(this._prevType&&qs[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(e.id),!c))return!0;if(qs[this._prevType]||qs[s]&&c){this._prevType=s;const m=this._stacks.length-1,b=this._stacks[m]||[];for(const C of this._renderableTiles){if(this.pool.isFull()&&(wu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(C),C.rtt[m]){const P=this.pool.getObjectForId(C.rtt[m].id);if(P.stamp===C.rtt[m].stamp){this.pool.useObject(P);continue}}const I=this.pool.getOrCreateFreeObject();this.pool.useObject(I),this.pool.stampObject(I),C.rtt[m]={id:I.id,stamp:I.stamp},l.context.bindFramebuffer.set(I.fbo.framebuffer),l.context.clear({color:u.aM.transparent,stencil:0}),l.currentStencilSource=void 0;for(let P=0;P<b.length;P++){const k=l.style._layers[b[P]],A=k.source?this._coordsDescendingInv[k.source][C.tileID.key]:[C.tileID];l.context.viewport.set([0,0,I.fbo.width,I.fbo.height]),l._renderTileClippingMasks(k,A),l.renderLayer(l,l.style.sourceCaches[k.source],k,A),k.source&&(C.rttCoords[k.source]=this._coordsDescendingInvStr[k.source][C.tileID.key])}}return wu(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),qs[s]}return!1}}const ac={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"MapLibre logo","Map.Title":"Map","Marker.Title":"Map marker","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","Popup.Close":"Close popup","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.Enable":"Enable terrain","TerrainControl.Disable":"Disable terrain","CooperativeGesturesHandler.WindowsHelpText":"Use Ctrl + scroll to zoom the map","CooperativeGesturesHandler.MacHelpText":"Use  + scroll to zoom the map","CooperativeGesturesHandler.MobileHelpText":"Use two fingers to move the map"},Au=O,Zh={hash:!1,interactive:!0,bearingSnap:7,attributionControl:$s,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,refreshExpiredTiles:!0,scrollZoom:!0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,trackResize:!0,center:[0,0],zoom:0,bearing:0,pitch:0,renderWorldCopies:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.a.MAX_TILE_CACHE_ZOOM_LEVELS,transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,clickTolerance:3,localIdeographFontFamily:"sans-serif",pitchWithRotate:!0,validateStyle:!0,maxCanvasSize:[4096,4096],cancelPendingTileRequestsWhileZooming:!0},lc=f=>{f.touchstart=f.dragStart,f.touchmoveWindow=f.dragMove,f.touchend=f.dragEnd},Gh={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xh{constructor(e,s,l=!1){this.mousedown=b=>{this.startMouse(u.e({},b,{ctrlKey:!0,preventDefault:()=>b.preventDefault()}),F.mousePos(this.element,b)),F.addEventListener(window,"mousemove",this.mousemove),F.addEventListener(window,"mouseup",this.mouseup)},this.mousemove=b=>{this.moveMouse(b,F.mousePos(this.element,b))},this.mouseup=b=>{this.mouseRotate.dragEnd(b),this.mousePitch&&this.mousePitch.dragEnd(b),this.offTemp()},this.touchstart=b=>{b.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=F.touchPos(this.element,b.targetTouches)[0],this.startTouch(b,this._startPos),F.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.addEventListener(window,"touchend",this.touchend))},this.touchmove=b=>{b.targetTouches.length!==1?this.reset():(this._lastPos=F.touchPos(this.element,b.targetTouches)[0],this.moveTouch(b,this._lastPos))},this.touchend=b=>{b.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()},this.reset=()=>{this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()},this._clickTolerance=10;const c=e.dragRotate._mouseRotate.getClickTolerance(),m=e.dragRotate._mousePitch.getClickTolerance();this.element=s,this.mouseRotate=Xl({clickTolerance:c,enable:!0}),this.touchRotate=(({enable:b,clickTolerance:C,bearingDegreesPerPixelMoved:I=.8})=>{const P=new Gl;return new Cr({clickTolerance:C,move:(k,A)=>({bearingDelta:(A.x-k.x)*I}),moveStateManager:P,enable:b,assignEvents:lc})})({clickTolerance:c,enable:!0}),this.map=e,l&&(this.mousePitch=Yl({clickTolerance:m,enable:!0}),this.touchPitch=(({enable:b,clickTolerance:C,pitchDegreesPerPixelMoved:I=-.5})=>{const P=new Gl;return new Cr({clickTolerance:C,move:(k,A)=>({pitchDelta:(A.y-k.y)*I}),moveStateManager:P,enable:b,assignEvents:lc})})({clickTolerance:m,enable:!0})),F.addEventListener(s,"mousedown",this.mousedown),F.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),F.addEventListener(s,"touchcancel",this.reset)}startMouse(e,s){this.mouseRotate.dragStart(e,s),this.mousePitch&&this.mousePitch.dragStart(e,s),F.disableDrag()}startTouch(e,s){this.touchRotate.dragStart(e,s),this.touchPitch&&this.touchPitch.dragStart(e,s),F.disableDrag()}moveMouse(e,s){const l=this.map,{bearingDelta:c}=this.mouseRotate.dragMove(e,s)||{};if(c&&l.setBearing(l.getBearing()+c),this.mousePitch){const{pitchDelta:m}=this.mousePitch.dragMove(e,s)||{};m&&l.setPitch(l.getPitch()+m)}}moveTouch(e,s){const l=this.map,{bearingDelta:c}=this.touchRotate.dragMove(e,s)||{};if(c&&l.setBearing(l.getBearing()+c),this.touchPitch){const{pitchDelta:m}=this.touchPitch.dragMove(e,s)||{};m&&l.setPitch(l.getPitch()+m)}}off(){const e=this.element;F.removeEventListener(e,"mousedown",this.mousedown),F.removeEventListener(e,"touchstart",this.touchstart,{passive:!1}),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend),F.removeEventListener(e,"touchcancel",this.reset),this.offTemp()}offTemp(){F.enableDrag(),F.removeEventListener(window,"mousemove",this.mousemove),F.removeEventListener(window,"mouseup",this.mouseup),F.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),F.removeEventListener(window,"touchend",this.touchend)}}let xn;function ei(f,e,s){const l=new u.N(f.lng,f.lat);if(f=new u.N(f.lng,f.lat),e){const c=new u.N(f.lng-360,f.lat),m=new u.N(f.lng+360,f.lat),b=s.locationPoint(f).distSqr(e);s.locationPoint(c).distSqr(e)<b?f=c:s.locationPoint(m).distSqr(e)<b&&(f=m)}for(;Math.abs(f.lng-s.center.lng)>180;){const c=s.locationPoint(f);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;f.lng>s.center.lng?f.lng-=360:f.lng+=360}return f.lng!==l.lng&&s.locationPoint(f).y>s.height/2-s.getHorizon()?f:l}const Hs={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ba(f,e,s){const l=f.classList;for(const c in Hs)l.remove(`maplibregl-${s}-anchor-${c}`);l.add(`maplibregl-${s}-anchor-${e}`)}class Fa extends u.E{constructor(e){if(super(),this._onKeyPress=s=>{const l=s.code,c=s.charCode||s.keyCode;l!=="Space"&&l!=="Enter"&&c!==32&&c!==13||this.togglePopup()},this._onMapClick=s=>{const l=s.originalEvent.target,c=this._element;this._popup&&(l===c||c.contains(l))&&this.togglePopup()},this._update=s=>{var l;if(!this._map)return;const c=this._map.loaded()&&!this._map.isMoving();(s?.type==="terrain"||s?.type==="render"&&!c)&&this._map.once("render",this._update),this._lngLat=this._map.transform.renderWorldCopies?ei(this._lngLat,this._flatPos,this._map.transform):(l=this._lngLat)===null||l===void 0?void 0:l.wrap(),this._flatPos=this._pos=this._map.project(this._lngLat)._add(this._offset),this._map.terrain&&(this._flatPos=this._map.transform.locationPoint(this._lngLat)._add(this._offset));let m="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?m=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(m=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let b="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?b="rotateX(0deg)":this._pitchAlignment==="map"&&(b=`rotateX(${this._map.getPitch()}deg)`),this._subpixelPositioning||s&&s.type!=="moveend"||(this._pos=this._pos.round()),F.setTransform(this._element,`${Hs[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${b} ${m}`),q.frameAsync(new AbortController).then(()=>{this._updateOpacity(s&&s.type==="moveend")}).catch(()=>{})},this._onMove=s=>{if(!this._isDragging){const l=this._clickTolerance||this._map._clickTolerance;this._isDragging=s.point.dist(this._pointerdownPos)>=l}this._isDragging&&(this._pos=s.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.k("dragstart"))),this.fire(new u.k("drag")))},this._onUp=()=>{this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.k("dragend")),this._state="inactive"},this._addDragHandler=s=>{this._element.contains(s.originalEvent.target)&&(s.preventDefault(),this._positionDelta=s.point.sub(this._pos).add(this._offset),this._pointerdownPos=s.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._subpixelPositioning=e&&e.subpixelPositioning||!1,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment!=="auto"?e.pitchAlignment:this._rotationAlignment,this.setOpacity(),this.setOpacity(e?.opacity,e?.opacityWhenCovered),e&&e.element)this._element=e.element,this._offset=u.P.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=F.create("div");const s=F.createNS("http://www.w3.org/2000/svg","svg"),l=41,c=27;s.setAttributeNS(null,"display","block"),s.setAttributeNS(null,"height",`${l}px`),s.setAttributeNS(null,"width",`${c}px`),s.setAttributeNS(null,"viewBox",`0 0 ${c} ${l}`);const m=F.createNS("http://www.w3.org/2000/svg","g");m.setAttributeNS(null,"stroke","none"),m.setAttributeNS(null,"stroke-width","1"),m.setAttributeNS(null,"fill","none"),m.setAttributeNS(null,"fill-rule","evenodd");const b=F.createNS("http://www.w3.org/2000/svg","g");b.setAttributeNS(null,"fill-rule","nonzero");const C=F.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const I=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ee of I){const ne=F.createNS("http://www.w3.org/2000/svg","ellipse");ne.setAttributeNS(null,"opacity","0.04"),ne.setAttributeNS(null,"cx","10.5"),ne.setAttributeNS(null,"cy","5.80029008"),ne.setAttributeNS(null,"rx",ee.rx),ne.setAttributeNS(null,"ry",ee.ry),C.appendChild(ne)}const P=F.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill",this._color);const k=F.createNS("http://www.w3.org/2000/svg","path");k.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),P.appendChild(k);const A=F.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"opacity","0.25"),A.setAttributeNS(null,"fill","#000000");const B=F.createNS("http://www.w3.org/2000/svg","path");B.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),A.appendChild(B);const $=F.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const H=F.createNS("http://www.w3.org/2000/svg","g");H.setAttributeNS(null,"transform","translate(8.0, 8.0)");const Y=F.createNS("http://www.w3.org/2000/svg","circle");Y.setAttributeNS(null,"fill","#000000"),Y.setAttributeNS(null,"opacity","0.25"),Y.setAttributeNS(null,"cx","5.5"),Y.setAttributeNS(null,"cy","5.5"),Y.setAttributeNS(null,"r","5.4999962");const Q=F.createNS("http://www.w3.org/2000/svg","circle");Q.setAttributeNS(null,"fill","#FFFFFF"),Q.setAttributeNS(null,"cx","5.5"),Q.setAttributeNS(null,"cy","5.5"),Q.setAttributeNS(null,"r","5.4999962"),H.appendChild(Y),H.appendChild(Q),b.appendChild(C),b.appendChild(P),b.appendChild(A),b.appendChild($),b.appendChild(H),s.appendChild(b),s.setAttributeNS(null,"height",l*this._scale+"px"),s.setAttributeNS(null,"width",c*this._scale+"px"),this._element.appendChild(s),this._offset=u.P.convert(e&&e.offset||[0,-14])}if(this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",s=>{s.preventDefault()}),this._element.addEventListener("mousedown",s=>{s.preventDefault()}),Ba(this._element,this._anchor,"marker"),e&&e.className)for(const s of e.className.split(" "))this._element.classList.add(s);this._popup=null}addTo(e){return this.remove(),this._map=e,this._element.setAttribute("aria-label",e._getUIString("Marker.Title")),e.getCanvasContainer().appendChild(this._element),e.on("move",this._update),e.on("moveend",this._update),e.on("terrain",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("terrain",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),F.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=u.N.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const c=Math.abs(13.5)/Math.SQRT2;e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[c,-1*(38.1-13.5+c)],"bottom-right":[-c,-1*(38.1-13.5+c)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}setSubpixelPositioning(e){return this._subpixelPositioning=e,this}getPopup(){return this._popup}togglePopup(){const e=this._popup;return this._element.style.opacity===this._opacityWhenCovered?this:e?(e.isOpen()?e.remove():(e.setLngLat(this._lngLat),e.addTo(this._map)),this):this}_updateOpacity(e=!1){var s,l;if(!(!((s=this._map)===null||s===void 0)&&s.terrain))return void(this._element.style.opacity!==this._opacity&&(this._element.style.opacity=this._opacity));if(e)this._opacityTimeout=null;else{if(this._opacityTimeout)return;this._opacityTimeout=setTimeout(()=>{this._opacityTimeout=null},100)}const c=this._map,m=c.terrain.depthAtPoint(this._pos),b=c.terrain.getElevationForLngLatZoom(this._lngLat,c.transform.tileZoom);if(c.transform.lngLatToCameraDepth(this._lngLat,b)-m<.006)return void(this._element.style.opacity=this._opacity);const C=-this._offset.y/c.transform._pixelPerMeter,I=Math.sin(c.getPitch()*Math.PI/180)*C,P=c.terrain.depthAtPoint(new u.P(this._pos.x,this._pos.y-this._offset.y)),k=c.transform.lngLatToCameraDepth(this._lngLat,b+I)-P>.006;!((l=this._popup)===null||l===void 0)&&l.isOpen()&&k&&this._popup.remove(),this._element.style.opacity=k?this._opacityWhenCovered:this._opacity}getOffset(){return this._offset}setOffset(e){return this._offset=u.P.convert(e),this._update(),this}addClassName(e){this._element.classList.add(e)}removeClassName(e){this._element.classList.remove(e)}toggleClassName(e){return this._element.classList.toggle(e)}setDraggable(e){return this._draggable=!!e,this._map&&(e?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e&&e!=="auto"?e:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}setOpacity(e,s){return e===void 0&&s===void 0&&(this._opacity="1",this._opacityWhenCovered="0.2"),e!==void 0&&(this._opacity=e),s!==void 0&&(this._opacityWhenCovered=s),this._map&&this._updateOpacity(!0),this}}const zu={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Uo=0,$o=!1;const dr={maxWidth:100,unit:"metric"};function jo(f,e,s){const l=s&&s.maxWidth||100,c=f._container.clientHeight/2,m=f.unproject([0,c]),b=f.unproject([l,c]),C=m.distanceTo(b);if(s&&s.unit==="imperial"){const I=3.2808*C;I>5280?Ze(e,l,I/5280,f._getUIString("ScaleControl.Miles")):Ze(e,l,I,f._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?Ze(e,l,C/1852,f._getUIString("ScaleControl.NauticalMiles")):C>=1e3?Ze(e,l,C/1e3,f._getUIString("ScaleControl.Kilometers")):Ze(e,l,C,f._getUIString("ScaleControl.Meters"))}function Ze(f,e,s,l){const c=function(m){const b=Math.pow(10,`${Math.floor(m)}`.length-1);let C=m/b;return C=C>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(I){const P=Math.pow(10,Math.ceil(-Math.log(I)/Math.LN10));return Math.round(I*P)/P}(C),b*C}(s);f.style.width=e*(c/s)+"px",f.innerHTML=`${c}&nbsp;${l}`}const rt={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",subpixelPositioning:!1},Oa=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Na(f){if(f){if(typeof f=="number"){const e=Math.round(Math.abs(f)/Math.SQRT2);return{center:new u.P(0,0),top:new u.P(0,f),"top-left":new u.P(e,e),"top-right":new u.P(-e,e),bottom:new u.P(0,-f),"bottom-left":new u.P(e,-e),"bottom-right":new u.P(-e,-e),left:new u.P(f,0),right:new u.P(-f,0)}}if(f instanceof u.P||Array.isArray(f)){const e=u.P.convert(f);return{center:e,top:e,"top-left":e,"top-right":e,bottom:e,"bottom-left":e,"bottom-right":e,left:e,right:e}}return{center:u.P.convert(f.center||[0,0]),top:u.P.convert(f.top||[0,0]),"top-left":u.P.convert(f["top-left"]||[0,0]),"top-right":u.P.convert(f["top-right"]||[0,0]),bottom:u.P.convert(f.bottom||[0,0]),"bottom-left":u.P.convert(f["bottom-left"]||[0,0]),"bottom-right":u.P.convert(f["bottom-right"]||[0,0]),left:u.P.convert(f.left||[0,0]),right:u.P.convert(f.right||[0,0])}}return Na(new u.P(0,0))}const cc=O;x.AJAXError=u.bh,x.Evented=u.E,x.LngLat=u.N,x.MercatorCoordinate=u.Z,x.Point=u.P,x.addProtocol=u.bi,x.config=u.a,x.removeProtocol=u.bj,x.AttributionControl=js,x.BoxZoomHandler=vn,x.CanvasSource=In,x.CooperativeGesturesHandler=Us,x.DoubleClickZoomHandler=os,x.DragPanHandler=Eu,x.DragRotateHandler=Pu,x.EdgeInsets=Fs,x.FullscreenControl=class extends u.E{constructor(f={}){super(),this._onFullscreenChange=()=>{var e;let s=window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement;for(;!((e=s?.shadowRoot)===null||e===void 0)&&e.fullscreenElement;)s=s.shadowRoot.fullscreenElement;s===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,f&&f.container&&(f.container instanceof HTMLElement?this._container=f.container:u.w("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(f){return this._map=f,this._container||(this._container=this._map.getContainer()),this._controlContainer=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){F.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const f=this._fullscreenButton=F.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);F.create("span","maplibregl-ctrl-icon",f).setAttribute("aria-hidden","true"),f.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const f=this._getTitle();this._fullscreenButton.setAttribute("aria-label",f),this._fullscreenButton.title=f}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.k("fullscreenstart")),this._prevCooperativeGesturesEnabled=this._map.cooperativeGestures.isEnabled(),this._map.cooperativeGestures.disable()):(this.fire(new u.k("fullscreenend")),this._prevCooperativeGesturesEnabled&&this._map.cooperativeGestures.enable())}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},x.GeoJSONSource=Co,x.GeolocateControl=class extends u.E{constructor(f){super(),this._onSuccess=e=>{if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new u.k("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(e),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.k("geolocate",e)),this._finish()}},this._updateCamera=e=>{const s=new u.N(e.coords.longitude,e.coords.latitude),l=e.coords.accuracy,c=this._map.getBearing(),m=u.e({bearing:c},this.options.fitBoundsOptions),b=ge.fromLngLat(s,l);this._map.fitBounds(b,m,{geolocateSource:!0})},this._updateMarker=e=>{if(e){const s=new u.N(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(s).addTo(this._map),this._userLocationDotMarker.setLngLat(s).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},this._onZoom=()=>{this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},this._onError=e=>{if(this._map){if(this.options.trackUserLocation)if(e.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(e.code===3&&$o)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.k("error",e)),this._finish()}},this._finish=()=>{this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},this._setupUI=()=>{this._map&&(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=F.create("button","maplibregl-ctrl-geolocate",this._container),F.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",this._geolocateButton.disabled=!0)},this._finishSetupUI=e=>{if(this._map){if(e===!1){u.w("Geolocation support is not available so the GeolocateControl will be disabled.");const s=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}else{const s=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.disabled=!1,this._geolocateButton.title=s,this._geolocateButton.setAttribute("aria-label",s)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=F.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Fa({element:this._dotElement}),this._circleElement=F.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Fa({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",()=>this.trigger()),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",s=>{s.geolocateSource||this._watchState!=="ACTIVE_LOCK"||s.originalEvent&&s.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.k("trackuserlocationend")),this.fire(new u.k("userlocationlostfocus")))})}},this.options=u.e({},zu,f)}onAdd(f){return this._map=f,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),function(){return u._(this,arguments,void 0,function*(e=!1){if(xn!==void 0&&!e)return xn;if(window.navigator.permissions===void 0)return xn=!!window.navigator.geolocation,xn;try{xn=(yield window.navigator.permissions.query({name:"geolocation"})).state!=="denied"}catch{xn=!!window.navigator.geolocation}return xn})}().then(e=>this._finishSetupUI(e)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),F.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Uo=0,$o=!1}_isOutOfMapMaxBounds(f){const e=this._map.getMaxBounds(),s=f.coords;return e&&(s.longitude<e.getWest()||s.longitude>e.getEast()||s.latitude<e.getSouth()||s.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_updateCircleRadius(){const f=this._map.getBounds(),e=f.getSouthEast(),s=f.getNorthEast(),l=e.distanceTo(s),c=Math.ceil(this._accuracy/(l/this._map._container.clientHeight)*2);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}trigger(){if(!this._setup)return u.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.k("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Uo--,$o=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.k("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.k("trackuserlocationstart")),this.fire(new u.k("userlocationfocus"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let f;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Uo++,Uo>1?(f={maximumAge:6e5,timeout:0},$o=!0):(f=this.options.positionOptions,$o=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,f)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},x.Hash=Ea,x.ImageSource=xr,x.KeyboardHandler=Pn,x.LngLatBounds=ge,x.LogoControl=rc,x.Map=class extends Mu{constructor(f){u.bf.mark(u.bg.create);const e=Object.assign(Object.assign({},Zh),f);if(e.minZoom!=null&&e.maxZoom!=null&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(e.minPitch!=null&&e.maxPitch!=null&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(e.minPitch!=null&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(e.maxPitch!=null&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Os(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),{bearingSnap:e.bearingSnap}),this._idleTriggered=!1,this._crossFadingFactor=1,this._renderTaskQueue=new wt,this._controls=[],this._mapId=u.a4(),this._contextLost=s=>{s.preventDefault(),this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this.fire(new u.k("webglcontextlost",{originalEvent:s}))},this._contextRestored=s=>{this._setupPainter(),this.resize(),this._update(),this.fire(new u.k("webglcontextrestored",{originalEvent:s}))},this._onMapScroll=s=>{if(s.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},this._onWindowOnline=()=>{this._update()},this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._maxTileCacheZoomLevels=e.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat===!0,this._preserveDrawingBuffer=e.preserveDrawingBuffer===!0,this._antialias=e.antialias===!0,this._trackResize=e.trackResize===!0,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles===!0,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions===!0,this._collectResourceTiming=e.collectResourceTiming===!0,this._locale=Object.assign(Object.assign({},ac),e.locale),this._clickTolerance=e.clickTolerance,this._overridePixelRatio=e.pixelRatio,this._maxCanvasSize=e.maxCanvasSize,this.transformCameraUpdate=e.transformCameraUpdate,this.cancelPendingTileRequestsWhileZooming=e.cancelPendingTileRequestsWhileZooming===!0,this._imageQueueHandle=st.addThrottleControl(()=>this.isMoving()),this._requestManager=new Qe(e.transformRequest),typeof e.container=="string"){if(this._container=document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)).on("moveend",()=>this._update(!1)).on("zoom",()=>this._update(!0)).on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}).once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let s=!1;const l=Bo(c=>{this._trackResize&&!this._removed&&(this.resize(c),this.redraw())},50);this._resizeObserver=new ResizeObserver(c=>{s?l(c):s=!0}),this._resizeObserver.observe(this._container)}this.handlers=new nc(this,e),this._hash=e.hash&&new Ea(typeof e.hash=="string"&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,u.e({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,this._validateStyle=e.validateStyle,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new js(typeof e.attributionControl=="boolean"?void 0:e.attributionControl)),e.maplibreLogo&&this.addControl(new rc,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new u.k(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new u.k(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new u.k("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(f,e){if(e===void 0&&(e=f.getDefaultPosition?f.getDefaultPosition():"top-right"),!f||!f.onAdd)return this.fire(new u.j(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=f.onAdd(this);this._controls.push(f);const l=this._controlPositions[e];return e.indexOf("bottom")!==-1?l.insertBefore(s,l.firstChild):l.appendChild(s),this}removeControl(f){if(!f||!f.onRemove)return this.fire(new u.j(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const e=this._controls.indexOf(f);return e>-1&&this._controls.splice(e,1),f.onRemove(this),this}hasControl(f){return this._controls.indexOf(f)>-1}calculateCameraOptionsFromTo(f,e,s,l){return l==null&&this.terrain&&(l=this.terrain.getElevationForLngLatZoom(s,this.transform.tileZoom)),super.calculateCameraOptionsFromTo(f,e,s,l)}resize(f){var e;const s=this._containerDimensions(),l=s[0],c=s[1],m=this._getClampedPixelRatio(l,c);if(this._resizeCanvas(l,c,m),this.painter.resize(l,c,m),this.painter.overLimit()){const C=this.painter.context.gl;this._maxCanvasSize=[C.drawingBufferWidth,C.drawingBufferHeight];const I=this._getClampedPixelRatio(l,c);this._resizeCanvas(l,c,I),this.painter.resize(l,c,I)}this.transform.resize(l,c),(e=this._requestedCameraState)===null||e===void 0||e.resize(l,c);const b=!this._moving;return b&&(this.stop(),this.fire(new u.k("movestart",f)).fire(new u.k("move",f))),this.fire(new u.k("resize",f)),b&&this.fire(new u.k("moveend",f)),this}_getClampedPixelRatio(f,e){const{0:s,1:l}=this._maxCanvasSize,c=this.getPixelRatio(),m=f*c,b=e*c;return Math.min(m>s?s/m:1,b>l?l/b:1)*c}getPixelRatio(){var f;return(f=this._overridePixelRatio)!==null&&f!==void 0?f:devicePixelRatio}setPixelRatio(f){this._overridePixelRatio=f,this.resize()}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(f){return this.transform.setMaxBounds(ge.convert(f)),this._update()}setMinZoom(f){if((f=f??-2)>=-2&&f<=this.transform.maxZoom)return this.transform.minZoom=f,this._update(),this.getZoom()<f&&this.setZoom(f),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(f){if((f=f??22)>=this.transform.minZoom)return this.transform.maxZoom=f,this._update(),this.getZoom()>f&&this.setZoom(f),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(f){if((f=f??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(f>=0&&f<=this.transform.maxPitch)return this.transform.minPitch=f,this._update(),this.getPitch()<f&&this.setPitch(f),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(f){if((f=f??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(f>=this.transform.minPitch)return this.transform.maxPitch=f,this._update(),this.getPitch()>f&&this.setPitch(f),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(f){return this.transform.renderWorldCopies=f,this._update()}project(f){return this.transform.locationPoint(u.N.convert(f),this.style&&this.terrain)}unproject(f){return this.transform.pointLocation(u.P.convert(f),this.terrain)}isMoving(){var f;return this._moving||((f=this.handlers)===null||f===void 0?void 0:f.isMoving())}isZooming(){var f;return this._zooming||((f=this.handlers)===null||f===void 0?void 0:f.isZooming())}isRotating(){var f;return this._rotating||((f=this.handlers)===null||f===void 0?void 0:f.isRotating())}_createDelegatedListener(f,e,s){if(f==="mouseenter"||f==="mouseover"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:m=>{const b=e.filter(I=>this.getLayer(I)),C=b.length!==0?this.queryRenderedFeatures(m.point,{layers:b}):[];C.length?l||(l=!0,s.call(this,new Ui(f,this,m.originalEvent,{features:C}))):l=!1},mouseout:()=>{l=!1}}}}if(f==="mouseleave"||f==="mouseout"){let l=!1;return{layers:e,listener:s,delegates:{mousemove:b=>{const C=e.filter(I=>this.getLayer(I));(C.length!==0?this.queryRenderedFeatures(b.point,{layers:C}):[]).length?l=!0:l&&(l=!1,s.call(this,new Ui(f,this,b.originalEvent)))},mouseout:b=>{l&&(l=!1,s.call(this,new Ui(f,this,b.originalEvent)))}}}}{const l=c=>{const m=e.filter(C=>this.getLayer(C)),b=m.length!==0?this.queryRenderedFeatures(c.point,{layers:m}):[];b.length&&(c.features=b,s.call(this,c),delete c.features)};return{layers:e,listener:s,delegates:{[f]:l}}}}_saveDelegatedListener(f,e){this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[f]=this._delegatedListeners[f]||[],this._delegatedListeners[f].push(e)}_removeDelegatedListener(f,e,s){if(!this._delegatedListeners||!this._delegatedListeners[f])return;const l=this._delegatedListeners[f];for(let c=0;c<l.length;c++){const m=l[c];if(m.listener===s&&m.layers.length===e.length&&m.layers.every(b=>e.includes(b))){for(const b in m.delegates)this.off(b,m.delegates[b]);return void l.splice(c,1)}}}on(f,e,s){if(s===void 0)return super.on(f,e);const l=this._createDelegatedListener(f,typeof e=="string"?[e]:e,s);this._saveDelegatedListener(f,l);for(const c in l.delegates)this.on(c,l.delegates[c]);return this}once(f,e,s){if(s===void 0)return super.once(f,e);const l=typeof e=="string"?[e]:e,c=this._createDelegatedListener(f,l,s);for(const m in c.delegates){const b=c.delegates[m];c.delegates[m]=(...C)=>{this._removeDelegatedListener(f,l,s),b(...C)}}this._saveDelegatedListener(f,c);for(const m in c.delegates)this.once(m,c.delegates[m]);return this}off(f,e,s){return s===void 0?super.off(f,e):(this._removeDelegatedListener(f,typeof e=="string"?[e]:e,s),this)}queryRenderedFeatures(f,e){if(!this.style)return[];let s;const l=f instanceof u.P||Array.isArray(f),c=l?f:[[0,0],[this.transform.width,this.transform.height]];if(e=e||(l?{}:f)||{},c instanceof u.P||typeof c[0]=="number")s=[u.P.convert(c)];else{const m=u.P.convert(c[0]),b=u.P.convert(c[1]);s=[m,new u.P(b.x,m.y),b,new u.P(m.x,b.y),m]}return this.style.queryRenderedFeatures(s,e,this.transform)}querySourceFeatures(f,e){return this.style.querySourceFeatures(f,e)}setStyle(f,e){return(e=u.e({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&f?(this._diffStyle(f,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._updateStyle(f,e))}setTransformRequest(f){return this._requestManager.setTransformRequest(f),this}_getUIString(f){const e=this._locale[f];if(e==null)throw new Error(`Missing UI string '${f}'`);return e}_updateStyle(f,e){if(e.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(f,e));const s=this.style&&e.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!f)),f?(this.style=new ua(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof f=="string"?this.style.loadURL(f,e,s):this.style.loadJSON(f,e,s),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new ua(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(f,e){if(typeof f=="string"){const s=this._requestManager.transformRequest(f,"Style");u.h(s,new AbortController).then(l=>{this._updateDiff(l.data,e)}).catch(l=>{l&&this.fire(new u.j(l))})}else typeof f=="object"&&this._updateDiff(f,e)}_updateDiff(f,e){try{this.style.setState(f,e)&&this._update(!0)}catch(s){u.w(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(f,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.w("There is no style added to the map.")}addSource(f,e){return this._lazyInitEmptyStyle(),this.style.addSource(f,e),this._update(!0)}isSourceLoaded(f){const e=this.style&&this.style.sourceCaches[f];if(e!==void 0)return e.loaded();this.fire(new u.j(new Error(`There is no source with ID '${f}'`)))}setTerrain(f){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),f){const e=this.style.sourceCaches[f.source];if(!e)throw new Error(`cannot load terrain, because there exists no source with ID: ${f.source}`);this.terrain===null&&e.reload();for(const s in this.style._layers){const l=this.style._layers[s];l.type==="hillshade"&&l.source===f.source&&u.w("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new oc(this.painter,e,f),this.painter.renderToTexture=new ku(this.painter,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._terrainDataCallback=s=>{s.dataType==="style"?this.terrain.sourceCache.freeRtt():s.dataType==="source"&&s.tile&&(s.sourceId!==f.source||this._elevationFreeze||(this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom)),this.terrain.sourceCache.freeRtt(s.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.minElevationForCurrentTile=0,this.transform.elevation=0;return this.fire(new u.k("terrain",{terrain:f})),this}getTerrain(){var f,e;return(e=(f=this.terrain)===null||f===void 0?void 0:f.options)!==null&&e!==void 0?e:null}areTilesLoaded(){const f=this.style&&this.style.sourceCaches;for(const e in f){const s=f[e]._tiles;for(const l in s){const c=s[l];if(c.state!=="loaded"&&c.state!=="errored")return!1}}return!0}removeSource(f){return this.style.removeSource(f),this._update(!0)}getSource(f){return this.style.getSource(f)}addImage(f,e,s={}){const{pixelRatio:l=1,sdf:c=!1,stretchX:m,stretchY:b,content:C,textFitWidth:I,textFitHeight:P}=s;if(this._lazyInitEmptyStyle(),!(e instanceof HTMLImageElement||u.b(e))){if(e.width===void 0||e.height===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:k,height:A,data:B}=e,$=e;return this.style.addImage(f,{data:new u.R({width:k,height:A},new Uint8Array(B)),pixelRatio:l,stretchX:m,stretchY:b,content:C,textFitWidth:I,textFitHeight:P,sdf:c,version:0,userImage:$}),$.onAdd&&$.onAdd(this,f),this}}{const{width:k,height:A,data:B}=q.getImageData(e);this.style.addImage(f,{data:new u.R({width:k,height:A},B),pixelRatio:l,stretchX:m,stretchY:b,content:C,textFitWidth:I,textFitHeight:P,sdf:c,version:0})}}updateImage(f,e){const s=this.style.getImage(f);if(!s)return this.fire(new u.j(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const l=e instanceof HTMLImageElement||u.b(e)?q.getImageData(e):e,{width:c,height:m,data:b}=l;if(c===void 0||m===void 0)return this.fire(new u.j(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(c!==s.data.width||m!==s.data.height)return this.fire(new u.j(new Error("The width and height of the updated image must be that same as the previous version of the image")));const C=!(e instanceof HTMLImageElement||u.b(e));return s.data.replace(b,C),this.style.updateImage(f,s),this}getImage(f){return this.style.getImage(f)}hasImage(f){return f?!!this.style.getImage(f):(this.fire(new u.j(new Error("Missing required image id"))),!1)}removeImage(f){this.style.removeImage(f)}loadImage(f){return st.getImage(this._requestManager.transformRequest(f,"Image"),new AbortController)}listImages(){return this.style.listImages()}addLayer(f,e){return this._lazyInitEmptyStyle(),this.style.addLayer(f,e),this._update(!0)}moveLayer(f,e){return this.style.moveLayer(f,e),this._update(!0)}removeLayer(f){return this.style.removeLayer(f),this._update(!0)}getLayer(f){return this.style.getLayer(f)}getLayersOrder(){return this.style.getLayersOrder()}setLayerZoomRange(f,e,s){return this.style.setLayerZoomRange(f,e,s),this._update(!0)}setFilter(f,e,s={}){return this.style.setFilter(f,e,s),this._update(!0)}getFilter(f){return this.style.getFilter(f)}setPaintProperty(f,e,s,l={}){return this.style.setPaintProperty(f,e,s,l),this._update(!0)}getPaintProperty(f,e){return this.style.getPaintProperty(f,e)}setLayoutProperty(f,e,s,l={}){return this.style.setLayoutProperty(f,e,s,l),this._update(!0)}getLayoutProperty(f,e){return this.style.getLayoutProperty(f,e)}setGlyphs(f,e={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(f,e),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(f,e,s={}){return this._lazyInitEmptyStyle(),this.style.addSprite(f,e,s,l=>{l||this._update(!0)}),this}removeSprite(f){return this._lazyInitEmptyStyle(),this.style.removeSprite(f),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(f,e={}){return this._lazyInitEmptyStyle(),this.style.setSprite(f,e,s=>{s||this._update(!0)}),this}setLight(f,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(f,e),this._update(!0)}getLight(){return this.style.getLight()}setSky(f){return this._lazyInitEmptyStyle(),this.style.setSky(f),this._update(!0)}getSky(){return this.style.getSky()}setFeatureState(f,e){return this.style.setFeatureState(f,e),this._update()}removeFeatureState(f,e){return this.style.removeFeatureState(f,e),this._update()}getFeatureState(f){return this.style.getFeatureState(f)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let f=0,e=0;return this._container&&(f=this._container.clientWidth||400,e=this._container.clientHeight||300),[f,e]}_setupContainer(){const f=this._container;f.classList.add("maplibregl-map");const e=this._canvasContainer=F.create("div","maplibregl-canvas-container",f);this._interactive&&e.classList.add("maplibregl-interactive"),this._canvas=F.create("canvas","maplibregl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex",this._interactive?"0":"-1"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region");const s=this._containerDimensions(),l=this._getClampedPixelRatio(s[0],s[1]);this._resizeCanvas(s[0],s[1],l);const c=this._controlContainer=F.create("div","maplibregl-control-container",f),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(b=>{m[b]=F.create("div",`maplibregl-ctrl-${b} `,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(f,e,s){this._canvas.width=Math.floor(s*f),this._canvas.height=Math.floor(s*e),this._canvas.style.width=`${f}px`,this._canvas.style.height=`${e}px`}_setupPainter(){const f={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let e=null;this._canvas.addEventListener("webglcontextcreationerror",l=>{e={requestedAttributes:f},l&&(e.statusMessage=l.statusMessage,e.type=l.type)},{once:!0});const s=this._canvas.getContext("webgl2",f)||this._canvas.getContext("webgl",f);if(!s){const l="Failed to initialize WebGL";throw e?(e.message=l,new Error(JSON.stringify(e))):new Error(l)}this.painter=new Ta(s,this.transform),oe.testSupport(s)}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(f){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||f,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(f){return this._update(),this._renderTaskQueue.add(f)}_cancelRenderFrame(f){this._renderTaskQueue.remove(f)}_render(f){const e=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(f),this._removed)return;let s=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const c=this.transform.zoom,m=q.now();this.style.zoomHistory.update(c,m);const b=new u.z(c,{now:m,fadeDuration:e,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),C=b.crossFadingFactor();C===1&&C===this._crossFadingFactor||(s=!0,this._crossFadingFactor=C),this.style.update(b)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain?(this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.minElevationForCurrentTile=this.terrain.getMinTileElevationForLngLatZoom(this.transform.center,this.transform.tileZoom),this._elevationFreeze||(this.transform.elevation=this.terrain.getElevationForLngLatZoom(this.transform.center,this.transform.tileZoom))):(this.transform.minElevationForCurrentTile=0,this.transform.elevation=0),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,e,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:e,showPadding:this.showPadding}),this.fire(new u.k("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.bf.mark(u.bg.load),this.fire(new u.k("load"))),this.style&&(this.style.hasTransitions()||s)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const l=this._sourcesDirty||this._styleDirty||this._placementDirty;return l||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.k("idle")),!this._loaded||this._fullyLoaded||l||(this._fullyLoaded=!0,u.bf.mark(u.bg.fullLoad)),this}redraw(){return this.style&&(this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._render(0)),this}remove(){var f;this._hash&&this._hash.remove();for(const s of this._controls)s.onRemove(this);this._controls=[],this._frameRequest&&(this._frameRequest.abort(),this._frameRequest=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),st.removeThrottleControl(this._imageQueueHandle),(f=this._resizeObserver)===null||f===void 0||f.disconnect();const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e?.loseContext&&e.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),F.remove(this._canvasContainer),F.remove(this._controlContainer),this._container.classList.remove("maplibregl-map"),u.bf.clearMetrics(),this._removed=!0,this.fire(new u.k("remove"))}triggerRepaint(){this.style&&!this._frameRequest&&(this._frameRequest=new AbortController,q.frameAsync(this._frameRequest).then(f=>{u.bf.frame(f),this._frameRequest=null,this._render(f)}).catch(()=>{}))}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(f){this._showTileBoundaries!==f&&(this._showTileBoundaries=f,this._update())}get showPadding(){return!!this._showPadding}set showPadding(f){this._showPadding!==f&&(this._showPadding=f,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(f){this._showCollisionBoxes!==f&&(this._showCollisionBoxes=f,f?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(f){this._showOverdrawInspector!==f&&(this._showOverdrawInspector=f,this._update())}get repaint(){return!!this._repaint}set repaint(f){this._repaint!==f&&(this._repaint=f,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(f){this._vertices=f,this._update()}get version(){return Au}getCameraTargetElevation(){return this.transform.elevation}},x.MapMouseEvent=Ui,x.MapTouchEvent=rs,x.MapWheelEvent=Su,x.Marker=Fa,x.NavigationControl=class{constructor(f){this._updateZoomButtons=()=>{const e=this._map.getZoom(),s=e===this._map.getMaxZoom(),l=e===this._map.getMinZoom();this._zoomInButton.disabled=s,this._zoomOutButton.disabled=l,this._zoomInButton.setAttribute("aria-disabled",s.toString()),this._zoomOutButton.setAttribute("aria-disabled",l.toString())},this._rotateCompassArrow=()=>{const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=e},this._setButtonTitle=(e,s)=>{const l=this._map._getUIString(`NavigationControl.${s}`);e.title=l,e.setAttribute("aria-label",l)},this.options=u.e({},Gh,f),this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",e=>this._map.zoomIn({},{originalEvent:e})),F.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",e=>this._map.zoomOut({},{originalEvent:e})),F.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(this._compass=this._createButton("maplibregl-ctrl-compass",e=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:e}):this._map.resetNorth({},{originalEvent:e})}),this._compassIcon=F.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}onAdd(f){return this._map=f,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xh(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){F.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(f,e){const s=F.create("button",f,this._container);return s.type="button",s.addEventListener("click",e),s}},x.Popup=class extends u.E{constructor(f){super(),this.remove=()=>(this._content&&F.remove(this._content),this._container&&(F.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),this._map._canvasContainer.classList.remove("maplibregl-track-pointer"),delete this._map,this.fire(new u.k("close"))),this),this._onMouseUp=e=>{this._update(e.point)},this._onMouseMove=e=>{this._update(e.point)},this._onDrag=e=>{this._update(e.point)},this._update=e=>{var s;if(!this._map||!this._lngLat&&!this._trackPointer||!this._content)return;if(!this._container){if(this._container=F.create("div","maplibregl-popup",this._map.getContainer()),this._tip=F.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className)for(const C of this.options.className.split(" "))this._container.classList.add(C);this._closeButton&&this._closeButton.setAttribute("aria-label",this._map._getUIString("Popup.Close")),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")}if(this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._lngLat=this._map.transform.renderWorldCopies&&!this._trackPointer?ei(this._lngLat,this._flatPos,this._map.transform):(s=this._lngLat)===null||s===void 0?void 0:s.wrap(),this._trackPointer&&!e)return;const l=this._flatPos=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat);this._map.terrain&&(this._flatPos=this._trackPointer&&e?e:this._map.transform.locationPoint(this._lngLat));let c=this.options.anchor;const m=Na(this.options.offset);if(!c){const C=this._container.offsetWidth,I=this._container.offsetHeight;let P;P=l.y+m.bottom.y<I?["top"]:l.y>this._map.transform.height-I?["bottom"]:[],l.x<C/2?P.push("left"):l.x>this._map.transform.width-C/2&&P.push("right"),c=P.length===0?"bottom":P.join("-")}let b=l.add(m[c]);this.options.subpixelPositioning||(b=b.round()),F.setTransform(this._container,`${Hs[c]} translate(${b.x}px,${b.y}px)`),Ba(this._container,c,"popup")},this._onClose=()=>{this.remove()},this.options=u.e(Object.create(rt),f)}addTo(f){return this._map&&this.remove(),this._map=f,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.k("open")),this}isOpen(){return!!this._map}getLngLat(){return this._lngLat}setLngLat(f){return this._lngLat=u.N.convert(f),this._pos=null,this._flatPos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._flatPos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(f){return this.setDOMContent(document.createTextNode(f))}setHTML(f){const e=document.createDocumentFragment(),s=document.createElement("body");let l;for(s.innerHTML=f;l=s.firstChild,l;)e.appendChild(l);return this.setDOMContent(e)}getMaxWidth(){var f;return(f=this._container)===null||f===void 0?void 0:f.style.maxWidth}setMaxWidth(f){return this.options.maxWidth=f,this._update(),this}setDOMContent(f){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=F.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(f),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(f){return this._container&&this._container.classList.add(f),this}removeClassName(f){return this._container&&this._container.classList.remove(f),this}setOffset(f){return this.options.offset=f,this._update(),this}toggleClassName(f){if(this._container)return this._container.classList.toggle(f)}setSubpixelPositioning(f){this.options.subpixelPositioning=f}_createCloseButton(){this.options.closeButton&&(this._closeButton=F.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const f=this._container.querySelector(Oa);f&&f.focus()}},x.RasterDEMTileSource=ci,x.RasterTileSource=At,x.ScaleControl=class{constructor(f){this._onMove=()=>{jo(this._map,this._container,this.options)},this.setUnit=e=>{this.options.unit=e,jo(this._map,this._container,this.options)},this.options=Object.assign(Object.assign({},dr),f)}getDefaultPosition(){return"bottom-left"}onAdd(f){return this._map=f,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-scale",f.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){F.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}},x.ScrollZoomHandler=qn,x.Style=ua,x.TerrainControl=class{constructor(f){this._toggleTerrain=()=>{this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()},this._updateTerrainIcon=()=>{this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.Disable")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.Enable"))},this.options=f}onAdd(f){return this._map=f,this._container=F.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=F.create("button","maplibregl-ctrl-terrain",this._container),F.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){F.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}},x.TwoFingersTouchPitchHandler=Vs,x.TwoFingersTouchRotateHandler=ec,x.TwoFingersTouchZoomHandler=Jl,x.TwoFingersTouchZoomRotateHandler=ic,x.VectorTileSource=wo,x.VideoSource=Cs,x.addSourceType=(f,e)=>u._(void 0,void 0,void 0,function*(){if(Io(f))throw new Error(`A source type called "${f}" already exists.`);((s,l)=>{So[s]=l})(f,e)}),x.clearPrewarmedResources=function(){const f=fn;f&&(f.isPreloaded()&&f.numActive()===1?(f.release(Mr),fn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},x.getMaxParallelImageRequests=function(){return u.a.MAX_PARALLEL_IMAGE_REQUESTS},x.getRTLTextPluginStatus=function(){return ar().getRTLTextPluginStatus()},x.getVersion=function(){return cc},x.getWorkerCount=function(){return sr.workerCount},x.getWorkerUrl=function(){return u.a.WORKER_URL},x.importScriptInWorkers=function(f){return bo().broadcast("IS",f)},x.prewarm=function(){Wr().acquire(Mr)},x.setMaxParallelImageRequests=function(f){u.a.MAX_PARALLEL_IMAGE_REQUESTS=f},x.setRTLTextPlugin=function(f,e){return ar().setRTLTextPlugin(f,e)},x.setWorkerCount=function(f){sr.workerCount=f},x.setWorkerUrl=function(f){u.a.WORKER_URL=f}});var S=a;return S})}(ah)),ah.exports}var l_=c1();function u1(p,r,a){let d;const y=()=>{const x=document.createElement("template");return x.innerHTML=p,x.content.firstChild},S=()=>(d||(d=y())).cloneNode(!0);return S.cloneNode=S,S}function c_(p,r,a){a==null?p.removeAttribute(r):p.setAttribute(r,a)}function h1(p,r){r==null?p.removeAttribute("class"):p.className=r}function d1(p,r,a={}){const d=Object.keys(r||{}),y=Object.keys(a);let S,x;for(S=0,x=y.length;S<x;S++){const u=y[S];!u||u==="undefined"||r[u]||($f(p,u,!1),delete a[u])}for(S=0,x=d.length;S<x;S++){const u=d[S],O=!!r[u];!u||u==="undefined"||a[u]===O||!O||($f(p,u,!0),a[u]=O)}return a}function p1(p,r,a){if(!r)return a?c_(p,"style"):r;const d=p.style;if(typeof r=="string")return d.cssText=r;typeof a=="string"&&(d.cssText=a=void 0),a||(a={}),r||(r={});let y,S;for(S in a)r[S]==null&&d.removeProperty(S),delete a[S];for(S in r)y=r[S],y!==a[S]&&(d.setProperty(S,y),a[S]=y);return a}function $f(p,r,a){const d=r.trim().split(/\s+/);for(let y=0,S=d.length;y<S;y++)p.classList.toggle(d[y],a)}const m1=vo(),f1=()=>ho(m1),g1=u1("<div>"),u_=vo(),h_=()=>ho(u_),d_=p=>Yt(()=>{var r;const a=(r=h_())==null?void 0:r();a&&p(a)});function _1(p){const[r,a]=Xi(p,["id","style","class","classList","cursor","options","children"]),d=Ot(()=>r.id??Jc()),y=Ot(()=>!r.style&&!r.class&&!r.classList?{position:"relative",width:"100%","aspect-ratio":"calc(16/9)"}:void 0),S=(()=>{const W=g1();return cp(q=>{const F=d(),oe=r.class,ie=r.classList,pe=r.style??y();return F!==q._v$&&c_(W,"id",q._v$=F),oe!==q._v$2&&h1(W,q._v$2=oe),q._v$3=d1(W,ie,q._v$3),q._v$4=p1(W,pe,q._v$4),q},{_v$:void 0,_v$2:void 0,_v$3:void 0,_v$4:void 0}),W})(),[x,u]=qt(),O=f1();yo(()=>{const W=new l_.Map({style:"https://demotiles.maplibre.org/style.json",...r.options,container:S});O?.onMapMount(W,d()),W.once("load",()=>u(W))});const V=Ot(()=>{var W;return typeof((W=r.options)==null?void 0:W.interactive)>"u"||r.options.interactive});return Yt(()=>{var W;const q=(W=x())==null?void 0:W.getCanvas();q&&(q.style.cursor=r.cursor??V()?"grab":"auto")}),Yt(()=>{const W=x();if(W)for(const[q,F]of Object.entries(a)){if(!q.startsWith("on"))continue;const oe=q.slice(2).toLowerCase();W.on(oe,F),si(()=>W.off(oe,F))}}),si(()=>{var W;(W=x())==null||W.remove(),O?.onMapUnmount(d())}),Ye(u_.Provider,{value:x,get children(){return[S,Ot(()=>r.children)]}})}const y1=p=>r=>{const[a,d]=Xi(r,["position"]);let y;return d_(S=>{y||(y=new p(d.options??{}),S.addControl(y,a.position))}),si(()=>{var S;const x=(S=h_())==null?void 0:S();y&&x&&x.hasControl(y)&&x.removeControl(y)}),[]},v1=y1(l_.NavigationControl);var x1=Ht('<div class="t-center text-white flex flex-col h-full p-4"><div class=flex-1></div><div class=flex><div class="flex-1 text-left flex items-center"><div></div></div><div class="flex-1 text-xs text-right">');function b1(p){return d_(r=>{r.flyTo({center:p.center})}),[]}function w1(p){const[r,a]=qt(!1),[d,y]=qt("-"),[S,x]=qt("Select Location"),[u,O]=qt([106.82976614124544,-6.2773016456564275]);return yo(()=>{setTimeout(()=>{a(!0)},500)}),Yt(()=>{const V=p.aqiCtx?.ctx.aqiSelectedLocation.val();V&&(y(V.address),x(V.name),O([V.latitude,V.longitude]))}),(()=>{var V=jt(x1),W=V.firstChild,q=W.nextSibling,F=q.firstChild,oe=F.firstChild,ie=F.nextSibling;return bt(W,Ye(_1,{onload:pe=>{console.log("MapLibre",pe)},style:{width:"100%",height:"100%","border-radius":"8px"},options:{center:[106.82976614124544,-6.2773016456564275],style:{version:8,metadata:{},center:[106.82976614124544,-6.2773016456564275,16],sources:{googlesatellite:{type:"raster",tiles:["https://mt2.google.com/vt/lyrs=s&hl=id&x={x}&y={y}&z={z}","https://mt1.google.com/vt/lyrs=s&hl=id&x={x}&y={y}&z={z}","https://mt0.google.com/vt/lyrs=s&hl=id&x={x}&y={y}&z={z}"],tileSize:256},googlelabels:{type:"raster",tiles:["https://mt2.google.com/vt/lyrs=h&hl=id&x={x}&y={y}&z={z}","https://mt1.google.com/vt/lyrs=h&hl=id&x={x}&y={y}&z={z}","https://mt0.google.com/vt/lyrs=h&hl=id&x={x}&y={y}&z={z}"],tileSize:256}},sprite:"none",layers:[{id:"googlesatellite",type:"raster",source:"googlesatellite",minzoom:0,maxzoom:24},{id:"googlelabels",type:"raster",source:"googlelabels",minzoom:0,maxzoom:24}]},zoom:16},get children(){return[Ye(v1,{options:{showCompass:!0}}),Ye(b1,{get center(){return u()}})]}})),bt(oe,S),bt(ie,d),V})()}function p_(p,r,a){const d=Mi(p,a?.in);return isNaN(r)?Ni(a?.in||p,NaN):(r&&d.setDate(d.getDate()+r),d)}function C1(){return Object.assign({},xl())}function S1(p,r){const a=Mi(p,r?.in).getDay();return a===0?7:a}function I1(p,r){const a=T1(r)?new r(0):Ni(r,0);return a.setFullYear(p.getFullYear(),p.getMonth(),p.getDate()),a.setHours(p.getHours(),p.getMinutes(),p.getSeconds(),p.getMilliseconds()),a}function T1(p){return typeof p=="function"&&p.prototype?.constructor===p}const E1=10;class m_{subPriority=0;validate(r,a){return!0}}class P1 extends m_{constructor(r,a,d,y,S){super(),this.value=r,this.validateValue=a,this.setValue=d,this.priority=y,S&&(this.subPriority=S)}validate(r,a){return this.validateValue(r,this.value,a)}set(r,a,d){return this.setValue(r,a,this.value,d)}}class M1 extends m_{priority=E1;subPriority=-1;constructor(r,a){super(),this.context=r||(d=>Ni(a,d))}set(r,a){return a.timestampIsSet?r:Ni(r,I1(r,this.context))}}class Wt{run(r,a,d,y){const S=this.parse(r,a,d,y);return S?{setter:new P1(S.value,this.validate,this.set,this.priority,this.subPriority),rest:S.rest}:null}validate(r,a,d){return!0}}class k1 extends Wt{priority=140;parse(r,a,d){switch(a){case"G":case"GG":case"GGG":return d.era(r,{width:"abbreviated"})||d.era(r,{width:"narrow"});case"GGGGG":return d.era(r,{width:"narrow"});case"GGGG":default:return d.era(r,{width:"wide"})||d.era(r,{width:"abbreviated"})||d.era(r,{width:"narrow"})}}set(r,a,d){return a.era=d,r.setFullYear(d,0,1),r.setHours(0,0,0,0),r}incompatibleTokens=["R","u","t","T"]}const Ei={month:/^(1[0-2]|0?\d)/,date:/^(3[0-1]|[0-2]?\d)/,dayOfYear:/^(36[0-6]|3[0-5]\d|[0-2]?\d?\d)/,week:/^(5[0-3]|[0-4]?\d)/,hour23h:/^(2[0-3]|[0-1]?\d)/,hour24h:/^(2[0-4]|[0-1]?\d)/,hour11h:/^(1[0-1]|0?\d)/,hour12h:/^(1[0-2]|0?\d)/,minute:/^[0-5]?\d/,second:/^[0-5]?\d/,singleDigit:/^\d/,twoDigits:/^\d{1,2}/,threeDigits:/^\d{1,3}/,fourDigits:/^\d{1,4}/,anyDigitsSigned:/^-?\d+/,singleDigitSigned:/^-?\d/,twoDigitsSigned:/^-?\d{1,2}/,threeDigitsSigned:/^-?\d{1,3}/,fourDigitsSigned:/^-?\d{1,4}/},jr={basicOptionalMinutes:/^([+-])(\d{2})(\d{2})?|Z/,basic:/^([+-])(\d{2})(\d{2})|Z/,basicOptionalSeconds:/^([+-])(\d{2})(\d{2})((\d{2}))?|Z/,extended:/^([+-])(\d{2}):(\d{2})|Z/,extendedOptionalSeconds:/^([+-])(\d{2}):(\d{2})(:(\d{2}))?|Z/};function Pi(p,r){return p&&{value:r(p.value),rest:p.rest}}function vi(p,r){const a=r.match(p);return a?{value:parseInt(a[0],10),rest:r.slice(a[0].length)}:null}function qr(p,r){const a=r.match(p);if(!a)return null;if(a[0]==="Z")return{value:0,rest:r.slice(1)};const d=a[1]==="+"?1:-1,y=a[2]?parseInt(a[2],10):0,S=a[3]?parseInt(a[3],10):0,x=a[5]?parseInt(a[5],10):0;return{value:d*(y*_p+S*gp+x*jx),rest:r.slice(a[0].length)}}function f_(p){return vi(Ei.anyDigitsSigned,p)}function Si(p,r){switch(p){case 1:return vi(Ei.singleDigit,r);case 2:return vi(Ei.twoDigits,r);case 3:return vi(Ei.threeDigits,r);case 4:return vi(Ei.fourDigits,r);default:return vi(new RegExp("^\\d{1,"+p+"}"),r)}}function gh(p,r){switch(p){case 1:return vi(Ei.singleDigitSigned,r);case 2:return vi(Ei.twoDigitsSigned,r);case 3:return vi(Ei.threeDigitsSigned,r);case 4:return vi(Ei.fourDigitsSigned,r);default:return vi(new RegExp("^-?\\d{1,"+p+"}"),r)}}function vp(p){switch(p){case"morning":return 4;case"evening":return 17;case"pm":case"noon":case"afternoon":return 12;case"am":case"midnight":case"night":default:return 0}}function g_(p,r){const a=r>0,d=a?r:1-r;let y;if(d<=50)y=p||100;else{const S=d+50,x=Math.trunc(S/100)*100,u=p>=S%100;y=p+x-(u?100:0)}return a?y:1-y}function __(p){return p%400===0||p%4===0&&p%100!==0}class A1 extends Wt{priority=130;incompatibleTokens=["Y","R","u","w","I","i","e","c","t","T"];parse(r,a,d){const y=S=>({year:S,isTwoDigitYear:a==="yy"});switch(a){case"y":return Pi(Si(4,r),y);case"yo":return Pi(d.ordinalNumber(r,{unit:"year"}),y);default:return Pi(Si(a.length,r),y)}}validate(r,a){return a.isTwoDigitYear||a.year>0}set(r,a,d){const y=r.getFullYear();if(d.isTwoDigitYear){const x=g_(d.year,y);return r.setFullYear(x,0,1),r.setHours(0,0,0,0),r}const S=!("era"in a)||a.era===1?d.year:1-d.year;return r.setFullYear(S,0,1),r.setHours(0,0,0,0),r}}class z1 extends Wt{priority=130;parse(r,a,d){const y=S=>({year:S,isTwoDigitYear:a==="YY"});switch(a){case"Y":return Pi(Si(4,r),y);case"Yo":return Pi(d.ordinalNumber(r,{unit:"year"}),y);default:return Pi(Si(a.length,r),y)}}validate(r,a){return a.isTwoDigitYear||a.year>0}set(r,a,d,y){const S=yp(r,y);if(d.isTwoDigitYear){const u=g_(d.year,S);return r.setFullYear(u,0,y.firstWeekContainsDate),r.setHours(0,0,0,0),_o(r,y)}const x=!("era"in a)||a.era===1?d.year:1-d.year;return r.setFullYear(x,0,y.firstWeekContainsDate),r.setHours(0,0,0,0),_o(r,y)}incompatibleTokens=["y","R","u","Q","q","M","L","I","d","D","i","t","T"]}class D1 extends Wt{priority=130;parse(r,a){return gh(a==="R"?4:a.length,r)}set(r,a,d){const y=Ni(r,0);return y.setFullYear(d,0,4),y.setHours(0,0,0,0),fl(y)}incompatibleTokens=["G","y","Y","u","Q","q","M","L","w","d","D","e","c","t","T"]}class L1 extends Wt{priority=130;parse(r,a){return gh(a==="u"?4:a.length,r)}set(r,a,d){return r.setFullYear(d,0,1),r.setHours(0,0,0,0),r}incompatibleTokens=["G","y","Y","R","w","I","i","e","c","t","T"]}class R1 extends Wt{priority=120;parse(r,a,d){switch(a){case"Q":case"QQ":return Si(a.length,r);case"Qo":return d.ordinalNumber(r,{unit:"quarter"});case"QQQ":return d.quarter(r,{width:"abbreviated",context:"formatting"})||d.quarter(r,{width:"narrow",context:"formatting"});case"QQQQQ":return d.quarter(r,{width:"narrow",context:"formatting"});case"QQQQ":default:return d.quarter(r,{width:"wide",context:"formatting"})||d.quarter(r,{width:"abbreviated",context:"formatting"})||d.quarter(r,{width:"narrow",context:"formatting"})}}validate(r,a){return a>=1&&a<=4}set(r,a,d){return r.setMonth((d-1)*3,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","M","L","w","I","d","D","i","e","c","t","T"]}class B1 extends Wt{priority=120;parse(r,a,d){switch(a){case"q":case"qq":return Si(a.length,r);case"qo":return d.ordinalNumber(r,{unit:"quarter"});case"qqq":return d.quarter(r,{width:"abbreviated",context:"standalone"})||d.quarter(r,{width:"narrow",context:"standalone"});case"qqqqq":return d.quarter(r,{width:"narrow",context:"standalone"});case"qqqq":default:return d.quarter(r,{width:"wide",context:"standalone"})||d.quarter(r,{width:"abbreviated",context:"standalone"})||d.quarter(r,{width:"narrow",context:"standalone"})}}validate(r,a){return a>=1&&a<=4}set(r,a,d){return r.setMonth((d-1)*3,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","Q","M","L","w","I","d","D","i","e","c","t","T"]}class F1 extends Wt{incompatibleTokens=["Y","R","q","Q","L","w","I","D","i","e","c","t","T"];priority=110;parse(r,a,d){const y=S=>S-1;switch(a){case"M":return Pi(vi(Ei.month,r),y);case"MM":return Pi(Si(2,r),y);case"Mo":return Pi(d.ordinalNumber(r,{unit:"month"}),y);case"MMM":return d.month(r,{width:"abbreviated",context:"formatting"})||d.month(r,{width:"narrow",context:"formatting"});case"MMMMM":return d.month(r,{width:"narrow",context:"formatting"});case"MMMM":default:return d.month(r,{width:"wide",context:"formatting"})||d.month(r,{width:"abbreviated",context:"formatting"})||d.month(r,{width:"narrow",context:"formatting"})}}validate(r,a){return a>=0&&a<=11}set(r,a,d){return r.setMonth(d,1),r.setHours(0,0,0,0),r}}class O1 extends Wt{priority=110;parse(r,a,d){const y=S=>S-1;switch(a){case"L":return Pi(vi(Ei.month,r),y);case"LL":return Pi(Si(2,r),y);case"Lo":return Pi(d.ordinalNumber(r,{unit:"month"}),y);case"LLL":return d.month(r,{width:"abbreviated",context:"standalone"})||d.month(r,{width:"narrow",context:"standalone"});case"LLLLL":return d.month(r,{width:"narrow",context:"standalone"});case"LLLL":default:return d.month(r,{width:"wide",context:"standalone"})||d.month(r,{width:"abbreviated",context:"standalone"})||d.month(r,{width:"narrow",context:"standalone"})}}validate(r,a){return a>=0&&a<=11}set(r,a,d){return r.setMonth(d,1),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","M","w","I","D","i","e","c","t","T"]}function N1(p,r,a){const d=Mi(p,a?.in),y=n_(d,a)-r;return d.setDate(d.getDate()-y*7),Mi(d,a?.in)}class V1 extends Wt{priority=100;parse(r,a,d){switch(a){case"w":return vi(Ei.week,r);case"wo":return d.ordinalNumber(r,{unit:"week"});default:return Si(a.length,r)}}validate(r,a){return a>=1&&a<=53}set(r,a,d,y){return _o(N1(r,d,y),y)}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","i","t","T"]}function U1(p,r,a){const d=Mi(p,a?.in),y=i_(d,a)-r;return d.setDate(d.getDate()-y*7),d}class $1 extends Wt{priority=100;parse(r,a,d){switch(a){case"I":return vi(Ei.week,r);case"Io":return d.ordinalNumber(r,{unit:"week"});default:return Si(a.length,r)}}validate(r,a){return a>=1&&a<=53}set(r,a,d){return fl(U1(r,d))}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","e","c","t","T"]}const j1=[31,28,31,30,31,30,31,31,30,31,30,31],q1=[31,29,31,30,31,30,31,31,30,31,30,31];class H1 extends Wt{priority=90;subPriority=1;parse(r,a,d){switch(a){case"d":return vi(Ei.date,r);case"do":return d.ordinalNumber(r,{unit:"date"});default:return Si(a.length,r)}}validate(r,a){const d=r.getFullYear(),y=__(d),S=r.getMonth();return y?a>=1&&a<=q1[S]:a>=1&&a<=j1[S]}set(r,a,d){return r.setDate(d),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","w","I","D","i","e","c","t","T"]}class W1 extends Wt{priority=90;subpriority=1;parse(r,a,d){switch(a){case"D":case"DD":return vi(Ei.dayOfYear,r);case"Do":return d.ordinalNumber(r,{unit:"date"});default:return Si(a.length,r)}}validate(r,a){const d=r.getFullYear();return __(d)?a>=1&&a<=366:a>=1&&a<=365}set(r,a,d){return r.setMonth(0,d),r.setHours(0,0,0,0),r}incompatibleTokens=["Y","R","q","Q","M","L","w","I","d","E","i","e","c","t","T"]}function xp(p,r,a){const d=xl(),y=a?.weekStartsOn??a?.locale?.options?.weekStartsOn??d.weekStartsOn??d.locale?.options?.weekStartsOn??0,S=Mi(p,a?.in),x=S.getDay(),O=(r%7+7)%7,V=7-y,W=r<0||r>6?r-(x+V)%7:(O+V)%7-(x+V)%7;return p_(S,W,a)}class Z1 extends Wt{priority=90;parse(r,a,d){switch(a){case"E":case"EE":case"EEE":return d.day(r,{width:"abbreviated",context:"formatting"})||d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"});case"EEEEE":return d.day(r,{width:"narrow",context:"formatting"});case"EEEEEE":return d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"});case"EEEE":default:return d.day(r,{width:"wide",context:"formatting"})||d.day(r,{width:"abbreviated",context:"formatting"})||d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"})}}validate(r,a){return a>=0&&a<=6}set(r,a,d,y){return r=xp(r,d,y),r.setHours(0,0,0,0),r}incompatibleTokens=["D","i","e","c","t","T"]}class G1 extends Wt{priority=90;parse(r,a,d,y){const S=x=>{const u=Math.floor((x-1)/7)*7;return(x+y.weekStartsOn+6)%7+u};switch(a){case"e":case"ee":return Pi(Si(a.length,r),S);case"eo":return Pi(d.ordinalNumber(r,{unit:"day"}),S);case"eee":return d.day(r,{width:"abbreviated",context:"formatting"})||d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"});case"eeeee":return d.day(r,{width:"narrow",context:"formatting"});case"eeeeee":return d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"});case"eeee":default:return d.day(r,{width:"wide",context:"formatting"})||d.day(r,{width:"abbreviated",context:"formatting"})||d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"})}}validate(r,a){return a>=0&&a<=6}set(r,a,d,y){return r=xp(r,d,y),r.setHours(0,0,0,0),r}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","c","t","T"]}class X1 extends Wt{priority=90;parse(r,a,d,y){const S=x=>{const u=Math.floor((x-1)/7)*7;return(x+y.weekStartsOn+6)%7+u};switch(a){case"c":case"cc":return Pi(Si(a.length,r),S);case"co":return Pi(d.ordinalNumber(r,{unit:"day"}),S);case"ccc":return d.day(r,{width:"abbreviated",context:"standalone"})||d.day(r,{width:"short",context:"standalone"})||d.day(r,{width:"narrow",context:"standalone"});case"ccccc":return d.day(r,{width:"narrow",context:"standalone"});case"cccccc":return d.day(r,{width:"short",context:"standalone"})||d.day(r,{width:"narrow",context:"standalone"});case"cccc":default:return d.day(r,{width:"wide",context:"standalone"})||d.day(r,{width:"abbreviated",context:"standalone"})||d.day(r,{width:"short",context:"standalone"})||d.day(r,{width:"narrow",context:"standalone"})}}validate(r,a){return a>=0&&a<=6}set(r,a,d,y){return r=xp(r,d,y),r.setHours(0,0,0,0),r}incompatibleTokens=["y","R","u","q","Q","M","L","I","d","D","E","i","e","t","T"]}function Y1(p,r,a){const d=Mi(p,a?.in),y=S1(d,a),S=r-y;return p_(d,S,a)}class K1 extends Wt{priority=90;parse(r,a,d){const y=S=>S===0?7:S;switch(a){case"i":case"ii":return Si(a.length,r);case"io":return d.ordinalNumber(r,{unit:"day"});case"iii":return Pi(d.day(r,{width:"abbreviated",context:"formatting"})||d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"}),y);case"iiiii":return Pi(d.day(r,{width:"narrow",context:"formatting"}),y);case"iiiiii":return Pi(d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"}),y);case"iiii":default:return Pi(d.day(r,{width:"wide",context:"formatting"})||d.day(r,{width:"abbreviated",context:"formatting"})||d.day(r,{width:"short",context:"formatting"})||d.day(r,{width:"narrow",context:"formatting"}),y)}}validate(r,a){return a>=1&&a<=7}set(r,a,d){return r=Y1(r,d),r.setHours(0,0,0,0),r}incompatibleTokens=["y","Y","u","q","Q","M","L","w","d","D","E","e","c","t","T"]}class J1 extends Wt{priority=80;parse(r,a,d){switch(a){case"a":case"aa":case"aaa":return d.dayPeriod(r,{width:"abbreviated",context:"formatting"})||d.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaaa":return d.dayPeriod(r,{width:"narrow",context:"formatting"});case"aaaa":default:return d.dayPeriod(r,{width:"wide",context:"formatting"})||d.dayPeriod(r,{width:"abbreviated",context:"formatting"})||d.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,a,d){return r.setHours(vp(d),0,0,0),r}incompatibleTokens=["b","B","H","k","t","T"]}class Q1 extends Wt{priority=80;parse(r,a,d){switch(a){case"b":case"bb":case"bbb":return d.dayPeriod(r,{width:"abbreviated",context:"formatting"})||d.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbbb":return d.dayPeriod(r,{width:"narrow",context:"formatting"});case"bbbb":default:return d.dayPeriod(r,{width:"wide",context:"formatting"})||d.dayPeriod(r,{width:"abbreviated",context:"formatting"})||d.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,a,d){return r.setHours(vp(d),0,0,0),r}incompatibleTokens=["a","B","H","k","t","T"]}class ew extends Wt{priority=80;parse(r,a,d){switch(a){case"B":case"BB":case"BBB":return d.dayPeriod(r,{width:"abbreviated",context:"formatting"})||d.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBBB":return d.dayPeriod(r,{width:"narrow",context:"formatting"});case"BBBB":default:return d.dayPeriod(r,{width:"wide",context:"formatting"})||d.dayPeriod(r,{width:"abbreviated",context:"formatting"})||d.dayPeriod(r,{width:"narrow",context:"formatting"})}}set(r,a,d){return r.setHours(vp(d),0,0,0),r}incompatibleTokens=["a","b","t","T"]}class tw extends Wt{priority=70;parse(r,a,d){switch(a){case"h":return vi(Ei.hour12h,r);case"ho":return d.ordinalNumber(r,{unit:"hour"});default:return Si(a.length,r)}}validate(r,a){return a>=1&&a<=12}set(r,a,d){const y=r.getHours()>=12;return y&&d<12?r.setHours(d+12,0,0,0):!y&&d===12?r.setHours(0,0,0,0):r.setHours(d,0,0,0),r}incompatibleTokens=["H","K","k","t","T"]}class iw extends Wt{priority=70;parse(r,a,d){switch(a){case"H":return vi(Ei.hour23h,r);case"Ho":return d.ordinalNumber(r,{unit:"hour"});default:return Si(a.length,r)}}validate(r,a){return a>=0&&a<=23}set(r,a,d){return r.setHours(d,0,0,0),r}incompatibleTokens=["a","b","h","K","k","t","T"]}class nw extends Wt{priority=70;parse(r,a,d){switch(a){case"K":return vi(Ei.hour11h,r);case"Ko":return d.ordinalNumber(r,{unit:"hour"});default:return Si(a.length,r)}}validate(r,a){return a>=0&&a<=11}set(r,a,d){return r.getHours()>=12&&d<12?r.setHours(d+12,0,0,0):r.setHours(d,0,0,0),r}incompatibleTokens=["h","H","k","t","T"]}class rw extends Wt{priority=70;parse(r,a,d){switch(a){case"k":return vi(Ei.hour24h,r);case"ko":return d.ordinalNumber(r,{unit:"hour"});default:return Si(a.length,r)}}validate(r,a){return a>=1&&a<=24}set(r,a,d){const y=d<=24?d%24:d;return r.setHours(y,0,0,0),r}incompatibleTokens=["a","b","h","H","K","t","T"]}class sw extends Wt{priority=60;parse(r,a,d){switch(a){case"m":return vi(Ei.minute,r);case"mo":return d.ordinalNumber(r,{unit:"minute"});default:return Si(a.length,r)}}validate(r,a){return a>=0&&a<=59}set(r,a,d){return r.setMinutes(d,0,0),r}incompatibleTokens=["t","T"]}class ow extends Wt{priority=50;parse(r,a,d){switch(a){case"s":return vi(Ei.second,r);case"so":return d.ordinalNumber(r,{unit:"second"});default:return Si(a.length,r)}}validate(r,a){return a>=0&&a<=59}set(r,a,d){return r.setSeconds(d,0),r}incompatibleTokens=["t","T"]}class aw extends Wt{priority=30;parse(r,a){const d=y=>Math.trunc(y*Math.pow(10,-a.length+3));return Pi(Si(a.length,r),d)}set(r,a,d){return r.setMilliseconds(d),r}incompatibleTokens=["t","T"]}class lw extends Wt{priority=10;parse(r,a){switch(a){case"X":return qr(jr.basicOptionalMinutes,r);case"XX":return qr(jr.basic,r);case"XXXX":return qr(jr.basicOptionalSeconds,r);case"XXXXX":return qr(jr.extendedOptionalSeconds,r);case"XXX":default:return qr(jr.extended,r)}}set(r,a,d){return a.timestampIsSet?r:Ni(r,r.getTime()-fh(r)-d)}incompatibleTokens=["t","T","x"]}class cw extends Wt{priority=10;parse(r,a){switch(a){case"x":return qr(jr.basicOptionalMinutes,r);case"xx":return qr(jr.basic,r);case"xxxx":return qr(jr.basicOptionalSeconds,r);case"xxxxx":return qr(jr.extendedOptionalSeconds,r);case"xxx":default:return qr(jr.extended,r)}}set(r,a,d){return a.timestampIsSet?r:Ni(r,r.getTime()-fh(r)-d)}incompatibleTokens=["t","T","X"]}class uw extends Wt{priority=40;parse(r){return f_(r)}set(r,a,d){return[Ni(r,d*1e3),{timestampIsSet:!0}]}incompatibleTokens="*"}class hw extends Wt{priority=20;parse(r){return f_(r)}set(r,a,d){return[Ni(r,d),{timestampIsSet:!0}]}incompatibleTokens="*"}const dw={G:new k1,y:new A1,Y:new z1,R:new D1,u:new L1,Q:new R1,q:new B1,M:new F1,L:new O1,w:new V1,I:new $1,d:new H1,D:new W1,E:new Z1,e:new G1,c:new X1,i:new K1,a:new J1,b:new Q1,B:new ew,h:new tw,H:new iw,K:new nw,k:new rw,m:new sw,s:new ow,S:new aw,X:new lw,x:new cw,t:new uw,T:new hw},pw=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,mw=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,fw=/^'([^]*?)'?$/,gw=/''/g,_w=/\S/,yw=/[a-zA-Z]/;function jf(p,r,a,d){const y=()=>Ni(a,NaN),S=C1(),x=S.locale??e_,u=S.firstWeekContainsDate??S.locale?.options?.firstWeekContainsDate??1,O=S.weekStartsOn??S.locale?.options?.weekStartsOn??0,V={firstWeekContainsDate:u,weekStartsOn:O,locale:x},W=[new M1(d?.in,a)],q=r.match(mw).map(ve=>{const Ce=ve[0];if(Ce in tp){const je=tp[Ce];return je(ve,x.formatLong)}return ve}).join("").match(pw),F=[];for(let ve of q){o_(ve)&&ip(ve,r,p),s_(ve)&&ip(ve,r,p);const Ce=ve[0],je=dw[Ce];if(je){const{incompatibleTokens:st}=je;if(Array.isArray(st)){const qe=F.find(ct=>st.includes(ct.token)||ct.token===Ce);if(qe)throw new RangeError(`The format string mustn't contain \`${qe.fullToken}\` and \`${ve}\` at the same time`)}else if(je.incompatibleTokens==="*"&&F.length>0)throw new RangeError(`The format string mustn't contain \`${ve}\` and any other token at the same time`);F.push({token:Ce,fullToken:ve});const Qe=je.run(p,ve,x.match,V);if(!Qe)return y();W.push(Qe.setter),p=Qe.rest}else{if(Ce.match(yw))throw new RangeError("Format string contains an unescaped latin alphabet character `"+Ce+"`");if(ve==="''"?ve="'":Ce==="'"&&(ve=vw(ve)),p.indexOf(ve)===0)p=p.slice(ve.length);else return y()}}if(p.length>0&&_w.test(p))return y();const oe=W.map(ve=>ve.priority).sort((ve,Ce)=>Ce-ve).filter((ve,Ce,je)=>je.indexOf(ve)===Ce).map(ve=>W.filter(Ce=>Ce.priority===ve).sort((Ce,je)=>je.subPriority-Ce.subPriority)).map(ve=>ve[0]);let ie=Mi(a,d?.in);if(isNaN(+ie))return y();const pe={};for(const ve of oe){if(!ve.validate(ie,V))return y();const Ce=ve.set(ie,pe,V);Array.isArray(Ce)?(ie=Ce[0],Object.assign(pe,Ce[1])):ie=Ce}return ie}function vw(p){return p.match(fw)[1].replace(gw,"'")}var xw=Ht('<div class="t-center text-white p-2 overflow-auto h-full w-full"><div class="border-b border-white">Kondisi Udara Terkini</div><div class="flex flex-row">'),bw=Ht("<div>Tidak Tersedia"),ww=Ht("<div>"),Cw=Ht('<div class="flex flex-col px-2"><!$><!/><div class="border border-white rounded-md p-2"><img class="p-2 h-20"src=images/air.png><div class="bg-[#26FF2633] px-2 rounded-sm shadow-md">Fair?</div><div class="flex flex-row py-1"><div class=flex-1>CO<sup>2</sup></div><div class="border border-white rounded-md flex-1"></div></div><div class="flex flex-row py-1"><div class=flex-1>LPG</div><div class="border border-white rounded-md flex-1">'),Sw=Ht('<div class="flex flex-row"><div class="flex-1 pr-2">Now</div><div>');function Iw(p){const r=yl(),a=r?.ctx.aqiUpdateAll,d=r?.ctx.aqiSelectedLocation;return(()=>{var y=jt(xw),S=y.firstChild,x=S.nextSibling;return bt(x,Ye(cg,{get each(){return Ot(()=>!!(a.val()&&d.val()&&a.val()[d.val().name]))()?a.val()[d.val().name]:[]},get fallback(){return jt(bw)},children:(u,O)=>(()=>{var V=jt(Cw),W=V.firstChild,[q,F]=Sn(W.nextSibling),oe=q.nextSibling,ie=oe.firstChild,pe=ie.nextSibling,ve=pe.nextSibling,Ce=ve.firstChild,je=Ce.nextSibling,st=ve.nextSibling,Qe=st.firstChild,qe=Qe.nextSibling;return bt(V,Ye(Pr,{get when(){return O()},get fallback(){return(()=>{var ct=jt(Sw),We=ct.firstChild,It=We.nextSibling;return bt(It,()=>np(jf(u.period,"yyyy-MM-dd HH:mm:ss",new Date),"HH:mm:ss")),ct})()},get children(){var ct=jt(ww);return bt(ct,()=>np(jf(u.period,"yyyy-MM-dd HH:mm:ss",new Date),"HH:mm:ss")),ct}}),q,F),bt(je,()=>u.co2),bt(qe,()=>u.lpg),V})()})),y})()}var Tw=Ht('<div class="t-center text-white h-full flex flex-col"><div>MQ-135</div><div>Level Udara <!$><!/></div><!$><!/>'),Ew=Ht('<div class="flex-1 flex flex-row justify-center items-center">Tidak Tersedia');const Pw=I0(()=>S0(()=>import("./EChartsComponent-Dri_4RWG.js"),__vite__mapDeps([0,1])));function qf(p){const r=yl(),a=r?.ctx.aqiUpdateAll,d=r?.ctx.aqiSelectedLocation,y=p.jenis.toLowerCase();return(()=>{var S=jt(Tw),x=S.firstChild,u=x.nextSibling,O=u.firstChild,V=O.nextSibling,[W,q]=Sn(V.nextSibling),F=u.nextSibling,[oe,ie]=Sn(F.nextSibling);return bt(u,()=>p.jenis,W,q),bt(S,Ye(Pr,{get when(){return Ot(()=>!!(a.val()&&d.val()))()&&a.val()[d.val()?.name]},get fallback(){return jt(Ew)},get children(){return Ye(Pw,{get xdata(){return a.val()[d.val()?.name].map(pe=>pe[y]).slice(0,7)},get xlabels(){return a.val()[d.val()?.name].map(pe=>pe.period).slice(0,7)}})}}),oe,ie),S})()}var Mw=Ht('<section id=bodySection><section id=controls><section id=registerSection><section id=registerNotVirtualSection><button id=registerNotVirtualButton class=control>Register Component Types</button><section id=registerNotVirtualRadioSection class=radioLine><section class=labelledRadio><input id=registerNotVirtualAllRadio class=control type=radio name=registerNotVirtualRadio><label for=registerNotVirtualAllRadio>All</label></section><section class=labelledRadio><input id=registerNotVirtualColorEventRadio class=control type=radio name=registerNotVirtualRadio checked><label for=registerVirtualColorEventRadio>Color, Event</label></section></section></section><section id=registerVirtualSection><button id=registerVirtualButton class=control>Register Component Types As Virtual</button><section id=registerVirtualRadioSection class=radioLine><section class=labelledRadio><input id=registerVirtualAllRadio type=radio name=registerVirtualRadio><label for=registerVirtualAllRadio>All</label></section><section class=labelledRadio><input id=registerVirtualTextBooleanRadio type=radio name=registerVirtualRadio checked><label for=registerVirtualTextBooleanRadio>Text, Boolean</label></section></section></section></section><section id=eventBindingSection><span id=eventBindingSpan title="Layout will be cleared">Event Binding:</span><section id=eventBindingRadios class=radioLine><section class=labelledRadio><input id=eventBindingVirtualRadio class=control type=radio name=eventBindingRadio title="Layout will be cleared"><label for=eventBindingVirtualRadio>Virtual</label></section><section class=labelledRadio><input id=eventBindingEmbeddedRadio class=control type=radio name=eventBindingRadio title="Layout will be cleared"><label for=eventBindingEmbeddedRadio>Embedded</label></section></section></section><section id=clearSection><button id=clearButton class=control>Clear</button></section><section id=predefinedLayoutsSection><select id=layoutSelect class=control></select><button id=loadLayoutButton class=control>Load Layout</button></section><section id=saveAndReloadLayoutSection><button id=saveLayoutButton class=control>Save Layout</button><button id=reloadSavedLayoutButton class=control>Reload saved Layout</button></section><section id=addComponentSection><select id=registeredComponentTypesForAddSelect class=control></select><button id=addComponentByDragButton class=control>D</button><button id=addComponentButton class=control>Add Component</button></section><section id=rootComponentSection><button id=loadComponentAsRootButton class=control>Load Component as Root</button></section><section id=replaceComponentSection><select id=registeredComponentTypesForReplaceSelect class=control></select><button id=replaceComponentButton class=control>Replace Color Component with</button></section><section id=lastVirtualRectingCountSection><span>Last virtual recting count</span><span id=lastVirtualRectingCountSpan></span></section><section id=clickCount><span>Click count: Capture: </span><span id=captureClickCountSpan></span><span> Bubble: </span><span id=bubbleClickCountSpan></span></section><section id=stackHeaderClick><span>Stack Header: </span><div id=stackHeaderClickedDiv><span>Clicked: </span><span id=stackHeaderClickedItemCountSpan></span></div></section></section><div class="layout-container-wrapper px-2 py-2 md:pt-8 md:pb-20 md:px-48 w-full h-[100dvh]"><section id=layoutContainer>');const kw=()=>{const p=vl;let r;const a=yl();yo(()=>{console.log("Loaded",p),r=new vv([Ye(Ux,{}),Ye(Nx,{aqiCtx:a}),Ye(a1,{aqiCtx:a}),Ye(w1,{aqiCtx:a}),Ye(Iw,{aqiCtx:a}),Ye(qf,{jenis:"CO2",aqiCtx:a}),Ye(qf,{jenis:"LPG",aqiCtx:a}),()=>Ye(bv,{})],{useVirtualEventBinding:!0}),window.goldenLayoutApiTestApp=r,r.start(),d()});const d=()=>{!window.location.search.includes("gl-window")&&r.goldenLoadPredefinedLayout("miniRow")};return jt(Mw)};function y_(p,r){p.indexOf(r)===-1&&p.push(r)}function Aw(p,r){const a=p.indexOf(r);a>-1&&p.splice(a,1)}const v_=(p,r,a)=>Math.min(Math.max(a,p),r),Er={duration:.3,delay:0,endDelay:0,repeat:0,easing:"ease"},Yc=p=>typeof p=="number",ul=p=>Array.isArray(p)&&!Yc(p[0]),zw=(p,r,a)=>{const d=r-p;return((a-p)%d+d)%d+p};function Dw(p,r){return ul(p)?p[zw(0,p.length,r)]:p}const x_=(p,r,a)=>-a*p+a*r+p,b_=()=>{},co=p=>p,bp=(p,r,a)=>r-p===0?1:(a-p)/(r-p);function w_(p,r){const a=p[p.length-1];for(let d=1;d<=r;d++){const y=bp(0,r,d);p.push(x_(a,1,y))}}function Lw(p){const r=[0];return w_(r,p-1),r}function Rw(p,r=Lw(p.length),a=co){const d=p.length,y=d-r.length;return y>0&&w_(r,y),S=>{let x=0;for(;x<d-2&&!(S<r[x+1]);x++);let u=v_(0,1,bp(r[x],r[x+1],S));return u=Dw(a,x)(u),x_(p[x],p[x+1],u)}}const C_=p=>Array.isArray(p)&&Yc(p[0]),rp=p=>typeof p=="object"&&!!p.createAnimation,Kc=p=>typeof p=="function",Bw=p=>typeof p=="string",Wd={ms:p=>p*1e3,s:p=>p/1e3},S_=(p,r,a)=>(((1-3*a+3*r)*p+(3*a-6*r))*p+3*r)*p,Fw=1e-7,Ow=12;function Nw(p,r,a,d,y){let S,x,u=0;do x=r+(a-r)/2,S=S_(x,d,y)-p,S>0?a=x:r=x;while(Math.abs(S)>Fw&&++u<Ow);return x}function Bc(p,r,a,d){if(p===r&&a===d)return co;const y=S=>Nw(S,0,1,p,a);return S=>S===0||S===1?S:S_(y(S),r,d)}const Vw=(p,r="end")=>a=>{a=r==="end"?Math.min(a,.999):Math.max(a,.001);const d=a*p,y=r==="end"?Math.floor(d):Math.ceil(d);return v_(0,1,y/p)},Uw={ease:Bc(.25,.1,.25,1),"ease-in":Bc(.42,0,1,1),"ease-in-out":Bc(.42,0,.58,1),"ease-out":Bc(0,0,.58,1)},$w=/\((.*?)\)/;function Hf(p){if(Kc(p))return p;if(C_(p))return Bc(...p);const r=Uw[p];if(r)return r;if(p.startsWith("steps")){const a=$w.exec(p);if(a){const d=a[1].split(",");return Vw(parseFloat(d[0]),d[1].trim())}}return co}class jw{constructor(r,a=[0,1],{easing:d,duration:y=Er.duration,delay:S=Er.delay,endDelay:x=Er.endDelay,repeat:u=Er.repeat,offset:O,direction:V="normal",autoplay:W=!0}={}){if(this.startTime=null,this.rate=1,this.t=0,this.cancelTimestamp=null,this.easing=co,this.duration=0,this.totalDuration=0,this.repeat=0,this.playState="idle",this.finished=new Promise((F,oe)=>{this.resolve=F,this.reject=oe}),d=d||Er.easing,rp(d)){const F=d.createAnimation(a);d=F.easing,a=F.keyframes||a,y=F.duration||y}this.repeat=u,this.easing=ul(d)?co:Hf(d),this.updateDuration(y);const q=Rw(a,O,ul(d)?d.map(Hf):co);this.tick=F=>{var oe;S=S;let ie=0;this.pauseTime!==void 0?ie=this.pauseTime:ie=(F-this.startTime)*this.rate,this.t=ie,ie/=1e3,ie=Math.max(ie-S,0),this.playState==="finished"&&this.pauseTime===void 0&&(ie=this.totalDuration);const pe=ie/this.duration;let ve=Math.floor(pe),Ce=pe%1;!Ce&&pe>=1&&(Ce=1),Ce===1&&ve--;const je=ve%2;(V==="reverse"||V==="alternate"&&je||V==="alternate-reverse"&&!je)&&(Ce=1-Ce);const st=ie>=this.totalDuration?1:Math.min(Ce,1),Qe=q(this.easing(st));r(Qe),this.pauseTime===void 0&&(this.playState==="finished"||ie>=this.totalDuration+x)?(this.playState="finished",(oe=this.resolve)===null||oe===void 0||oe.call(this,Qe)):this.playState!=="idle"&&(this.frameRequestId=requestAnimationFrame(this.tick))},W&&this.play()}play(){const r=performance.now();this.playState="running",this.pauseTime!==void 0?this.startTime=r-this.pauseTime:this.startTime||(this.startTime=r),this.cancelTimestamp=this.startTime,this.pauseTime=void 0,this.frameRequestId=requestAnimationFrame(this.tick)}pause(){this.playState="paused",this.pauseTime=this.t}finish(){this.playState="finished",this.tick(0)}stop(){var r;this.playState="idle",this.frameRequestId!==void 0&&cancelAnimationFrame(this.frameRequestId),(r=this.reject)===null||r===void 0||r.call(this,!1)}cancel(){this.stop(),this.tick(this.cancelTimestamp)}reverse(){this.rate*=-1}commitStyles(){}updateDuration(r){this.duration=r,this.totalDuration=r*(this.repeat+1)}get currentTime(){return this.t}set currentTime(r){this.pauseTime!==void 0||this.rate===0?this.pauseTime=r:this.startTime=performance.now()-r/this.rate}get playbackRate(){return this.rate}set playbackRate(r){this.rate=r}}class qw{setAnimation(r){this.animation=r,r?.finished.then(()=>this.clearAnimation()).catch(()=>{})}clearAnimation(){this.animation=this.generator=void 0}}const Zd=new WeakMap;function I_(p){return Zd.has(p)||Zd.set(p,{transforms:[],values:new Map}),Zd.get(p)}function Hw(p,r){return p.has(r)||p.set(r,new qw),p.get(r)}const Ww=["","X","Y","Z"],Zw=["translate","scale","rotate","skew"],gl={x:"translateX",y:"translateY",z:"translateZ"},Wf={syntax:"<angle>",initialValue:"0deg",toDefaultUnit:p=>p+"deg"},Gw={translate:{syntax:"<length-percentage>",initialValue:"0px",toDefaultUnit:p=>p+"px"},rotate:Wf,scale:{syntax:"<number>",initialValue:1,toDefaultUnit:co},skew:Wf},_l=new Map,Ch=p=>`--motion-${p}`,_h=["x","y","z"];Zw.forEach(p=>{Ww.forEach(r=>{_h.push(p+r),_l.set(Ch(p+r),Gw[p])})});const Xw=(p,r)=>_h.indexOf(p)-_h.indexOf(r),Yw=new Set(_h),wp=p=>Yw.has(p),Kw=(p,r)=>{gl[r]&&(r=gl[r]);const{transforms:a}=I_(p);y_(a,r),p.style.transform=T_(a)},T_=p=>p.sort(Xw).reduce(Jw,"").trim(),Jw=(p,r)=>`${p} ${r}(var(${Ch(r)}))`,sp=p=>p.startsWith("--"),Zf=new Set;function Qw(p){if(!Zf.has(p)){Zf.add(p);try{const{syntax:r,initialValue:a}=_l.has(p)?_l.get(p):{};CSS.registerProperty({name:p,inherits:!1,syntax:r,initialValue:a})}catch{}}}const Gd=(p,r)=>document.createElement("div").animate(p,r),Gf={cssRegisterProperty:()=>typeof CSS<"u"&&Object.hasOwnProperty.call(CSS,"registerProperty"),waapi:()=>Object.hasOwnProperty.call(Element.prototype,"animate"),partialKeyframes:()=>{try{Gd({opacity:[1]})}catch{return!1}return!0},finished:()=>!!Gd({opacity:[0,1]},{duration:.001}).finished,linearEasing:()=>{try{Gd({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0}},Xd={},cl={};for(const p in Gf)cl[p]=()=>(Xd[p]===void 0&&(Xd[p]=Gf[p]()),Xd[p]);const e2=.015,t2=(p,r)=>{let a="";const d=Math.round(r/e2);for(let y=0;y<d;y++)a+=p(bp(0,d-1,y))+", ";return a.substring(0,a.length-2)},Xf=(p,r)=>Kc(p)?cl.linearEasing()?`linear(${t2(p,r)})`:Er.easing:C_(p)?i2(p):p,i2=([p,r,a,d])=>`cubic-bezier(${p}, ${r}, ${a}, ${d})`;function n2(p,r){for(let a=0;a<p.length;a++)p[a]===null&&(p[a]=a?p[a-1]:r());return p}const r2=p=>Array.isArray(p)?p:[p];function op(p){return gl[p]&&(p=gl[p]),wp(p)?Ch(p):p}const Fc={get:(p,r)=>{r=op(r);let a=sp(r)?p.style.getPropertyValue(r):getComputedStyle(p)[r];if(!a&&a!==0){const d=_l.get(r);d&&(a=d.initialValue)}return a},set:(p,r,a)=>{r=op(r),sp(r)?p.style.setProperty(r,a):p.style[r]=a}};function s2(p,r=!0){if(!(!p||p.playState==="finished"))try{p.stop?p.stop():(r&&p.commitStyles(),p.cancel())}catch{}}function o2(p,r){var a;let d=r?.toDefaultUnit||co;const y=p[p.length-1];if(Bw(y)){const S=((a=y.match(/(-?[\d.]+)([a-z%]*)/))===null||a===void 0?void 0:a[2])||"";S&&(d=x=>x+S)}return d}function a2(){return window.__MOTION_DEV_TOOLS_RECORD}function l2(p,r,a,d={},y){const S=a2(),x=d.record!==!1&&S;let u,{duration:O=Er.duration,delay:V=Er.delay,endDelay:W=Er.endDelay,repeat:q=Er.repeat,easing:F=Er.easing,persist:oe=!1,direction:ie,offset:pe,allowWebkitAcceleration:ve=!1,autoplay:Ce=!0}=d;const je=I_(p),st=wp(r);let Qe=cl.waapi();st&&Kw(p,r);const qe=op(r),ct=Hw(je.values,qe),We=_l.get(qe);return s2(ct.animation,!(rp(F)&&ct.generator)&&d.record!==!1),()=>{const It=()=>{var tt,oi;return(oi=(tt=Fc.get(p,qe))!==null&&tt!==void 0?tt:We?.initialValue)!==null&&oi!==void 0?oi:0};let Ve=n2(r2(a),It);const pi=o2(Ve,We);if(rp(F)){const tt=F.createAnimation(Ve,r!=="opacity",It,qe,ct);F=tt.easing,Ve=tt.keyframes||Ve,O=tt.duration||O}if(sp(qe)&&(cl.cssRegisterProperty()?Qw(qe):Qe=!1),st&&!cl.linearEasing()&&(Kc(F)||ul(F)&&F.some(Kc))&&(Qe=!1),Qe){We&&(Ve=Ve.map(St=>Yc(St)?We.toDefaultUnit(St):St)),Ve.length===1&&(!cl.partialKeyframes()||x)&&Ve.unshift(It());const tt={delay:Wd.ms(V),duration:Wd.ms(O),endDelay:Wd.ms(W),easing:ul(F)?void 0:Xf(F,O),direction:ie,iterations:q+1,fill:"both"};u=p.animate({[qe]:Ve,offset:pe,easing:ul(F)?F.map(St=>Xf(St,O)):void 0},tt),u.finished||(u.finished=new Promise((St,Zt)=>{u.onfinish=St,u.oncancel=Zt}));const oi=Ve[Ve.length-1];u.finished.then(()=>{oe||(Fc.set(p,qe,oi),u.cancel())}).catch(b_),ve||(u.playbackRate=1.000001)}else if(y&&st)Ve=Ve.map(tt=>typeof tt=="string"?parseFloat(tt):tt),Ve.length===1&&Ve.unshift(parseFloat(It())),u=new y(tt=>{Fc.set(p,qe,pi?pi(tt):tt)},Ve,Object.assign(Object.assign({},d),{duration:O,easing:F}));else{const tt=Ve[Ve.length-1];Fc.set(p,qe,We&&Yc(tt)?We.toDefaultUnit(tt):tt)}return x&&S(p,r,Ve,{duration:O,delay:V,easing:F,repeat:q,offset:pe},"motion-one"),ct.setAnimation(u),u&&!Ce&&u.pause(),u}}const c2=(p,r)=>p[r]?Object.assign(Object.assign({},p),p[r]):Object.assign({},p);function u2(p,r){return typeof p=="string"?p=document.querySelectorAll(p):p instanceof Element&&(p=[p]),Array.from(p||[])}function E_(p,r){var a={};for(var d in p)Object.prototype.hasOwnProperty.call(p,d)&&r.indexOf(d)<0&&(a[d]=p[d]);if(p!=null&&typeof Object.getOwnPropertySymbols=="function")for(var y=0,d=Object.getOwnPropertySymbols(p);y<d.length;y++)r.indexOf(d[y])<0&&Object.prototype.propertyIsEnumerable.call(p,d[y])&&(a[d[y]]=p[d[y]]);return a}const h2={any:0,all:1};function d2(p,r,{root:a,margin:d,amount:y="any"}={}){if(typeof IntersectionObserver>"u")return()=>{};const S=u2(p),x=new WeakMap,u=V=>{V.forEach(W=>{const q=x.get(W.target);if(W.isIntersecting!==!!q)if(W.isIntersecting){const F=r(W);Kc(F)?x.set(W.target,F):O.unobserve(W.target)}else q&&(q(W),x.delete(W.target))})},O=new IntersectionObserver(u,{root:a,rootMargin:d,threshold:typeof y=="number"?y:h2[y]});return S.forEach(V=>O.observe(V)),()=>O.disconnect()}function p2(p,r){return typeof p!=typeof r?!0:Array.isArray(p)&&Array.isArray(r)?!m2(p,r):p!==r}function m2(p,r){const a=r.length;if(a!==p.length)return!1;for(let d=0;d<a;d++)if(r[d]!==p[d])return!1;return!0}function f2(p){return typeof p=="object"}function Yf(p,r){if(f2(p))return p;if(p&&r)return r[p]}let uo;function g2(){if(!uo)return;const p=uo.sort(y2).map(v2);p.forEach(Kf),p.forEach(Kf),uo=void 0}function Yd(p){uo?y_(uo,p):(uo=[p],requestAnimationFrame(g2))}function _2(p){uo&&Aw(uo,p)}const y2=(p,r)=>p.getDepth()-r.getDepth(),v2=p=>p.animateUpdates(),Kf=p=>p.next(),Jf=(p,r)=>new CustomEvent(p,{detail:{target:r}});function ap(p,r,a){p.dispatchEvent(new CustomEvent(r,{detail:{originalEvent:a}}))}function Qf(p,r,a){p.dispatchEvent(new CustomEvent(r,{detail:{originalEntry:a}}))}const x2={isActive:p=>!!p.inView,subscribe:(p,{enable:r,disable:a},{inViewOptions:d={}})=>{const{once:y}=d,S=E_(d,["once"]);return d2(p,x=>{if(r(),Qf(p,"viewenter",x),!y)return u=>{a(),Qf(p,"viewleave",u)}},S)}},eg=(p,r,a)=>d=>{d.pointerType&&d.pointerType!=="mouse"||(a(),ap(p,r,d))},b2={isActive:p=>!!p.hover,subscribe:(p,{enable:r,disable:a})=>{const d=eg(p,"hoverstart",r),y=eg(p,"hoverend",a);return p.addEventListener("pointerenter",d),p.addEventListener("pointerleave",y),()=>{p.removeEventListener("pointerenter",d),p.removeEventListener("pointerleave",y)}}},w2={isActive:p=>!!p.press,subscribe:(p,{enable:r,disable:a})=>{const d=S=>{a(),ap(p,"pressend",S),window.removeEventListener("pointerup",d)},y=S=>{r(),ap(p,"pressstart",S),window.addEventListener("pointerup",d)};return p.addEventListener("pointerdown",y),()=>{p.removeEventListener("pointerdown",y),window.removeEventListener("pointerup",d)}}},lh={inView:x2,hover:b2,press:w2},tg=["initial","animate",...Object.keys(lh),"exit"],ig=new WeakMap;function C2(p={},r){let a,d=r?r.getDepth()+1:0;const y={initial:!0,animate:!0},S={},x={};for(const pe of tg)x[pe]=typeof p[pe]=="string"?p[pe]:r?.getContext()[pe];const u=p.initial===!1?"animate":"initial";let O=Yf(p[u]||x[u],p.variants)||{},V=E_(O,["transition"]);const W=Object.assign({},V);function*q(){var pe,ve;const Ce=V;V={};const je={};for(const We of tg){if(!y[We])continue;const It=Yf(p[We]);if(It)for(const Ve in It)Ve!=="transition"&&(V[Ve]=It[Ve],je[Ve]=c2((ve=(pe=It.transition)!==null&&pe!==void 0?pe:p.transition)!==null&&ve!==void 0?ve:{},Ve))}const st=new Set([...Object.keys(V),...Object.keys(Ce)]),Qe=[];st.forEach(We=>{var It;V[We]===void 0&&(V[We]=W[We]),p2(Ce[We],V[We])&&((It=W[We])!==null&&It!==void 0||(W[We]=Fc.get(a,We)),Qe.push(l2(a,We,V[We],je[We],jw)))}),yield;const qe=Qe.map(We=>We()).filter(Boolean);if(!qe.length)return;const ct=V;a.dispatchEvent(Jf("motionstart",ct)),Promise.all(qe.map(We=>We.finished)).then(()=>{a.dispatchEvent(Jf("motioncomplete",ct))}).catch(b_)}const F=(pe,ve)=>()=>{y[pe]=ve,Yd(ie)},oe=()=>{for(const pe in lh){const ve=lh[pe].isActive(p),Ce=S[pe];ve&&!Ce?S[pe]=lh[pe].subscribe(a,{enable:F(pe,!0),disable:F(pe,!1)},p):!ve&&Ce&&(Ce(),delete S[pe])}},ie={update:pe=>{a&&(p=pe,oe(),Yd(ie))},setActive:(pe,ve)=>{a&&(y[pe]=ve,Yd(ie))},animateUpdates:q,getDepth:()=>d,getTarget:()=>V,getOptions:()=>p,getContext:()=>x,mount:pe=>(a=pe,ig.set(a,ie),oe(),()=>{ig.delete(a),_2(ie);for(const ve in S)S[ve]()}),isMounted:()=>!!a};return ie}function S2(p){const r={},a=[];for(let d in p){const y=p[d];wp(d)&&(gl[d]&&(d=gl[d]),a.push(d),d=Ch(d));let S=Array.isArray(y)?y[0]:y;const x=_l.get(d);x&&(S=Yc(y)?x.toDefaultUnit(y):y),r[d]=S}return a.length&&(r.transform=T_(a)),r}var I2=vo();function T2(p,r,a,d){const y=C2(a?.initial===!1?{...r(),initial:!1}:r(),d);return Yt(()=>{if(a&&!a.mount())return;const S=p(),x=y.mount(S);Yt(()=>y.update(r())),si(()=>{a&&r().exit?(y.setActive("exit",!0),S.addEventListener("motioncomplete",x)):x()})}),[y,S2(y.getTarget())]}var E2=["initial","animate","inView","inViewOptions","hover","press","variants","transition","exit"],P2=["tag"],ng=vo(),rg=p=>{const[r,,a]=Xi(p,E2,P2),[d,y]=T2(()=>S,()=>({...r}),ho(I2),ho(ng));let S;return Ye(ng.Provider,{value:d,get children(){return Ye(lg,Li(a,{ref:x=>{S=x,p.ref?.(x)},get component(){return p.tag||"div"},get style(){return pg(p.style,y)}}))}})},M2=new Proxy(rg,{get:(p,r)=>a=>Ye(rg,Li(a,{tag:r}))}),k2=Ht('<main class="bg-tampilan-awal bg-cover">');function z2(){const[p,r]=qt(1e3),a=()=>p,d={ANIMATION_DURATION_SECOND:1,ANIMATION_PAGE_EXIT:{opacity:0},ANIMATION_PAGE_INVIEW:{opacity:1},ANIMATION_PAGE_ANIMATE:{opacity:1},ANIMATION_PAGE_ENTER:{opacity:.1}};return yo(()=>{const y=yl();r(1e3),Uc.externalTimingAPI(S=>{if(S){y?.ctx.lastNavigatorTime.set(performance.now()),y?.ctx.externalDateTimeUTC.set(S.dateTime);const x=Jg(y?.ctx.externalDateTimeUTC.val());console.log("Date is ",S,y?.ctx.lastNavigatorTime.val()),Yg(()=>{const u=performance.now(),O=u-y?.ctx.lastNavigatorTime.val();x.setMilliseconds(x.getMilliseconds()+O),y?.ctx.externalDateTimeUTC.set(x.toISOString()),y?.ctx.lastNavigatorTime.set(u)},a(),setInterval)}})}),si(()=>{r(!1)}),(()=>{var y=jt(k2);return bt(y,Ye(M2,{get initial(){return d.ANIMATION_PAGE_ENTER},get animate(){return d.ANIMATION_PAGE_ANIMATE},get exit(){return d.ANIMATION_PAGE_EXIT},get transition(){return{duration:d.ANIMATION_DURATION_SECOND}},get children(){return Ye(kw,{})}})),y})()}export{z2 as H,xo as m};
